{"version":3,"sources":["qml2js-parser.min.js","/source/qml2js-parser.min.js"],"names":["global","clone","obj","temp","key","is_letter","ch","UNICODE","letter","test","is_digit","charCodeAt","is_alphanumeric_char","is_unicode_combining_mark","non_spacing_mark","space_combining_mark","is_unicode_connector_punctuation","connector_punctuation","is_identifier_start","is_identifier_char","parse_js_number","num","RE_HEX_NUMBER","parseInt","substr","RE_OCT_NUMBER","RE_DEC_NUMBER","parseFloat","JS_Parse_Error","message","line","col","pos","comment","this","ex","stack","js_error","is_token","token","type","val","value","replacerConsoleRange","str","cc","res","i","len","length","cjk","cjk_c","normal_c","repeatString","_str","count","TypeError","RangeError","Infinity","Math","floor","rpt","extractLinesForErrorDiag","code_text","column","options","line_range","codeLines","split","show_line_index","show_start_line","max","show_end_line","index_len","show_code","index","suffix","one_line_code","prefix","tokenizer","$TEXT","peek","S","text","charAt","next","signal_eof","EX_EOF","newline_before","find","what","indexOf","start_token","tokline","tokcol","tokpos","is_comment","regex_allowed","HOP","UNARY_POSTFIX","KEYWORDS_BEFORE_EXPRESSION","PUNC_BEFORE_EXPRESSION","ret","nlb","comments_before","skip_whitespace","WHITESPACE_CHARS","read_while","pred","parse_error","err","read_num","has_e","after_e","has_x","has_dot","valid","isNaN","read_escaped_char","String","fromCharCode","hex_bytes","n","digit","read_string","with_eof_error","quote","read_line_comment","substring","read_multiline_comment","tok","warn","read_name","backslash","name","read_regexp","prev_backslash","regexp","in_class","mods","read_operator","grow","op","bigger","OPERATORS","handle_slash","push","next_token","handle_dot","read_word","word","KEYWORDS","KEYWORDS_ATOM","eof_error","cont","force_regexp","PUNC_CHARS","OPERATOR_CHARS","replace","context","nc","NodeWithToken","start","end","qmlweb_parse","document_type","exigent_mode","embed_tokens","is","peeked","input","prev","croak","msg","ctx","eLine","eCol","token_error","unexpected","expect_token","expect","punc","can_insert_semicolon","semicolon","as","slice","arguments","parenthesised","expression","add_tokens","maybe_embed_tokens","parser","ast","apply","labeled_statement","label","labels","stat","statement","STATEMENTS_WITH_LABELS","pop","simple_statement","prog1","break_cont","member","in_loop","for_","init","var_","for_in","regular_for","step","lhs","if_","belse","cond","body","block_","a","try_","bcatch","bfinally","vardefs","no_in","const_","new_","args","newexp","expr_atom","expr_list","subscripts","closing","allow_trailing_comma","allow_empty","first","array_","from","to","object_","as_property_name","as_name","function_","expr","allow_calls","curry","make_unary","tag","is_assignable","expr_op","left","min_prec","prec","PRECEDENCE","right","expr_ops","maybe_conditional","yes","maybe_assign","ASSIGNMENT","maybe_qmlelem","undefined","qmlblock","qml_is_element","toUpperCase","qmlstatement","qmlpropdef","objName","propName","in_function","qmldefaultprop","qmlsignaldef","propname","onProp","subname","todo","qmlimport","moduleName","isDottedNotation","version","namespace","qmldocument","imports","root","jsdocument","statements","amIn","s","console","log","switch_block_","in_statement","loop","cur","UNARY_PREFIX","ATOMIC_START_TOKEN","atom","commas","JSResource","f","concat","Function","array_to_hash","Array","prototype","call","characters","array","prop","Object","hasOwnProperty","QMLMethod","src","QMLPropertyDefinition","QMLAliasDefinition","objectName","propertyName","QMLSignalDefinition","params","parameters","QMLMetaPropertyGroup","QMLMetaElement","$class","$children","$on","convertToEngine","tree","walk","walker","walkers","bindout","binding","QMLBinding","toplevel","item","$imports","qmlelem","elem","$defaultProperty","qmlprop","qmlobjdef","property","qmlobj","qmlmethod","qmlaliasdef","string","isList","hasBinding","parseQML","parsetree","QmlDocument","ast_walker","_vardefs","defs","MAP","def","_block","out","gen","user","with_walkers","save","block","splice","var","const","try","t","c","throw","new","ctor","switch","branch","break","continue","conditional","e","assign","lvalue","rvalue","dot","function","defun","if","for","for-in","vvar","hash","while","do","return","binary","unary-prefix","unary-postfix","sub","subscript","object","props","p","rx","elements","seq","with","parent","Scope","names","mangled","rev_mangled","cname","refs","uses_with","uses_eval","children","level","ast_add_scope","with_new_scope","current_scope","scope","define","reference","_lambda","is_defun","d","w","having_eval","fixrefs","origin","has","ast_mangle","get_mangled","newMangle","except","get_define","defines","extra","next_mangled","with_scope","_scope","set_mangle","at_top","self","best_of","ast1","ast2","gen_code","last_stat","b","aborts","boolean_expr","make_conditional","make_real_conditional","when_constant","warn_unreachable","empty","is_string","node","prepare_ifs","redo_if","fi","e_body","redo_if_lambda","redo_if_block","for_side_effects","handler","stop","$stop","restart","$restart","found","unary","ast_lift_variables","do_body","env","skip","references","unshift","_toplevel","ast_squeeze","negate","not_c","keep_comps","rmblock","tighten","block_type","reduce","forEach","dead_code","has_quit","st","no_warnings","make_seqs","make_if","make_real_if","tmp","_do_while","defaults","is_identifier","last","make_string","ascii_only","dq","sq","to_ascii","code","toString","encode_string","inline_script","make_name","indent","beautify","repeat_string","indent_start","indentation","indent_level","with_indent","incr","add_spaces","join","add_commas","space","parenthesize","make","el","needs_parens","DOT_CALL_NO_PARENS","make_num","m","toLowerCase","exec","make_then","th","make_block","make_function","keyword","must_has_semicolon","make_block_statements","noindent","make_switch_block","newline","has_body","make_1vardef","quote_keys","space_colon","SPLICE_NEEDS_BRACKETS","tr","ca","has_call","co","func","condition","operator","jsp","stmt","split_lines","max_line_length","splits","parse","current_length","last_split","split_here","custom","prev_token","map","RESERVED_WORDS","construct","meta","component","constructors","qdirInfo","engine","qmldirs","Qt","createComponent","url","createObject","dom","className","id","$context","$basePath","applyProperties","createSimpleProperty","getter","setter","QMLProperty","default","changed","$properties","set","get","readOnly","newVal","$canEditReadOnlyProperties","setupGetterSetter","$isComponentRoot","metaObject","objectScope","componentScope","Signal","compile","eval","fromAnimation","$setCustomData","signalName","connect","j","completed","completedAlreadyCalled","unboundMethod","QMLBaseObject","QObject","$draw","isComponentRoot","Component","completedSignals","destruction","attributes","__proto__","constructor","Keys","asteriskPresed","backPressed","backtabPressed","callPressed","cancelPressed","deletePressed","escapePressed","flipPressed","hangupPressed","leftPressed","menuPressed","noPressed","pressed","released","returnPressed","rightPressed","selectPressed","spacePressed","tabPressed","upPressed","volumeDownPressed","volumeUpPressed","yesPressed","getAttributes","QMLColor","round","QMLContext","nameForObject","QMLComponent","$metaObject","jsImports","finalizeImports","js","importDesc","qmlEngine","qrc","jsparse","getUrlContents","importJavascriptInContext","bind","moduleImports","loadImport","loadImports","QMLInteger","QMLItem","$parent","rootElement","document","innerHTML","style","position","top","overflow","createElement","pointerEvents","qml","css","boxSizing","resources","parentChanged","newParent","oldParent","childrenChanged","removeChild","appendChild","updateHGeometry","updateVGeometry","dataChanged","newData","child","xChanged","yChanged","widthChanged","heightChanged","implicitWidthChanged","implicitHeightChanged","focus","setupFocusOnDom","element","updateFocus","hasFocus","activeElement","firstChild","addEventListener","focusChanged","qmlFocus","activeFocus","getElementsByTagName","rootContext","base","$isUsingImplicitWidth","$isUsingImplicitHeight","anchors","leftChanged","rightChanged","topChanged","bottomChanged","horizontalCenterChanged","verticalCenterChanged","fillChanged","centerInChanged","leftMarginChanged","rightMarginChanged","topMarginChanged","bottomMarginChanged","marginsChanged","stateChanged","oldVal","oldState","newState","k","states","actions","$revertActions","action","target","changes","$getAllChanges","change","$actions","origValue","explicit","restoreEntryValues","transition","rating","transitions","curTransition","curRating","reversible","$start","QMLRotation","getConstructor","QMLScale","QMLTranslate","$updateTransform","transform","rotation","scale","filter","transformStyle","axis","x","y","z","angle","xScale","yScale","transformType","operation","MozTransform","webkitTransform","webkitTransformStyle","OTransform","msTransform","msFilter","webkitFilter","MozFilter","rotationChanged","scaleChanged","transformChanged","visibleChanged","visibility","opacityChanged","opacity","clipChanged","zChanged","width","height","implicitHeight","implicitWidth","spacing","margins","visible","state","window","onresize","innerHeight","innerWidth","offsetHeight","offsetWidth","$drawItem","rotRad","PI","rotOffsetX","sin","rotOffsetY","globalAlpha","translate","rotate","restore","QMLList","list","QMLPositioner","spacingChanged","layoutChildren","slotChildrenChanged","animation","$tidyupList","QMLPropertyChanges","QMLVariant","objectId","objectIds","$delete","$Component","disconnect","$updatingGeometry","hC","lM","leftMargin","rM","rightMargin","fill","isConnected","centerIn","horizontalCenter","u","vC","bottom","tM","topMargin","bM","bottomMargin","verticalCenter","toJSON","deps","JSON","stringify","REGEXP_MODIFIERS","RegExp","char_code","=","QMLDocument","base54","DIGITS","has_mangled","mname","prior","evaluate","$NOT_CONSTANT","no","Error","lval","ex2","AtTop","v","Splice","o","doit","readExports","eatUntil","recursive","matches","semi","matcher","exports","match","skipExceptions","urlContentCache","xhr","XMLHttpRequest","open","send","status","responseText","readQmlDir","makeurl","path","lines","qmldirFileUrl","qmldir","internals","externals","importJs","filename","Easing","Linear","InQuad","OutQuad","InOutQuad","OutInQuad","InCubic","OutCubic","InOutCubic","OutInCubic","InQuart","OutQuart","InOutQuart","OutInQuart","InQuint","OutQuint","InOutQuint","OutInQuint","InSine","OutSine","InOutSine","OutInSine","InExpo","OutExpo","InOutExpo","OutInExpo","InCirc","OutCirc","InOutCirc","OutInCirc","InElastic","OutElastic","InOutElastic","OutInElastic","InBack","OutBack","InOutBack","OutInBack","InBounce","OutBounce","InOutBounce","OutInBounce","Font","MixedCase","AllUppercase","AllLowercase","SmallCaps","Capitalize","Light","Normal","DemiBold","Bold","Black","includesFile","rgba","r","g","openUrlExternally","page","executionContext","components","nameIsUrl","file","moredirs","importPathList","error","extractBasePath","$file","resolvedUrl","removeDotSegments","detectedBasePath","currentCaller","caller","maxcount","LeftButton","RightButton","MiddleButton","NoModifier","ShiftModifier","ControlModifier","AltModifier","MetaModifier","KeypadModifier","LeftToRight","RightToLeft","Vertical","Horizontal","Key_Escape","Key_Tab","Key_Backtab","Key_Backspace","Key_Return","Key_Enter","Key_Insert","Key_Delete","Key_Pause","Key_Print","Key_SysReq","Key_Clear","Key_Home","Key_End","Key_Left","Key_Up","Key_Right","Key_Down","Key_PageUp","Key_PageDown","Key_Shift","Key_Control","Key_Meta","Key_Alt","Key_AltGr","Key_CapsLock","Key_NumLock","Key_ScrollLock","Key_F1","Key_F2","Key_F3","Key_F4","Key_F5","Key_F6","Key_F7","Key_F8","Key_F9","Key_F10","Key_F11","Key_F12","Key_F13","Key_F14","Key_F15","Key_F16","Key_F17","Key_F18","Key_F19","Key_F20","Key_F21","Key_F22","Key_F23","Key_F24","Key_F25","Key_F26","Key_F27","Key_F28","Key_F29","Key_F30","Key_F31","Key_F32","Key_F33","Key_F34","Key_F35","Key_Super_L","Key_Super_R","Key_Menu","Key_Hyper_L","Key_Hyper_R","Key_Help","Key_Direction_L","Key_Direction_R","Key_Space","Key_Any","Key_Exclam","Key_QuoteDbl","Key_NumberSign","Key_Dollar","Key_Percent","Key_Ampersant","Key_Apostrophe","Key_ParenLeft","Key_ParenRight","Key_Asterisk","Key_Plus","Key_Comma","Key_Minus","Key_Period","Key_Slash","Key_0","Key_1","Key_2","Key_3","Key_4","Key_5","Key_6","Key_7","Key_8","Key_9","Key_Colon","Key_Semicolon","Key_Less","Key_Equal","Key_Greater","Key_Question","Key_At","Key_A","Key_B","Key_C","Key_D","Key_E","Key_F","Key_G","Key_H","Key_I","Key_J","Key_K","Key_L","Key_M","Key_N","Key_O","Key_P","Key_Q","Key_R","Key_S","Key_T","Key_U","Key_V","Key_W","Key_X","Key_Y","Key_Z","Key_BracketLeft","Key_Backslash","Key_BracketRight","Key_AsciiCircum","Key_Underscore","Key_QuoteLeft","Key_BraceLeft","Key_Bar","Key_BraceRight","Key_AsciiTilde","Key_Back","Key_Forward","Key_Stop","Key_VolumeDown","Key_VolumeUp","Key_VolumeMute","Key_Yes","Key_multiply","Key_add","Key_substract","Key_divide","Key_News","Key_OfficeHome","Key_Option","Key_Paste","Key_Phone","Key_Calendar","Key_Reply","Key_Reload","Key_RotateWindows","Key_RotationPB","Key_RotationKB","Key_Save","Key_Send","Key_Spell","Key_SplitScreen","Key_Support","Key_TaskPane","Key_Terminal","Key_Tools","Key_Travel","Key_Video","Key_Word","Key_Xfer","Key_ZoomIn","Key_ZoomOut","Key_Away","Key_Messenger","Key_WebCam","Key_MailForward","Key_Pictures","Key_Music","Key_Battery","Key_Bluetooth","Key_WLAN","Key_UWB","Key_AudioForward","Key_AudioRepeat","Key_AudioRandomPlay","Key_Subtitle","Key_AudioCycleTrack","Key_Time","Key_Hibernate","Key_View","Key_TopMenu","Key_PowerDown","Key_Suspend","Key_ContrastAdjust","Key_MediaLast","Key_unknown","Key_Call","Key_Camera","Key_CameraFocus","Key_Context1","Key_Context2","Key_Context3","Key_Context4","Key_Flip","Key_Hangup","Key_No","Key_Select","Key_ToggleCallHangup","Key_VoiceDial","Key_LastNumberRedial","Key_Execute","Key_Printer","Key_Play","Key_Sleep","Key_Zoom","Key_Cancel","connectedSlots","signal","slot","thisObj","$connectNotify","callType","$disconnectNotify","GETTER","SETTER","evaluatingProperty","int","real","Number","double","bool","Boolean","color","enum","variant","modules","Main","registerGlobalQmlType","registerQmlType","moduleDescriptor","versions","module","baseClass","inherit","collectConstructorsForModule","mergeObjects","obj1","obj2","mergedObject","perContextConstructors","moduleVersion","moduleAlias","moduleConstructors","oldProto","create","keys","setupGetter","setupSetter","useDefineProperty","defineProperty","configurable","enumerable","JSItemModel","roleNames","setRoleNames","rowsInserted","rowsMoved","rowsRemoved","modelReset","jsData","source","symbolName","AST_Tree","foo_function_scope","properties","operationState","QMLOperationState","Init","bp","QMLEngine","keyCodeToQt","keyCode","keypad","shiftKey","eventToKeyboard","accepted","isAutoRepeat","modifiers","ctrlKey","CtrlModifier","altKey","metaKey","charCode","touchHandler","preventDefault","at","layerX","touches","pageX","offsetLeft","layerY","pageY","offsetTop","button","onclick","mousemoveHandler","mouseAreas","l","hoverEnabled","oldMousePos","exited","entered","tick","now","Date","getTime","elapsed","lastTick","tickers","fps","$interval","running","bindedProperties","rootObject","Running","tickerId","setInterval","whenStart","removeEventListener","clearInterval","Idle","whenStop","ensureFileIsLoadedInQrc","qmlparse","basePath","loadFile","loadQMLTree","loadQML","debugTree","$initializePropertyBindings","leadingSlash","segments","segment","importsArray","currentFileDir","qmldirsContents","QtQuick","QtQuick.Controls","entry","nameIsQualifiedModuleName","nameIsDir","content","userAddedModulePaths","probableDirs","diredName","attrname","addImportPath","focusedElement","keyboardSignals","onkeypress","event","eventName","backup","onkeyup","registerProperty","dependantProperties","update","dirpath","userAddedImportPaths","setImportPathList","arrayOfDirs","addModulePath","dirPath","loadComponent","$getTextMetrics","fontCss","canvas","font","metrics","measureText","$resolvePath","$registerStart","$registerStop","$addTicker","$removeTicker","size","getWidth","getHeight","$perfDraw","debugConsole","$syncPropertyToRemote","sendToServer","method","generateBodyForPostQuery","ajax","mimeType","queryMimeType","success","xhrReadResponse","saved","objectToUrlEncoded","myEncodeURIComponent","encodeURIComponent","overrideMimeType","onreadystatechange","readyState","DONE","failure","runningRequests","isLoading","setRequestHeader","responseObject","updatePropertiesFromResponseObject","$hasProperty","fetched","fetch","mimetype","remove","destroy","localStorage","getKey","attrName","category","loadProperties","getItem","initializeProperties","emitter","setItem"],"mappings":"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","file":"qml2js-parser.min.js","sourcesContent":["(function(global){\r\n\n/**\r\n * Create QML binding.\r\n * @param {Variant} val Sourcecode or function representing the binding\r\n * @param {Array} tree Parser tree of the binding\r\n * @return {Object} Object representing the binding\r\n */\r\nglobal.QMLBinding = function(val, tree) {\r\n    // this.function states whether the binding is a simple js statement or a function containing a\r\n    // return statement. We decide this on whether it is a code block or not. If it is, we require a\r\n    // return statement. If it is a code block it could though also be a object definition, so we\r\n    // need to check that as well (it is, if the content is labels).\r\n    this.function = tree && tree[0] == \"block\" && tree[1][0] && tree[1][0][0] !== \"label\";\r\n    this.src = val;\r\n}\r\n\r\nglobal.QMLBinding.prototype.toJSON = function() {\r\n    return {src: this.src,\r\n        deps: JSON.stringify(this.deps),\r\n        tree: JSON.stringify(this.tree) };\r\n}\r\n\r\n/**\r\n * Compile binding. Afterwards you may call binding.eval to evaluate.\r\n */\r\nQMLBinding.prototype.compile = function() {\r\n    this.eval = new Function('__executionObject', '__executionContext', \"with(__executionContext) with(__executionObject) \" + ( this.function ? \"\" : \"return \" ) + this.src);\r\n}\r\n\n/* @license\r\n\r\n  Copyright (c) 2010 Mihai Bazon <mihai.bazon@gmail.com>\r\n  Copyright (c) 2011 Lauri Paimen <lauri@paimen.info>\r\n  Copyright (c) 2013 Anton Kreuzkamp <akreuzkamp@web.de>\r\n  Based on parse-js (http://marijn.haverbeke.nl/parse-js/).\r\n\r\n  Redistribution and use in source and binary forms, with or without\r\n  modification, are permitted provided that the following conditions\r\n  are met:\r\n\r\n      * Redistributions of source code must retain the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer.\r\n\r\n      * Redistributions in binary form must reproduce the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer in the documentation and/or other materials\r\n        provided with the distribution.\r\n\r\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AS IS AND ANY\r\n  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\r\n  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\r\n  OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\r\n  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\r\n  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\r\n  SUCH DAMAGE.\r\n*/\r\n\r\n\r\n/*\r\n * QML parser and parsetree'er.\r\n *\r\n * Based on Javascript parser written by Mihai Bazon for UglifyJS project.\r\n * That, again, is a port of Javascript parser by Marijn Haverbeke.\r\n * Big thanks to both of you (and others involved)!\r\n * UglifyJS: https://github.com/mishoo/UglifyJS\r\n * Marijn's parser: http://marijn.haverbeke.nl/parse-js/\r\n *\r\n * The primary goal of this file is to offer QML parsing *on top of UglifyJS\r\n * parser* and to change Javascript parts as little as possible. If you find\r\n * bugs/improvements to Javascript parsing parts, check if those are fixed to\r\n * UglifyJS parser first. If not, fix them there. After UglifyJS has been fixed,\r\n * backport the changes to this file. Less changes to Javascript, more easy it\r\n * will be to keep up with UglifyJS.\r\n * Ultimately it would be great to keep the original parser and QML additions in\r\n * different files but the structure of code does not support that.\r\n *\r\n * Exports:\r\n *\r\n * - QMLBinding(src, tree) to pass qml bindings along.\r\n *\r\n * - parseQML(src) -- parses QML source and returns it as output tree expected\r\n *   by the QML engine\r\n *\r\n * - qmlweb_parse(src) -- parses QML or JS source and returns tree a la uglifyjs parser.\r\n *   Currently used for debugging purposes.\r\n */\r\n\r\n// Object cloning for debug prints.\r\nfunction clone(obj){\r\n    if(obj == null || typeof(obj) != 'object')\r\n        return obj;\r\n\r\n    var temp = {}; // changed\r\n\r\n    for(var key in obj)\r\n        temp[key] = clone(obj[key]);\r\n    return temp;\r\n}\r\n\r\n/* -----[ Tokenizer (constants) ]----- */\r\n\r\nvar KEYWORDS = array_to_hash([\r\n        \"break\",\r\n        \"case\",\r\n        \"catch\",\r\n        \"const\",\r\n        \"continue\",\r\n        \"default\",\r\n        \"delete\",\r\n        \"do\",\r\n        \"else\",\r\n        \"finally\",\r\n        \"for\",\r\n        \"function\",\r\n        \"if\",\r\n        \"in\",\r\n        \"instanceof\",\r\n        \"new\",\r\n        \"return\",\r\n        \"switch\",\r\n        \"throw\",\r\n        \"try\",\r\n        \"typeof\",\r\n        \"var\",\r\n        \"void\",\r\n        \"while\",\r\n        \"with\"\r\n]);\r\n\r\nvar RESERVED_WORDS = array_to_hash([\r\n        \"abstract\",\r\n        \"boolean\",\r\n        \"byte\",\r\n        \"char\",\r\n        \"class\",\r\n        \"debugger\",\r\n        \"double\",\r\n        \"enum\",\r\n        \"export\",\r\n        \"extends\",\r\n        \"final\",\r\n        \"float\",\r\n        \"goto\",\r\n        \"implements\",\r\n        \"import\",\r\n        \"int\",\r\n        \"interface\",\r\n        \"long\",\r\n        \"native\",\r\n        \"package\",\r\n        \"private\",\r\n        \"protected\",\r\n        \"public\",\r\n        \"short\",\r\n        \"static\",\r\n        \"super\",\r\n        \"synchronized\",\r\n        \"throws\",\r\n        \"transient\",\r\n        \"volatile\"\r\n]);\r\n\r\nvar KEYWORDS_BEFORE_EXPRESSION = array_to_hash([\r\n        \"return\",\r\n        \"new\",\r\n        \"delete\",\r\n        \"throw\",\r\n        \"else\",\r\n        \"case\"\r\n]);\r\n\r\nvar KEYWORDS_ATOM = array_to_hash([\r\n        \"false\",\r\n        \"null\",\r\n        \"true\",\r\n        \"undefined\"\r\n]);\r\n\r\nvar OPERATOR_CHARS = array_to_hash(characters(\"+-*&%=<>!?|~^\"));\r\n\r\nvar RE_HEX_NUMBER = /^0x[0-9a-f]+$/i;\r\nvar RE_OCT_NUMBER = /^0[0-7]+$/;\r\nvar RE_DEC_NUMBER = /^\\d*\\.?\\d*(?:e[+-]?\\d*(?:\\d\\.?|\\.?\\d)\\d*)?$/i;\r\n\r\nvar OPERATORS = array_to_hash([\r\n        \"in\",\r\n        \"instanceof\",\r\n        \"typeof\",\r\n        \"new\",\r\n        \"void\",\r\n        \"delete\",\r\n        \"++\",\r\n        \"--\",\r\n        \"+\",\r\n        \"-\",\r\n        \"!\",\r\n        \"~\",\r\n        \"&\",\r\n        \"|\",\r\n        \"^\",\r\n        \"*\",\r\n        \"/\",\r\n        \"%\",\r\n        \">>\",\r\n        \"<<\",\r\n        \">>>\",\r\n        \"<\",\r\n        \">\",\r\n        \"<=\",\r\n        \">=\",\r\n        \"==\",\r\n        \"===\",\r\n        \"!=\",\r\n        \"!==\",\r\n        \"?\",\r\n        \"=\",\r\n        \"+=\",\r\n        \"-=\",\r\n        \"/=\",\r\n        \"*=\",\r\n        \"%=\",\r\n        \">>=\",\r\n        \"<<=\",\r\n        \">>>=\",\r\n        \"|=\",\r\n        \"^=\",\r\n        \"&=\",\r\n        \"&&\",\r\n        \"||\"\r\n]);\r\n\r\nvar WHITESPACE_CHARS = array_to_hash(characters(\" \\n\\r\\t\\u200b\"));\r\n\r\nvar PUNC_BEFORE_EXPRESSION = array_to_hash(characters(\"[{}(,.;:\"));\r\n\r\nvar PUNC_CHARS = array_to_hash(characters(\"[]{}(),;:\"));\r\n\r\nvar REGEXP_MODIFIERS = array_to_hash(characters(\"gmsiy\"));\r\n\r\n/* -----[ Tokenizer ]----- */\r\n\r\n// regexps adapted from http://xregexp.com/plugins/#unicode\r\nvar UNICODE = {\r\n        letter: new RegExp(\"[\\\\u0041-\\\\u005A\\\\u0061-\\\\u007A\\\\u00AA\\\\u00B5\\\\u00BA\\\\u00C0-\\\\u00D6\\\\u00D8-\\\\u00F6\\\\u00F8-\\\\u02C1\\\\u02C6-\\\\u02D1\\\\u02E0-\\\\u02E4\\\\u02EC\\\\u02EE\\\\u0370-\\\\u0374\\\\u0376\\\\u0377\\\\u037A-\\\\u037D\\\\u0386\\\\u0388-\\\\u038A\\\\u038C\\\\u038E-\\\\u03A1\\\\u03A3-\\\\u03F5\\\\u03F7-\\\\u0481\\\\u048A-\\\\u0523\\\\u0531-\\\\u0556\\\\u0559\\\\u0561-\\\\u0587\\\\u05D0-\\\\u05EA\\\\u05F0-\\\\u05F2\\\\u0621-\\\\u064A\\\\u066E\\\\u066F\\\\u0671-\\\\u06D3\\\\u06D5\\\\u06E5\\\\u06E6\\\\u06EE\\\\u06EF\\\\u06FA-\\\\u06FC\\\\u06FF\\\\u0710\\\\u0712-\\\\u072F\\\\u074D-\\\\u07A5\\\\u07B1\\\\u07CA-\\\\u07EA\\\\u07F4\\\\u07F5\\\\u07FA\\\\u0904-\\\\u0939\\\\u093D\\\\u0950\\\\u0958-\\\\u0961\\\\u0971\\\\u0972\\\\u097B-\\\\u097F\\\\u0985-\\\\u098C\\\\u098F\\\\u0990\\\\u0993-\\\\u09A8\\\\u09AA-\\\\u09B0\\\\u09B2\\\\u09B6-\\\\u09B9\\\\u09BD\\\\u09CE\\\\u09DC\\\\u09DD\\\\u09DF-\\\\u09E1\\\\u09F0\\\\u09F1\\\\u0A05-\\\\u0A0A\\\\u0A0F\\\\u0A10\\\\u0A13-\\\\u0A28\\\\u0A2A-\\\\u0A30\\\\u0A32\\\\u0A33\\\\u0A35\\\\u0A36\\\\u0A38\\\\u0A39\\\\u0A59-\\\\u0A5C\\\\u0A5E\\\\u0A72-\\\\u0A74\\\\u0A85-\\\\u0A8D\\\\u0A8F-\\\\u0A91\\\\u0A93-\\\\u0AA8\\\\u0AAA-\\\\u0AB0\\\\u0AB2\\\\u0AB3\\\\u0AB5-\\\\u0AB9\\\\u0ABD\\\\u0AD0\\\\u0AE0\\\\u0AE1\\\\u0B05-\\\\u0B0C\\\\u0B0F\\\\u0B10\\\\u0B13-\\\\u0B28\\\\u0B2A-\\\\u0B30\\\\u0B32\\\\u0B33\\\\u0B35-\\\\u0B39\\\\u0B3D\\\\u0B5C\\\\u0B5D\\\\u0B5F-\\\\u0B61\\\\u0B71\\\\u0B83\\\\u0B85-\\\\u0B8A\\\\u0B8E-\\\\u0B90\\\\u0B92-\\\\u0B95\\\\u0B99\\\\u0B9A\\\\u0B9C\\\\u0B9E\\\\u0B9F\\\\u0BA3\\\\u0BA4\\\\u0BA8-\\\\u0BAA\\\\u0BAE-\\\\u0BB9\\\\u0BD0\\\\u0C05-\\\\u0C0C\\\\u0C0E-\\\\u0C10\\\\u0C12-\\\\u0C28\\\\u0C2A-\\\\u0C33\\\\u0C35-\\\\u0C39\\\\u0C3D\\\\u0C58\\\\u0C59\\\\u0C60\\\\u0C61\\\\u0C85-\\\\u0C8C\\\\u0C8E-\\\\u0C90\\\\u0C92-\\\\u0CA8\\\\u0CAA-\\\\u0CB3\\\\u0CB5-\\\\u0CB9\\\\u0CBD\\\\u0CDE\\\\u0CE0\\\\u0CE1\\\\u0D05-\\\\u0D0C\\\\u0D0E-\\\\u0D10\\\\u0D12-\\\\u0D28\\\\u0D2A-\\\\u0D39\\\\u0D3D\\\\u0D60\\\\u0D61\\\\u0D7A-\\\\u0D7F\\\\u0D85-\\\\u0D96\\\\u0D9A-\\\\u0DB1\\\\u0DB3-\\\\u0DBB\\\\u0DBD\\\\u0DC0-\\\\u0DC6\\\\u0E01-\\\\u0E30\\\\u0E32\\\\u0E33\\\\u0E40-\\\\u0E46\\\\u0E81\\\\u0E82\\\\u0E84\\\\u0E87\\\\u0E88\\\\u0E8A\\\\u0E8D\\\\u0E94-\\\\u0E97\\\\u0E99-\\\\u0E9F\\\\u0EA1-\\\\u0EA3\\\\u0EA5\\\\u0EA7\\\\u0EAA\\\\u0EAB\\\\u0EAD-\\\\u0EB0\\\\u0EB2\\\\u0EB3\\\\u0EBD\\\\u0EC0-\\\\u0EC4\\\\u0EC6\\\\u0EDC\\\\u0EDD\\\\u0F00\\\\u0F40-\\\\u0F47\\\\u0F49-\\\\u0F6C\\\\u0F88-\\\\u0F8B\\\\u1000-\\\\u102A\\\\u103F\\\\u1050-\\\\u1055\\\\u105A-\\\\u105D\\\\u1061\\\\u1065\\\\u1066\\\\u106E-\\\\u1070\\\\u1075-\\\\u1081\\\\u108E\\\\u10A0-\\\\u10C5\\\\u10D0-\\\\u10FA\\\\u10FC\\\\u1100-\\\\u1159\\\\u115F-\\\\u11A2\\\\u11A8-\\\\u11F9\\\\u1200-\\\\u1248\\\\u124A-\\\\u124D\\\\u1250-\\\\u1256\\\\u1258\\\\u125A-\\\\u125D\\\\u1260-\\\\u1288\\\\u128A-\\\\u128D\\\\u1290-\\\\u12B0\\\\u12B2-\\\\u12B5\\\\u12B8-\\\\u12BE\\\\u12C0\\\\u12C2-\\\\u12C5\\\\u12C8-\\\\u12D6\\\\u12D8-\\\\u1310\\\\u1312-\\\\u1315\\\\u1318-\\\\u135A\\\\u1380-\\\\u138F\\\\u13A0-\\\\u13F4\\\\u1401-\\\\u166C\\\\u166F-\\\\u1676\\\\u1681-\\\\u169A\\\\u16A0-\\\\u16EA\\\\u1700-\\\\u170C\\\\u170E-\\\\u1711\\\\u1720-\\\\u1731\\\\u1740-\\\\u1751\\\\u1760-\\\\u176C\\\\u176E-\\\\u1770\\\\u1780-\\\\u17B3\\\\u17D7\\\\u17DC\\\\u1820-\\\\u1877\\\\u1880-\\\\u18A8\\\\u18AA\\\\u1900-\\\\u191C\\\\u1950-\\\\u196D\\\\u1970-\\\\u1974\\\\u1980-\\\\u19A9\\\\u19C1-\\\\u19C7\\\\u1A00-\\\\u1A16\\\\u1B05-\\\\u1B33\\\\u1B45-\\\\u1B4B\\\\u1B83-\\\\u1BA0\\\\u1BAE\\\\u1BAF\\\\u1C00-\\\\u1C23\\\\u1C4D-\\\\u1C4F\\\\u1C5A-\\\\u1C7D\\\\u1D00-\\\\u1DBF\\\\u1E00-\\\\u1F15\\\\u1F18-\\\\u1F1D\\\\u1F20-\\\\u1F45\\\\u1F48-\\\\u1F4D\\\\u1F50-\\\\u1F57\\\\u1F59\\\\u1F5B\\\\u1F5D\\\\u1F5F-\\\\u1F7D\\\\u1F80-\\\\u1FB4\\\\u1FB6-\\\\u1FBC\\\\u1FBE\\\\u1FC2-\\\\u1FC4\\\\u1FC6-\\\\u1FCC\\\\u1FD0-\\\\u1FD3\\\\u1FD6-\\\\u1FDB\\\\u1FE0-\\\\u1FEC\\\\u1FF2-\\\\u1FF4\\\\u1FF6-\\\\u1FFC\\\\u2071\\\\u207F\\\\u2090-\\\\u2094\\\\u2102\\\\u2107\\\\u210A-\\\\u2113\\\\u2115\\\\u2119-\\\\u211D\\\\u2124\\\\u2126\\\\u2128\\\\u212A-\\\\u212D\\\\u212F-\\\\u2139\\\\u213C-\\\\u213F\\\\u2145-\\\\u2149\\\\u214E\\\\u2183\\\\u2184\\\\u2C00-\\\\u2C2E\\\\u2C30-\\\\u2C5E\\\\u2C60-\\\\u2C6F\\\\u2C71-\\\\u2C7D\\\\u2C80-\\\\u2CE4\\\\u2D00-\\\\u2D25\\\\u2D30-\\\\u2D65\\\\u2D6F\\\\u2D80-\\\\u2D96\\\\u2DA0-\\\\u2DA6\\\\u2DA8-\\\\u2DAE\\\\u2DB0-\\\\u2DB6\\\\u2DB8-\\\\u2DBE\\\\u2DC0-\\\\u2DC6\\\\u2DC8-\\\\u2DCE\\\\u2DD0-\\\\u2DD6\\\\u2DD8-\\\\u2DDE\\\\u2E2F\\\\u3005\\\\u3006\\\\u3031-\\\\u3035\\\\u303B\\\\u303C\\\\u3041-\\\\u3096\\\\u309D-\\\\u309F\\\\u30A1-\\\\u30FA\\\\u30FC-\\\\u30FF\\\\u3105-\\\\u312D\\\\u3131-\\\\u318E\\\\u31A0-\\\\u31B7\\\\u31F0-\\\\u31FF\\\\u3400\\\\u4DB5\\\\u4E00\\\\u9FC3\\\\uA000-\\\\uA48C\\\\uA500-\\\\uA60C\\\\uA610-\\\\uA61F\\\\uA62A\\\\uA62B\\\\uA640-\\\\uA65F\\\\uA662-\\\\uA66E\\\\uA67F-\\\\uA697\\\\uA717-\\\\uA71F\\\\uA722-\\\\uA788\\\\uA78B\\\\uA78C\\\\uA7FB-\\\\uA801\\\\uA803-\\\\uA805\\\\uA807-\\\\uA80A\\\\uA80C-\\\\uA822\\\\uA840-\\\\uA873\\\\uA882-\\\\uA8B3\\\\uA90A-\\\\uA925\\\\uA930-\\\\uA946\\\\uAA00-\\\\uAA28\\\\uAA40-\\\\uAA42\\\\uAA44-\\\\uAA4B\\\\uAC00\\\\uD7A3\\\\uF900-\\\\uFA2D\\\\uFA30-\\\\uFA6A\\\\uFA70-\\\\uFAD9\\\\uFB00-\\\\uFB06\\\\uFB13-\\\\uFB17\\\\uFB1D\\\\uFB1F-\\\\uFB28\\\\uFB2A-\\\\uFB36\\\\uFB38-\\\\uFB3C\\\\uFB3E\\\\uFB40\\\\uFB41\\\\uFB43\\\\uFB44\\\\uFB46-\\\\uFBB1\\\\uFBD3-\\\\uFD3D\\\\uFD50-\\\\uFD8F\\\\uFD92-\\\\uFDC7\\\\uFDF0-\\\\uFDFB\\\\uFE70-\\\\uFE74\\\\uFE76-\\\\uFEFC\\\\uFF21-\\\\uFF3A\\\\uFF41-\\\\uFF5A\\\\uFF66-\\\\uFFBE\\\\uFFC2-\\\\uFFC7\\\\uFFCA-\\\\uFFCF\\\\uFFD2-\\\\uFFD7\\\\uFFDA-\\\\uFFDC]\"),\r\n        non_spacing_mark: new RegExp(\"[\\\\u0300-\\\\u036F\\\\u0483-\\\\u0487\\\\u0591-\\\\u05BD\\\\u05BF\\\\u05C1\\\\u05C2\\\\u05C4\\\\u05C5\\\\u05C7\\\\u0610-\\\\u061A\\\\u064B-\\\\u065E\\\\u0670\\\\u06D6-\\\\u06DC\\\\u06DF-\\\\u06E4\\\\u06E7\\\\u06E8\\\\u06EA-\\\\u06ED\\\\u0711\\\\u0730-\\\\u074A\\\\u07A6-\\\\u07B0\\\\u07EB-\\\\u07F3\\\\u0816-\\\\u0819\\\\u081B-\\\\u0823\\\\u0825-\\\\u0827\\\\u0829-\\\\u082D\\\\u0900-\\\\u0902\\\\u093C\\\\u0941-\\\\u0948\\\\u094D\\\\u0951-\\\\u0955\\\\u0962\\\\u0963\\\\u0981\\\\u09BC\\\\u09C1-\\\\u09C4\\\\u09CD\\\\u09E2\\\\u09E3\\\\u0A01\\\\u0A02\\\\u0A3C\\\\u0A41\\\\u0A42\\\\u0A47\\\\u0A48\\\\u0A4B-\\\\u0A4D\\\\u0A51\\\\u0A70\\\\u0A71\\\\u0A75\\\\u0A81\\\\u0A82\\\\u0ABC\\\\u0AC1-\\\\u0AC5\\\\u0AC7\\\\u0AC8\\\\u0ACD\\\\u0AE2\\\\u0AE3\\\\u0B01\\\\u0B3C\\\\u0B3F\\\\u0B41-\\\\u0B44\\\\u0B4D\\\\u0B56\\\\u0B62\\\\u0B63\\\\u0B82\\\\u0BC0\\\\u0BCD\\\\u0C3E-\\\\u0C40\\\\u0C46-\\\\u0C48\\\\u0C4A-\\\\u0C4D\\\\u0C55\\\\u0C56\\\\u0C62\\\\u0C63\\\\u0CBC\\\\u0CBF\\\\u0CC6\\\\u0CCC\\\\u0CCD\\\\u0CE2\\\\u0CE3\\\\u0D41-\\\\u0D44\\\\u0D4D\\\\u0D62\\\\u0D63\\\\u0DCA\\\\u0DD2-\\\\u0DD4\\\\u0DD6\\\\u0E31\\\\u0E34-\\\\u0E3A\\\\u0E47-\\\\u0E4E\\\\u0EB1\\\\u0EB4-\\\\u0EB9\\\\u0EBB\\\\u0EBC\\\\u0EC8-\\\\u0ECD\\\\u0F18\\\\u0F19\\\\u0F35\\\\u0F37\\\\u0F39\\\\u0F71-\\\\u0F7E\\\\u0F80-\\\\u0F84\\\\u0F86\\\\u0F87\\\\u0F90-\\\\u0F97\\\\u0F99-\\\\u0FBC\\\\u0FC6\\\\u102D-\\\\u1030\\\\u1032-\\\\u1037\\\\u1039\\\\u103A\\\\u103D\\\\u103E\\\\u1058\\\\u1059\\\\u105E-\\\\u1060\\\\u1071-\\\\u1074\\\\u1082\\\\u1085\\\\u1086\\\\u108D\\\\u109D\\\\u135F\\\\u1712-\\\\u1714\\\\u1732-\\\\u1734\\\\u1752\\\\u1753\\\\u1772\\\\u1773\\\\u17B7-\\\\u17BD\\\\u17C6\\\\u17C9-\\\\u17D3\\\\u17DD\\\\u180B-\\\\u180D\\\\u18A9\\\\u1920-\\\\u1922\\\\u1927\\\\u1928\\\\u1932\\\\u1939-\\\\u193B\\\\u1A17\\\\u1A18\\\\u1A56\\\\u1A58-\\\\u1A5E\\\\u1A60\\\\u1A62\\\\u1A65-\\\\u1A6C\\\\u1A73-\\\\u1A7C\\\\u1A7F\\\\u1B00-\\\\u1B03\\\\u1B34\\\\u1B36-\\\\u1B3A\\\\u1B3C\\\\u1B42\\\\u1B6B-\\\\u1B73\\\\u1B80\\\\u1B81\\\\u1BA2-\\\\u1BA5\\\\u1BA8\\\\u1BA9\\\\u1C2C-\\\\u1C33\\\\u1C36\\\\u1C37\\\\u1CD0-\\\\u1CD2\\\\u1CD4-\\\\u1CE0\\\\u1CE2-\\\\u1CE8\\\\u1CED\\\\u1DC0-\\\\u1DE6\\\\u1DFD-\\\\u1DFF\\\\u20D0-\\\\u20DC\\\\u20E1\\\\u20E5-\\\\u20F0\\\\u2CEF-\\\\u2CF1\\\\u2DE0-\\\\u2DFF\\\\u302A-\\\\u302F\\\\u3099\\\\u309A\\\\uA66F\\\\uA67C\\\\uA67D\\\\uA6F0\\\\uA6F1\\\\uA802\\\\uA806\\\\uA80B\\\\uA825\\\\uA826\\\\uA8C4\\\\uA8E0-\\\\uA8F1\\\\uA926-\\\\uA92D\\\\uA947-\\\\uA951\\\\uA980-\\\\uA982\\\\uA9B3\\\\uA9B6-\\\\uA9B9\\\\uA9BC\\\\uAA29-\\\\uAA2E\\\\uAA31\\\\uAA32\\\\uAA35\\\\uAA36\\\\uAA43\\\\uAA4C\\\\uAAB0\\\\uAAB2-\\\\uAAB4\\\\uAAB7\\\\uAAB8\\\\uAABE\\\\uAABF\\\\uAAC1\\\\uABE5\\\\uABE8\\\\uABED\\\\uFB1E\\\\uFE00-\\\\uFE0F\\\\uFE20-\\\\uFE26]\"),\r\n        space_combining_mark: new RegExp(\"[\\\\u0903\\\\u093E-\\\\u0940\\\\u0949-\\\\u094C\\\\u094E\\\\u0982\\\\u0983\\\\u09BE-\\\\u09C0\\\\u09C7\\\\u09C8\\\\u09CB\\\\u09CC\\\\u09D7\\\\u0A03\\\\u0A3E-\\\\u0A40\\\\u0A83\\\\u0ABE-\\\\u0AC0\\\\u0AC9\\\\u0ACB\\\\u0ACC\\\\u0B02\\\\u0B03\\\\u0B3E\\\\u0B40\\\\u0B47\\\\u0B48\\\\u0B4B\\\\u0B4C\\\\u0B57\\\\u0BBE\\\\u0BBF\\\\u0BC1\\\\u0BC2\\\\u0BC6-\\\\u0BC8\\\\u0BCA-\\\\u0BCC\\\\u0BD7\\\\u0C01-\\\\u0C03\\\\u0C41-\\\\u0C44\\\\u0C82\\\\u0C83\\\\u0CBE\\\\u0CC0-\\\\u0CC4\\\\u0CC7\\\\u0CC8\\\\u0CCA\\\\u0CCB\\\\u0CD5\\\\u0CD6\\\\u0D02\\\\u0D03\\\\u0D3E-\\\\u0D40\\\\u0D46-\\\\u0D48\\\\u0D4A-\\\\u0D4C\\\\u0D57\\\\u0D82\\\\u0D83\\\\u0DCF-\\\\u0DD1\\\\u0DD8-\\\\u0DDF\\\\u0DF2\\\\u0DF3\\\\u0F3E\\\\u0F3F\\\\u0F7F\\\\u102B\\\\u102C\\\\u1031\\\\u1038\\\\u103B\\\\u103C\\\\u1056\\\\u1057\\\\u1062-\\\\u1064\\\\u1067-\\\\u106D\\\\u1083\\\\u1084\\\\u1087-\\\\u108C\\\\u108F\\\\u109A-\\\\u109C\\\\u17B6\\\\u17BE-\\\\u17C5\\\\u17C7\\\\u17C8\\\\u1923-\\\\u1926\\\\u1929-\\\\u192B\\\\u1930\\\\u1931\\\\u1933-\\\\u1938\\\\u19B0-\\\\u19C0\\\\u19C8\\\\u19C9\\\\u1A19-\\\\u1A1B\\\\u1A55\\\\u1A57\\\\u1A61\\\\u1A63\\\\u1A64\\\\u1A6D-\\\\u1A72\\\\u1B04\\\\u1B35\\\\u1B3B\\\\u1B3D-\\\\u1B41\\\\u1B43\\\\u1B44\\\\u1B82\\\\u1BA1\\\\u1BA6\\\\u1BA7\\\\u1BAA\\\\u1C24-\\\\u1C2B\\\\u1C34\\\\u1C35\\\\u1CE1\\\\u1CF2\\\\uA823\\\\uA824\\\\uA827\\\\uA880\\\\uA881\\\\uA8B4-\\\\uA8C3\\\\uA952\\\\uA953\\\\uA983\\\\uA9B4\\\\uA9B5\\\\uA9BA\\\\uA9BB\\\\uA9BD-\\\\uA9C0\\\\uAA2F\\\\uAA30\\\\uAA33\\\\uAA34\\\\uAA4D\\\\uAA7B\\\\uABE3\\\\uABE4\\\\uABE6\\\\uABE7\\\\uABE9\\\\uABEA\\\\uABEC]\"),\r\n        connector_punctuation: new RegExp(\"[\\\\u005F\\\\u203F\\\\u2040\\\\u2054\\\\uFE33\\\\uFE34\\\\uFE4D-\\\\uFE4F\\\\uFF3F]\")\r\n};\r\n\r\nfunction is_letter(ch) {\r\n        return UNICODE.letter.test(ch);\r\n};\r\n\r\nfunction is_digit(ch) {\r\n        ch = ch.charCodeAt(0);\r\n        return ch >= 48 && ch <= 57; //XXX: find out if \"UnicodeDigit\" means something else than 0..9\r\n};\r\n\r\nfunction is_alphanumeric_char(ch) {\r\n        return is_digit(ch) || is_letter(ch);\r\n};\r\n\r\nfunction is_unicode_combining_mark(ch) {\r\n        return UNICODE.non_spacing_mark.test(ch) || UNICODE.space_combining_mark.test(ch);\r\n};\r\n\r\nfunction is_unicode_connector_punctuation(ch) {\r\n        return UNICODE.connector_punctuation.test(ch);\r\n};\r\n\r\nfunction is_identifier_start(ch) {\r\n        return ch == \"$\" || ch == \"_\" || is_letter(ch);\r\n};\r\n\r\nfunction is_identifier_char(ch) {\r\n        return is_identifier_start(ch)\r\n                || is_unicode_combining_mark(ch)\r\n                || is_digit(ch)\r\n                || is_unicode_connector_punctuation(ch)\r\n                || ch == \"\\u200c\" // zero-width non-joiner <ZWNJ>\r\n                || ch == \"\\u200d\" // zero-width joiner <ZWJ> (in my ECMA-262 PDF, this is also 200c)\r\n        ;\r\n};\r\n\r\nfunction parse_js_number(num) {\r\n        if (RE_HEX_NUMBER.test(num)) {\r\n                return parseInt(num.substr(2), 16);\r\n        } else if (RE_OCT_NUMBER.test(num)) {\r\n                return parseInt(num.substr(1), 8);\r\n        } else if (RE_DEC_NUMBER.test(num)) {\r\n                return parseFloat(num);\r\n        }\r\n};\r\n\r\nfunction JS_Parse_Error(message, line, col, pos, comment) {\r\n        this.message = message;\r\n        this.line = line + 1;\r\n        this.col = col;\r\n        this.pos = pos;\r\n        this.comment = comment ? comment : \"\";\r\n        try {\r\n                ({})();\r\n        } catch(ex) {\r\n                this.stack = ex.stack;\r\n        };\r\n};\r\n\r\nJS_Parse_Error.prototype.toString = function() {\r\n        return this.message + \" (line: \" + this.line + \", col: \" + this.col + \", pos: \" + this.pos + \")\" + \"\\n\" + this.comment + \"\\n\" + this.stack;\r\n};\r\n\r\nfunction js_error(message, line, col, pos, comment) {\r\n        throw new JS_Parse_Error(message, line, col, pos, comment);\r\n};\r\n\r\nfunction is_token(token, type, val) {\r\n        return token.type == type && (val == null || token.value == val);\r\n};\r\n// CJK characters in the console display longer lengths, calculate the length of a string of actual display\r\nvar normal_c = \" \";\r\nvar cjk_c = \"\";\r\nvar cjk = function(char_code) {\r\n    return 0x4E00 <= char_code && char_code <= 0x9FFF ||\r\n        0x3400 <= char_code && char_code <= 0x4DFF ||\r\n        0x20000 <= char_code && char_code <= 0x2A6DF ||\r\n        0xF900 <= char_code && char_code <= 0xFAFF ||\r\n        0x2F800 <= char_code && char_code <= 0x2FA1F;\r\n};\r\nfunction replacerConsoleRange(str) {\r\n    var res = \"\";\r\n    for (var i = 0, len = str.length, cc; i < len; i += 1) {\r\n        cc = str.charCodeAt(i);\r\n        if (cc === 9) { // \\t\r\n            res += '\\t' // tabtab\r\n        } else if (cjk(cc)) {\r\n            res += cjk_c\r\n        } else {\r\n            res += normal_c\r\n        }\r\n    }\r\n    return res;\r\n};\r\nfunction repeatString(_str, count) {\r\n    'use strict';\r\n    if (_str == null) {\r\n        throw new TypeError('can\\'t convert ' + _str + ' to object');\r\n    }\r\n    var str = '' + _str;\r\n    count = +count;\r\n    if (count != count) {\r\n        count = 0;\r\n    }\r\n    if (count < 0) {\r\n        throw new RangeError('repeat count must be non-negative');\r\n    }\r\n    if (count == Infinity) {\r\n        throw new RangeError('repeat count must be less than infinity');\r\n    }\r\n    count = Math.floor(count);\r\n    if (str.length == 0 || count == 0) {\r\n        return '';\r\n    }\r\n    // Ensuring count is a 31-bit integer allows us to heavily optimize the\r\n    // main part. But anyway, most current (August 2014) browsers can't handle\r\n    // strings 1 << 28 chars or longer, so:\r\n    if (str.length * count >= 1 << 28) {\r\n        throw new RangeError('repeat count must not overflow maximum string size');\r\n    }\r\n    var rpt = '';\r\n    for (;;) {\r\n        if ((count & 1) == 1) {\r\n            rpt += str;\r\n        }\r\n        count >>>= 1;\r\n        if (count == 0) {\r\n            break;\r\n        }\r\n        str += str;\r\n    }\r\n    // Could we try:\r\n    // return Array(count + 1).join(_str);\r\n    return rpt;\r\n};\r\nfunction extractLinesForErrorDiag(code_text, line, column, options) {\r\n    options || (options = {});\r\n    var line_range = options.line_range << 0 || 3;\r\n\r\n    var codeLines = code_text.split(\"\\n\");\r\n\r\n    // Error line number index\r\n    var show_line_index = line;\r\n    // The starting line of the display code number\r\n    var show_start_line = Math.max(show_line_index - line_range, 0);\r\n    // End line of code displays the number of\r\n    var show_end_line = show_line_index + line_range;\r\n\r\n    // The number of characters required to display line, blank spaces + 1\r\n    var index_len = (\"\" + show_end_line).length + 1;\r\n\r\n    var show_code = \"\";\r\n\r\n    for (var index = show_start_line; index <= show_end_line; index++) {\r\n        var suffix = (index + 1 + repeatString(' ', index_len)).substr(0, index_len + 1);\r\n        var one_line_code = codeLines[index];\r\n        if (index === show_line_index) {\r\n            var prefix = '>>';\r\n            one_line_code += '\\n' + repeatString(normal_c, prefix.length + suffix.length) +\r\n                replacerConsoleRange(one_line_code.substr(0, column)) + // Replaced as blank character string\r\n                \"\";\r\n        } else {\r\n            var prefix = '  ';\r\n        }\r\n        show_code += prefix + suffix + one_line_code + \"\\n\";\r\n    }\r\n    return show_code\r\n};\r\n\r\nvar EX_EOF = {};\r\n\r\nfunction tokenizer($TEXT) {\r\n\r\n        var S = {\r\n                text            : $TEXT.replace(/\\r\\n?|[\\n\\u2028\\u2029]/g, \"\\n\").replace(/^\\uFEFF/, ''),\r\n                pos             : 0,\r\n                tokpos          : 0,\r\n                line            : 0,\r\n                tokline         : 0,\r\n                col             : 0,\r\n                tokcol          : 0,\r\n                newline_before  : false,\r\n                regex_allowed   : false,\r\n                comments_before : []\r\n        };\r\n\r\n        function peek() { return S.text.charAt(S.pos); };\r\n\r\n        function next(signal_eof) {\r\n                var ch = S.text.charAt(S.pos++);\r\n                if (signal_eof && !ch)\r\n                        throw EX_EOF;\r\n                if (ch == \"\\n\") {\r\n                        S.newline_before = true;\r\n                        ++S.line;\r\n                        S.col = 0;\r\n                } else {\r\n                        ++S.col;\r\n                }\r\n                return ch;\r\n        };\r\n\r\n        function eof() {\r\n                return !S.peek();\r\n        };\r\n\r\n        function find(what, signal_eof) {\r\n                var pos = S.text.indexOf(what, S.pos);\r\n                if (signal_eof && pos == -1) throw EX_EOF;\r\n                return pos;\r\n        };\r\n\r\n        function start_token() {\r\n                S.tokline = S.line;\r\n                S.tokcol = S.col;\r\n                S.tokpos = S.pos;\r\n        };\r\n\r\n        function token(type, value, is_comment) {\r\n                S.regex_allowed = ((type == \"operator\" && !HOP(UNARY_POSTFIX, value)) ||\r\n                                   (type == \"keyword\" && HOP(KEYWORDS_BEFORE_EXPRESSION, value)) ||\r\n                                   (type == \"punc\" && HOP(PUNC_BEFORE_EXPRESSION, value)));\r\n                var ret = {\r\n                        type  : type,\r\n                        value : value,\r\n                        line  : S.tokline,\r\n                        col   : S.tokcol,\r\n                        pos   : S.tokpos,\r\n                        nlb   : S.newline_before\r\n                };\r\n                if (!is_comment) {\r\n                        ret.comments_before = S.comments_before;\r\n                        S.comments_before = [];\r\n                }\r\n                S.newline_before = false;\r\n                return ret;\r\n        };\r\n\r\n        function skip_whitespace() {\r\n                while (HOP(WHITESPACE_CHARS, peek()))\r\n                        next();\r\n        };\r\n\r\n        function read_while(pred) {\r\n                var ret = \"\", ch = peek(), i = 0;\r\n                while (ch && pred(ch, i++)) {\r\n                        ret += next();\r\n                        ch = peek();\r\n                }\r\n                return ret;\r\n        };\r\n\r\n        function parse_error(err) {\r\n                js_error(err, S.tokline, S.tokcol, S.tokpos, extractLinesForErrorDiag( S.text, S.tokline, S.tokcol ) );\r\n        };\r\n\r\n        function read_num(prefix) {\r\n                var has_e = false, after_e = false, has_x = false, has_dot = prefix == \".\";\r\n                var num = read_while(function(ch, i){\r\n                        if (ch == \"x\" || ch == \"X\") {\r\n                                if (has_x) return false;\r\n                                return has_x = true;\r\n                        }\r\n                        if (!has_x && (ch == \"E\" || ch == \"e\")) {\r\n                                if (has_e) return false;\r\n                                return has_e = after_e = true;\r\n                        }\r\n                        if (ch == \"-\") {\r\n                                if (after_e || (i == 0 && !prefix)) return true;\r\n                                return false;\r\n                        }\r\n                        if (ch == \"+\") return after_e;\r\n                        after_e = false;\r\n                        if (ch == \".\") {\r\n                                if (!has_dot && !has_x)\r\n                                        return has_dot = true;\r\n                                return false;\r\n                        }\r\n                        return is_alphanumeric_char(ch);\r\n                });\r\n                if (prefix)\r\n                        num = prefix + num;\r\n                var valid = parse_js_number(num);\r\n                if (!isNaN(valid)) {\r\n                        return token(\"num\", valid);\r\n                } else {\r\n                        parse_error(\"Invalid syntax: \" + num);\r\n                }\r\n        };\r\n\r\n        function read_escaped_char() {\r\n                var ch = next(true);\r\n                switch (ch) {\r\n                    case \"n\" : return \"\\n\";\r\n                    case \"r\" : return \"\\r\";\r\n                    case \"t\" : return \"\\t\";\r\n                    case \"b\" : return \"\\b\";\r\n                    case \"v\" : return \"\\v\";\r\n                    case \"f\" : return \"\\f\";\r\n                    case \"0\" : return \"\\0\";\r\n                    case \"x\" : return String.fromCharCode(hex_bytes(2));\r\n                    case \"u\" : return String.fromCharCode(hex_bytes(4));\r\n                    case \"\\n\": return \"\";\r\n                    default  : return ch;\r\n                }\r\n        };\r\n\r\n        function hex_bytes(n) {\r\n                var num = 0;\r\n                for (; n > 0; --n) {\r\n                        var digit = parseInt(next(true), 16);\r\n                        if (isNaN(digit))\r\n                                parse_error(\"Invalid hex-character pattern in string\");\r\n                        num = (num << 4) | digit;\r\n                }\r\n                return num;\r\n        };\r\n\r\n        function read_string() {\r\n                return with_eof_error(\"Unterminated string constant\", function(){\r\n                        var quote = next(), ret = \"\";\r\n                        for (;;) {\r\n                                var ch = next(true);\r\n                                if (ch == \"\\\\\") ch = read_escaped_char();\r\n                                else if (ch == quote) break;\r\n                                ret += ch;\r\n                        }\r\n                        return token(\"string\", ret);\r\n                });\r\n        };\r\n\r\n        function read_line_comment() {\r\n                next();\r\n                var i = find(\"\\n\"), ret;\r\n                if (i == -1) {\r\n                        ret = S.text.substr(S.pos);\r\n                        S.pos = S.text.length;\r\n                } else {\r\n                        ret = S.text.substring(S.pos, i);\r\n                        S.pos = i;\r\n                }\r\n                return token(\"comment1\", ret, true);\r\n        };\r\n\r\n        function read_multiline_comment() {\r\n                next();\r\n                return with_eof_error(\"Unterminated multiline comment\", function(){\r\n                        var i = find(\"*/\", true),\r\n                            text = S.text.substring(S.pos, i),\r\n                            tok = token(\"comment2\", text, true);\r\n                        S.pos = i + 2;\r\n                        S.line += text.split(\"\\n\").length - 1;\r\n                        S.newline_before = text.indexOf(\"\\n\") >= 0;\r\n\r\n                        // https://github.com/mishoo/UglifyJS/issues/#issue/100\r\n                        if (/^@cc_on/i.test(text)) {\r\n                                warn(\"WARNING: at line \" + S.line);\r\n                                warn(\"*** Found \\\"conditional comment\\\": \" + text);\r\n                                warn(\"*** UglifyJS DISCARDS ALL COMMENTS.  This means your code might no longer work properly in Internet Explorer.\");\r\n                        }\r\n\r\n                        return tok;\r\n                });\r\n        };\r\n\r\n        function read_name() {\r\n                var backslash = false, name = \"\", ch;\r\n                while ((ch = peek()) != null) {\r\n                        if (!backslash) {\r\n                                if (ch == \"\\\\\") backslash = true, next();\r\n                                else if (is_identifier_char(ch)) name += next();\r\n                                else break;\r\n                        }\r\n                        else {\r\n                                if (ch != \"u\") parse_error(\"Expecting UnicodeEscapeSequence -- uXXXX\");\r\n                                ch = read_escaped_char();\r\n                                if (!is_identifier_char(ch)) parse_error(\"Unicode char: \" + ch.charCodeAt(0) + \" is not valid in identifier\");\r\n                                name += ch;\r\n                                backslash = false;\r\n                        }\r\n                }\r\n                return name;\r\n        };\r\n\r\n        function read_regexp() {\r\n                return with_eof_error(\"Unterminated regular expression\", function(){\r\n                        var prev_backslash = false, regexp = \"\", ch, in_class = false;\r\n                        while ((ch = next(true))) if (prev_backslash) {\r\n                                regexp += \"\\\\\" + ch;\r\n                                prev_backslash = false;\r\n                        } else if (ch == \"[\") {\r\n                                in_class = true;\r\n                                regexp += ch;\r\n                        } else if (ch == \"]\" && in_class) {\r\n                                in_class = false;\r\n                                regexp += ch;\r\n                        } else if (ch == \"/\" && !in_class) {\r\n                                break;\r\n                        } else if (ch == \"\\\\\") {\r\n                                prev_backslash = true;\r\n                        } else {\r\n                                regexp += ch;\r\n                        }\r\n                        var mods = read_name();\r\n                        return token(\"regexp\", [ regexp, mods ]);\r\n                });\r\n        };\r\n\r\n        function read_operator(prefix) {\r\n                function grow(op) {\r\n                        if (!peek()) return op;\r\n                        var bigger = op + peek();\r\n                        if (HOP(OPERATORS, bigger)) {\r\n                                next();\r\n                                return grow(bigger);\r\n                        } else {\r\n                                return op;\r\n                        }\r\n                };\r\n                return token(\"operator\", grow(prefix || next()));\r\n        };\r\n\r\n        function handle_slash() {\r\n                next();\r\n                var regex_allowed = S.regex_allowed;\r\n                switch (peek()) {\r\n                    case \"/\":\r\n                        S.comments_before.push(read_line_comment());\r\n                        S.regex_allowed = regex_allowed;\r\n                        return next_token();\r\n                    case \"*\":\r\n                        S.comments_before.push(read_multiline_comment());\r\n                        S.regex_allowed = regex_allowed;\r\n                        return next_token();\r\n                }\r\n                return S.regex_allowed ? read_regexp() : read_operator(\"/\");\r\n        };\r\n\r\n        function handle_dot() {\r\n                next();\r\n                return is_digit(peek())\r\n                        ? read_num(\".\")\r\n                        : token(\"punc\", \".\");\r\n        };\r\n\r\n        function read_word() {\r\n                var word = read_name();\r\n                return !HOP(KEYWORDS, word)\r\n                        ? token(\"name\", word)\r\n                        : HOP(OPERATORS, word)\r\n                        ? token(\"operator\", word)\r\n                        : HOP(KEYWORDS_ATOM, word)\r\n                        ? token(\"atom\", word)\r\n                        : token(\"keyword\", word);\r\n        };\r\n\r\n        function with_eof_error(eof_error, cont) {\r\n                try {\r\n                        return cont();\r\n                } catch(ex) {\r\n                        if (ex === EX_EOF) parse_error(eof_error);\r\n                        else throw ex;\r\n                }\r\n        };\r\n\r\n        function next_token(force_regexp) {\r\n                if (force_regexp)\r\n                        return read_regexp();\r\n                skip_whitespace();\r\n                start_token();\r\n                var ch = peek();\r\n                if (!ch) return token(\"eof\");\r\n                if (is_digit(ch)) return read_num();\r\n                if (ch == '\"' || ch == \"'\") return read_string();\r\n                if (HOP(PUNC_CHARS, ch)) return token(\"punc\", next());\r\n                if (ch == \".\") return handle_dot();\r\n                if (ch == \"/\") return handle_slash();\r\n                if (HOP(OPERATOR_CHARS, ch)) return read_operator();\r\n                if (ch == \"\\\\\" || is_identifier_start(ch)) return read_word();\r\n                parse_error(\"Unexpected character '\" + ch + \"'\");\r\n        };\r\n\r\n        next_token.context = function(nc) {\r\n                if (nc) S = nc;\r\n                return S;\r\n        };\r\n\r\n        return next_token;\r\n\r\n};\r\n\r\n/* -----[ Parser (constants) ]----- */\r\n\r\nvar UNARY_PREFIX = array_to_hash([\r\n        \"typeof\",\r\n        \"void\",\r\n        \"delete\",\r\n        \"--\",\r\n        \"++\",\r\n        \"!\",\r\n        \"~\",\r\n        \"-\",\r\n        \"+\"\r\n]);\r\n\r\nvar UNARY_POSTFIX = array_to_hash([ \"--\", \"++\" ]);\r\n\r\nvar ASSIGNMENT = (function(a, ret, i){\r\n        while (i < a.length) {\r\n                ret[a[i]] = a[i].substr(0, a[i].length - 1);\r\n                i++;\r\n        }\r\n        return ret;\r\n})(\r\n        [\"+=\", \"-=\", \"/=\", \"*=\", \"%=\", \">>=\", \"<<=\", \">>>=\", \"|=\", \"^=\", \"&=\"],\r\n        { \"=\": true },\r\n        0\r\n);\r\n\r\nvar PRECEDENCE = (function(a, ret){\r\n        for (var i = 0, n = 1; i < a.length; ++i, ++n) {\r\n                var b = a[i];\r\n                for (var j = 0; j < b.length; ++j) {\r\n                        ret[b[j]] = n;\r\n                }\r\n        }\r\n        return ret;\r\n})(\r\n        [\r\n                [\"||\"],\r\n                [\"&&\"],\r\n                [\"|\"],\r\n                [\"^\"],\r\n                [\"&\"],\r\n                [\"==\", \"===\", \"!=\", \"!==\"],\r\n                [\"<\", \">\", \"<=\", \">=\", \"in\", \"instanceof\"],\r\n                [\">>\", \"<<\", \">>>\"],\r\n                [\"+\", \"-\"],\r\n                [\"*\", \"/\", \"%\"]\r\n        ],\r\n        {}\r\n);\r\n\r\nvar STATEMENTS_WITH_LABELS = array_to_hash([ \"for\", \"do\", \"while\", \"switch\" ]);\r\n\r\nvar ATOMIC_START_TOKEN = array_to_hash([ \"atom\", \"num\", \"string\", \"regexp\", \"name\" ]);\r\n\r\n/* -----[ Parser ]----- */\r\n\r\nfunction NodeWithToken(str, start, end) {\r\n        this.name = str;\r\n        this.start = start;\r\n        this.end = end;\r\n};\r\n\r\nNodeWithToken.prototype.toString = function() { return this.name; };\r\n\r\nqmlweb_parse.QMLDocument = 1;\r\nqmlweb_parse.JSResource = 2;\r\nfunction qmlweb_parse($TEXT, document_type, exigent_mode, embed_tokens) {\r\n\r\n        var S = {\r\n                text        : $TEXT.replace(/\\r\\n?|[\\n\\u2028\\u2029]/g, \"\\n\").replace(/^\\uFEFF/, ''),\r\n                input       : typeof $TEXT == \"string\" ? tokenizer($TEXT, true) : $TEXT,\r\n                token       : null,\r\n                prev        : null,\r\n                peeked      : null,\r\n                in_function : 0,\r\n                in_loop     : 0,\r\n                labels      : []\r\n        };\r\n\r\n        S.token = next();\r\n\r\n        function is(type, value) {\r\n                return is_token(S.token, type, value);\r\n        };\r\n\r\n        function peek() { return S.peeked || (S.peeked = S.input()); };\r\n\r\n        function next() {\r\n                S.prev = S.token;\r\n                if (S.peeked) {\r\n                        S.token = S.peeked;\r\n                        S.peeked = null;\r\n                } else {\r\n                        S.token = S.input();\r\n                }\r\n                return S.token;\r\n        };\r\n\r\n        function prev() {\r\n                return S.prev;\r\n        };\r\n\r\n        function croak(msg, line, col, pos) {\r\n                var ctx = S.input.context();\r\n                var eLine = line != null ? line : ctx.tokline;\r\n                var eCol = col != null ? col : ctx.tokcol;\r\n                js_error(msg,\r\n                         eLine,\r\n                         eCol,\r\n                         pos != null ? pos : ctx.tokpos,\r\n                         extractLinesForErrorDiag( S.text, eLine, eCol ) );\r\n        };\r\n\r\n        function token_error(token, msg) {\r\n                croak(msg, token.line, token.col);\r\n        };\r\n\r\n        function unexpected(token) {\r\n                if (token == null)\r\n                        token = S.token;\r\n                token_error(token, \"Unexpected token: \" + token.type + \" (\" + token.value + \")\");\r\n        };\r\n\r\n        function expect_token(type, val) {\r\n                if (is(type, val)) {\r\n                        return next();\r\n                }\r\n                token_error(S.token, \"Unexpected token \" + S.token.type + \" \" + S.token.val + \", expected \" + type + \" \" + val);\r\n        };\r\n\r\n        function expect(punc) { return expect_token(\"punc\", punc); };\r\n\r\n        function can_insert_semicolon() {\r\n                return !exigent_mode && (\r\n                        S.token.nlb || is(\"eof\") || is(\"punc\", \"}\")\r\n                );\r\n        };\r\n\r\n        function semicolon() {\r\n                if (is(\"punc\", \";\")) next();\r\n                else if (!can_insert_semicolon()) unexpected();\r\n        };\r\n\r\n        function as() {\r\n                return slice(arguments);\r\n        };\r\n\r\n        function parenthesised() {\r\n                expect(\"(\");\r\n                var ex = expression();\r\n                expect(\")\");\r\n                return ex;\r\n        };\r\n\r\n        function add_tokens(str, start, end) {\r\n                return str instanceof NodeWithToken ? str : new NodeWithToken(str, start, end);\r\n        };\r\n\r\n        function maybe_embed_tokens(parser) {\r\n                if (embed_tokens) return function() {\r\n                        var start = S.token;\r\n                        var ast = parser.apply(this, arguments);\r\n                        ast[0] = add_tokens(ast[0], start, prev());\r\n                        return ast;\r\n                };\r\n                else return parser;\r\n        };\r\n\r\n        var statement = maybe_embed_tokens(function() {\r\n                if (is(\"operator\", \"/\")) {\r\n                        S.peeked = null;\r\n                        S.token = S.input(true); // force regexp\r\n                }\r\n                switch (S.token.type) {\r\n                    case \"num\":\r\n                    case \"string\":\r\n                    case \"regexp\":\r\n                    case \"operator\":\r\n                    case \"atom\":\r\n                        return simple_statement();\r\n\r\n                    case \"name\":\r\n                        return is_token(peek(), \"punc\", \":\")\r\n                                ? labeled_statement(prog1(S.token.value, next, next))\r\n                                : simple_statement();\r\n\r\n                    case \"punc\":\r\n                        switch (S.token.value) {\r\n                            case \"{\":\r\n                                return as(\"block\", block_());\r\n                            case \"[\":\r\n                            case \"(\":\r\n                                return simple_statement();\r\n                            case \";\":\r\n                                next();\r\n                                return as(\"block\");\r\n                            default:\r\n                                unexpected();\r\n                        }\r\n\r\n                    case \"keyword\":\r\n                        switch (prog1(S.token.value, next)) {\r\n                            case \"break\":\r\n                                return break_cont(\"break\");\r\n\r\n                            case \"continue\":\r\n                                return break_cont(\"continue\");\r\n\r\n                            case \"debugger\":\r\n                                semicolon();\r\n                                return as(\"debugger\");\r\n\r\n                            case \"do\":\r\n                                return (function(body){\r\n                                        expect_token(\"keyword\", \"while\");\r\n                                        return as(\"do\", prog1(parenthesised, semicolon), body);\r\n                                })(in_loop(statement));\r\n\r\n                            case \"for\":\r\n                                return for_();\r\n\r\n                            case \"function\":\r\n                                return function_(true);\r\n\r\n                            case \"if\":\r\n                                return if_();\r\n\r\n                            case \"return\":\r\n                                if (S.in_function == 0)\r\n                                        croak(\"'return' outside of function\");\r\n                                return as(\"return\",\r\n                                          is(\"punc\", \";\")\r\n                                          ? (next(), null)\r\n                                          : can_insert_semicolon()\r\n                                          ? null\r\n                                          : prog1(expression, semicolon));\r\n\r\n                            case \"switch\":\r\n                                return as(\"switch\", parenthesised(), switch_block_());\r\n\r\n                            case \"throw\":\r\n                                return as(\"throw\", prog1(expression, semicolon));\r\n\r\n                            case \"try\":\r\n                                return try_();\r\n\r\n                            case \"var\":\r\n                                return prog1(var_, semicolon);\r\n\r\n                            case \"const\":\r\n                                return prog1(const_, semicolon);\r\n\r\n                            case \"while\":\r\n                                return as(\"while\", parenthesised(), in_loop(statement));\r\n\r\n                            case \"with\":\r\n                                return as(\"with\", parenthesised(), statement());\r\n\r\n                            default:\r\n                                unexpected();\r\n                        }\r\n                }\r\n        });\r\n\r\n        function labeled_statement(label) {\r\n                S.labels.push(label);\r\n                var start = S.token, stat = statement();\r\n                if (exigent_mode && !HOP(STATEMENTS_WITH_LABELS, stat[0]))\r\n                        unexpected(start);\r\n                S.labels.pop();\r\n                return as(\"label\", label, stat);\r\n        };\r\n\r\n        function simple_statement() {\r\n                return as(\"stat\", prog1(expression, semicolon));\r\n        };\r\n\r\n        function break_cont(type) {\r\n                var name = is(\"name\") ? S.token.value : null;\r\n                if (name != null) {\r\n                        next();\r\n                        if (!member(name, S.labels))\r\n                                croak(\"Label \" + name + \" without matching loop or statement\");\r\n                }\r\n                else if (S.in_loop == 0)\r\n                        croak(type + \" not inside a loop or switch\");\r\n                semicolon();\r\n                return as(type, name);\r\n        };\r\n\r\n        function for_() {\r\n                expect(\"(\");\r\n                var init = null;\r\n                if (!is(\"punc\", \";\")) {\r\n                        init = is(\"keyword\", \"var\")\r\n                                ? (next(), var_(true))\r\n                                : expression(true, true);\r\n                        if (is(\"operator\", \"in\"))\r\n                                return for_in(init);\r\n                }\r\n                return regular_for(init);\r\n        };\r\n\r\n        function regular_for(init) {\r\n                expect(\";\");\r\n                var test = is(\"punc\", \";\") ? null : expression();\r\n                expect(\";\");\r\n                var step = is(\"punc\", \")\") ? null : expression();\r\n                expect(\")\");\r\n                return as(\"for\", init, test, step, in_loop(statement));\r\n        };\r\n\r\n        function for_in(init) {\r\n                var lhs = init[0] == \"var\" ? as(\"name\", init[1][0]) : init;\r\n                next();\r\n                var obj = expression();\r\n                expect(\")\");\r\n                return as(\"for-in\", init, lhs, obj, in_loop(statement));\r\n        };\r\n\r\n        var function_ = maybe_embed_tokens(function(in_statement) {\r\n                var name = is(\"name\") ? prog1(S.token.value, next) : null;\r\n                if (in_statement && !name)\r\n                        unexpected();\r\n                expect(\"(\");\r\n                return as(in_statement ? \"defun\" : \"function\",\r\n                          name,\r\n                          // arguments\r\n                          (function(first, a){\r\n                                  while (!is(\"punc\", \")\")) {\r\n                                          if (first) first = false; else expect(\",\");\r\n                                          if (!is(\"name\")) unexpected();\r\n                                          a.push(S.token.value);\r\n                                          next();\r\n                                  }\r\n                                  next();\r\n                                  return a;\r\n                          })(true, []),\r\n                          // body\r\n                          (function(){\r\n                                  ++S.in_function;\r\n                                  var loop = S.in_loop;\r\n                                  S.in_loop = 0;\r\n                                  var a = block_();\r\n                                  --S.in_function;\r\n                                  S.in_loop = loop;\r\n                                  return a;\r\n                          })());\r\n        });\r\n\r\n        function if_() {\r\n                var cond = parenthesised(), body = statement(), belse;\r\n                if (is(\"keyword\", \"else\")) {\r\n                        next();\r\n                        belse = statement();\r\n                }\r\n                return as(\"if\", cond, body, belse);\r\n        };\r\n\r\n        function block_() {\r\n                expect(\"{\");\r\n                var a = [];\r\n                while (!is(\"punc\", \"}\")) {\r\n                        if (is(\"eof\")) unexpected();\r\n                        a.push(statement());\r\n                }\r\n                next();\r\n                return a;\r\n        };\r\n\r\n        var switch_block_ = curry(in_loop, function(){\r\n                expect(\"{\");\r\n                var a = [], cur = null;\r\n                while (!is(\"punc\", \"}\")) {\r\n                        if (is(\"eof\")) unexpected();\r\n                        if (is(\"keyword\", \"case\")) {\r\n                                next();\r\n                                cur = [];\r\n                                a.push([ expression(), cur ]);\r\n                                expect(\":\");\r\n                        }\r\n                        else if (is(\"keyword\", \"default\")) {\r\n                                next();\r\n                                expect(\":\");\r\n                                cur = [];\r\n                                a.push([ null, cur ]);\r\n                        }\r\n                        else {\r\n                                if (!cur) unexpected();\r\n                                cur.push(statement());\r\n                        }\r\n                }\r\n                next();\r\n                return a;\r\n        });\r\n\r\n        function try_() {\r\n                var body = block_(), bcatch, bfinally;\r\n                if (is(\"keyword\", \"catch\")) {\r\n                        next();\r\n                        expect(\"(\");\r\n                        if (!is(\"name\"))\r\n                                croak(\"Name expected\");\r\n                        var name = S.token.value;\r\n                        next();\r\n                        expect(\")\");\r\n                        bcatch = [ name, block_() ];\r\n                }\r\n                if (is(\"keyword\", \"finally\")) {\r\n                        next();\r\n                        bfinally = block_();\r\n                }\r\n                if (!bcatch && !bfinally)\r\n                        croak(\"Missing catch/finally blocks\");\r\n                return as(\"try\", body, bcatch, bfinally);\r\n        };\r\n\r\n        function vardefs(no_in) {\r\n                var a = [];\r\n                for (;;) {\r\n                        if (!is(\"name\"))\r\n                                unexpected();\r\n                        var name = S.token.value;\r\n                        next();\r\n                        if (is(\"operator\", \"=\")) {\r\n                                next();\r\n                                a.push([ name, expression(false, no_in) ]);\r\n                        } else {\r\n                                a.push([ name ]);\r\n                        }\r\n                        if (!is(\"punc\", \",\"))\r\n                                break;\r\n                        next();\r\n                }\r\n                return a;\r\n        };\r\n\r\n        function var_(no_in) {\r\n                return as(\"var\", vardefs(no_in));\r\n        };\r\n\r\n        function const_() {\r\n                return as(\"const\", vardefs());\r\n        };\r\n\r\n        function new_() {\r\n                var newexp = expr_atom(false), args;\r\n                if (is(\"punc\", \"(\")) {\r\n                        next();\r\n                        args = expr_list(\")\");\r\n                } else {\r\n                        args = [];\r\n                }\r\n                return subscripts(as(\"new\", newexp, args), true);\r\n        };\r\n\r\n        var expr_atom = maybe_embed_tokens(function(allow_calls) {\r\n                if (is(\"operator\", \"new\")) {\r\n                        next();\r\n                        return new_();\r\n                }\r\n                if (is(\"operator\") && HOP(UNARY_PREFIX, S.token.value)) {\r\n                        return make_unary(\"unary-prefix\",\r\n                                          prog1(S.token.value, next),\r\n                                          expr_atom(allow_calls));\r\n                }\r\n                if (is(\"punc\")) {\r\n                        switch (S.token.value) {\r\n                            case \"(\":\r\n                                next();\r\n                                return subscripts(prog1(expression, curry(expect, \")\")), allow_calls);\r\n                            case \"[\":\r\n                                next();\r\n                                return subscripts(array_(), allow_calls);\r\n                            case \"{\":\r\n                                next();\r\n                                return subscripts(object_(), allow_calls);\r\n                        }\r\n                        unexpected();\r\n                }\r\n                if (is(\"keyword\", \"function\")) {\r\n                        next();\r\n                        return subscripts(function_(false), allow_calls);\r\n                }\r\n                if (HOP(ATOMIC_START_TOKEN, S.token.type)) {\r\n                        var atom = S.token.type == \"regexp\"\r\n                                ? as(\"regexp\", S.token.value[0], S.token.value[1])\r\n                                : as(S.token.type, S.token.value);\r\n                        return subscripts(prog1(atom, next), allow_calls);\r\n                }\r\n                unexpected();\r\n        });\r\n\r\n        function expr_list(closing, allow_trailing_comma, allow_empty) {\r\n                var first = true, a = [];\r\n                while (!is(\"punc\", closing)) {\r\n                        if (first) first = false; else expect(\",\");\r\n                        if (allow_trailing_comma && is(\"punc\", closing)) break;\r\n                        if (is(\"punc\", \",\") && allow_empty) {\r\n                                a.push([ \"atom\", \"undefined\" ]);\r\n                        } else {\r\n                                a.push(expression(false));\r\n                        }\r\n                }\r\n                next();\r\n                return a;\r\n        };\r\n\r\n        function array_() {\r\n                var from = S.token.pos,\r\n                    stat = expr_list(\"]\", !exigent_mode, true),\r\n                    to = S.token.pos;\r\n                return as(\"array\", stat, \"[\" + S.text.substr(from, to - from));\r\n        };\r\n\r\n        function object_() {\r\n                var first = true, a = [];\r\n                while (!is(\"punc\", \"}\")) {\r\n                        if (first) first = false; else expect(\",\");\r\n                        if (!exigent_mode && is(\"punc\", \"}\"))\r\n                                // allow trailing comma\r\n                                break;\r\n                        var type = S.token.type;\r\n                        var name = as_property_name();\r\n                        if (type == \"name\" && (name == \"get\" || name == \"set\") && !is(\"punc\", \":\")) {\r\n                                a.push([ as_name(), function_(false), name ]);\r\n                        } else {\r\n                                expect(\":\");\r\n                                a.push([ name, expression(false) ]);\r\n                        }\r\n                }\r\n                next();\r\n                return as(\"object\", a);\r\n        };\r\n\r\n        function as_property_name() {\r\n                switch (S.token.type) {\r\n                    case \"num\":\r\n                    case \"string\":\r\n                        return prog1(S.token.value, next);\r\n                }\r\n                return as_name();\r\n        };\r\n\r\n        function as_name() {\r\n                switch (S.token.type) {\r\n                    case \"name\":\r\n                    case \"operator\":\r\n                    case \"keyword\":\r\n                    case \"atom\":\r\n                        return prog1(S.token.value, next);\r\n                    default:\r\n                        unexpected();\r\n                }\r\n        };\r\n\r\n        function subscripts(expr, allow_calls) {\r\n                if (is(\"punc\", \".\")) {\r\n                        next();\r\n                        return subscripts(as(\"dot\", expr, as_name()), allow_calls);\r\n                }\r\n                if (is(\"punc\", \"[\")) {\r\n                        next();\r\n                        return subscripts(as(\"sub\", expr, prog1(expression, curry(expect, \"]\"))), allow_calls);\r\n                }\r\n                if (allow_calls && is(\"punc\", \"(\")) {\r\n                        next();\r\n                        return subscripts(as(\"call\", expr, expr_list(\")\")), true);\r\n                }\r\n                if (allow_calls && is(\"operator\") && HOP(UNARY_POSTFIX, S.token.value)) {\r\n                        return prog1(curry(make_unary, \"unary-postfix\", S.token.value, expr),\r\n                                     next);\r\n                }\r\n                return expr;\r\n        };\r\n\r\n        function make_unary(tag, op, expr) {\r\n                if ((op == \"++\" || op == \"--\") && !is_assignable(expr))\r\n                        croak(\"Invalid use of \" + op + \" operator\");\r\n                return as(tag, op, expr);\r\n        };\r\n\r\n        function expr_op(left, min_prec, no_in) {\r\n                var op = is(\"operator\") ? S.token.value : null;\r\n                if (op && op == \"in\" && no_in) op = null;\r\n                var prec = op != null ? PRECEDENCE[op] : null;\r\n                if (prec != null && prec > min_prec) {\r\n                        next();\r\n                        var right = expr_op(expr_atom(true), prec, no_in);\r\n                        return expr_op(as(\"binary\", op, left, right), min_prec, no_in);\r\n                }\r\n                return left;\r\n        };\r\n\r\n        function expr_ops(no_in) {\r\n                return expr_op(expr_atom(true), 0, no_in);\r\n        };\r\n\r\n        function maybe_conditional(no_in) {\r\n                var expr = expr_ops(no_in);\r\n                if (is(\"operator\", \"?\")) {\r\n                        next();\r\n                        var yes = expression(false);\r\n                        expect(\":\");\r\n                        return as(\"conditional\", expr, yes, expression(false, no_in));\r\n                }\r\n                return expr;\r\n        };\r\n\r\n        function is_assignable(expr) {\r\n                if (!exigent_mode) return true;\r\n                switch (expr[0]) {\r\n                    case \"dot\":\r\n                    case \"sub\":\r\n                    case \"new\":\r\n                    case \"call\":\r\n                        return true;\r\n                    case \"name\":\r\n                        return expr[1] != \"this\";\r\n                }\r\n        };\r\n\r\n        function maybe_assign(no_in) {\r\n                var left = maybe_conditional(no_in), val = S.token.value;\r\n                if (is(\"operator\") && HOP(ASSIGNMENT, val)) {\r\n                        if (is_assignable(left)) {\r\n                                next();\r\n                                return as(\"assign\", ASSIGNMENT[val], left, maybe_assign(no_in));\r\n                        }\r\n                        croak(\"Invalid assignment\");\r\n                }\r\n                return left;\r\n        };\r\n\r\n        function maybe_qmlelem(no_in) {\r\n                var expr = maybe_assign(no_in);\r\n                if (is(\"punc\", \"{\"))\r\n                    return as(\"qmlelem\", expr[1], undefined, qmlblock());\r\n                return expr;\r\n        };\r\n\r\n        var expression = maybe_embed_tokens(function(commas, no_in) {\r\n                if (arguments.length == 0)\r\n                        commas = true;\r\n                var expr = maybe_qmlelem(no_in);\r\n                if (commas && is(\"punc\", \",\")) {\r\n                        next();\r\n                        return as(\"seq\", expr, expression(true, no_in));\r\n                }\r\n                return expr;\r\n        });\r\n\r\n        function in_loop(cont) {\r\n                try {\r\n                        ++S.in_loop;\r\n                        return cont();\r\n                } finally {\r\n                        --S.in_loop;\r\n                }\r\n        };\r\n\r\n        function qml_is_element(str) {\r\n            return str[0].toUpperCase() == str[0];\r\n        }\r\n\r\n        function qmlblock() {\r\n            expect(\"{\");\r\n            var a = [];\r\n            while (!is(\"punc\", \"}\")) {\r\n                if (is(\"eof\")) unexpected();\r\n                a.push(qmlstatement());\r\n            }\r\n            expect(\"}\");\r\n            return a;\r\n        }\r\n\r\n        function qmlproperty() {\r\n            switch (S.token.type) {\r\n                case \"name\":\r\n                    return as(\"qmlbinding\", statement());\r\n                case \"num\":\r\n                case \"string\":\r\n                    return as(\"qmlvalue\", prog1(S.token.value, next,\r\n                        semicolon));\r\n                default:\r\n                    todo();\r\n            }\r\n        }\r\n\r\n        function qmlpropdef() {\r\n            var type = S.token.value;\r\n            next();\r\n            var name = S.token.value;\r\n            next();\r\n            if (type == \"alias\") {\r\n                expect(\":\");\r\n                if (!is(\"name\")) unexpected();\r\n                var objName = S.token.value;\r\n                next();\r\n                if (is(\"punc\", \".\")) {\r\n                    next();\r\n                    if (!is(\"name\")) unexpected();\r\n                    var propName = S.token.value;\r\n                    next();\r\n                }\r\n                return as(\"qmlaliasdef\", name, objName, propName);\r\n            }\r\n            if (is(\"punc\", \":\")) {\r\n                next();\r\n                S.in_function++;\r\n                var from = S.token.pos,\r\n                    stat = statement(),\r\n                    to = S.token.pos;\r\n                S.in_function--;\r\n                return as(\"qmlpropdef\", name, type, stat,\r\n                        S.text.substr(from, to - from));\r\n            } else if (is(\"punc\", \";\"))\r\n                next();\r\n            return as(\"qmlpropdef\", name, type);\r\n\r\n        }\r\n\r\n        function qmldefaultprop() {\r\n            next();\r\n            expect_token(\"name\", \"property\");\r\n\r\n            return as(\"qmldefaultprop\", qmlpropdef());\r\n        }\r\n\r\n        function qmlsignaldef() {\r\n            var name = S.token.value;\r\n            next();\r\n            var args = [];\r\n            if (is(\"punc\", \"(\")) {\r\n                next();\r\n                var first = true;\r\n                while (!is(\"punc\", \")\")) {\r\n                        if (first) first = false; else expect(\",\");\r\n                        if (!is(\"name\")) unexpected();\r\n                        var type = S.token.value;\r\n                        next();\r\n                        if (!is(\"name\")) unexpected();\r\n                        args.push({type: type, name: S.token.value});\r\n                        next();\r\n                }\r\n                next();\r\n            }\r\n            if (is(\"punc\", \";\"))\r\n                next();\r\n            return as(\"qmlsignaldef\", name, args);\r\n\r\n        }\r\n\r\n        function qmlstatement() {\r\n            if (is(\"keyword\", \"function\")) {\r\n                var from = S.token.pos;\r\n                next();\r\n                var stat = function_(true);\r\n                var to = S.token.pos;\r\n                var name = stat[1];\r\n                return as(\"qmlmethod\", name, stat,\r\n                    S.text.substr(from, to - from));\r\n            } else if (is(\"name\", \"signal\")) {\r\n                next();\r\n                if (is(\"punc\", \":\")) {\r\n                    next();\r\n                    S.in_function++;\r\n                    var from = S.token.pos,\r\n                        stat = statement(),\r\n                        to = S.token.pos;\r\n                    S.in_function--;\r\n                    return as(\"qmlprop\", propname, stat,\r\n                        S.text.substr(from, to - from));\r\n                } else {\r\n                    return qmlsignaldef();\r\n                }\r\n            } else if (S.token.type == \"name\") {\r\n                var propname = S.token.value;\r\n                next();\r\n                if (propname == \"property\" && (S.token.type == \"name\" || S.token.value == \"var\")) {\r\n                    return qmlpropdef();\r\n                } else if (qml_is_element(propname) && !is(\"punc\", \".\")) {\r\n                    // Element\r\n                    var onProp;\r\n                    if (is(\"name\", \"on\")) {\r\n                        next();\r\n                        onProp = S.token.value;\r\n                        next();\r\n                    }\r\n                    return as(\"qmlelem\", propname, onProp, qmlblock());\r\n                } else {\r\n                    // property statement\r\n                    if (is(\"punc\", \".\")) {\r\n                        // anchors, fonts etc, a.b: statement;\r\n                        // Can also be Component.onCompleted: ...\r\n                        // Assume only one subproperty\r\n                        next();\r\n                        var subname = S.token.value;\r\n                        next();\r\n                        expect(\":\");\r\n                        S.in_function++;\r\n                        var from = S.token.pos,\r\n                            stat = statement(),\r\n                            to = S.token.pos;\r\n                        S.in_function--;\r\n                        return as(\"qmlobjdef\", propname, subname, stat,\r\n                            S.text.substr(from, to - from));\r\n                    } else if (is(\"punc\", \"{\")) {\r\n                        return as(\"qmlobj\", propname, qmlblock());\r\n                    } else {\r\n                        // Evaluatable item\r\n                        expect(\":\");\r\n                        S.in_function++;\r\n                        var from = S.token.pos,\r\n                            stat = statement(),\r\n                            to = S.token.pos;\r\n                        S.in_function--;\r\n                        return as(\"qmlprop\", propname, stat,\r\n                            S.text.substr(from, to - from));\r\n                    }\r\n                }\r\n            } else if (is(\"keyword\", \"default\")) {\r\n                return qmldefaultprop();\r\n            } else {\r\n                todo();\r\n            }\r\n        }\r\n\r\n        function qmlimport() {\r\n            // todo\r\n            next();\r\n            var moduleName = S.token.value;\r\n            var isDottedNotation = (S.token.type == \"name\");\r\n            next();\r\n            \r\n            while (is(\"punc\", \".\")) {\r\n                next();\r\n                moduleName += \".\" + S.token.value;\r\n                next();\r\n            }\r\n            if (is(\"num\")) {\r\n                var version = S.token.value\r\n                next();\r\n            }\r\n            var namespace = \"\";\r\n            if (is(\"name\", \"as\")) {\r\n                next();\r\n                namespace = S.token.value;\r\n                next();\r\n            }\r\n            return as(\"qmlimport\", moduleName, version, namespace, isDottedNotation);\r\n        }\r\n\r\n        function qmldocument() {\r\n            var imports = [];\r\n            while (is(\"name\", \"import\")) {\r\n                imports.push(qmlimport());\r\n            }\r\n            var root = qmlstatement();\r\n            if (!is(\"eof\"))\r\n                unexpected();\r\n\r\n            return as(\"toplevel\", imports, root);\r\n        }\r\n\r\n        function jsdocument() {\r\n            var statements = [];\r\n            while (!is(\"eof\")) {\r\n                statements.push(statement());\r\n            }\r\n            return as(\"jsresource\", statements);\r\n        }\r\n\r\n        function amIn(s) {\r\n            console && console.log(s, clone(S), S.token.type, S.token.value);\r\n        }\r\n        function todo() {\r\n            amIn(\"todo parse:\");\r\n            next();\r\n        }\r\n\r\n        if (document_type === qmlweb_parse.JSResource) {\r\n            return jsdocument();\r\n        } else {\r\n            return qmldocument();\r\n        }\r\n\r\n};\r\n\r\n/* -----[ Utilities ]----- */\r\n\r\nfunction curry(f) {\r\n        var args = slice(arguments, 1);\r\n        return function() { return f.apply(this, args.concat(slice(arguments))); };\r\n};\r\n\r\nfunction prog1(ret) {\r\n        if (ret instanceof Function)\r\n                ret = ret();\r\n        for (var i = 1, n = arguments.length; --n > 0; ++i)\r\n                arguments[i]();\r\n        return ret;\r\n};\r\n\r\nfunction array_to_hash(a) {\r\n        var ret = {};\r\n        for (var i = 0; i < a.length; ++i)\r\n                ret[a[i]] = true;\r\n        return ret;\r\n};\r\n\r\nfunction slice(a, start) {\r\n        return Array.prototype.slice.call(a, start == null ? 0 : start);\r\n};\r\n\r\nfunction characters(str) {\r\n        return str.split(\"\");\r\n};\r\n\r\nfunction member(name, array) {\r\n        for (var i = array.length; --i >= 0;)\r\n                if (array[i] === name)\r\n                        return true;\r\n        return false;\r\n};\r\n\r\nfunction HOP(obj, prop) {\r\n        return Object.prototype.hasOwnProperty.call(obj, prop);\r\n};\r\n\r\nvar warn = function() {};\r\n\r\nQMLMethod.prototype = new QMLBinding();\r\nfunction QMLMethod(src) {\r\n    this.src = src;\r\n}\r\n\r\n/**\r\n * Create an object representing a QML property definition.\r\n * @param {String} type The type of the property\r\n * @param {Array} value The default value of the property\r\n * @return {Object} Object representing the defintion\r\n */\r\nfunction QMLPropertyDefinition(type, value) {\r\n    this.type = type;\r\n    this.value = value;\r\n}\r\n\r\nfunction QMLAliasDefinition(objName, propName) {\r\n    this.objectName = objName;\r\n    this.propertyName = propName;\r\n}\r\n\r\n/**\r\n * Create an object representing a QML signal definition.\r\n * @param {Array} params The parameters the signal ships\r\n * @return {Object} Object representing the defintion\r\n */\r\nfunction QMLSignalDefinition(params) {\r\n    this.parameters = params;\r\n}\r\n\r\n/**\r\n * Create an object representing a group of QML properties (like anchors).\r\n * @return {Object} Object representing the group\r\n */\r\nfunction QMLMetaPropertyGroup() {}\r\n\r\n/**\r\n * Create an object representing a QML element.\r\n * @param {String} type The type of the element\r\n * @param {String} onProp The name of the property specified with the \"on\" keyword\r\n */\r\nfunction QMLMetaElement(type, onProp) {\r\n    this.$class = type;\r\n    this.$children = [];\r\n    this.$on = onProp;\r\n}\r\n\r\n// Convert parser tree to the format understood by engine\r\nfunction convertToEngine(tree) {\r\n\r\n    // Help logger\r\n    function amIn(str, tree) {\r\n        console.log(str);\r\n        if (tree) console.log(JSON.stringify(tree, null, \"  \"));\r\n    }\r\n\r\n    var walkers = {\r\n        \"toplevel\": function(imports, statement) {\r\n            var item = { $class: \"QMLDocument\" };\r\n            item.$imports = imports;\r\n            item.$children = [ walk(statement) ];\r\n            return item;\r\n        },\r\n        \"qmlelem\": function(elem, onProp, statements) {\r\n            var item = new QMLMetaElement(elem, onProp);\r\n\r\n            for (var i in statements) {\r\n                var statement = statements[i],\r\n                    name = statement[1],\r\n                    val = walk(statement);\r\n                switch (statement[0]) {\r\n                    case \"qmldefaultprop\":\r\n                        item.$defaultProperty = name;\r\n                    case \"qmlprop\":\r\n                    case \"qmlpropdef\":\r\n                    case \"qmlaliasdef\":\r\n                    case \"qmlmethod\":\r\n                    case \"qmlsignaldef\":\r\n                        item[name] = val;\r\n                        break;\r\n                    case \"qmlelem\":\r\n                        item.$children.push(val);\r\n                        break;\r\n                    case \"qmlobjdef\":\r\n                        // Create object to item\r\n                        item[name] = item[name] || new QMLMetaPropertyGroup();\r\n                        item[name][statement[2]] = val;\r\n                        break;\r\n                    case \"qmlobj\":\r\n                        // Create object to item\r\n                        item[name] = item[name] || new QMLMetaPropertyGroup();\r\n                        for (var i in val)\r\n                            item[name][i] = val[i];\r\n                        break;\r\n                    default:\r\n                        console.log(\"Unknown statement\", statement);\r\n\r\n                }\r\n            }\r\n            // Make $children be either a single item or an array, if it's more than one\r\n            if (item.$children.length === 1)\r\n                item.$children = item.$children[0];\r\n\r\n            return item;\r\n        },\r\n        \"qmlprop\": function(name, tree, src) {\r\n            if (name == \"id\") {\r\n                // id property\r\n                return tree[1][1];\r\n            }\r\n            return bindout(tree, src);\r\n        },\r\n        \"qmlobjdef\": function(name, property, tree, src) {\r\n            return bindout(tree, src);\r\n        },\r\n        \"qmlobj\": function(elem, statements) {\r\n            var item = {};\r\n\r\n            for (var i in statements) {\r\n                var statement = statements[i],\r\n                    name = statement[1],\r\n                    val = walk(statement);\r\n                if (statement[0] == \"qmlprop\")\r\n                    item[name] = val;\r\n            }\r\n\r\n            return item;\r\n        },\r\n        \"qmlmethod\": function(name, tree, src) {\r\n            return new QMLMethod(src);\r\n        },\r\n        \"qmlpropdef\": function(name, type, tree, src) {\r\n            return new QMLPropertyDefinition(type, tree ? bindout(tree, src) : \"\");\r\n        },\r\n        \"qmlaliasdef\": function(name, objName, propName) {\r\n            return new QMLAliasDefinition(objName, propName);\r\n        },\r\n        \"qmlsignaldef\": function(name, params) {\r\n            return new QMLSignalDefinition(params);\r\n        },\r\n        \"qmldefaultprop\": function(tree) {\r\n            return walk(tree);\r\n        },\r\n        \"name\": function(src) {\r\n            if (src == \"true\" || src == \"false\")\r\n                return src == \"true\";\r\n            return new QMLBinding(src, [\"name\", src]);\r\n        },\r\n        \"num\": function(src) {\r\n            return +src;\r\n        },\r\n        \"string\": function(src) {\r\n            return String(src);\r\n        },\r\n        \"array\": function(tree, src) {\r\n            var a = [];\r\n            var isList = false;\r\n            var hasBinding = false;\r\n            for (var i in tree) {\r\n                var val = bindout(tree[i]);\r\n                a.push(val);\r\n\r\n                if (val instanceof QMLMetaElement)\r\n                    isList = true;\r\n                else if (val instanceof QMLBinding)\r\n                    hasBinding = true;\r\n            }\r\n\r\n            if (hasBinding) {\r\n                if (isList)\r\n                    throw new TypeError(\"An array may either contain bindings or Element definitions.\");\r\n                return new QMLBinding(src, tree);\r\n            }\r\n\r\n            return a;\r\n        }\r\n    };\r\n\r\n    function walk(tree) {\r\n        var type = tree[0];\r\n        var walker = walkers[type];\r\n        if (!walker) {\r\n            console.log(\"No walker for \" + type);\r\n            return;\r\n        } else {\r\n            return walker.apply(type, tree.slice(1));\r\n        }\r\n    }\r\n\r\n    return walk(tree);\r\n\r\n    // Try to bind out tree and return static variable instead of binding\r\n    function bindout(tree, binding) {\r\n        if (tree[0] === \"stat\") // We want to process the content of the statement\r\n            tree = tree[1];     // (but still handle the case, we get the content directly)\r\n        var type = tree[0];\r\n        var walker = walkers[type];\r\n        if (walker) {\r\n            return walker.apply(type, tree.slice(1));\r\n        } else {\r\n            return new QMLBinding(binding, tree);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// Function to parse qml and output tree expected by engine\r\nfunction parseQML(src) {\r\n    var parsetree = qmlweb_parse(src, qmlweb_parse.QmlDocument);\r\n    return convertToEngine(parsetree);\r\n}\r\n\r\nif (typeof global != \"undefined\") {\r\n  global.qmlweb_parse = qmlweb_parse;\r\n}\r\n\n/***********************************************************************\r\n\r\n  A JavaScript tokenizer / parser / beautifier / compressor.\r\n\r\n  This version is suitable for Node.js.  With minimal changes (the\r\n  exports stuff) it should work on any JS platform.\r\n\r\n  This file implements some AST processors.  They work on data built\r\n  by parse-js.\r\n\r\n  Exported functions:\r\n\r\n    - ast_mangle(ast, options) -- mangles the variable/function names\r\n      in the AST.  Returns an AST.\r\n\r\n    - ast_squeeze(ast) -- employs various optimizations to make the\r\n      final generated code even smaller.  Returns an AST.\r\n\r\n    - gen_code(ast, options) -- generates JS code from the AST.  Pass\r\n      true (or an object, see the code for some options) as second\r\n      argument to get \"pretty\" (indented) code.\r\n\r\n  -------------------------------- (C) ---------------------------------\r\n\r\n                           Author: Mihai Bazon\r\n                         <mihai.bazon@gmail.com>\r\n                       http://mihai.bazon.net/blog\r\n\r\n  Distributed under the BSD license:\r\n\r\n    Copyright 2011 (c) Lauri Paimen <lauri@paimen.info>\r\n    Copyright 2010 (c) Mihai Bazon <mihai.bazon@gmail.com>\r\n\r\n    Redistribution and use in source and binary forms, with or without\r\n    modification, are permitted provided that the following conditions\r\n    are met:\r\n\r\n        * Redistributions of source code must retain the above\r\n          copyright notice, this list of conditions and the following\r\n          disclaimer.\r\n\r\n        * Redistributions in binary form must reproduce the above\r\n          copyright notice, this list of conditions and the following\r\n          disclaimer in the documentation and/or other materials\r\n          provided with the distribution.\r\n\r\n    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AS IS AND ANY\r\n    EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\r\n    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\r\n    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\r\n    TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\r\n    THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\r\n    SUCH DAMAGE.\r\n\r\n ***********************************************************************/\r\n\r\n/*\r\n * Based on Javascript parser written by Mihai Bazon for UglifyJS project.\r\n * That, again, is a port of Javascript parser by Marijn Haverbeke.\r\n * Big thanks to both of you (and others involved)!\r\n * UglifyJS: https://github.com/mishoo/UglifyJS\r\n * Marijn's parser: http://marijn.haverbeke.nl/parse-js/\r\n *\r\n * The primary goal of this file is to offer QML parsing *on top of UglifyJS\r\n * parser* and to change Javascript parts as little as possible. If you find\r\n * bugs/improvements to Javascript parsing parts, check if those are fixed to\r\n * UglifyJS parser first. If not, fix them there. After UglifyJS has been fixed,\r\n * backport the changes to this file. Less changes to Javascript, more easy it\r\n * will be to keep up with UglifyJS.\r\n * Ultimately it would be great to keep the original parser and QML additions in\r\n * different files but the structure of code does not support that.\r\n */\r\n\r\n/*\r\nvar jsp = require(\"./parse-js\"),\r\n    slice = jsp.slice,\r\n    member = jsp.member,\r\n    PRECEDENCE = jsp.PRECEDENCE,\r\n    OPERATORS = jsp.OPERATORS;\r\n*/\r\n\r\n/* -----[ helper for AST traversal ]----- */\r\n\r\nfunction ast_walker(ast) {\r\n        function _vardefs(defs) {\r\n                return [ this[0], MAP(defs, function(def){\r\n                        var a = [ def[0] ];\r\n                        if (def.length > 1)\r\n                                a[1] = walk(def[1]);\r\n                        return a;\r\n                }) ];\r\n        };\r\n        function _block(statements) {\r\n                var out = [ this[0] ];\r\n                if (statements != null)\r\n                        out.push(MAP(statements, walk));\r\n                return out;\r\n        };\r\n        var walkers = {\r\n                \"string\": function(str) {\r\n                        return [ this[0], str ];\r\n                },\r\n                \"num\": function(num) {\r\n                        return [ this[0], num ];\r\n                },\r\n                \"name\": function(name) {\r\n                        return [ this[0], name ];\r\n                },\r\n                \"toplevel\": function(statements) {\r\n                        return [ this[0], MAP(statements, walk) ];\r\n                },\r\n                \"block\": _block,\r\n                \"splice\": _block,\r\n                \"var\": _vardefs,\r\n                \"const\": _vardefs,\r\n                \"try\": function(t, c, f) {\r\n                        return [\r\n                                this[0],\r\n                                MAP(t, walk),\r\n                                c != null ? [ c[0], MAP(c[1], walk) ] : null,\r\n                                f != null ? MAP(f, walk) : null\r\n                        ];\r\n                },\r\n                \"throw\": function(expr) {\r\n                        return [ this[0], walk(expr) ];\r\n                },\r\n                \"new\": function(ctor, args) {\r\n                        return [ this[0], walk(ctor), MAP(args, walk) ];\r\n                },\r\n                \"switch\": function(expr, body) {\r\n                        return [ this[0], walk(expr), MAP(body, function(branch){\r\n                                return [ branch[0] ? walk(branch[0]) : null,\r\n                                         MAP(branch[1], walk) ];\r\n                        }) ];\r\n                },\r\n                \"break\": function(label) {\r\n                        return [ this[0], label ];\r\n                },\r\n                \"continue\": function(label) {\r\n                        return [ this[0], label ];\r\n                },\r\n                \"conditional\": function(cond, t, e) {\r\n                        return [ this[0], walk(cond), walk(t), walk(e) ];\r\n                },\r\n                \"assign\": function(op, lvalue, rvalue) {\r\n                        return [ this[0], op, walk(lvalue), walk(rvalue) ];\r\n                },\r\n                \"dot\": function(expr) {\r\n                        return [ this[0], walk(expr) ].concat(slice(arguments, 1));\r\n                },\r\n                \"call\": function(expr, args) {\r\n                        return [ this[0], walk(expr), MAP(args, walk) ];\r\n                },\r\n                \"function\": function(name, args, body) {\r\n                        return [ this[0], name, args.slice(), MAP(body, walk) ];\r\n                },\r\n                \"defun\": function(name, args, body) {\r\n                        return [ this[0], name, args.slice(), MAP(body, walk) ];\r\n                },\r\n                \"if\": function(conditional, t, e) {\r\n                        return [ this[0], walk(conditional), walk(t), walk(e) ];\r\n                },\r\n                \"for\": function(init, cond, step, block) {\r\n                        return [ this[0], walk(init), walk(cond), walk(step), walk(block) ];\r\n                },\r\n                \"for-in\": function(vvar, key, hash, block) {\r\n                        return [ this[0], walk(vvar), walk(key), walk(hash), walk(block) ];\r\n                },\r\n                \"while\": function(cond, block) {\r\n                        return [ this[0], walk(cond), walk(block) ];\r\n                },\r\n                \"do\": function(cond, block) {\r\n                        return [ this[0], walk(cond), walk(block) ];\r\n                },\r\n                \"return\": function(expr) {\r\n                        return [ this[0], walk(expr) ];\r\n                },\r\n                \"binary\": function(op, left, right) {\r\n                        return [ this[0], op, walk(left), walk(right) ];\r\n                },\r\n                \"unary-prefix\": function(op, expr) {\r\n                        return [ this[0], op, walk(expr) ];\r\n                },\r\n                \"unary-postfix\": function(op, expr) {\r\n                        return [ this[0], op, walk(expr) ];\r\n                },\r\n                \"sub\": function(expr, subscript) {\r\n                        return [ this[0], walk(expr), walk(subscript) ];\r\n                },\r\n                \"object\": function(props) {\r\n                        return [ this[0], MAP(props, function(p){\r\n                                return p.length == 2\r\n                                        ? [ p[0], walk(p[1]) ]\r\n                                        : [ p[0], walk(p[1]), p[2] ]; // get/set-ter\r\n                        }) ];\r\n                },\r\n                \"regexp\": function(rx, mods) {\r\n                        return [ this[0], rx, mods ];\r\n                },\r\n                \"array\": function(elements) {\r\n                        return [ this[0], MAP(elements, walk) ];\r\n                },\r\n                \"stat\": function(stat) {\r\n                        return [ this[0], walk(stat) ];\r\n                },\r\n                \"seq\": function() {\r\n                        return [ this[0] ].concat(MAP(slice(arguments), walk));\r\n                },\r\n                \"label\": function(name, block) {\r\n                        return [ this[0], name, walk(block) ];\r\n                },\r\n                \"with\": function(expr, block) {\r\n                        return [ this[0], walk(expr), walk(block) ];\r\n                },\r\n                \"atom\": function(name) {\r\n                        return [ this[0], name ];\r\n                }\r\n        };\r\n\r\n        var user = {};\r\n        var stack = [];\r\n        function walk(ast) {\r\n                if (ast == null)\r\n                        return null;\r\n                try {\r\n                        stack.push(ast);\r\n                        var type = ast[0];\r\n                        var gen = user[type];\r\n                        if (gen) {\r\n                                var ret = gen.apply(ast, ast.slice(1));\r\n                                if (ret != null)\r\n                                        return ret;\r\n                        }\r\n                        gen = walkers[type];\r\n                        return gen.apply(ast, ast.slice(1));\r\n                } finally {\r\n                        stack.pop();\r\n                }\r\n        };\r\n\r\n        function with_walkers(walkers, cont){\r\n                var save = {}, i;\r\n                for (i in walkers) if (HOP(walkers, i)) {\r\n                        save[i] = user[i];\r\n                        user[i] = walkers[i];\r\n                }\r\n                var ret = cont();\r\n                for (i in save) if (HOP(save, i)) {\r\n                        if (!save[i]) delete user[i];\r\n                        else user[i] = save[i];\r\n                }\r\n                return ret;\r\n        };\r\n\r\n        return {\r\n                walk: walk,\r\n                with_walkers: with_walkers,\r\n                parent: function() {\r\n                        return stack[stack.length - 2]; // last one is current node\r\n                },\r\n                stack: function() {\r\n                        return stack;\r\n                }\r\n        };\r\n};\r\n\r\n/* -----[ Scope and mangling ]----- */\r\n\r\nfunction Scope(parent) {\r\n        this.names = {};        // names defined in this scope\r\n        this.mangled = {};      // mangled names (orig.name => mangled)\r\n        this.rev_mangled = {};  // reverse lookup (mangled => orig.name)\r\n        this.cname = -1;        // current mangled name\r\n        this.refs = {};         // names referenced from this scope\r\n        this.uses_with = false; // will become TRUE if with() is detected in this or any subscopes\r\n        this.uses_eval = false; // will become TRUE if eval() is detected in this or any subscopes\r\n        this.parent = parent;   // parent scope\r\n        this.children = [];     // sub-scopes\r\n        if (parent) {\r\n                this.level = parent.level + 1;\r\n                parent.children.push(this);\r\n        } else {\r\n                this.level = 0;\r\n        }\r\n};\r\n\r\nvar base54 = (function(){\r\n        var DIGITS = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_\";\r\n        return function(num) {\r\n                var ret = \"\";\r\n                do {\r\n                        ret = DIGITS.charAt(num % 54) + ret;\r\n                        num = Math.floor(num / 54);\r\n                } while (num > 0);\r\n                return ret;\r\n        };\r\n})();\r\n\r\nScope.prototype = {\r\n        has: function(name) {\r\n                for (var s = this; s; s = s.parent)\r\n                        if (HOP(s.names, name))\r\n                                return s;\r\n        },\r\n        has_mangled: function(mname) {\r\n                for (var s = this; s; s = s.parent)\r\n                        if (HOP(s.rev_mangled, mname))\r\n                                return s;\r\n        },\r\n        toJSON: function() {\r\n                return {\r\n                        names: this.names,\r\n                        uses_eval: this.uses_eval,\r\n                        uses_with: this.uses_with\r\n                };\r\n        },\r\n\r\n        next_mangled: function() {\r\n                // we must be careful that the new mangled name:\r\n                //\r\n                // 1. doesn't shadow a mangled name from a parent\r\n                //    scope, unless we don't reference the original\r\n                //    name from this scope OR from any sub-scopes!\r\n                //    This will get slow.\r\n                //\r\n                // 2. doesn't shadow an original name from a parent\r\n                //    scope, in the event that the name is not mangled\r\n                //    in the parent scope and we reference that name\r\n                //    here OR IN ANY SUBSCOPES!\r\n                //\r\n                // 3. doesn't shadow a name that is referenced but not\r\n                //    defined (possibly global defined elsewhere).\r\n                for (;;) {\r\n                        var m = base54(++this.cname), prior;\r\n\r\n                        // case 1.\r\n                        prior = this.has_mangled(m);\r\n                        if (prior && this.refs[prior.rev_mangled[m]] === prior)\r\n                                continue;\r\n\r\n                        // case 2.\r\n                        prior = this.has(m);\r\n                        if (prior && prior !== this && this.refs[m] === prior && !prior.has_mangled(m))\r\n                                continue;\r\n\r\n                        // case 3.\r\n                        if (HOP(this.refs, m) && this.refs[m] == null)\r\n                                continue;\r\n\r\n                        // I got \"do\" once. :-/\r\n                        if (!is_identifier(m))\r\n                                continue;\r\n\r\n                        return m;\r\n                }\r\n        },\r\n        set_mangle: function(name, m) {\r\n                this.rev_mangled[m] = name;\r\n                return this.mangled[name] = m;\r\n        },\r\n        get_mangled: function(name, newMangle) {\r\n                if (this.uses_eval || this.uses_with) return name; // no mangle if eval or with is in use\r\n                var s = this.has(name);\r\n                if (!s) return name; // not in visible scope, no mangle\r\n                if (HOP(s.mangled, name)) return s.mangled[name]; // already mangled in this scope\r\n                if (!newMangle) return name;                      // not found and no mangling requested\r\n                return s.set_mangle(name, s.next_mangled());\r\n        },\r\n        references: function(name) {\r\n                return name && !this.parent || this.uses_with || this.uses_eval || this.refs[name];\r\n        },\r\n        define: function(name, type) {\r\n                if (name != null) {\r\n                        if (type == \"var\" || !HOP(this.names, name))\r\n                                this.names[name] = type || \"var\";\r\n                        return name;\r\n                }\r\n        }\r\n};\r\n\r\nfunction ast_add_scope(ast) {\r\n\r\n        var current_scope = null;\r\n        var w = ast_walker(), walk = w.walk;\r\n        var having_eval = [];\r\n\r\n        function with_new_scope(cont) {\r\n                current_scope = new Scope(current_scope);\r\n                var ret = current_scope.body = cont();\r\n                ret.scope = current_scope;\r\n                current_scope = current_scope.parent;\r\n                return ret;\r\n        };\r\n\r\n        function define(name, type) {\r\n                return current_scope.define(name, type);\r\n        };\r\n\r\n        function reference(name) {\r\n                current_scope.refs[name] = true;\r\n        };\r\n\r\n        function _lambda(name, args, body) {\r\n                var is_defun = this[0] == \"defun\";\r\n                return [ this[0], is_defun ? define(name, \"defun\") : name, args, with_new_scope(function(){\r\n                        if (!is_defun) define(name, \"lambda\");\r\n                        MAP(args, function(name){ define(name, \"arg\") });\r\n                        return MAP(body, walk);\r\n                })];\r\n        };\r\n\r\n        function _vardefs(type) {\r\n                return function(defs) {\r\n                        MAP(defs, function(d){\r\n                                define(d[0], type);\r\n                                if (d[1]) reference(d[0]);\r\n                        });\r\n                };\r\n        };\r\n\r\n        return with_new_scope(function(){\r\n                // process AST\r\n                var ret = w.with_walkers({\r\n                        \"function\": _lambda,\r\n                        \"defun\": _lambda,\r\n                        \"label\": function(name, stat) { define(name, \"label\") },\r\n                        \"break\": function(label) { if (label) reference(label) },\r\n                        \"continue\": function(label) { if (label) reference(label) },\r\n                        \"with\": function(expr, block) {\r\n                                for (var s = current_scope; s; s = s.parent)\r\n                                        s.uses_with = true;\r\n                        },\r\n                        \"var\": _vardefs(\"var\"),\r\n                        \"const\": _vardefs(\"const\"),\r\n                        \"try\": function(t, c, f) {\r\n                                if (c != null) return [\r\n                                        this[0],\r\n                                        MAP(t, walk),\r\n                                        [ define(c[0], \"catch\"), MAP(c[1], walk) ],\r\n                                        f != null ? MAP(f, walk) : null\r\n                                ];\r\n                        },\r\n                        \"name\": function(name) {\r\n                                if (name == \"eval\")\r\n                                        having_eval.push(current_scope);\r\n                                reference(name);\r\n                        }\r\n                }, function(){\r\n                        return walk(ast);\r\n                });\r\n\r\n                // the reason why we need an additional pass here is\r\n                // that names can be used prior to their definition.\r\n\r\n                // scopes where eval was detected and their parents\r\n                // are marked with uses_eval, unless they define the\r\n                // \"eval\" name.\r\n                MAP(having_eval, function(scope){\r\n                        if (!scope.has(\"eval\")) while (scope) {\r\n                                scope.uses_eval = true;\r\n                                scope = scope.parent;\r\n                        }\r\n                });\r\n\r\n                // for referenced names it might be useful to know\r\n                // their origin scope.  current_scope here is the\r\n                // toplevel one.\r\n                function fixrefs(scope, i) {\r\n                        // do children first; order shouldn't matter\r\n                        for (i = scope.children.length; --i >= 0;)\r\n                                fixrefs(scope.children[i]);\r\n                        for (i in scope.refs) if (HOP(scope.refs, i)) {\r\n                                // find origin scope and propagate the reference to origin\r\n                                for (var origin = scope.has(i), s = scope; s; s = s.parent) {\r\n                                        s.refs[i] = origin;\r\n                                        if (s === origin) break;\r\n                                }\r\n                        }\r\n                };\r\n                fixrefs(current_scope);\r\n\r\n                return ret;\r\n        });\r\n\r\n};\r\n\r\n/* -----[ mangle names ]----- */\r\n\r\nfunction ast_mangle(ast, options) {\r\n        var w = ast_walker(), walk = w.walk, scope;\r\n        options = options || {};\r\n\r\n        function get_mangled(name, newMangle) {\r\n                if (!options.toplevel && !scope.parent) return name; // don't mangle toplevel\r\n                if (options.except && member(name, options.except))\r\n                        return name;\r\n                return scope.get_mangled(name, newMangle);\r\n        };\r\n\r\n        function get_define(name) {\r\n                if (options.defines) {\r\n                        // we always lookup a defined symbol for the current scope FIRST, so declared\r\n                        // vars trump a DEFINE symbol, but if no such var is found, then match a DEFINE value\r\n                        if (!scope.has(name)) {\r\n                                if (HOP(options.defines, name)) {\r\n                                        return options.defines[name];\r\n                                }\r\n                        }\r\n                        return null;\r\n                }\r\n        };\r\n\r\n        function _lambda(name, args, body) {\r\n                var is_defun = this[0] == \"defun\", extra;\r\n                if (name) {\r\n                        if (is_defun) name = get_mangled(name);\r\n                        else {\r\n                                extra = {};\r\n                                if (!(scope.uses_eval || scope.uses_with))\r\n                                        name = extra[name] = scope.next_mangled();\r\n                                else\r\n                                        extra[name] = name;\r\n                        }\r\n                }\r\n                body = with_scope(body.scope, function(){\r\n                        args = MAP(args, function(name){ return get_mangled(name) });\r\n                        return MAP(body, walk);\r\n                }, extra);\r\n                return [ this[0], name, args, body ];\r\n        };\r\n\r\n        function with_scope(s, cont, extra) {\r\n                var _scope = scope;\r\n                scope = s;\r\n                if (extra) for (var i in extra) if (HOP(extra, i)) {\r\n                        s.set_mangle(i, extra[i]);\r\n                }\r\n                for (var i in s.names) if (HOP(s.names, i)) {\r\n                        get_mangled(i, true);\r\n                }\r\n                var ret = cont();\r\n                ret.scope = s;\r\n                scope = _scope;\r\n                return ret;\r\n        };\r\n\r\n        function _vardefs(defs) {\r\n                return [ this[0], MAP(defs, function(d){\r\n                        return [ get_mangled(d[0]), walk(d[1]) ];\r\n                }) ];\r\n        };\r\n\r\n        return w.with_walkers({\r\n                \"function\": _lambda,\r\n                \"defun\": function() {\r\n                        // move function declarations to the top when\r\n                        // they are not in some block.\r\n                        var ast = _lambda.apply(this, arguments);\r\n                        switch (w.parent()[0]) {\r\n                            case \"toplevel\":\r\n                            case \"function\":\r\n                            case \"defun\":\r\n                                return MAP.at_top(ast);\r\n                        }\r\n                        return ast;\r\n                },\r\n                \"label\": function(label, stat) { return [ this[0], get_mangled(label), walk(stat) ] },\r\n                \"break\": function(label) { if (label) return [ this[0], get_mangled(label) ] },\r\n                \"continue\": function(label) { if (label) return [ this[0], get_mangled(label) ] },\r\n                \"var\": _vardefs,\r\n                \"const\": _vardefs,\r\n                \"name\": function(name) {\r\n                        return get_define(name) || [ this[0], get_mangled(name) ];\r\n                },\r\n                \"try\": function(t, c, f) {\r\n                        return [ this[0],\r\n                                 MAP(t, walk),\r\n                                 c != null ? [ get_mangled(c[0]), MAP(c[1], walk) ] : null,\r\n                                 f != null ? MAP(f, walk) : null ];\r\n                },\r\n                \"toplevel\": function(body) {\r\n                        var self = this;\r\n                        return with_scope(self.scope, function(){\r\n                                return [ self[0], MAP(body, walk) ];\r\n                        });\r\n                }\r\n        }, function() {\r\n                return walk(ast_add_scope(ast));\r\n        });\r\n};\r\n\r\n/* -----[\r\n   - compress foo[\"bar\"] into foo.bar,\r\n   - remove block brackets {} where possible\r\n   - join consecutive var declarations\r\n   - various optimizations for IFs:\r\n     - if (cond) foo(); else bar();  ==>  cond?foo():bar();\r\n     - if (cond) foo();  ==>  cond&&foo();\r\n     - if (foo) return bar(); else return baz();  ==> return foo?bar():baz(); // also for throw\r\n     - if (foo) return bar(); else something();  ==> {if(foo)return bar();something()}\r\n   ]----- */\r\n\r\nvar warn = function(){};\r\n\r\nfunction best_of(ast1, ast2) {\r\n        return gen_code(ast1).length > gen_code(ast2[0] == \"stat\" ? ast2[1] : ast2).length ? ast2 : ast1;\r\n};\r\n\r\nfunction last_stat(b) {\r\n        if (b[0] == \"block\" && b[1] && b[1].length > 0)\r\n                return b[1][b[1].length - 1];\r\n        return b;\r\n}\r\n\r\nfunction aborts(t) {\r\n        if (t) switch (last_stat(t)[0]) {\r\n            case \"return\":\r\n            case \"break\":\r\n            case \"continue\":\r\n            case \"throw\":\r\n                return true;\r\n        }\r\n};\r\n\r\nfunction boolean_expr(expr) {\r\n        return ( (expr[0] == \"unary-prefix\"\r\n                  && member(expr[1], [ \"!\", \"delete\" ])) ||\r\n\r\n                 (expr[0] == \"binary\"\r\n                  && member(expr[1], [ \"in\", \"instanceof\", \"==\", \"!=\", \"===\", \"!==\", \"<\", \"<=\", \">=\", \">\" ])) ||\r\n\r\n                 (expr[0] == \"binary\"\r\n                  && member(expr[1], [ \"&&\", \"||\" ])\r\n                  && boolean_expr(expr[2])\r\n                  && boolean_expr(expr[3])) ||\r\n\r\n                 (expr[0] == \"conditional\"\r\n                  && boolean_expr(expr[2])\r\n                  && boolean_expr(expr[3])) ||\r\n\r\n                 (expr[0] == \"assign\"\r\n                  && expr[1] === true\r\n                  && boolean_expr(expr[3])) ||\r\n\r\n                 (expr[0] == \"seq\"\r\n                  && boolean_expr(expr[expr.length - 1]))\r\n               );\r\n};\r\n\r\nfunction make_conditional(c, t, e) {\r\n    var make_real_conditional = function() {\r\n        if (c[0] == \"unary-prefix\" && c[1] == \"!\") {\r\n            return e ? [ \"conditional\", c[2], e, t ] : [ \"binary\", \"||\", c[2], t ];\r\n        } else {\r\n            return e ? [ \"conditional\", c, t, e ] : [ \"binary\", \"&&\", c, t ];\r\n        }\r\n    };\r\n    // shortcut the conditional if the expression has a constant value\r\n    return when_constant(c, function(ast, val){\r\n        warn_unreachable(val ? e : t);\r\n        return          (val ? t : e);\r\n    }, make_real_conditional);\r\n};\r\n\r\nfunction empty(b) {\r\n        return !b || (b[0] == \"block\" && (!b[1] || b[1].length == 0));\r\n};\r\n\r\nfunction is_string(node) {\r\n        return (node[0] == \"string\" ||\r\n                node[0] == \"unary-prefix\" && node[1] == \"typeof\" ||\r\n                node[0] == \"binary\" && node[1] == \"+\" &&\r\n                (is_string(node[2]) || is_string(node[3])));\r\n};\r\n\r\nvar when_constant = (function(){\r\n\r\n        var $NOT_CONSTANT = {};\r\n\r\n        // this can only evaluate constant expressions.  If it finds anything\r\n        // not constant, it throws $NOT_CONSTANT.\r\n        function evaluate(expr) {\r\n                switch (expr[0]) {\r\n                    case \"string\":\r\n                    case \"num\":\r\n                        return expr[1];\r\n                    case \"name\":\r\n                    case \"atom\":\r\n                        switch (expr[1]) {\r\n                            case \"true\": return true;\r\n                            case \"false\": return false;\r\n                        }\r\n                        break;\r\n                    case \"unary-prefix\":\r\n                        switch (expr[1]) {\r\n                            case \"!\": return !evaluate(expr[2]);\r\n                            case \"typeof\": return typeof evaluate(expr[2]);\r\n                            case \"~\": return ~evaluate(expr[2]);\r\n                            case \"-\": return -evaluate(expr[2]);\r\n                            case \"+\": return +evaluate(expr[2]);\r\n                        }\r\n                        break;\r\n                    case \"binary\":\r\n                        var left = expr[2], right = expr[3];\r\n                        switch (expr[1]) {\r\n                            case \"&&\"         : return evaluate(left) &&         evaluate(right);\r\n                            case \"||\"         : return evaluate(left) ||         evaluate(right);\r\n                            case \"|\"          : return evaluate(left) |          evaluate(right);\r\n                            case \"&\"          : return evaluate(left) &          evaluate(right);\r\n                            case \"^\"          : return evaluate(left) ^          evaluate(right);\r\n                            case \"+\"          : return evaluate(left) +          evaluate(right);\r\n                            case \"*\"          : return evaluate(left) *          evaluate(right);\r\n                            case \"/\"          : return evaluate(left) /          evaluate(right);\r\n                            case \"-\"          : return evaluate(left) -          evaluate(right);\r\n                            case \"<<\"         : return evaluate(left) <<         evaluate(right);\r\n                            case \">>\"         : return evaluate(left) >>         evaluate(right);\r\n                            case \">>>\"        : return evaluate(left) >>>        evaluate(right);\r\n                            case \"==\"         : return evaluate(left) ==         evaluate(right);\r\n                            case \"===\"        : return evaluate(left) ===        evaluate(right);\r\n                            case \"!=\"         : return evaluate(left) !=         evaluate(right);\r\n                            case \"!==\"        : return evaluate(left) !==        evaluate(right);\r\n                            case \"<\"          : return evaluate(left) <          evaluate(right);\r\n                            case \"<=\"         : return evaluate(left) <=         evaluate(right);\r\n                            case \">\"          : return evaluate(left) >          evaluate(right);\r\n                            case \">=\"         : return evaluate(left) >=         evaluate(right);\r\n                            case \"in\"         : return evaluate(left) in         evaluate(right);\r\n                            case \"instanceof\" : return evaluate(left) instanceof evaluate(right);\r\n                        }\r\n                }\r\n                throw $NOT_CONSTANT;\r\n        };\r\n\r\n        return function(expr, yes, no) {\r\n                try {\r\n                        var val = evaluate(expr), ast;\r\n                        switch (typeof val) {\r\n                            case \"string\": ast =  [ \"string\", val ]; break;\r\n                            case \"number\": ast =  [ \"num\", val ]; break;\r\n                            case \"boolean\": ast =  [ \"name\", String(val) ]; break;\r\n                            default: throw new Error(\"Can't handle constant of type: \" + (typeof val));\r\n                        }\r\n                        return yes.call(expr, ast, val);\r\n                } catch(ex) {\r\n                        if (ex === $NOT_CONSTANT) {\r\n                                if (expr[0] == \"binary\"\r\n                                    && (expr[1] == \"===\" || expr[1] == \"!==\")\r\n                                    && ((is_string(expr[2]) && is_string(expr[3]))\r\n                                        || (boolean_expr(expr[2]) && boolean_expr(expr[3])))) {\r\n                                        expr[1] = expr[1].substr(0, 2);\r\n                                }\r\n                                else if (no && expr[0] == \"binary\"\r\n                                         && (expr[1] == \"||\" || expr[1] == \"&&\")) {\r\n                                    // the whole expression is not constant but the lval may be...\r\n                                    try {\r\n                                        var lval = evaluate(expr[2]);\r\n                                        expr = ((expr[1] == \"&&\" && (lval ? expr[3] : lval))    ||\r\n                                                (expr[1] == \"||\" && (lval ? lval    : expr[3])) ||\r\n                                                expr);\r\n                                    } catch(ex2) {\r\n                                        // IGNORE... lval is not constant\r\n                                    }\r\n                                }\r\n                                return no ? no.call(expr, expr) : null;\r\n                        }\r\n                        else throw ex;\r\n                }\r\n        };\r\n\r\n})();\r\n\r\nfunction warn_unreachable(ast) {\r\n        if (!empty(ast))\r\n                warn(\"Dropping unreachable code: \" + gen_code(ast, true));\r\n};\r\n\r\nfunction prepare_ifs(ast) {\r\n        var w = ast_walker(), walk = w.walk;\r\n        // In this first pass, we rewrite ifs which abort with no else with an\r\n        // if-else.  For example:\r\n        //\r\n        // if (x) {\r\n        //     blah();\r\n        //     return y;\r\n        // }\r\n        // foobar();\r\n        //\r\n        // is rewritten into:\r\n        //\r\n        // if (x) {\r\n        //     blah();\r\n        //     return y;\r\n        // } else {\r\n        //     foobar();\r\n        // }\r\n        function redo_if(statements) {\r\n                statements = MAP(statements, walk);\r\n\r\n                for (var i = 0; i < statements.length; ++i) {\r\n                        var fi = statements[i];\r\n                        if (fi[0] != \"if\") continue;\r\n\r\n                        if (fi[3] && walk(fi[3])) continue;\r\n\r\n                        var t = walk(fi[2]);\r\n                        if (!aborts(t)) continue;\r\n\r\n                        var conditional = walk(fi[1]);\r\n\r\n                        var e_body = statements.slice(i + 1);\r\n                        var e = e_body.length == 1 ? e_body[0] : [ \"block\", e_body ];\r\n\r\n                        var ret = statements.slice(0, i).concat([ [\r\n                                fi[0],          // \"if\"\r\n                                conditional,    // conditional\r\n                                t,              // then\r\n                                e               // else\r\n                        ] ]);\r\n\r\n                        return redo_if(ret);\r\n                }\r\n\r\n                return statements;\r\n        };\r\n\r\n        function redo_if_lambda(name, args, body) {\r\n                body = redo_if(body);\r\n                return [ this[0], name, args, body ];\r\n        };\r\n\r\n        function redo_if_block(statements) {\r\n                return [ this[0], statements != null ? redo_if(statements) : null ];\r\n        };\r\n\r\n        return w.with_walkers({\r\n                \"defun\": redo_if_lambda,\r\n                \"function\": redo_if_lambda,\r\n                \"block\": redo_if_block,\r\n                \"splice\": redo_if_block,\r\n                \"toplevel\": function(statements) {\r\n                        return [ this[0], redo_if(statements) ];\r\n                },\r\n                \"try\": function(t, c, f) {\r\n                        return [\r\n                                this[0],\r\n                                redo_if(t),\r\n                                c != null ? [ c[0], redo_if(c[1]) ] : null,\r\n                                f != null ? redo_if(f) : null\r\n                        ];\r\n                }\r\n        }, function() {\r\n                return walk(ast);\r\n        });\r\n};\r\n\r\nfunction for_side_effects(ast, handler) {\r\n        var w = ast_walker(), walk = w.walk;\r\n        var $stop = {}, $restart = {};\r\n        function stop() { throw $stop };\r\n        function restart() { throw $restart };\r\n        function found(){ return handler.call(this, this, w, stop, restart) };\r\n        function unary(op) {\r\n                if (op == \"++\" || op == \"--\")\r\n                        return found.apply(this, arguments);\r\n        };\r\n        return w.with_walkers({\r\n                \"try\": found,\r\n                \"throw\": found,\r\n                \"return\": found,\r\n                \"new\": found,\r\n                \"switch\": found,\r\n                \"break\": found,\r\n                \"continue\": found,\r\n                \"assign\": found,\r\n                \"call\": found,\r\n                \"if\": found,\r\n                \"for\": found,\r\n                \"for-in\": found,\r\n                \"while\": found,\r\n                \"do\": found,\r\n                \"return\": found,\r\n                \"unary-prefix\": unary,\r\n                \"unary-postfix\": unary,\r\n                \"defun\": found\r\n        }, function(){\r\n                while (true) try {\r\n                        walk(ast);\r\n                        break;\r\n                } catch(ex) {\r\n                        if (ex === $stop) break;\r\n                        if (ex === $restart) continue;\r\n                        throw ex;\r\n                }\r\n        });\r\n};\r\n\r\nfunction ast_lift_variables(ast) {\r\n        var w = ast_walker(), walk = w.walk, scope;\r\n        function do_body(body, env) {\r\n                var _scope = scope;\r\n                scope = env;\r\n                body = MAP(body, walk);\r\n                var hash = {}, names = MAP(env.names, function(type, name){\r\n                        if (type != \"var\") return MAP.skip;\r\n                        if (!env.references(name)) return MAP.skip;\r\n                        hash[name] = true;\r\n                        return [ name ];\r\n                });\r\n                if (names.length > 0) {\r\n                        // looking for assignments to any of these variables.\r\n                        // we can save considerable space by moving the definitions\r\n                        // in the var declaration.\r\n                        for_side_effects([ \"block\", body ], function(ast, walker, stop, restart) {\r\n                                if (ast[0] == \"assign\"\r\n                                    && ast[1] === true\r\n                                    && ast[2][0] == \"name\"\r\n                                    && HOP(hash, ast[2][1])) {\r\n                                        // insert the definition into the var declaration\r\n                                        for (var i = names.length; --i >= 0;) {\r\n                                                if (names[i][0] == ast[2][1]) {\r\n                                                        if (names[i][1]) // this name already defined, we must stop\r\n                                                                stop();\r\n                                                        names[i][1] = ast[3]; // definition\r\n                                                        names.push(names.splice(i, 1)[0]);\r\n                                                        break;\r\n                                                }\r\n                                        }\r\n                                        // remove this assignment from the AST.\r\n                                        var p = walker.parent();\r\n                                        if (p[0] == \"seq\") {\r\n                                                var a = p[2];\r\n                                                a.unshift(0, p.length);\r\n                                                p.splice.apply(p, a);\r\n                                        }\r\n                                        else if (p[0] == \"stat\") {\r\n                                                p.splice(0, p.length, \"block\"); // empty statement\r\n                                        }\r\n                                        else {\r\n                                                stop();\r\n                                        }\r\n                                        restart();\r\n                                }\r\n                                stop();\r\n                        });\r\n                        body.unshift([ \"var\", names ]);\r\n                }\r\n                scope = _scope;\r\n                return body;\r\n        };\r\n        function _vardefs(defs) {\r\n                var ret = null;\r\n                for (var i = defs.length; --i >= 0;) {\r\n                        var d = defs[i];\r\n                        if (!d[1]) continue;\r\n                        d = [ \"assign\", true, [ \"name\", d[0] ], d[1] ];\r\n                        if (ret == null) ret = d;\r\n                        else ret = [ \"seq\", d, ret ];\r\n                }\r\n                if (ret == null) {\r\n                        if (w.parent()[0] == \"for-in\")\r\n                                return [ \"name\", defs[0][0] ];\r\n                        return MAP.skip;\r\n                }\r\n                return [ \"stat\", ret ];\r\n        };\r\n        function _toplevel(body) {\r\n                return [ this[0], do_body(body, this.scope) ];\r\n        };\r\n        return w.with_walkers({\r\n                \"function\": function(name, args, body){\r\n                        for (var i = args.length; --i >= 0 && !body.scope.references(args[i]);)\r\n                                args.pop();\r\n                        if (!body.scope.references(name)) name = null;\r\n                        return [ this[0], name, args, do_body(body, body.scope) ];\r\n                },\r\n                \"defun\": function(name, args, body){\r\n                        if (!scope.references(name)) return MAP.skip;\r\n                        for (var i = args.length; --i >= 0 && !body.scope.references(args[i]);)\r\n                                args.pop();\r\n                        return [ this[0], name, args, do_body(body, body.scope) ];\r\n                },\r\n                \"var\": _vardefs,\r\n                \"toplevel\": _toplevel\r\n        }, function(){\r\n                return walk(ast_add_scope(ast));\r\n        });\r\n};\r\n\r\nfunction ast_squeeze(ast, options) {\r\n        options = defaults(options, {\r\n                make_seqs   : true,\r\n                dead_code   : true,\r\n                keep_comps  : true,\r\n                no_warnings : false\r\n        });\r\n\r\n        var w = ast_walker(), walk = w.walk, scope;\r\n\r\n        function negate(c) {\r\n                var not_c = [ \"unary-prefix\", \"!\", c ];\r\n                switch (c[0]) {\r\n                    case \"unary-prefix\":\r\n                        return c[1] == \"!\" && boolean_expr(c[2]) ? c[2] : not_c;\r\n                    case \"seq\":\r\n                        c = slice(c);\r\n                        c[c.length - 1] = negate(c[c.length - 1]);\r\n                        return c;\r\n                    case \"conditional\":\r\n                        return best_of(not_c, [ \"conditional\", c[1], negate(c[2]), negate(c[3]) ]);\r\n                    case \"binary\":\r\n                        var op = c[1], left = c[2], right = c[3];\r\n                        if (!options.keep_comps) switch (op) {\r\n                            case \"<=\"  : return [ \"binary\", \">\", left, right ];\r\n                            case \"<\"   : return [ \"binary\", \">=\", left, right ];\r\n                            case \">=\"  : return [ \"binary\", \"<\", left, right ];\r\n                            case \">\"   : return [ \"binary\", \"<=\", left, right ];\r\n                        }\r\n                        switch (op) {\r\n                            case \"==\"  : return [ \"binary\", \"!=\", left, right ];\r\n                            case \"!=\"  : return [ \"binary\", \"==\", left, right ];\r\n                            case \"===\" : return [ \"binary\", \"!==\", left, right ];\r\n                            case \"!==\" : return [ \"binary\", \"===\", left, right ];\r\n                            case \"&&\"  : return best_of(not_c, [ \"binary\", \"||\", negate(left), negate(right) ]);\r\n                            case \"||\"  : return best_of(not_c, [ \"binary\", \"&&\", negate(left), negate(right) ]);\r\n                        }\r\n                        break;\r\n                }\r\n                return not_c;\r\n        };\r\n\r\n        function with_scope(s, cont) {\r\n                var _scope = scope;\r\n                scope = s;\r\n                var ret = cont();\r\n                ret.scope = s;\r\n                scope = _scope;\r\n                return ret;\r\n        };\r\n\r\n        function rmblock(block) {\r\n                if (block != null && block[0] == \"block\" && block[1]) {\r\n                        if (block[1].length == 1)\r\n                                block = block[1][0];\r\n                        else if (block[1].length == 0)\r\n                                block = [ \"block\" ];\r\n                }\r\n                return block;\r\n        };\r\n\r\n        function _lambda(name, args, body) {\r\n                var is_defun = this[0] == \"defun\";\r\n                body = with_scope(body.scope, function(){\r\n                        var ret = tighten(body, \"lambda\");\r\n                        if (!is_defun && name && !scope.references(name))\r\n                                name = null;\r\n                        return ret;\r\n                });\r\n                return [ this[0], name, args, body ];\r\n        };\r\n\r\n        // this function does a few things:\r\n        // 1. discard useless blocks\r\n        // 2. join consecutive var declarations\r\n        // 3. remove obviously dead code\r\n        // 4. transform consecutive statements using the comma operator\r\n        // 5. if block_type == \"lambda\" and it detects constructs like if(foo) return ... - rewrite like if (!foo) { ... }\r\n        function tighten(statements, block_type) {\r\n                statements = MAP(statements, walk);\r\n\r\n                statements = statements.reduce(function(a, stat){\r\n                        if (stat[0] == \"block\") {\r\n                                if (stat[1]) {\r\n                                        a.push.apply(a, stat[1]);\r\n                                }\r\n                        } else {\r\n                                a.push(stat);\r\n                        }\r\n                        return a;\r\n                }, []);\r\n\r\n                statements = (function(a, prev){\r\n                        statements.forEach(function(cur){\r\n                                if (prev && ((cur[0] == \"var\" && prev[0] == \"var\") ||\r\n                                             (cur[0] == \"const\" && prev[0] == \"const\"))) {\r\n                                        prev[1] = prev[1].concat(cur[1]);\r\n                                } else {\r\n                                        a.push(cur);\r\n                                        prev = cur;\r\n                                }\r\n                        });\r\n                        return a;\r\n                })([]);\r\n\r\n                if (options.dead_code) statements = (function(a, has_quit){\r\n                        statements.forEach(function(st){\r\n                                if (has_quit) {\r\n                                        if (st[0] == \"function\" || st[0] == \"defun\") {\r\n                                                a.push(st);\r\n                                        }\r\n                                        else if (st[0] == \"var\" || st[0] == \"const\") {\r\n                                                if (!options.no_warnings)\r\n                                                        warn(\"Variables declared in unreachable code\");\r\n                                                st[1] = MAP(st[1], function(def){\r\n                                                        if (def[1] && !options.no_warnings)\r\n                                                                warn_unreachable([ \"assign\", true, [ \"name\", def[0] ], def[1] ]);\r\n                                                        return [ def[0] ];\r\n                                                });\r\n                                                a.push(st);\r\n                                        }\r\n                                        else if (!options.no_warnings)\r\n                                                warn_unreachable(st);\r\n                                }\r\n                                else {\r\n                                        a.push(st);\r\n                                        if (member(st[0], [ \"return\", \"throw\", \"break\", \"continue\" ]))\r\n                                                has_quit = true;\r\n                                }\r\n                        });\r\n                        return a;\r\n                })([]);\r\n\r\n                if (options.make_seqs) statements = (function(a, prev) {\r\n                        statements.forEach(function(cur){\r\n                                if (prev && prev[0] == \"stat\" && cur[0] == \"stat\") {\r\n                                        prev[1] = [ \"seq\", prev[1], cur[1] ];\r\n                                } else {\r\n                                        a.push(cur);\r\n                                        prev = cur;\r\n                                }\r\n                        });\r\n                        if (a.length >= 2\r\n                            && a[a.length-2][0] == \"stat\"\r\n                            && (a[a.length-1][0] == \"return\" || a[a.length-1][0] == \"throw\")\r\n                            && a[a.length-1][1])\r\n                        {\r\n                                a.splice(a.length - 2, 2,\r\n                                         [ a[a.length-1][0],\r\n                                           [ \"seq\", a[a.length-2][1], a[a.length-1][1] ]]);\r\n                        }\r\n                        return a;\r\n                })([]);\r\n\r\n                // this increases jQuery by 1K.  Probably not such a good idea after all..\r\n                // part of this is done in prepare_ifs anyway.\r\n                // if (block_type == \"lambda\") statements = (function(i, a, stat){\r\n                //         while (i < statements.length) {\r\n                //                 stat = statements[i++];\r\n                //                 if (stat[0] == \"if\" && !stat[3]) {\r\n                //                         if (stat[2][0] == \"return\" && stat[2][1] == null) {\r\n                //                                 a.push(make_if(negate(stat[1]), [ \"block\", statements.slice(i) ]));\r\n                //                                 break;\r\n                //                         }\r\n                //                         var last = last_stat(stat[2]);\r\n                //                         if (last[0] == \"return\" && last[1] == null) {\r\n                //                                 a.push(make_if(stat[1], [ \"block\", stat[2][1].slice(0, -1) ], [ \"block\", statements.slice(i) ]));\r\n                //                                 break;\r\n                //                         }\r\n                //                 }\r\n                //                 a.push(stat);\r\n                //         }\r\n                //         return a;\r\n                // })(0, []);\r\n\r\n                return statements;\r\n        };\r\n\r\n        function make_if(c, t, e) {\r\n                return when_constant(c, function(ast, val){\r\n                        if (val) {\r\n                                warn_unreachable(e);\r\n                                return t;\r\n                        } else {\r\n                                warn_unreachable(t);\r\n                                return e;\r\n                        }\r\n                }, function() {\r\n                        return make_real_if(c, t, e);\r\n                });\r\n        };\r\n\r\n        function make_real_if(c, t, e) {\r\n                c = walk(c);\r\n                t = walk(t);\r\n                e = walk(e);\r\n\r\n                if (empty(t)) {\r\n                        c = negate(c);\r\n                        t = e;\r\n                        e = null;\r\n                } else if (empty(e)) {\r\n                        e = null;\r\n                } else {\r\n                        // if we have both else and then, maybe it makes sense to switch them?\r\n                        (function(){\r\n                                var a = gen_code(c);\r\n                                var n = negate(c);\r\n                                var b = gen_code(n);\r\n                                if (b.length < a.length) {\r\n                                        var tmp = t;\r\n                                        t = e;\r\n                                        e = tmp;\r\n                                        c = n;\r\n                                }\r\n                        })();\r\n                }\r\n                if (empty(e) && empty(t))\r\n                        return [ \"stat\", c ];\r\n                var ret = [ \"if\", c, t, e ];\r\n                if (t[0] == \"if\" && empty(t[3]) && empty(e)) {\r\n                        ret = best_of(ret, walk([ \"if\", [ \"binary\", \"&&\", c, t[1] ], t[2] ]));\r\n                }\r\n                else if (t[0] == \"stat\") {\r\n                        if (e) {\r\n                                if (e[0] == \"stat\") {\r\n                                        ret = best_of(ret, [ \"stat\", make_conditional(c, t[1], e[1]) ]);\r\n                                }\r\n                        }\r\n                        else {\r\n                                ret = best_of(ret, [ \"stat\", make_conditional(c, t[1]) ]);\r\n                        }\r\n                }\r\n                else if (e && t[0] == e[0] && (t[0] == \"return\" || t[0] == \"throw\") && t[1] && e[1]) {\r\n                        ret = best_of(ret, [ t[0], make_conditional(c, t[1], e[1] ) ]);\r\n                }\r\n                else if (e && aborts(t)) {\r\n                        ret = [ [ \"if\", c, t ] ];\r\n                        if (e[0] == \"block\") {\r\n                                if (e[1]) ret = ret.concat(e[1]);\r\n                        }\r\n                        else {\r\n                                ret.push(e);\r\n                        }\r\n                        ret = walk([ \"block\", ret ]);\r\n                }\r\n                else if (t && aborts(e)) {\r\n                        ret = [ [ \"if\", negate(c), e ] ];\r\n                        if (t[0] == \"block\") {\r\n                                if (t[1]) ret = ret.concat(t[1]);\r\n                        } else {\r\n                                ret.push(t);\r\n                        }\r\n                        ret = walk([ \"block\", ret ]);\r\n                }\r\n                return ret;\r\n        };\r\n\r\n        function _do_while(cond, body) {\r\n                return when_constant(cond, function(cond, val){\r\n                        if (!val) {\r\n                                warn_unreachable(body);\r\n                                return [ \"block\" ];\r\n                        } else {\r\n                                return [ \"for\", null, null, null, walk(body) ];\r\n                        }\r\n                });\r\n        };\r\n\r\n        return w.with_walkers({\r\n                \"sub\": function(expr, subscript) {\r\n                        if (subscript[0] == \"string\") {\r\n                                var name = subscript[1];\r\n                                if (is_identifier(name))\r\n                                        return [ \"dot\", walk(expr), name ];\r\n                                else if (/^[1-9][0-9]*$/.test(name) || name === \"0\")\r\n                                        return [ \"sub\", walk(expr), [ \"num\", parseInt(name, 10) ] ];\r\n                        }\r\n                },\r\n                \"if\": make_if,\r\n                \"toplevel\": function(body) {\r\n                        return [ \"toplevel\", with_scope(this.scope, function(){\r\n                                return tighten(body);\r\n                        }) ];\r\n                },\r\n                \"switch\": function(expr, body) {\r\n                        var last = body.length - 1;\r\n                        return [ \"switch\", walk(expr), MAP(body, function(branch, i){\r\n                                var block = tighten(branch[1]);\r\n                                if (i == last && block.length > 0) {\r\n                                        var node = block[block.length - 1];\r\n                                        if (node[0] == \"break\" && !node[1])\r\n                                                block.pop();\r\n                                }\r\n                                return [ branch[0] ? walk(branch[0]) : null, block ];\r\n                        }) ];\r\n                },\r\n                \"function\": _lambda,\r\n                \"defun\": _lambda,\r\n                \"block\": function(body) {\r\n                        if (body) return rmblock([ \"block\", tighten(body) ]);\r\n                },\r\n                \"binary\": function(op, left, right) {\r\n                        return when_constant([ \"binary\", op, walk(left), walk(right) ], function yes(c){\r\n                                return best_of(walk(c), this);\r\n                        }, function no() {\r\n                                return this;\r\n                        });\r\n                },\r\n                \"conditional\": function(c, t, e) {\r\n                        return make_conditional(walk(c), walk(t), walk(e));\r\n                },\r\n                \"try\": function(t, c, f) {\r\n                        return [\r\n                                \"try\",\r\n                                tighten(t),\r\n                                c != null ? [ c[0], tighten(c[1]) ] : null,\r\n                                f != null ? tighten(f) : null\r\n                        ];\r\n                },\r\n                \"unary-prefix\": function(op, expr) {\r\n                        expr = walk(expr);\r\n                        var ret = [ \"unary-prefix\", op, expr ];\r\n                        if (op == \"!\")\r\n                                ret = best_of(ret, negate(expr));\r\n                        return when_constant(ret, function(ast, val){\r\n                                return walk(ast); // it's either true or false, so minifies to !0 or !1\r\n                        }, function() { return ret });\r\n                },\r\n                \"name\": function(name) {\r\n                        switch (name) {\r\n                            case \"true\": return [ \"unary-prefix\", \"!\", [ \"num\", 0 ]];\r\n                            case \"false\": return [ \"unary-prefix\", \"!\", [ \"num\", 1 ]];\r\n                        }\r\n                },\r\n                \"new\": function(ctor, args) {\r\n                        if (ctor[0] == \"name\" && ctor[1] == \"Array\" && !scope.has(\"Array\")) {\r\n                                if (args.length != 1) {\r\n                                        return [ \"array\", args ];\r\n                                } else {\r\n                                        return [ \"call\", [ \"name\", \"Array\" ], args ];\r\n                                }\r\n                        }\r\n                },\r\n                \"call\": function(expr, args) {\r\n                        if (expr[0] == \"name\" && expr[1] == \"Array\" && args.length != 1 && !scope.has(\"Array\")) {\r\n                                return [ \"array\", args ];\r\n                        }\r\n                },\r\n                \"while\": _do_while\r\n        }, function() {\r\n                for (var i = 0; i < 2; ++i) {\r\n                        ast = prepare_ifs(ast);\r\n                        ast = ast_add_scope(ast);\r\n                        ast = walk(ast);\r\n                }\r\n                return ast;\r\n        });\r\n};\r\n\r\n/* -----[ re-generate code from the AST ]----- */\r\n\r\nvar DOT_CALL_NO_PARENS = /*jsp.*/array_to_hash([\r\n        \"name\",\r\n        \"array\",\r\n        \"object\",\r\n        \"string\",\r\n        \"dot\",\r\n        \"sub\",\r\n        \"call\",\r\n        \"regexp\"\r\n]);\r\n\r\nfunction make_string(str, ascii_only) {\r\n        var dq = 0, sq = 0;\r\n        str = str.replace(/[\\\\\\b\\f\\n\\r\\t\\x22\\x27\\u2028\\u2029]/g, function(s){\r\n                switch (s) {\r\n                    case \"\\\\\": return \"\\\\\\\\\";\r\n                    case \"\\b\": return \"\\\\b\";\r\n                    case \"\\f\": return \"\\\\f\";\r\n                    case \"\\n\": return \"\\\\n\";\r\n                    case \"\\r\": return \"\\\\r\";\r\n                    case \"\\t\": return \"\\\\t\";\r\n                    case \"\\u2028\": return \"\\\\u2028\";\r\n                    case \"\\u2029\": return \"\\\\u2029\";\r\n                    case '\"': ++dq; return '\"';\r\n                    case \"'\": ++sq; return \"'\";\r\n                }\r\n                return s;\r\n        });\r\n        if (ascii_only) str = to_ascii(str);\r\n        if (dq > sq) return \"'\" + str.replace(/\\x27/g, \"\\\\'\") + \"'\";\r\n        else return '\"' + str.replace(/\\x22/g, '\\\\\"') + '\"';\r\n};\r\n\r\nfunction to_ascii(str) {\r\n        return str.replace(/[\\u0080-\\uffff]/g, function(ch) {\r\n                var code = ch.charCodeAt(0).toString(16);\r\n                while (code.length < 4) code = \"0\" + code;\r\n                return \"\\\\u\" + code;\r\n        });\r\n};\r\n\r\nvar SPLICE_NEEDS_BRACKETS = /*jsp.*/array_to_hash([ \"if\", \"while\", \"do\", \"for\", \"for-in\", \"with\" ]);\r\n\r\nfunction gen_code(ast, options) {\r\n        options = defaults(options, {\r\n                indent_start : 0,\r\n                indent_level : 4,\r\n                quote_keys   : false,\r\n                space_colon  : false,\r\n                beautify     : false,\r\n                ascii_only   : false,\r\n                inline_script: false\r\n        });\r\n        var beautify = !!options.beautify;\r\n        var indentation = 0,\r\n            newline = beautify ? \"\\n\" : \"\",\r\n            space = beautify ? \" \" : \"\";\r\n\r\n        function encode_string(str) {\r\n                var ret = make_string(str, options.ascii_only);\r\n                if (options.inline_script)\r\n                        ret = ret.replace(/<\\x2fscript([>/\\t\\n\\f\\r ])/gi, \"<\\\\/script$1\");\r\n                return ret;\r\n        };\r\n\r\n        function make_name(name) {\r\n                name = name.toString();\r\n                if (options.ascii_only)\r\n                        name = to_ascii(name);\r\n                return name;\r\n        };\r\n\r\n        function indent(line) {\r\n                if (line == null)\r\n                        line = \"\";\r\n                if (beautify)\r\n                        line = repeat_string(\" \", options.indent_start + indentation * options.indent_level) + line;\r\n                return line;\r\n        };\r\n\r\n        function with_indent(cont, incr) {\r\n                if (incr == null) incr = 1;\r\n                indentation += incr;\r\n                try { return cont.apply(null, slice(arguments, 1)); }\r\n                finally { indentation -= incr; }\r\n        };\r\n\r\n        function add_spaces(a) {\r\n                if (beautify)\r\n                        return a.join(\" \");\r\n                var b = [];\r\n                for (var i = 0; i < a.length; ++i) {\r\n                        var next = a[i + 1];\r\n                        b.push(a[i]);\r\n                        if (next &&\r\n                            ((/[a-z0-9_\\x24]$/i.test(a[i].toString()) && /^[a-z0-9_\\x24]/i.test(next.toString())) ||\r\n                             (/[\\+\\-]$/.test(a[i].toString()) && /^[\\+\\-]/.test(next.toString())))) {\r\n                                b.push(\" \");\r\n                        }\r\n                }\r\n                return b.join(\"\");\r\n        };\r\n\r\n        function add_commas(a) {\r\n                return a.join(\",\" + space);\r\n        };\r\n\r\n        function parenthesize(expr) {\r\n                var gen = make(expr);\r\n                for (var i = 1; i < arguments.length; ++i) {\r\n                        var el = arguments[i];\r\n                        if ((el instanceof Function && el(expr)) || expr[0] == el)\r\n                                return \"(\" + gen + \")\";\r\n                }\r\n                return gen;\r\n        };\r\n\r\n        function best_of(a) {\r\n                if (a.length == 1) {\r\n                        return a[0];\r\n                }\r\n                if (a.length == 2) {\r\n                        var b = a[1];\r\n                        a = a[0];\r\n                        return a.length <= b.length ? a : b;\r\n                }\r\n                return best_of([ a[0], best_of(a.slice(1)) ]);\r\n        };\r\n\r\n        function needs_parens(expr) {\r\n                if (expr[0] == \"function\" || expr[0] == \"object\") {\r\n                        // dot/call on a literal function requires the\r\n                        // function literal itself to be parenthesized\r\n                        // only if it's the first \"thing\" in a\r\n                        // statement.  This means that the parent is\r\n                        // \"stat\", but it could also be a \"seq\" and\r\n                        // we're the first in this \"seq\" and the\r\n                        // parent is \"stat\", and so on.  Messy stuff,\r\n                        // but it worths the trouble.\r\n                        var a = slice(w.stack()), self = a.pop(), p = a.pop();\r\n                        while (p) {\r\n                                if (p[0] == \"stat\") return true;\r\n                                if (((p[0] == \"seq\" || p[0] == \"call\" || p[0] == \"dot\" || p[0] == \"sub\" || p[0] == \"conditional\") && p[1] === self) ||\r\n                                    ((p[0] == \"binary\" || p[0] == \"assign\" || p[0] == \"unary-postfix\") && p[2] === self)) {\r\n                                        self = p;\r\n                                        p = a.pop();\r\n                                } else {\r\n                                        return false;\r\n                                }\r\n                        }\r\n                }\r\n                return !HOP(DOT_CALL_NO_PARENS, expr[0]);\r\n        };\r\n\r\n        function make_num(num) {\r\n                var str = num.toString(10), a = [ str.replace(/^0\\./, \".\") ], m;\r\n                if (Math.floor(num) === num) {\r\n                        a.push(\"0x\" + num.toString(16).toLowerCase(), // probably pointless\r\n                               \"0\" + num.toString(8)); // same.\r\n                        if ((m = /^(.*?)(0+)$/.exec(num))) {\r\n                                a.push(m[1] + \"e\" + m[2].length);\r\n                        }\r\n                } else if ((m = /^0?\\.(0+)(.*)$/.exec(num))) {\r\n                        a.push(m[2] + \"e-\" + (m[1].length + m[2].length),\r\n                               str.substr(str.indexOf(\".\")));\r\n                }\r\n                return best_of(a);\r\n        };\r\n\r\n        var w = ast_walker();\r\n        var make = w.walk;\r\n        return w.with_walkers({\r\n                \"string\": encode_string,\r\n                \"num\": make_num,\r\n                \"name\": make_name,\r\n                \"toplevel\": function(statements) {\r\n                        return make_block_statements(statements)\r\n                                .join(newline + newline);\r\n                },\r\n                \"splice\": function(statements) {\r\n                        var parent = w.parent();\r\n                        if (HOP(SPLICE_NEEDS_BRACKETS, parent)) {\r\n                                // we need block brackets in this case\r\n                                return make_block.apply(this, arguments);\r\n                        } else {\r\n                                return MAP(make_block_statements(statements, true),\r\n                                           function(line, i) {\r\n                                                   // the first line is already indented\r\n                                                   return i > 0 ? indent(line) : line;\r\n                                           }).join(newline);\r\n                        }\r\n                },\r\n                \"block\": make_block,\r\n                \"var\": function(defs) {\r\n                        return \"var \" + add_commas(MAP(defs, make_1vardef)) + \";\";\r\n                },\r\n                \"const\": function(defs) {\r\n                        return \"const \" + add_commas(MAP(defs, make_1vardef)) + \";\";\r\n                },\r\n                \"try\": function(tr, ca, fi) {\r\n                        var out = [ \"try\", make_block(tr) ];\r\n                        if (ca) out.push(\"catch\", \"(\" + ca[0] + \")\", make_block(ca[1]));\r\n                        if (fi) out.push(\"finally\", make_block(fi));\r\n                        return add_spaces(out);\r\n                },\r\n                \"throw\": function(expr) {\r\n                        return add_spaces([ \"throw\", make(expr) ]) + \";\";\r\n                },\r\n                \"new\": function(ctor, args) {\r\n                        args = args.length > 0 ? \"(\" + add_commas(MAP(args, make)) + \")\" : \"\";\r\n                        return add_spaces([ \"new\", parenthesize(ctor, \"seq\", \"binary\", \"conditional\", \"assign\", function(expr){\r\n                                var w = ast_walker(), has_call = {};\r\n                                try {\r\n                                        w.with_walkers({\r\n                                                \"call\": function() { throw has_call },\r\n                                                \"function\": function() { return this }\r\n                                        }, function(){\r\n                                                w.walk(expr);\r\n                                        });\r\n                                } catch(ex) {\r\n                                        if (ex === has_call)\r\n                                                return true;\r\n                                        throw ex;\r\n                                }\r\n                        }) + args ]);\r\n                },\r\n                \"switch\": function(expr, body) {\r\n                        return add_spaces([ \"switch\", \"(\" + make(expr) + \")\", make_switch_block(body) ]);\r\n                },\r\n                \"break\": function(label) {\r\n                        var out = \"break\";\r\n                        if (label != null)\r\n                                out += \" \" + make_name(label);\r\n                        return out + \";\";\r\n                },\r\n                \"continue\": function(label) {\r\n                        var out = \"continue\";\r\n                        if (label != null)\r\n                                out += \" \" + make_name(label);\r\n                        return out + \";\";\r\n                },\r\n                \"conditional\": function(co, th, el) {\r\n                        return add_spaces([ parenthesize(co, \"assign\", \"seq\", \"conditional\"), \"?\",\r\n                                            parenthesize(th, \"seq\"), \":\",\r\n                                            parenthesize(el, \"seq\") ]);\r\n                },\r\n                \"assign\": function(op, lvalue, rvalue) {\r\n                        if (op && op !== true) op += \"=\";\r\n                        else op = \"=\";\r\n                        return add_spaces([ make(lvalue), op, parenthesize(rvalue, \"seq\") ]);\r\n                },\r\n                \"dot\": function(expr) {\r\n                        var out = make(expr), i = 1;\r\n                        if (expr[0] == \"num\") {\r\n                                if (!/\\./.test(expr[1]))\r\n                                        out += \".\";\r\n                        } else if (needs_parens(expr))\r\n                                out = \"(\" + out + \")\";\r\n                        while (i < arguments.length)\r\n                                out += \".\" + make_name(arguments[i++]);\r\n                        return out;\r\n                },\r\n                \"call\": function(func, args) {\r\n                        var f = make(func);\r\n                        if (needs_parens(func))\r\n                                f = \"(\" + f + \")\";\r\n                        return f + \"(\" + add_commas(MAP(args, function(expr){\r\n                                return parenthesize(expr, \"seq\");\r\n                        })) + \")\";\r\n                },\r\n                \"function\": make_function,\r\n                \"defun\": make_function,\r\n                \"if\": function(co, th, el) {\r\n                        var out = [ \"if\", \"(\" + make(co) + \")\", el ? make_then(th) : make(th) ];\r\n                        if (el) {\r\n                                out.push(\"else\", make(el));\r\n                        }\r\n                        return add_spaces(out);\r\n                },\r\n                \"for\": function(init, cond, step, block) {\r\n                        var out = [ \"for\" ];\r\n                        init = (init != null ? make(init) : \"\").replace(/;*\\s*$/, \";\" + space);\r\n                        cond = (cond != null ? make(cond) : \"\").replace(/;*\\s*$/, \";\" + space);\r\n                        step = (step != null ? make(step) : \"\").replace(/;*\\s*$/, \"\");\r\n                        var args = init + cond + step;\r\n                        if (args == \"; ; \") args = \";;\";\r\n                        out.push(\"(\" + args + \")\", make(block));\r\n                        return add_spaces(out);\r\n                },\r\n                \"for-in\": function(vvar, key, hash, block) {\r\n                        return add_spaces([ \"for\", \"(\" +\r\n                                            (vvar ? make(vvar).replace(/;+$/, \"\") : make(key)),\r\n                                            \"in\",\r\n                                            make(hash) + \")\", make(block) ]);\r\n                },\r\n                \"while\": function(condition, block) {\r\n                        return add_spaces([ \"while\", \"(\" + make(condition) + \")\", make(block) ]);\r\n                },\r\n                \"do\": function(condition, block) {\r\n                        return add_spaces([ \"do\", make(block), \"while\", \"(\" + make(condition) + \")\" ]) + \";\";\r\n                },\r\n                \"return\": function(expr) {\r\n                        var out = [ \"return\" ];\r\n                        if (expr != null) out.push(make(expr));\r\n                        return add_spaces(out) + \";\";\r\n                },\r\n                \"binary\": function(operator, lvalue, rvalue) {\r\n                        var left = make(lvalue), right = make(rvalue);\r\n                        // XXX: I'm pretty sure other cases will bite here.\r\n                        //      we need to be smarter.\r\n                        //      adding parens all the time is the safest bet.\r\n                        if (member(lvalue[0], [ \"assign\", \"conditional\", \"seq\" ]) ||\r\n                            lvalue[0] == \"binary\" && PRECEDENCE[operator] > PRECEDENCE[lvalue[1]]) {\r\n                                left = \"(\" + left + \")\";\r\n                        }\r\n                        if (member(rvalue[0], [ \"assign\", \"conditional\", \"seq\" ]) ||\r\n                            rvalue[0] == \"binary\" && PRECEDENCE[operator] >= PRECEDENCE[rvalue[1]] &&\r\n                            !(rvalue[1] == operator && member(operator, [ \"&&\", \"||\", \"*\" ]))) {\r\n                                right = \"(\" + right + \")\";\r\n                        }\r\n                        else if (!beautify && options.inline_script && (operator == \"<\" || operator == \"<<\")\r\n                                 && rvalue[0] == \"regexp\" && /^script/i.test(rvalue[1])) {\r\n                                right = \" \" + right;\r\n                        }\r\n                        return add_spaces([ left, operator, right ]);\r\n                },\r\n                \"unary-prefix\": function(operator, expr) {\r\n                        var val = make(expr);\r\n                        if (!(expr[0] == \"num\" || (expr[0] == \"unary-prefix\" && !HOP(OPERATORS, operator + expr[1])) || !needs_parens(expr)))\r\n                                val = \"(\" + val + \")\";\r\n                        return operator + (jsp.is_alphanumeric_char(operator.charAt(0)) ? \" \" : \"\") + val;\r\n                },\r\n                \"unary-postfix\": function(operator, expr) {\r\n                        var val = make(expr);\r\n                        if (!(expr[0] == \"num\" || (expr[0] == \"unary-postfix\" && !HOP(OPERATORS, operator + expr[1])) || !needs_parens(expr)))\r\n                                val = \"(\" + val + \")\";\r\n                        return val + operator;\r\n                },\r\n                \"sub\": function(expr, subscript) {\r\n                        var hash = make(expr);\r\n                        if (needs_parens(expr))\r\n                                hash = \"(\" + hash + \")\";\r\n                        return hash + \"[\" + make(subscript) + \"]\";\r\n                },\r\n                \"object\": function(props) {\r\n                        if (props.length == 0)\r\n                                return \"{}\";\r\n                        return \"{\" + newline + with_indent(function(){\r\n                                return MAP(props, function(p){\r\n                                        if (p.length == 3) {\r\n                                                // getter/setter.  The name is in p[0], the arg.list in p[1][2], the\r\n                                                // body in p[1][3] and type (\"get\" / \"set\") in p[2].\r\n                                                return indent(make_function(p[0], p[1][2], p[1][3], p[2]));\r\n                                        }\r\n                                        var key = p[0], val = parenthesize(p[1], \"seq\");\r\n                                        if (options.quote_keys) {\r\n                                                key = encode_string(key);\r\n                                        } else if ((typeof key == \"number\" || !beautify && +key + \"\" == key)\r\n                                                   && parseFloat(key) >= 0) {\r\n                                                key = make_num(+key);\r\n                                        } else if (!is_identifier(key)) {\r\n                                                key = encode_string(key);\r\n                                        }\r\n                                        return indent(add_spaces(beautify && options.space_colon\r\n                                                                 ? [ key, \":\", val ]\r\n                                                                 : [ key + \":\", val ]));\r\n                                }).join(\",\" + newline);\r\n                        }) + newline + indent(\"}\");\r\n                },\r\n                \"regexp\": function(rx, mods) {\r\n                        return \"/\" + rx + \"/\" + mods;\r\n                },\r\n                \"array\": function(elements) {\r\n                        if (elements.length == 0) return \"[]\";\r\n                        return add_spaces([ \"[\", add_commas(MAP(elements, function(el){\r\n                                if (!beautify && el[0] == \"atom\" && el[1] == \"undefined\") return \"\";\r\n                                return parenthesize(el, \"seq\");\r\n                        })), \"]\" ]);\r\n                },\r\n                \"stat\": function(stmt) {\r\n                        return make(stmt).replace(/;*\\s*$/, \";\");\r\n                },\r\n                \"seq\": function() {\r\n                        return add_commas(MAP(slice(arguments), make));\r\n                },\r\n                \"label\": function(name, block) {\r\n                        return add_spaces([ make_name(name), \":\", make(block) ]);\r\n                },\r\n                \"with\": function(expr, block) {\r\n                        return add_spaces([ \"with\", \"(\" + make(expr) + \")\", make(block) ]);\r\n                },\r\n                \"atom\": function(name) {\r\n                        return make_name(name);\r\n                }\r\n        }, function(){ return make(ast) });\r\n\r\n        // The squeezer replaces \"block\"-s that contain only a single\r\n        // statement with the statement itself; technically, the AST\r\n        // is correct, but this can create problems when we output an\r\n        // IF having an ELSE clause where the THEN clause ends in an\r\n        // IF *without* an ELSE block (then the outer ELSE would refer\r\n        // to the inner IF).  This function checks for this case and\r\n        // adds the block brackets if needed.\r\n        function make_then(th) {\r\n                if (th[0] == \"do\") {\r\n                        // https://github.com/mishoo/UglifyJS/issues/#issue/57\r\n                        // IE croaks with \"syntax error\" on code like this:\r\n                        //     if (foo) do ... while(cond); else ...\r\n                        // we need block brackets around do/while\r\n                        return make_block([ th ]);\r\n                }\r\n                var b = th;\r\n                while (true) {\r\n                        var type = b[0];\r\n                        if (type == \"if\") {\r\n                                if (!b[3])\r\n                                        // no else, we must add the block\r\n                                        return make([ \"block\", [ th ]]);\r\n                                b = b[3];\r\n                        }\r\n                        else if (type == \"while\" || type == \"do\") b = b[2];\r\n                        else if (type == \"for\" || type == \"for-in\") b = b[4];\r\n                        else break;\r\n                }\r\n                return make(th);\r\n        };\r\n\r\n        function make_function(name, args, body, keyword) {\r\n                var out = keyword || \"function\";\r\n                if (name) {\r\n                        out += \" \" + make_name(name);\r\n                }\r\n                out += \"(\" + add_commas(MAP(args, make_name)) + \")\";\r\n                return add_spaces([ out, make_block(body) ]);\r\n        };\r\n\r\n        function must_has_semicolon(node) {\r\n                switch (node[0]) {\r\n                    case \"with\":\r\n                    case \"while\":\r\n                        return empty(node[2]); // `with' or `while' with empty body?\r\n                    case \"for\":\r\n                    case \"for-in\":\r\n                        return empty(node[4]); // `for' with empty body?\r\n                    case \"if\":\r\n                        if (empty(node[2]) && !node[3]) return true; // `if' with empty `then' and no `else'\r\n                        if (node[3]) {\r\n                                if (empty(node[3])) return true; // `else' present but empty\r\n                                return must_has_semicolon(node[3]); // dive into the `else' branch\r\n                        }\r\n                        return must_has_semicolon(node[2]); // dive into the `then' branch\r\n                }\r\n        };\r\n\r\n        function make_block_statements(statements, noindent) {\r\n                for (var a = [], last = statements.length - 1, i = 0; i <= last; ++i) {\r\n                        var stat = statements[i];\r\n                        var code = make(stat);\r\n                        if (code != \";\") {\r\n                                if (!beautify && i == last && !must_has_semicolon(stat)) {\r\n                                        code = code.replace(/;+\\s*$/, \"\");\r\n                                }\r\n                                a.push(code);\r\n                        }\r\n                }\r\n                return noindent ? a : MAP(a, indent);\r\n        };\r\n\r\n        function make_switch_block(body) {\r\n                var n = body.length;\r\n                if (n == 0) return \"{}\";\r\n                return \"{\" + newline + MAP(body, function(branch, i){\r\n                        var has_body = branch[1].length > 0, code = with_indent(function(){\r\n                                return indent(branch[0]\r\n                                              ? add_spaces([ \"case\", make(branch[0]) + \":\" ])\r\n                                              : \"default:\");\r\n                        }, 0.5) + (has_body ? newline + with_indent(function(){\r\n                                return make_block_statements(branch[1]).join(newline);\r\n                        }) : \"\");\r\n                        if (!beautify && has_body && i < n - 1)\r\n                                code += \";\";\r\n                        return code;\r\n                }).join(newline) + newline + indent(\"}\");\r\n        };\r\n\r\n        function make_block(statements) {\r\n                if (!statements) return \";\";\r\n                if (statements.length == 0) return \"{}\";\r\n                return \"{\" + newline + with_indent(function(){\r\n                        return make_block_statements(statements).join(newline);\r\n                }) + newline + indent(\"}\");\r\n        };\r\n\r\n        function make_1vardef(def) {\r\n                var name = def[0], val = def[1];\r\n                if (val != null)\r\n                        name = add_spaces([ make_name(name), \"=\", parenthesize(val, \"seq\") ]);\r\n                return name;\r\n        };\r\n\r\n};\r\n\r\nfunction split_lines(code, max_line_length) {\r\n        var splits = [ 0 ];\r\n        jsp.parse(function(){\r\n                var next_token = jsp.tokenizer(code);\r\n                var last_split = 0;\r\n                var prev_token;\r\n                function current_length(tok) {\r\n                        return tok.pos - last_split;\r\n                };\r\n                function split_here(tok) {\r\n                        last_split = tok.pos;\r\n                        splits.push(last_split);\r\n                };\r\n                function custom(){\r\n                        var tok = next_token.apply(this, arguments);\r\n                        out: {\r\n                                if (prev_token) {\r\n                                        if (prev_token.type == \"keyword\") break out;\r\n                                }\r\n                                if (current_length(tok) > max_line_length) {\r\n                                        switch (tok.type) {\r\n                                            case \"keyword\":\r\n                                            case \"atom\":\r\n                                            case \"name\":\r\n                                            case \"punc\":\r\n                                                split_here(tok);\r\n                                                break out;\r\n                                        }\r\n                                }\r\n                        }\r\n                        prev_token = tok;\r\n                        return tok;\r\n                };\r\n                custom.context = function() {\r\n                        return next_token.context.apply(this, arguments);\r\n                };\r\n                return custom;\r\n        }());\r\n        return splits.map(function(pos, i){\r\n                return code.substring(pos, splits[i + 1] || code.length);\r\n        }).join(\"\\n\");\r\n};\r\n\r\n/* -----[ Utilities ]----- */\r\n\r\nfunction repeat_string(str, i) {\r\n        if (i <= 0) return \"\";\r\n        if (i == 1) return str;\r\n        var d = repeat_string(str, i >> 1);\r\n        d += d;\r\n        if (i & 1) d += str;\r\n        return d;\r\n};\r\n\r\nfunction defaults(args, defs) {\r\n        var ret = {};\r\n        if (args === true)\r\n                args = {};\r\n        for (var i in defs) if (HOP(defs, i)) {\r\n                ret[i] = (args && HOP(args, i)) ? args[i] : defs[i];\r\n        }\r\n        return ret;\r\n};\r\n\r\nfunction is_identifier(name) {\r\n        return /^[a-z_$][a-z0-9_$]*$/i.test(name)\r\n                && name != \"this\"\r\n                && !HOP(jsp.KEYWORDS_ATOM, name)\r\n                && !HOP(jsp.RESERVED_WORDS, name)\r\n                && !HOP(jsp.KEYWORDS, name);\r\n};\r\n\r\nfunction HOP(obj, prop) {\r\n        return Object.prototype.hasOwnProperty.call(obj, prop);\r\n};\r\n\r\n// some utilities\r\n\r\nvar MAP;\r\n\r\n(function(){\r\n        MAP = function(a, f, o) {\r\n                var ret = [], top = [], i;\r\n                function doit() {\r\n                        var val = f.call(o, a[i], i);\r\n                        if (val instanceof AtTop) {\r\n                                val = val.v;\r\n                                if (val instanceof Splice) {\r\n                                        top.push.apply(top, val.v);\r\n                                } else {\r\n                                        top.push(val);\r\n                                }\r\n                        }\r\n                        else if (val != skip) {\r\n                                if (val instanceof Splice) {\r\n                                        ret.push.apply(ret, val.v);\r\n                                } else {\r\n                                        ret.push(val);\r\n                                }\r\n                        }\r\n                };\r\n                if (a instanceof Array) for (i = 0; i < a.length; ++i) doit();\r\n                else for (i in a) if (HOP(a, i)) doit();\r\n                return top.concat(ret);\r\n        };\r\n        MAP.at_top = function(val) { return new AtTop(val) };\r\n        MAP.splice = function(val) { return new Splice(val) };\r\n        var skip = MAP.skip = {};\r\n        function AtTop(val) { this.v = val };\r\n        function Splice(val) { this.v = val };\r\n})();\r\n\r\n/* -----[ Exports ]----- */\r\n/*\r\nexports.ast_walker = ast_walker;\r\nexports.ast_mangle = ast_mangle;\r\nexports.ast_squeeze = ast_squeeze;\r\nexports.ast_lift_variables = ast_lift_variables;\r\nexports.gen_code = gen_code;\r\nexports.ast_add_scope = ast_add_scope;\r\nexports.set_logger = function(logger) { warn = logger };\r\nexports.make_string = make_string;\r\nexports.split_lines = split_lines;\r\nexports.MAP = MAP;\r\n\r\n// keep this last!\r\nexports.ast_squeeze_more = require(\"./squeeze-more\").ast_squeeze_more;\r\n*/\r\n\n/* @license\r\n\r\n  Copyright (c) 2011 Lauri Paimen <lauri@paimen.info>\r\n  Copyright (c) 2015 Pavel Vasev <pavel.vasev@gmail.com> - initial\r\n                     and working import implementation.\r\n\r\n  Redistribution and use in source and binary forms, with or without\r\n  modification, are permitted provided that the following conditions\r\n  are met:\r\n\r\n      * Redistributions of source code must retain the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer.\r\n\r\n      * Redistributions in binary form must reproduce the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer in the documentation and/or other materials\r\n        provided with the distribution.\r\n\r\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AS IS AND ANY\r\n  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\r\n  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\r\n  OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\r\n  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\r\n  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\r\n  SUCH DAMAGE.\r\n*/\r\n\r\n\r\n/*\r\n * Misc classes for importing files.\r\n *\r\n * Currently the file contains a lot of unused code for future\r\n * purposes. Most of it can be rewritten as there is now Javascript parser\r\n * available.\r\n *\r\n * Exports:\r\n *\r\n * - getUrlContents(url) -- get URL contents. Returns contents or false in\r\n *   error.\r\n *\r\n * - Some other stuff not currently used/needed.\r\n *\r\n *\r\n */\r\n(function() {\r\n\r\nfunction parseQML(file) {\r\n    var contents = getUrlContents(file + \".js\");\r\n    if (contents) {\r\n        console.log(\"Using pre-processed content for \" + file);\r\n        return new Function(\"return \" + contents)();\r\n    } else {\r\n        contents = getUrlContents(file);\r\n        if (contents) {\r\n            // todo: use parser/compiler here\r\n            console.log(\"todo: add parser to import.js \" + file);\r\n        } else {\r\n            console.log(\"warn: Fetch failed for \" + file);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Get URL contents. EXPORTED.\r\n * @param url {String} Url to fetch.\r\n * @param skipExceptions {bool} when turned on, ignore exeptions and return false. This feature is used by readQmlDir.\r\n * @private\r\n * @return {mixed} String of contents or false in errors.\r\n *\r\n * Q1: can someone provide use-case when we need caching here?\r\n * A1:\r\n * Q2: should errors be cached? (now they aren't)\r\n * A2:\r\n \r\n * Q3: split getUrlContents into: getUrlContents, getUrlContentsWithCaching, getUrlContentsWithoutErrors..\r\n */\r\ngetUrlContents = function (url, skipExceptions) {\r\n    if (typeof urlContentCache[url] == 'undefined') {\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.open(\"GET\", url, false);\r\n\r\n      if (skipExceptions)\r\n        { try { xhr.send(null); } catch (e) { return false; } } /* it is OK to not have logging here, because DeveloperTools already will have red log record */\r\n      else\r\n        xhr.send(null);\r\n\r\n      if (xhr.status != 200 && xhr.status != 0) { // 0 if accessing with file://\r\n          console.log(\"Retrieving \" + url + \" failed: \" + xhr.responseText, xhr);\r\n          return false;\r\n      }\r\n      urlContentCache[url] = xhr.responseText;\r\n    }\r\n    return urlContentCache[url];\r\n}\r\nif (typeof global.urlContentCache == 'undefined')\r\n  global.urlContentCache = {};\r\n\r\n/**\r\n * Read qmldir spec file at directory. EXPORTED.\r\n * @param url Url of the directory\r\n * @return {Object} Object, where .internals lists qmldir internal references\r\n *                          and .externals lists qmldir external references.\r\n */\r\n\r\n/*  Note on how importing works.\r\n\r\n   * parseQML gives us `tree.$imports` variable, which contains information from `import` statements.\r\n\r\n   * After each call to parseQML, we call engine.loadImports(tree.$imports).\r\n     It in turn invokes readQmlDir() calls for each import, with respect to current component base path and engine.importPathList().\r\n\r\n   * We keep all component names from all qmldir files in global variable `engine.qmldir`.\r\n   \r\n   * In construct() function, we use `engine.qmldir` for component url lookup.\r\n\r\n   Reference import info: http://doc.qt.io/qt-5/qtqml-syntax-imports.html \r\n   Also please look at notes and TODO's in qtcore.js::loadImports() and qtcore.js::construct() methods.\r\n*/\r\n \r\nreadQmlDir = function (url) {\r\n    // in case 'url' is empty, do not attach \"/\"\r\n    // Q1: when this happen?\r\n    var qmldirFileUrl = url.length > 0 ? (url + \"/qmldir\") : \"qmldir\";\r\n\r\n    var qmldir = getUrlContents( qmldirFileUrl, true), // loading url contents with skipping errors\r\n        lines,\r\n        line,\r\n        internals = {},\r\n        externals = {},\r\n        match,\r\n        i;\r\n\r\n    if (qmldir === false) {\r\n        return false;\r\n    }\r\n\r\n    // we have to check for \"://\" \r\n    // In that case, item path is meant to be absolute, and we have no need to prefix it with base url\r\n    function makeurl( path ) {\r\n       if (path.indexOf(\"://\") > 0) return path;\r\n       return url + \"/\" + path;\r\n    }\r\n\r\n    lines = qmldir.split(/\\r?\\n/);\r\n    for (i = 0; i < lines.length; i++) {\r\n        // trim\r\n        line = lines[i].replace(/^\\s+|\\s+$/g, \"\");\r\n        if (!line.length || line[0] == \"#\") {\r\n            // Empty line or comment\r\n            continue;\r\n        }\r\n        match = line.split(/\\s+/);\r\n        if (match.length == 2 || match.length == 3) {\r\n            if (match[0] == \"plugin\") {\r\n                console.log(url + \": qmldir plugins are not supported!\");\r\n            } else if (match[0] == \"internal\") {\r\n                internals[match[1]] = { url: makeurl( match[2] ) };\r\n            } else {\r\n                if (match.length == 2) {\r\n                    externals[match[0]] = { url: makeurl( match[1] ) };\r\n                } else {\r\n                    externals[match[0]] = { url: makeurl( match[2] ), version: match[1] };\r\n                }\r\n            }\r\n        } else {\r\n            console.log(url + \": unmatched: \" + line);\r\n        }\r\n    }\r\n    return {internals: internals, externals: externals};\r\n}\r\n\r\n\r\n/**\r\n * Import and parse javascript file. EXPORTED.\r\n * @return {object} Object which has \"var\"s and functions from file as keys, or\r\n *         undefined if operation fails\r\n */\r\nimportJs = function (filename) {\r\n\r\n    // todo: .pragma support\r\n\r\n    // Exports as follow:\r\n    // function a() { function b() {} } exports only a.\r\n    // var a = function b(){} exports a and b. Not sure if b should be exported.\r\n    //                        rare case, however.\r\n    // var a = function(){} exports only a.\r\n\r\n    var i,\r\n        src = getUrlContents(filename),\r\n        exports = [];\r\n\r\n    if (src === false) {\r\n        return;\r\n    }\r\n\r\n    // Analyse source\r\n    exports = readExports(src);\r\n    console.log(filename + \" exports:\", exports);\r\n\r\n    // Wrap source to function to retain private scope of the variables.\r\n    // Make that function return an object.\r\n    // That object contains getters and setters for exported stuff.\r\n    // Add () to execute the function.\r\n    src += \";return {\";\r\n    for (i = 0; i < exports.length; i++) {\r\n        // create getters and setters for properties\r\n        // keeps variables synced better\r\n        src += \"get \" + exports[i] + \"(){return \" + exports[i] + \"},\";\r\n        src += \"set \" + exports[i] + \"(){\" + exports[i] + \" = arguments[0]},\";\r\n        // without getters and setters:\r\n        // src += exports[i] + \":\" + exports[i] + \",\";\r\n    }\r\n    src += \"}\";\r\n\r\n    // evaluate source to get the object.\r\n    return new Function(src)();\r\n}\r\n\r\n/**\r\n * Read code for variables and functions which are exported to qml\r\n * @private\r\n * @param src source code\r\n * @return Array Array of local variable names to export\r\n */\r\nfunction readExports(src) {\r\n\r\n    // Eat src until str is found. Recurse if recursive set.\r\n    function eatUntil(src, str, recursive) {\r\n        var i;\r\n        if (!recursive) {\r\n            i = src.indexOf(str);\r\n            if (i == -1) {\r\n                console.log(\"eof encountered, \" + str + \" expected.\");\r\n                return \"\";\r\n            }\r\n        } else {\r\n            i = 0;\r\n            while (i < src.length) {\r\n                if (src.substr(i, str.length) == str) {\r\n                    break;\r\n                }\r\n                switch(src[i]) {\r\n                 case \"{\": // inner block\r\n                    src = eatUntil(src.substr(i + 1), \"}\", true );\r\n                    i = 0;\r\n                    break;\r\n                 case \"(\": // Parentheses\r\n                    src = eatUntil(src.substr(i + 1), \")\", true );\r\n                    i = 0;\r\n                    break;\r\n                 case \"/\": // Possible beginning of comment\r\n                    if (src[i + 1] == \"/\") {\r\n                        src = eatUntil(src.substr(i + 1), \"\\n\");\r\n                        i = 0;\r\n                    } else if (src[i + 1] == \"*\") {\r\n                        src = eatUntil(src.substr(i + 1), \"*/\");\r\n                        i = 0;\r\n                    } else {\r\n                        i++;\r\n                    }\r\n                    break;\r\n                 default:\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n        return src.substr(i + str.length);\r\n    }\r\n\r\n    // Strip comments and code blocks from the input source\r\n    // This is quite similar with eatCodeBlock but still a bit different.\r\n    // If either section has bugs, check the other section, too!\r\n    var i = 0,\r\n        // Code without blocks and comments\r\n        semi = \"\",\r\n        // todo: these doesn't match with exports containing \"$\"\r\n        matcher = /var\\s+\\w+|function\\s+\\w+/g,\r\n        matches,\r\n        tmp,\r\n        exports = [];\r\n\r\n    while (i < src.length) {\r\n        switch (src[i]) {\r\n         case \"{\": // code block\r\n            src = eatUntil(src.substr(i + 1), \"}\", true);\r\n            i = 0;\r\n            break;\r\n         case \"(\": // parentheses\r\n            src = eatUntil(src.substr(i + 1), \")\", true);\r\n            i = 0;\r\n            break;\r\n         case \"/\": // comment\r\n            if (src[i + 1] == \"/\") {\r\n                src = eatUntil(src.substr(i + 1), \"\\n\");\r\n                i = 0;\r\n            } else if (src[i + 1] == \"*\") {\r\n                src = eatUntil(src.substr(i + 1), \"*/\");\r\n                i = 0;\r\n            } else {\r\n                semi += src[i];\r\n                i++;\r\n            }\r\n            break;\r\n        default:\r\n            semi += src[i];\r\n            i++;\r\n            break;\r\n        }\r\n    }\r\n\r\n    // Search exports from semi\r\n    matches = semi.match(matcher);\r\n\r\n    // matches now contain strings defined in matcher. Re-match these to get\r\n    // exports. Matching can be done in one step, but I couldn't get it working\r\n    // so bear this extra step.\r\n    for (i = 0; i < matches.length; i++) {\r\n        tmp = /\\w+\\s+(\\w+)/.exec(matches[i]);\r\n        if (tmp) {\r\n            exports.push(tmp[1]);\r\n        }\r\n    }\r\n    return exports;\r\n}\r\n\r\n})();\r\n\nglobal.Easing = {\r\n  Linear: 1,\r\n  InQuad: 2,          OutQuad: 3,     InOutQuad: 4,           OutInQuad: 5,\r\n  InCubic: 6,         OutCubic: 7,    InOutCubic: 8,          OutInCubic: 9,\r\n  InQuart: 10,        OutQuart: 11,   InOutQuart: 12,         OutInQuart: 13,\r\n  InQuint: 14,        OutQuint: 15,   InOutQuint: 16,         OutInQuint: 17,\r\n  InSine: 18,         OutSine: 19,    InOutSine: 20,          OutInSine: 21,\r\n  InExpo: 22,         OutExpo: 23,    InOutExpo: 24,          OutInExpo: 25,\r\n  InCirc: 26,         OutCirc: 27,    InOutCirc: 28,          OutInCirc: 29,\r\n  InElastic: 30,      OutElastic: 31, InOutElastic: 32,       OutInElastic: 33,\r\n  InBack: 34,         OutBack: 35,    InOutBack: 36,          OutInBack: 37,\r\n  InBounce: 38,       OutBounce: 39,  InOutBounce: 40,        OutInBounce: 41\r\n}\r\n\nglobal.Font = {\r\n  // Capitalization\r\n  MixedCase: \"none\",\r\n  AllUppercase: \"uppercase\",\r\n  AllLowercase: \"lowercase\",\r\n  SmallCaps: \"smallcaps\",\r\n  Capitalize: \"capitalize\",\r\n  // Weight\r\n  Light: \"lighter\",\r\n  Normal: \"normal\",\r\n  DemiBold: \"600\",\r\n  Bold: \"bold\",\r\n  Black: \"bolder\",\r\n}\r\n\nglobal.qrc = {\r\n  includesFile: function(path) {\r\n    return typeof qrc[path] != 'undefined';\r\n  }\r\n};\r\n\nglobal.Qt = {\r\n  rgba: function(r,g,b,a) {\r\n    return \"rgba(\"\r\n      + Math.round(r * 255) + \",\"\r\n      + Math.round(g * 255) + \",\"\r\n      + Math.round(b * 255) + \",\"\r\n      + a + \")\";\r\n  },\r\n  openUrlExternally: function(url) {\r\n    page = window.open(url, '_blank');\r\n    page.focus();\r\n  },\r\n  // Load file, parse and construct as Component (.qml)\r\n  //FIXME: remove the parameter executionContext and get it autonomously.\r\n  createComponent: function(name, executionContext) {\r\n    if (name in engine.components)\r\n        return engine.components[name];\r\n\r\n    var nameIsUrl = name.indexOf(\"//\") >= 0 || name.indexOf(\":/\") >= 0; // e.g. // in protocol, or :/ in disk urls (D:/)\r\n\r\n    // Do not perform path lookups if name starts with @ sign.\r\n    // This is used when we load components from qmldir files\r\n    // because in that case we do not need any lookups.\r\n    if (name.length > 0 && name[0] == \"@\") {\r\n      nameIsUrl = true;\r\n      name = name.substr( 1,name.length-1 );\r\n    }\r\n\r\n    var file = nameIsUrl ? name : engine.$basePath + name;\r\n\r\n    var src = getUrlContents(file, true);\r\n    // if failed to load, and provided name is not direct url, try to load from dirs in importPathList()\r\n    if (src==false && !nameIsUrl) {\r\n      var moredirs = engine.importPathList();\r\n\r\n      for (var i=0; i<moredirs.length; i++) {\r\n        file = moredirs[i] + name;\r\n        src = getUrlContents(file, true);\r\n        if (src !== false) break;\r\n      }\r\n    }\r\n\r\n    // When createComponent failed to load content from all probable sources, it should return undefined.\r\n    if (src === false)\r\n      return undefined;\r\n\r\n    var tree = parseQML(src);\r\n\r\n    if (tree.$children.length !== 1)\r\n        console.error(\"A QML component must only contain one root element!\");\r\n\r\n    var component = new QMLComponent({ object: tree, context: executionContext });\r\n    component.$basePath = engine.extractBasePath( file );\r\n    component.$imports = tree.$imports;\r\n    component.$file = file; // just for debugging\r\n\r\n    engine.loadImports( tree.$imports,component.$basePath );\r\n\r\n    engine.components[name] = component;\r\n    return component;\r\n  },\r\n\r\n    // Returns url resolved relative to the URL of the caller.\r\n  // http://doc.qt.io/qt-5/qml-qtqml-qt.html#resolvedUrl-method\r\n  resolvedUrl: function(url)\r\n  {\r\n    if (!url || !url.substr) // url is not a string object\r\n      return url;\r\n\r\n    // Must check for cases: D:/, file://, http://, or slash at the beginning. \r\n    // This means the url is absolute => we have to skip processing (except removing dot segments).\r\n    if (url == \"\" || url.indexOf(\":/\") != -1 || url.indexOf(\"/\") == 0)\r\n      return engine.removeDotSegments( url );\r\n\r\n    // we have $basePath variable placed in context of \"current\" document\r\n    // this is done in construct() function\r\n\r\n    // let's go to the callers and inspect their arguments\r\n    // The 2-nd argument of the callers we hope is context object\r\n    // e.g. see calling signature of bindings and signals\r\n\r\n    // Actually Qt cpp code is doing the same; the difference is that they know calling context\r\n    // https://qt.gitorious.org/qt/qtdeclarative/source/eeaba26596d447c531dfac9d6e6bf5cfe4537813:src/qml/qml/v8/qqmlbuiltinfunctions.cpp#L833\r\n\r\n    var detectedBasePath = \"\";\r\n    var currentCaller = Qt.resolvedUrl.caller;\r\n    var maxcount = 10;\r\n    while (maxcount-- > 0 && currentCaller) {\r\n      if (currentCaller.arguments[1] && currentCaller.arguments[1][\"$basePath\"])\r\n      {\r\n        detectedBasePath = currentCaller.arguments[1][\"$basePath\"];\r\n        break;\r\n      }\r\n      currentCaller = currentCaller.caller;\r\n    }\r\n\r\n    return engine.removeDotSegments( detectedBasePath + url )\r\n  },\r\n\r\n  // Buttons masks\r\n  LeftButton: 1,\r\n  RightButton: 2,\r\n  MiddleButton: 4,\r\n  // Modifiers masks\r\n  NoModifier: 0,\r\n  ShiftModifier: 1,\r\n  ControlModifier: 2,\r\n  AltModifier: 4,\r\n  MetaModifier: 8,\r\n  KeypadModifier: 16, // Note: Not available in web\r\n  // Layout directions\r\n  LeftToRight: 0,\r\n  RightToLeft: 1,\r\n  // Orientations\r\n  Vertical: 0,\r\n  Horizontal: 1,\r\n  // Keys\r\n  Key_Escape: 27,\r\n  Key_Tab: 9,\r\n  Key_Backtab: 245,\r\n  Key_Backspace: 8,\r\n  Key_Return: 13,\r\n  Key_Enter: 13,\r\n  Key_Insert: 45,\r\n  Key_Delete: 46,\r\n  Key_Pause: 19,\r\n  Key_Print: 42,\r\n  Key_SysReq: 0,\r\n  Key_Clear: 12,\r\n  Key_Home: 36,\r\n  Key_End: 35,\r\n  Key_Left: 37,\r\n  Key_Up: 38,\r\n  Key_Right: 39,\r\n  Key_Down: 40,\r\n  Key_PageUp: 33,\r\n  Key_PageDown: 34,\r\n  Key_Shift: 16,\r\n  Key_Control: 17,\r\n  Key_Meta: 91,\r\n  Key_Alt: 18,\r\n  Key_AltGr: 0,\r\n  Key_CapsLock: 20,\r\n  Key_NumLock: 144,\r\n  Key_ScrollLock: 145,\r\n  Key_F1: 112, Key_F2: 113, Key_F3: 114, Key_F4: 115, Key_F5: 116, Key_F6: 117, Key_F7: 118, Key_F8: 119, Key_F9: 120, Key_F10: 121, Key_F11: 122, Key_F12: 123, Key_F13: 124, Key_F14: 125, Key_F15: 126, Key_F16: 127, Key_F17: 128, Key_F18: 129, Key_F19: 130, Key_F20: 131, Key_F21: 132, Key_F22: 133, Key_F23: 134, Key_F24: 135, Key_F25: 0, Key_F26: 0, Key_F27: 0, Key_F28: 0, Key_F29: 0, Key_F30: 0, Key_F31: 0, Key_F32: 0, Key_F33: 0, Key_F34: 0, Key_F35: 0,\r\n  Key_Super_L: 0,\r\n  Key_Super_R: 0,\r\n  Key_Menu: 0,\r\n  Key_Hyper_L: 0,\r\n  Key_Hyper_R: 0,\r\n  Key_Help: 6,\r\n  Key_Direction_L: 0,\r\n  Key_Direction_R: 0,\r\n  Key_Space: 32,\r\n  Key_Any:   32,\r\n  Key_Exclam: 161,\r\n  Key_QuoteDbl: 162,\r\n  Key_NumberSign: 163,\r\n  Key_Dollar: 164,\r\n  Key_Percent: 165,\r\n  Key_Ampersant: 166,\r\n  Key_Apostrophe: 222,\r\n  Key_ParenLeft: 168,\r\n  Key_ParenRight: 169,\r\n  Key_Asterisk: 170,\r\n  Key_Plus: 171,\r\n  Key_Comma: 188,\r\n  Key_Minus: 173,\r\n  Key_Period: 190,\r\n  Key_Slash: 191,\r\n  Key_0: 48, Key_1: 49, Key_2: 50, Key_3: 51, Key_4: 52, Key_5: 53, Key_6: 54, Key_7: 55, Key_8: 56, Key_9: 57,\r\n  Key_Colon: 58,\r\n  Key_Semicolon: 59,\r\n  Key_Less: 60,\r\n  Key_Equal: 61,\r\n  Key_Greater: 62,\r\n  Key_Question: 63,\r\n  Key_At: 64,\r\n  Key_A: 65, Key_B: 66, Key_C: 67, Key_D: 68, Key_E: 69, Key_F: 70, Key_G: 71, Key_H: 72, Key_I: 73, Key_J: 74, Key_K: 75, Key_L: 76, Key_M: 77, Key_N: 78, Key_O: 79, Key_P: 80, Key_Q: 81, Key_R: 82, Key_S: 83, Key_T: 84, Key_U: 85, Key_V: 86, Key_W: 87, Key_X: 88, Key_Y: 89, Key_Z: 90,\r\n  Key_BracketLeft: 219,\r\n  Key_Backslash: 220,\r\n  Key_BracketRight: 221,\r\n  Key_AsciiCircum: 160,\r\n  Key_Underscore: 167,\r\n  Key_QuoteLeft: 0,\r\n  Key_BraceLeft: 174,\r\n  Key_Bar: 172,\r\n  Key_BraceRight: 175,\r\n  Key_AsciiTilde: 176,\r\n  Key_Back: 0,\r\n  Key_Forward: 0,\r\n  Key_Stop: 0,\r\n  Key_VolumeDown: 182,\r\n  Key_VolumeUp: 183,\r\n  Key_VolumeMute: 181,\r\n  Key_Yes: 0,\r\n  Key_multiply: 106,\r\n  Key_add: 107,\r\n  Key_substract: 109,\r\n  Key_divide: 111,\r\n  Key_News: 0,\r\n  Key_OfficeHome: 0,\r\n  Key_Option: 0,\r\n  Key_Paste: 0,\r\n  Key_Phone: 0,\r\n  Key_Calendar: 0,\r\n  Key_Reply: 0,\r\n  Key_Reload: 0,\r\n  Key_RotateWindows: 0,\r\n  Key_RotationPB: 0,\r\n  Key_RotationKB: 0,\r\n  Key_Save: 0,\r\n  Key_Send: 0,\r\n  Key_Spell: 0,\r\n  Key_SplitScreen: 0,\r\n  Key_Support: 0,\r\n  Key_TaskPane: 0,\r\n  Key_Terminal: 0,\r\n  Key_Tools: 0,\r\n  Key_Travel: 0,\r\n  Key_Video: 0,\r\n  Key_Word: 0,\r\n  Key_Xfer: 0,\r\n  Key_ZoomIn: 0,\r\n  Key_ZoomOut: 0,\r\n  Key_Away: 0,\r\n  Key_Messenger: 0,\r\n  Key_WebCam: 0,\r\n  Key_MailForward: 0,\r\n  Key_Pictures: 0,\r\n  Key_Music: 0,\r\n  Key_Battery: 0,\r\n  Key_Bluetooth: 0,\r\n  Key_WLAN: 0,\r\n  Key_UWB: 0,\r\n  Key_AudioForward: 0,\r\n  Key_AudioRepeat: 0,\r\n  Key_AudioRandomPlay: 0,\r\n  Key_Subtitle: 0,\r\n  Key_AudioCycleTrack: 0,\r\n  Key_Time: 0,\r\n  Key_Hibernate: 0,\r\n  Key_View: 0,\r\n  Key_TopMenu: 0,\r\n  Key_PowerDown: 0,\r\n  Key_Suspend: 0,\r\n  Key_ContrastAdjust: 0,\r\n  Key_MediaLast: 0,\r\n  Key_unknown: -1,\r\n  Key_Call: 0,\r\n  Key_Camera: 0,\r\n  Key_CameraFocus: 0,\r\n  Key_Context1: 0,\r\n  Key_Context2: 0,\r\n  Key_Context3: 0,\r\n  Key_Context4: 0,\r\n  Key_Flip: 0,\r\n  Key_Hangup: 0,\r\n  Key_No: 0,\r\n  Key_Select: 93,\r\n  Key_Yes: 0,\r\n  Key_ToggleCallHangup: 0,\r\n  Key_VoiceDial: 0,\r\n  Key_LastNumberRedial: 0,\r\n  Key_Execute: 43,\r\n  Key_Printer: 42,\r\n  Key_Play: 250,\r\n  Key_Sleep: 95,\r\n  Key_Zoom: 251,\r\n  Key_Cancel: 3\r\n}\r\n\n/**\r\n * Creates and returns a signal with the parameters specified in @p params.\r\n *\r\n * @param params Array with the parameters of the signal. Each element has to be\r\n *               an object with the two properties \"type\" and \"name\" specifying\r\n *               the datatype of the parameter and its name. The type is\r\n *               currently ignored.\r\n * @param options Options that allow finetuning of the signal.\r\n */\r\nglobal.Signal = function Signal(params, options) {\r\n    options = options || {};\r\n    var connectedSlots = [];\r\n    var obj = options.obj\r\n\r\n    var signal = function() {\r\n        for (var i in connectedSlots)\r\n            try {\r\n                connectedSlots[i].slot.apply(connectedSlots[i].thisObj, arguments);\r\n            } catch(err) {\r\n                console.log(err.message);\r\n            }\r\n    };\r\n    signal.parameters = params || [];\r\n    signal.connect = function() {\r\n        if (arguments.length == 1)\r\n            connectedSlots.push({thisObj: global, slot: arguments[0]});\r\n        else if (typeof arguments[1] == 'string' || arguments[1] instanceof String) {\r\n            if (arguments[0].$tidyupList && arguments[0] !== obj)\r\n                arguments[0].$tidyupList.push(this);\r\n            connectedSlots.push({thisObj: arguments[0], slot: arguments[0][arguments[1]]});\r\n        } else {\r\n            if (arguments[0].$tidyupList && (!obj || (arguments[0] !== obj && arguments[0] !== obj.$parent)))\r\n                arguments[0].$tidyupList.push(this);\r\n            connectedSlots.push({thisObj: arguments[0], slot: arguments[1]});\r\n        }\r\n\r\n        // Notify object of connect\r\n        if (options.obj && options.obj.$connectNotify) {\r\n            options.obj.$connectNotify(options);\r\n        }\r\n\r\n    }\r\n    signal.disconnect = function() {\r\n        var callType = arguments.length == 1 ? (arguments[0] instanceof Function ? 1 : 2)\r\n                       : (typeof arguments[1] == 'string' || arguments[1] instanceof String) ? 3 : 4;\r\n        for (var i = 0; i < connectedSlots.length; i++) {\r\n            var item = connectedSlots[i];\r\n            if ((callType == 1 && item.slot == arguments[0])\r\n                || (callType == 2 && item.thisObj == arguments[0])\r\n                || (callType == 3 && item.thisObj == arguments[0] && item.slot == arguments[0][arguments[1]])\r\n                || (item.thisObj == arguments[0] && item.slot == arguments[1])\r\n            ) {\r\n                if (item.thisObj)\r\n                    item.thisObj.$tidyupList.splice(item.thisObj.$tidyupList.indexOf(this), 1);\r\n                connectedSlots.splice(i, 1);\r\n                i--; // We have removed an item from the list so the indexes shifted one backwards\r\n            }\r\n        }\r\n\r\n        // Notify object of disconnect\r\n        if (options.obj && options.obj.$disconnectNotify) {\r\n            options.obj.$disconnectNotify(options);\r\n        }\r\n    }\r\n    signal.isConnected = function() {\r\n        var callType = arguments.length == 1 ? 1\r\n                       : (typeof arguments[1] == 'string' || arguments[1] instanceof String) ? 2 : 3;\r\n        for (var i in connectedSlots) {\r\n            var item = connectedSlots[i];\r\n            if ((callType == 1 && item.slot == arguments[0])\r\n                || (callType == 2 && item.thisObj == arguments[0] && item.slot == arguments[0][arguments[1]])\r\n                || (item.thisObj == arguments[0] && item.slot == arguments[1])\r\n            )\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n    return signal;\r\n}\r\n\r\n\nvar GETTER = \"__defineGetter__\",\r\n    SETTER = \"__defineSetter__\",\r\n    // Property that is currently beeing evaluated. Used to get the information\r\n    // which property called the getter of a certain other property for\r\n    // evaluation and is thus dependant on it.\r\n    evaluatingProperty = undefined,\r\n    // All object constructors\r\n    constructors = {\r\n      int:         QMLInteger,\r\n      real:        Number,\r\n      double:      Number,\r\n      string:      String,\r\n      bool:        Boolean,\r\n      list:        QMLList,\r\n      color:       QMLColor,\r\n      enum:        Number,\r\n      url:         String,\r\n      variant:     QMLVariant,\r\n      'var':       QMLVariant,\r\n      QMLDocument: QMLComponent\r\n    };\r\nvar modules = {\r\n    Main: constructors\r\n  };\r\n\r\n// Helper. Adds a type to the constructor list\r\nglobal.registerGlobalQmlType = function (name, type) {\r\n  global[type.name]  = type;\r\n  constructors[name] = type;\r\n  modules.Main[name] = type;\r\n};\r\n\r\n// Helper. Register a type to a module\r\nglobal.registerQmlType = function(options) {\r\n  if (typeof options != 'object') {\r\n    registerGlobalQmlType(arguments[0], arguments[1]);\r\n  } else {\r\n    var moduleDescriptor = {\r\n      name:        options.name,\r\n      versions:    options.versions,\r\n      constructor: options.constructor\r\n    };\r\n\r\n    if (typeof modules[options.module] == 'undefined')\r\n      modules[options.module] = [];\r\n    modules[options.module].push(moduleDescriptor);\r\n\r\n    if (typeof options.baseClass !== 'undefined') {\r\n      inherit(options.constructor, options.baseClass);\r\n    }\r\n  }\r\n};\r\n\r\nglobal.getConstructor = function (moduleName, version, name) {\r\n  if (typeof modules[moduleName] != 'undefined') {\r\n    for (var i = 0 ; i < modules[moduleName].length ; ++i) {\r\n      var type = modules[moduleName][i];\r\n\r\n      if (type.name == name && type.versions.test(version))\r\n        return type.constructor;\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\nglobal.collectConstructorsForModule = function (moduleName, version) {\r\n  var constructors = {};\r\n\r\n  if (typeof modules[moduleName] == 'undefined') {\r\n    console.warn(\"module `\" + moduleName + \"` not found\");\r\n    return constructors;\r\n  }\r\n  for (var i = 0 ; i < modules[moduleName].length ; ++i) {\r\n    var module = modules[moduleName][i];\r\n\r\n    if (module.versions.test(version)) {\r\n      constructors[module.name] = module.constructor;\r\n    }\r\n  }\r\n  return constructors;\r\n};\r\n\r\nglobal.mergeObjects = function (obj1, obj2) {\r\n  var mergedObject = {};\r\n\r\n  if (typeof obj1 != 'undefined' && obj1 != null) {\r\n    for (var key in obj1) { mergedObject[key] = obj1[key]; }\r\n  }\r\n  if (typeof obj2 != 'undefined' && obj2 != null) {\r\n    for (var key in obj2) { mergedObject[key] = obj2[key]; }\r\n  }\r\n  return mergedObject;\r\n}\r\n\r\nglobal.perContextConstructors = {};\r\n\r\nglobal.loadImports = function (self, imports) {\r\n  constructors = mergeObjects(modules.Main, null);\r\n  for (var i = 0 ; i < imports.length ; ++i) {\r\n    var moduleName = imports[i][1],\r\n        moduleVersion = imports[i][2],\r\n        moduleAlias = imports[i][3],\r\n        moduleConstructors = collectConstructorsForModule(moduleName, moduleVersion);\r\n\r\n    if (moduleAlias !== \"\")\r\n      constructors[moduleAlias] = mergeObjects(constructors[moduleAlias], moduleConstructors);\r\n    else\r\n      constructors = mergeObjects(constructors, moduleConstructors);\r\n  }\r\n  perContextConstructors[self.objectId] = constructors;\r\n}\r\n\r\nglobal.inherit = function(constructor, baseClass) {\r\n  var oldProto = constructor.prototype;\r\n  constructor.prototype = Object.create(baseClass.prototype);\r\n  Object.keys(oldProto).forEach(function(prop) {\r\n    constructor.prototype[prop] = oldProto[prop];\r\n  });\r\n  constructor.prototype.constructor = baseClass;\r\n}\r\n\r\n/**\r\n * QML Object constructor.\r\n * @param {Object} meta Meta information about the object and the creation context\r\n * @return {Object} New qml object\r\n */\r\nfunction construct(meta) {\r\n    var item,\r\n        component;\r\n\r\n    if (meta.object.$class in constructors) {\r\n        item = new constructors[meta.object.$class](meta);\r\n    }\r\n    else {\r\n        // Load component from file. Please look at import.js for main notes.\r\n        // Actually, we have to use that order:\r\n        // 1) try to load component from current basePath\r\n        // 2) from importPathList\r\n        // 3) from directories in imports statements and then\r\n        // 4) from qmldir files\r\n        // Currently we support only 1,2 and 4 and use order: 4,1,2\r\n        // TODO: engine.qmldirs is global for all loaded components. That's not qml's original behaviour.\r\n        var qdirInfo = engine.qmldirs[meta.object.$class]; // Are we have info on that component in some imported qmldir files?\r\n        if (qdirInfo) {\r\n            // We have that component in some qmldir, load it from qmldir's url\r\n            component = Qt.createComponent( \"@\" + qdirInfo.url, meta.context);\r\n        }\r\n        else\r\n            component = Qt.createComponent(meta.object.$class + \".qml\", meta.context);\r\n\r\n        if (component) {\r\n            var item = component.createObject(meta.parent);\r\n\r\n            if (typeof item.dom != 'undefined')\r\n                item.dom.className += \" \" + meta.object.$class + (meta.object.id ? \" \" + meta.object.id : \"\");\r\n            var dProp; // Handle default properties\r\n        } else {\r\n            console.log(\"No constructor found for \" + meta.object.$class);\r\n            return;\r\n        }\r\n    }\r\n\r\n    // id\r\n    if (meta.object.id)\r\n        meta.context[meta.object.id] = item;\r\n\r\n    // keep path in item for probale use it later in Qt.resolvedUrl\r\n    item.$context[\"$basePath\"] = engine.$basePath; //gut\r\n\r\n    // Apply properties (Bindings won't get evaluated, yet)\r\n    applyProperties(meta.object, item, item, item.$context);\r\n\r\n    return item;\r\n}\r\n\r\n/**\r\n * Create property getters and setters for object.\r\n * @param {Object} obj Object for which gsetters will be set\r\n * @param {String} propName Property name\r\n * @param {Object} [options] Options that allow finetuning of the property\r\n */\r\nfunction createSimpleProperty(type, obj, propName, options) {\r\n    var prop = new QMLProperty(type, obj, propName);\r\n    var getter, setter;\r\n\r\n    if (typeof options == 'undefined')\r\n      options = {};\r\n    else if (typeof options != 'object')\r\n      options = { default: options }\r\n\r\n    obj[propName + \"Changed\"] = prop.changed;\r\n    obj.$properties[propName] = prop;\r\n    obj.$properties[propName].set(options.default);\r\n    getter = function()       { return obj.$properties[propName].get(); };\r\n    if (!options.readOnly)\r\n      setter = function(newVal) { return obj.$properties[propName].set(newVal); };\r\n    else {\r\n      setter = function(newVal) {\r\n        if (obj.$canEditReadOnlyProperties != true)\r\n          throw \"property '\" + propName + \"' has read only access\";\r\n        return obj.$properties[propName].set(newVal);\r\n      }\r\n    }\r\n    setupGetterSetter(obj, propName, getter, setter);\r\n    if (obj.$isComponentRoot)\r\n        setupGetterSetter(obj.$context, propName, getter, setter);\r\n}\r\n\r\n/**\r\n * Set up simple getter function for property\r\n */\r\nvar setupGetter,\r\n    setupSetter,\r\n    setupGetterSetter;\r\n(function() {\r\n\r\n// todo: What's wrong with Object.defineProperty on some browsers?\r\n// Object.defineProperty is the standard way to setup getters and setters.\r\n// However, the following way to use Object.defineProperty don't work on some\r\n// webkit-based browsers, namely Safari, iPad, iPhone and Nokia N9 browser.\r\n// Chrome, firefox and opera still digest them fine.\r\n\r\n// So, if the deprecated __defineGetter__ is available, use those, and if not\r\n// use the standard Object.defineProperty (IE for example).\r\n\r\n    var useDefineProperty = !(Object[GETTER] && Object[SETTER]);\r\n\r\n    if (useDefineProperty) {\r\n\r\n        if (!Object.defineProperty) {\r\n            console.log(\"No __defineGetter__ or defineProperty available!\");\r\n        }\r\n\r\n        setupGetter = function(obj, propName, func) {\r\n            Object.defineProperty(obj, propName,\r\n                { get: func, configurable: true, enumerable: true } );\r\n        }\r\n        setupSetter = function(obj, propName, func) {\r\n            Object.defineProperty(obj, propName,\r\n                { set: func, configurable: true, enumerable: false });\r\n        }\r\n        setupGetterSetter = function(obj, propName, getter, setter) {\r\n            Object.defineProperty(obj, propName,\r\n                {get: getter, set: setter, configurable: true, enumerable: false });\r\n        }\r\n    } else {\r\n        setupGetter = function(obj, propName, func) {\r\n            obj[GETTER](propName, func);\r\n        }\r\n        setupSetter = function(obj, propName, func) {\r\n            obj[SETTER](propName, func);\r\n        }\r\n        setupGetterSetter = function(obj, propName, getter, setter) {\r\n            obj[GETTER](propName, getter);\r\n            obj[SETTER](propName, setter);\r\n        }\r\n    }\r\n\r\n})();\r\n/**\r\n * Apply properties from metaObject to item.\r\n * @param {Object} metaObject Source of properties\r\n * @param {Object} item Target of property apply\r\n * @param {Object} objectScope Scope in which properties should be evaluated\r\n * @param {Object} componentScope Component scope in which properties should be evaluated\r\n */\r\nfunction applyProperties(metaObject, item, objectScope, componentScope) {\r\n    var i;\r\n    objectScope = objectScope || item;\r\n    for (i in metaObject) {\r\n        var value = metaObject[i];\r\n        // skip global id's and internal values\r\n        if (i == \"id\" || i[0] == \"$\") {\r\n            continue;\r\n        }\r\n        // slots\r\n        if (i.indexOf(\"on\") == 0 && i[2].toUpperCase() == i[2]) {\r\n            var signalName =  i[2].toLowerCase() + i.slice(3);\r\n            if (!item[signalName]) {\r\n                console.warn(\"No signal called \" + signalName + \" found!\");\r\n                continue;\r\n            }\r\n            else if (typeof item[signalName].connect != 'function') {\r\n                console.warn(signalName + \" is not a signal!\");\r\n                continue;\r\n            }\r\n            if (!value.eval) {\r\n                var params = \"\";\r\n                for (var j in item[signalName].parameters) {\r\n                    params += j==0 ? \"\" : \", \";\r\n                    params += item[signalName].parameters[j].name;\r\n                }\r\n                value.src = \"(function(\" + params + \") {\" + value.src + \"})\";\r\n                value.function = false;\r\n                value.compile();\r\n            }\r\n            item[signalName].connect(item, value.eval(objectScope, componentScope));\r\n            continue;\r\n        }\r\n\r\n        if (value instanceof Object) {\r\n            if (value instanceof QMLSignalDefinition) {\r\n                item[i] = Signal(value.parameters);\r\n                if (item.$isComponentRoot)\r\n                    componentScope[i] = item[i];\r\n                continue;\r\n            } else if (value instanceof QMLMethod) {\r\n                value.compile();\r\n                item[i] = value.eval(objectScope, componentScope);\r\n                if (item.$isComponentRoot)\r\n                    componentScope[i] = item[i];\r\n                continue;\r\n            } else if (value instanceof QMLAliasDefinition) {\r\n                createSimpleProperty(\"alias\", item, i);\r\n                item.$properties[i].componentScope = componentScope;\r\n                item.$properties[i].val = value;\r\n                item.$properties[i].get = function() {\r\n                    var obj = this.componentScope[this.val.objectName];\r\n                    return this.val.propertyName ? obj.$properties[this.val.propertyName].get() : obj;\r\n                }\r\n                item.$properties[i].set = function(newVal, fromAnimation, objectScope, componentScope) {\r\n                    if (!this.val.propertyName)\r\n                        throw \"Cannot set alias property pointing to an QML object.\";\r\n                    this.componentScope[this.val.objectName].$properties[this.val.propertyName].set(newVal, fromAnimation, objectScope, componentScope);\r\n                }\r\n                continue;\r\n            } else if (value instanceof QMLPropertyDefinition) {\r\n                createSimpleProperty(value.type, item, i);\r\n                item.$properties[i].set(value.value, true, objectScope, componentScope);\r\n                continue;\r\n            } else if (item[i] && value instanceof QMLMetaPropertyGroup) {\r\n                // Apply properties one by one, otherwise apply at once\r\n                applyProperties(value, item[i], objectScope, componentScope);\r\n                continue;\r\n            }\r\n        }\r\n        if (item.$properties && i in item.$properties)\r\n            item.$properties[i].set(value, true, objectScope, componentScope);\r\n        else if (i in item)\r\n            item[i] = value;\r\n        else if (item.$setCustomData)\r\n            item.$setCustomData(i, value);\r\n        else\r\n            console.warn(\"Cannot assign to non-existent property \\\"\" + i + \"\\\". Ignoring assignment.\");\r\n    }\r\n    if (metaObject.$children && metaObject.$children.length !== 0) {\r\n        if (item.$defaultProperty)\r\n            item.$properties[item.$defaultProperty].set(metaObject.$children, true, objectScope, componentScope);\r\n        else\r\n            throw \"Cannot assign to unexistant default property\";\r\n    }\r\n    // We purposefully set the default property AFTER using it, in order to only have it applied for\r\n    // instanciations of this component, but not for its internal children\r\n    if (metaObject.$defaultProperty)\r\n        item.$defaultProperty = metaObject.$defaultProperty;\r\n    if (typeof item.completed != 'undefined' && item.completedAlreadyCalled == false) {\r\n      item.completedAlreadyCalled = true;\r\n      item.completed();\r\n    }\r\n}\r\n\r\n// ItemModel. EXPORTED.\r\nJSItemModel = function() {\r\n    this.roleNames = [];\r\n\r\n    this.setRoleNames = function(names) {\r\n        this.roleNames = names;\r\n    }\r\n\r\n    this.dataChanged = Signal([\r\n        {type:\"int\", name:\"startIndex\"},\r\n        {type:\"int\", name:\"endIndex\"}\r\n    ]);\r\n    this.rowsInserted = Signal([\r\n        {type:\"int\", name:\"startIndex\"},\r\n        {type:\"int\", name:\"endIndex\"}\r\n    ]);\r\n    this.rowsMoved = Signal([\r\n        {type:\"int\", name:\"sourceStartIndex\"},\r\n        {type:\"int\", name:\"sourceEndIndex\"},\r\n        {type:\"int\", name:\"destinationIndex\"}\r\n    ]);\r\n    this.rowsRemoved = Signal([\r\n        {type:\"int\", name:\"startIndex\"},\r\n        {type:\"int\", name:\"endIndex\"}\r\n    ]);\r\n    this.modelReset = Signal();\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\n// Stuff below defines QML things\r\n// -----------------------------------------------------------------------------\r\n\r\n// Helper\r\nfunction unboundMethod() {\r\n    console.log(\"Unbound method for\", this);\r\n}\r\n\n(function() {\r\n  global.importJavascriptInContext = function (jsData, $context) {\r\n    with($context) {\r\n      eval(jsData.source);\r\n      for (var i = 0 ; i < jsData.exports.length ; ++i) {\r\n        var symbolName = jsData.exports[i];\r\n        $context[symbolName] = eval(symbolName);\r\n      }\r\n    }\r\n  }\r\n\r\n  global.jsparse = function (source) {\r\n    var obj = { exports: [], source: source };\r\n    var AST_Tree = qmlweb_parse(source, qmlweb_parse.JSResource);\r\n    var foo_function_scope = AST_Tree[2][2][3];\r\n\r\n    for (var i = 0 ; i < foo_function_scope.length ; ++i) {\r\n      var item = foo_function_scope[i];\r\n\r\n      switch (item[0]) {\r\n        case \"var\":\r\n          obj.exports.push(item[1][0][0]);\r\n          break ;\r\n        case \"defun\":\r\n          obj.exports.push(item[1]);\r\n          break ;\r\n      }\r\n    }\r\n    return obj;\r\n  }\r\n\r\n})();\r\n\n// Base object for all qml elements\r\nfunction QMLBaseObject(meta) {\r\n    QObject.call(this, meta.parent);\r\n    var i,\r\n        prop;\r\n\r\n    this.$draw = function(){};\r\n    this.$isComponentRoot = meta.isComponentRoot;\r\n    this.$context = meta.context;\r\n\r\n    // Component.onCompleted\r\n    this.Component = new QObject(this);\r\n    this.Component.completed = Signal([]);\r\n    engine.completedSignals.push(this.Component.completed);\r\n    this.completed = this.Component.completed;\r\n\r\n    this.Component.destruction = Signal([]);\r\n    this.destruction = this.Component.destruction;\r\n\r\n    // Component get own properties\r\n    var attributes = [];\r\n    for (var key in meta.object) {\r\n      if (meta.object.hasOwnProperty(key) &&\r\n          typeof meta.object[key] != 'undefined' && meta.object[key] != null &&\r\n          (meta.object[key].__proto__.constructor.name == 'QMLPropertyDefinition' ||\r\n           meta.object[key].__proto__.constructor.name == 'QMLAliasDefinition')) {\r\n        attributes.push(key);\r\n      }\r\n    }\r\n\r\n    this.Keys = new QObject(this);\r\n    this.Keys.asteriskPresed = Signal();\r\n    this.Keys.backPressed = Signal();\r\n    this.Keys.backtabPressed = Signal();\r\n    this.Keys.callPressed = Signal();\r\n    this.Keys.cancelPressed = Signal();\r\n    this.Keys.deletePressed = Signal();\r\n    for (var i = 0 ; i < 10 ; ++i)\r\n      this.Keys['digit'+i+'Pressed'] = Signal();\r\n    this.Keys.escapePressed = Signal();\r\n    this.Keys.flipPressed = Signal();\r\n    this.Keys.hangupPressed = Signal();\r\n    this.Keys.leftPressed = Signal();\r\n    this.Keys.menuPressed = Signal();\r\n    this.Keys.noPressed = Signal();\r\n    this.Keys.pressed = Signal();\r\n    this.Keys.released = Signal();\r\n    this.Keys.returnPressed = Signal();\r\n    this.Keys.rightPressed = Signal();\r\n    this.Keys.selectPressed = Signal();\r\n    this.Keys.spacePressed = Signal();\r\n    this.Keys.tabPressed = Signal();\r\n    this.Keys.upPressed = Signal();\r\n    this.Keys.volumeDownPressed = Signal();\r\n    this.Keys.volumeUpPressed = Signal();\r\n    this.Keys.yesPressed = Signal();\r\n\r\n    this.getAttributes = function() { return (attributes); }\r\n}\r\n\r\nregisterQmlType({\r\n    module: 'QtQuick',\r\n    name: 'QtObject',\r\n    versions: /.*/,\r\n    constructor: QMLBaseObject\r\n});\r\n\n// TODO\r\nfunction QMLColor(val) {\r\n  if (typeof val === \"number\") {\r\n    // we assume it is int value and must be converted to css hex with padding\r\n    // http://stackoverflow.com/questions/57803/how-to-convert-decimal-to-hex-in-javascript\r\n    val = \"#\" + (Math.round(val) + 0x1000000).toString(16).substr(-6).toUpperCase();\r\n  } else {\r\n    if(typeof val === \"array\" && val.length >= 3) {\r\n      // array like [r,g,b] where r,g,b are in 0..1 range\r\n      var m = 255;\r\n      val = \"rgb(\" + Math.round(m * val[0]) + \",\" + Math.round(m * val[1]) + \",\" + Math.round(m * val[2]) + \")\";\r\n    }\r\n  }\r\n  return val;\r\n};\r\n\nfunction QMLContext() {\r\n    this.nameForObject = function(obj) {\r\n        for (var name in this) {\r\n            if (this[name] == obj)\r\n                return name;\r\n        }\r\n    }\r\n}\r\n\r\nQMLComponent.prototype.createObject = function(parent, properties) {\r\n    var oldState = engine.operationState;\r\n    engine.operationState = QMLOperationState.Init;\r\n    // change base path to current component base path\r\n    var bp = engine.$basePath; engine.$basePath = this.$basePath ? this.$basePath : engine.$basePath;\r\n\r\n    var item = construct({\r\n        object: this.$metaObject,\r\n        parent: parent,\r\n        context: this.$context ? Object.create(this.$context) : new QMLContext(),\r\n        isComponentRoot: true\r\n    });\r\n\r\n    // change base path back\r\n    //TODO looks a bit hacky\r\n    engine.$basePath = bp;\r\n\r\n    engine.operationState = oldState;\r\n    return item;\r\n}\r\n\r\nfunction QMLComponent(meta) {\r\n    if (constructors[meta.object.$class] == QMLComponent)\r\n        this.$metaObject = meta.object.$children[0];\r\n    else\r\n        this.$metaObject = meta.object;\r\n    this.$context = meta.context;\r\n\r\n    var jsImports = [];\r\n\r\n    this.finalizeImports = (function($context) {\r\n      for (var i = 0 ; i < jsImports.length ; ++i) {\r\n        var importDesc = jsImports[i];\r\n        var src = importDesc[1];\r\n        var js;\r\n\r\n        if (typeof qmlEngine.$basePath != 'undefined')\r\n          src = qmlEngine.$basePath + src;\r\n        if (typeof qrc[src] != 'undefined')\r\n          js = qrc[src];\r\n        else\r\n          js = global.jsparse(getUrlContents(src));\r\n        if (importDesc[3] !== \"\") {\r\n          $context[importDesc[3]] = {};\r\n          importJavascriptInContext(js, $context[importDesc[3]]);\r\n        }\r\n        else\r\n          importJavascriptInContext(js, $context);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (meta.object.$imports instanceof Array)\r\n    {\r\n      var moduleImports = [];\r\n      var loadImport    = (function(importDesc) {\r\n        if (/\\.js$/.test(importDesc[1]))\r\n          jsImports.push(importDesc);\r\n        else\r\n          moduleImports.push(importDesc);\r\n      }).bind(this);\r\n\r\n      for (var i = 0 ; i < meta.object.$imports.length ; ++i) {\r\n        loadImport(meta.object.$imports[i]);\r\n      }\r\n      loadImports(this, moduleImports);\r\n      if (typeof this.$context != 'undefined' && this.$context != null)\r\n        this.finalizeImports(this.$context);\r\n    }\r\n}\r\ninherit(QMLComponent, QMLBaseObject);\r\n\r\nregisterQmlType('Component',   QMLComponent);\r\nregisterQmlType('QMLDocument', QMLComponent);\r\n\n/*\r\n * - QMLEngine(element, options) -- Returns new qml engine object, for which:\r\n *   - loadFile(file) -- Load file to the engine (.qml or .qml.js atm)\r\n *   - start() -- start the engine/application\r\n *   - stop() -- stop the engine/application. Restarting is experimental.\r\n *   element is HTMLCanvasElement and options are for debugging.\r\n *   For further reference, see testpad and qml viewer applications.\r\n */\r\n\r\n// There can only be one running QMLEngine. This variable points to the currently running engine.\r\nvar engine = null;\r\n\r\n// QML engine. EXPORTED.\r\nQMLEngine = function (element, options) {\r\n//----------Public Members----------\r\n    this.fps = 60;\r\n    this.$interval = Math.floor(1000 / this.fps); // Math.floor, causes bugs to timing?\r\n    this.running = false;\r\n\r\n    // Mouse Handling\r\n    this.mouseAreas = [];\r\n    this.oldMousePos = {x:0, y:0};\r\n\r\n    // List of available Components\r\n    this.components = {};\r\n\r\n    this.rootElement = element;\r\n\r\n    // List of Component.completed signals\r\n    this.completedSignals = [];\r\n\r\n    // Current operation state of the engine (Idle, init, etc.)\r\n    this.operationState = 1;\r\n\r\n    // List of properties whose values are bindings. For internal use only.\r\n    this.bindedProperties = [];\r\n\r\n    // Root object of the engine\r\n    this.rootObject = null;\r\n\r\n    // Base path of qml engine (used for resource loading)\r\n    this.$basePath = \"\";\r\n\r\n\r\n//----------Public Methods----------\r\n    // Start the engine\r\n    this.start = function()\r\n    {\r\n        engine = this;\r\n        var i;\r\n        if (this.operationState !== QMLOperationState.Running) {\r\n            this.operationState = QMLOperationState.Running;\r\n            tickerId = setInterval(tick, this.$interval);\r\n            for (i = 0; i < whenStart.length; i++) {\r\n                whenStart[i]();\r\n            }\r\n        }\r\n    }\r\n\r\n    // Stop the engine\r\n    this.stop = function()\r\n    {\r\n        var i;\r\n        if (this.operationState == QMLOperationState.Running) {\r\n            element.removeEventListener(\"touchstart\", touchHandler);\r\n            element.removeEventListener(\"mousemove\", mousemoveHandler);\r\n            clearInterval(tickerId);\r\n            this.operationState = QMLOperationState.Idle;\r\n            for (i = 0; i < whenStop.length; i++) {\r\n                whenStop[i]();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    this.ensureFileIsLoadedInQrc = function(file) {\r\n      if (!qrc.includesFile(file)) {\r\n        var src = getUrlContents(file);\r\n\r\n        if (src) {\r\n            console.log('Loading file [', file, ']');\r\n            qrc[file] = qmlparse(src);\r\n        } else {\r\n            console.log('Can not load file [', file, ']');\r\n        }\r\n      }\r\n    }\r\n\r\n    this.extractBasePath = function( file ) {\r\n       var basePath = file.split(/[\\/\\\\]/); // work both in url (\"/\") and windows (\"\\\", from file://d:\\test\\) notation\r\n       basePath[basePath.length - 1] = \"\";\r\n       basePath = basePath.join(\"/\");\r\n       return basePath;\r\n    }\r\n    // Load file, parse and construct (.qml or .qml.js)\r\n    this.loadFile = function(file) {\r\n        var tree;\r\n\r\n        this.$basePath = this.extractBasePath(file);\r\n        this.ensureFileIsLoadedInQrc(file);\r\n        tree = convertToEngine(qrc[file]);\r\n        this.loadQMLTree(tree);\r\n    }\r\n\r\n    // parse and construct qml\r\n    this.loadQML = function(src) {\r\n        this.loadQMLTree(parseQML(src));\r\n    }\r\n\r\n    this.loadQMLTree = function(tree, file) {\r\n        engine = this;\r\n        if (options.debugTree) {\r\n            options.debugTree(tree);\r\n        }\r\n\r\n        // Create and initialize objects\r\n        var component = new QMLComponent({ object: tree, parent: null });\r\n\r\n        this.loadImports( tree.$imports );\r\n        component.$basePath = engine.$basePath;\r\n        component.$imports = tree.$imports; // for later use\r\n        component.$file = file; // just for debugging\r\n\r\n        this.rootObject = component.createObject(null);\r\n        component.finalizeImports(this.rootContext());\r\n        this.$initializePropertyBindings();\r\n\r\n        this.start();\r\n\r\n        // Call completed signals\r\n        for (var i in this.completedSignals) {\r\n            this.completedSignals[i]();\r\n        }\r\n    }\r\n\r\n    /** from http://docs.closure-library.googlecode.com/git/local_closure_goog_uri_uri.js.source.html\r\n     *\r\n     * Removes dot segments in given path component, as described in\r\n     * RFC 3986, section 5.2.4.\r\n     *\r\n     * @param {string} path A non-empty path component.\r\n     * @return {string} Path component with removed dot segments.\r\n     */\r\n    this.removeDotSegments = function(path) {\r\n        var leadingSlash = (path && path[0] == \"/\");   // path.startsWith('/'); -- startsWith seems to be undefined in some browsers\r\n        var segments = path.split('/');\r\n        var out = [];\r\n\r\n        for (var pos = 0; pos < segments.length; ) {\r\n            var segment = segments[pos++];\r\n\r\n            if (segment == '.') {\r\n                if (leadingSlash && pos == segments.length) {\r\n                    out.push('');\r\n                }\r\n            } else if (segment == '..') {\r\n                if (out.length > 1 || out.length == 1 && out[0] != '') {\r\n                    out.pop();\r\n                }\r\n                if (leadingSlash && pos == segments.length) {\r\n                    out.push('');\r\n                }\r\n            } else {\r\n                out.push(segment);\r\n                leadingSlash = true;\r\n            }\r\n        }\r\n\r\n        return out.join('/');\r\n    };\r\n\r\n    /*\r\n      engine.loadImports( imports, currentDir ) : performs loading of qmldir files from given qml import records.\r\n\r\n      Input:\r\n      * parameter `importsArray` - import statements. It is in parser notation, e.g. [import1, import2, ...] where each importN is also array: [\"qmlimport\",\"name\",version,as,isQualifiedName]\r\n      * parameter `currentFileDir` - base dir for imports lookup. It will be used together with importPathList()\r\n\r\n      Implicit input:\r\n      * engine object function `importPathList()` - list of urls bases used for qmldir files lookup\r\n\r\n      Additional implicit input/output:\r\n      * engine object variable `qmldirsContents` - used for caching, e.g. memory for previously loaded qmldir files\r\n\r\n      Output: \r\n      * engine object variable `qmldirs` - new records will be added there\r\n\r\n      Return value: \r\n      * nothing\r\n\r\n      Details:\r\n\r\n      For each of given import statements, loadImports \r\n      1. computes qmldir file location according to http://doc.qt.io/qt-5/qtqml-syntax-imports.html\r\n      2. calls `readQmlDir` for actual reading and parsing of qmldir file content\r\n      3. gets `external` declarations of that qmldir file and pushes them to `engine.qmldirs` hash.\r\n\r\n      `engine.qmldirs` is a hash of form: { componentName => componentFileUrl }\r\n      This hash then used by `qml.js::construct` method for computing component urls.\r\n\r\n      Notes:\r\n      1. This method is not suited for loading js imports. This may be done probably after answering to Q1 (below).\r\n      2. Please look for additional notes at readQmlDir function.\r\n\r\n      QNA\r\n      Q1: How and where in engine component names might be prefixed? E.g. names with dot inside: SomeModule.Component1\r\n      A1: Seems it doesn't matter. Seems we may just save name with dot-inside right to qmldirs, and it may be used by construct() seamlessly. Check it..\r\n\r\n      Q2: How we may access component object from here, to store qmldirs info in components logical scope, and not at engine scope?\r\n      A2: Probably, answer is in Component.js and in global.loadImports\r\n\r\n      TODO \r\n      * We have to keep output in component scope, not in engine scope.\r\n      * We have to add module \"as\"-names to component's names (which is possible after keeping imports in component scope).\r\n      * Determine how this stuff is related to `global.loadImports`\r\n      * Check A1\r\n      * Make a complete picture of what going in with imports, including Component.js own imports loading\r\n      * Note importJs method in import.js \r\n    */\r\n\r\n    this.loadImports = function(importsArray, currentFileDir) {\r\n        if (!this.qmldirsContents) this.qmldirsContents = { \"QtQuick\":{}, \"QtQuick.Controls\":{} }; // cache\r\n        // putting initial keys in qmldirsContents - is a hack. We should find a way to explain to qmlweb, is this built-in module or qmldir-style module.\r\n\r\n        if (!this.qmldirs) this.qmldirs = {};                 // resulting components lookup table\r\n\r\n        if (!importsArray || importsArray.length == 0) return;\r\n        if (!currentFileDir) currentFileDir = this.$basePath;     // use this.$basePath by default\r\n\r\n        for (var i=0; i<importsArray.length; i++) {\r\n            var entry = importsArray[i];\r\n\r\n            var name = entry[1];\r\n\r\n            var nameIsUrl = name.indexOf(\"//\") == 0 || name.indexOf(\"://\") >= 0;  // is it url to remote resource\r\n            var nameIsQualifiedModuleName = entry[4]; // e.g. QtQuick, QtQuick.Controls, etc\r\n            var nameIsDir = !nameIsQualifiedModuleName && !nameIsUrl; // local [relative] dir\r\n\r\n            if (nameIsDir) {\r\n                // resolve name from relative to full dir path\r\n                // we hope all dirs are relative\r\n                name = this.removeDotSegments( currentFileDir + name );\r\n                if (name[ name.length-1 ] == \"/\")\r\n                    name = name.substr( 0, name.length-1 ); // remove trailing slash as it required for `readQmlDir`\r\n            }\r\n            // TODO if nameIsDir, we have also to add `name` to importPathList() for current component...\r\n\r\n            // check if we have already loaded that qmldir file\r\n            if (this.qmldirsContents[ name ]) continue;\r\n\r\n            var content = false;\r\n            if (nameIsQualifiedModuleName && this.userAddedModulePaths && this.userAddedModulePaths[ name ]) {\r\n                // 1. we have qualified module and user had configured path for that module with this.addModulePath\r\n                content = readQmlDir( this.userAddedModulePaths[ name ] );\r\n            }\r\n            else if (nameIsUrl || nameIsDir)\r\n            {\r\n                // 2. direct load\r\n                // nameIsUrl => url do not need dirs\r\n                // nameIsDir => already computed full path above\r\n                content = readQmlDir( name );\r\n            }\r\n            else\r\n            {\r\n                // 3. qt-style lookup for qualified module\r\n                var probableDirs = [currentFileDir].concat( this.importPathList() )\r\n                var diredName = name.replace( /\\./g,\"/\" );\r\n\r\n                for (var k=0; k<probableDirs.length; k++) {\r\n                    var file = probableDirs[k] + diredName;\r\n                    content = readQmlDir( file );\r\n                    if (content) break;\r\n                }\r\n            }\r\n\r\n            if (!content) {\r\n                console.log(\"qmlengine::loadImports: cannot load qmldir file for import name=\",name );\r\n                // save blank info, meaning that we failed to load import\r\n                // this prevents repeated lookups\r\n                this.qmldirsContents[ name ] = {};\r\n\r\n               // NEW\r\n               // add that dir to import path list\r\n               // that means, lookup qml files in that failed dir by trying to load them directly\r\n               // this is not the same behavior as in Qt for \"url\" schemes,\r\n               // but it is same as for ordirnal disk files. \r\n               // So, we do it for experimental purposes.\r\n               if (nameIsDir) \r\n                 this.addImportPath( name + \"/\" );\r\n\r\n               continue;\r\n            }\r\n\r\n            // copy founded externals to global var\r\n            // TODO actually we have to copy it to current component\r\n            for (var attrname in content.externals) { this.qmldirs[attrname] = content.externals[attrname]; }\r\n\r\n            // keep already loaded qmldir files\r\n            this.qmldirsContents[ name ] = content;\r\n        }\r\n\r\n    }\r\n\r\n    this.rootContext = function() {\r\n      return this.rootObject.$context;\r\n    }\r\n\r\n    this.focusedElement = (function() {\r\n      return this.rootContext().activeFocus;\r\n    }).bind(this);\r\n\r\n    // KEYBOARD MANAGEMENT\r\n    var keyboardSignals = {};\r\n    keyboardSignals[Qt.Key_Asterisk]   = 'asteriskPressed';\r\n    keyboardSignals[Qt.Key_Back]       = 'backPressed';\r\n    keyboardSignals[Qt.Key_Backtab]    = 'backtabPressed';\r\n    keyboardSignals[Qt.Key_Call]       = 'callPressed';\r\n    keyboardSignals[Qt.Key_Cancel]     = 'cancelPressed';\r\n    keyboardSignals[Qt.Key_Delete]     = 'deletePressed';\r\n    keyboardSignals[Qt.Key_0]          = 'digit0Pressed';\r\n    keyboardSignals[Qt.Key_1]          = 'digit1Pressed';\r\n    keyboardSignals[Qt.Key_2]          = 'digit2Pressed';\r\n    keyboardSignals[Qt.Key_3]          = 'digit3Pressed';\r\n    keyboardSignals[Qt.Key_4]          = 'digit4Pressed';\r\n    keyboardSignals[Qt.Key_5]          = 'digit5Pressed';\r\n    keyboardSignals[Qt.Key_6]          = 'digit6Pressed';\r\n    keyboardSignals[Qt.Key_7]          = 'digit7Pressed';\r\n    keyboardSignals[Qt.Key_8]          = 'digit8Pressed';\r\n    keyboardSignals[Qt.Key_9]          = 'digit9Pressed';\r\n    keyboardSignals[Qt.Key_Escape]     = 'escapePressed';\r\n    keyboardSignals[Qt.Key_Flip]       = 'flipPressed';\r\n    keyboardSignals[Qt.Key_Hangup]     = 'hangupPressed';\r\n    keyboardSignals[Qt.Key_Menu]       = 'menuPressed';\r\n    keyboardSignals[Qt.Key_No]         = 'noPressed';\r\n    keyboardSignals[Qt.Key_Return]     = 'returnPressed';\r\n    keyboardSignals[Qt.Key_Select]     = 'selectPressed';\r\n    keyboardSignals[Qt.Key_Space]      = 'spacePressed';\r\n    keyboardSignals[Qt.Key_Tab]        = 'tabPressed';\r\n    keyboardSignals[Qt.Key_VolumeDown] = 'volumeDownPressed';\r\n    keyboardSignals[Qt.Key_VolumeUp]   = 'volumeUpPressed';\r\n    keyboardSignals[Qt.Key_Yes]        = 'yesPressed';\r\n    keyboardSignals[Qt.Key_Up]         = 'upPressed';\r\n    keyboardSignals[Qt.Key_Right]      = 'rightPressed';\r\n    keyboardSignals[Qt.Key_Down]       = 'downPressed';\r\n    keyboardSignals[Qt.Key_Left]       = 'leftPressed';\r\n\r\n    function keyCodeToQt(e) {\r\n      if (e.keyCode >= 96 && e.keyCode <= 111) {\r\n        e.keypad = true;\r\n      }\r\n      if (e.keyCode == Qt.Key_Tab && e.shiftKey == true)\r\n        return Qt.Key_Backtab;\r\n      else if (e.keyCode >= 97 && e.keyCode <= 122)\r\n        return e.keyCode - (97 - Qt.Key_A);\r\n      return e.keyCode;\r\n    }\r\n\r\n    function eventToKeyboard(e) {\r\n        return {\r\n            accepted: false,\r\n            count: 1,\r\n            isAutoRepeat: false,\r\n            key: keyCodeToQt(e),\r\n            modifiers: (e.ctrlKey * Qt.CtrlModifier)\r\n                    | (e.altKey   * Qt.AltModifier)\r\n                    | (e.shiftKey * Qt.ShiftModifier)\r\n                    | (e.metaKey  * Qt.MetaModifier)\r\n                    | (e.keypad   * Qt.KeypadModifier),\r\n            text: String.fromCharCode(e.charCode)\r\n        };\r\n    }\r\n\r\n    document.onkeypress = (function(e) {\r\n      var focusedElement = this.focusedElement();\r\n      var event          = eventToKeyboard(e || window.event);\r\n      var eventName      = keyboardSignals[event.key];\r\n\r\n      while (event.accepted != true && focusedElement != null) {\r\n        var backup       = focusedElement.$context.event;\r\n\r\n        focusedElement.$context.event = event;\r\n        focusedElement.Keys.pressed(event);\r\n        if (eventName != null)\r\n          focusedElement.Keys[eventName](event);\r\n        focusedElement.$context.event = backup;\r\n        if (event.accepted == true)\r\n          e.preventDefault();\r\n        else\r\n          focusedElement = focusedElement.$parent;\r\n      }\r\n    }).bind(this);\r\n\r\n    document.onkeyup = (function(e) {\r\n      var focusedElement = this.focusedElement();\r\n      var event          = eventToKeyboard(e || window.event);\r\n\r\n      while (event.accepted != true && focusedElement != null) {\r\n        var backup       = focusedElement.$context.event;\r\n\r\n        focusedElement.$context.event = event;\r\n        focusedElement.Keys.released(event);\r\n        focusedElement.$context.event = backup;\r\n        if (event.accepted == true)\r\n          e.preventDefault();\r\n        else\r\n          focusedElement = focusedElement.$parent;\r\n      }\r\n    }).bind(this);\r\n    // END KEYBOARD MANAGEMENT\r\n\r\n    this.registerProperty = function(obj, propName)\r\n    {\r\n        var dependantProperties = [];\r\n        var value = obj[propName];\r\n\r\n        function getter() {\r\n            if (evaluatingProperty && dependantProperties.indexOf(evaluatingProperty) == -1)\r\n                dependantProperties.push(evaluatingProperty);\r\n\r\n            return value;\r\n        }\r\n\r\n        function setter(newVal) {\r\n            value = newVal;\r\n\r\n            for (i in dependantProperties)\r\n                dependantProperties[i].update();\r\n        }\r\n\r\n        setupGetterSetter(obj, propName, getter, setter);\r\n    }\r\n\r\n    // next 3 methods used in Qt.createComponent for qml files lookup\r\n    // please open qt site for documentation\r\n    // http://doc.qt.io/qt-5/qqmlengine.html#addImportPath\r\n\r\n    this.addImportPath = function( dirpath ) {\r\n        if (!this.userAddedImportPaths) this.userAddedImportPaths = [];\r\n        this.userAddedImportPaths.push( dirpath );\r\n    }\r\n\r\n    this.setImportPathList = function( arrayOfDirs )\r\n    {\r\n        this.userAddedImportPaths = arrayOfDirs;\r\n    }\r\n\r\n    this.importPathList = function() {\r\n        return (this.userAddedImportPaths || []);\r\n    }\r\n\r\n    // `addModulePath` defines conrete path for module lookup\r\n    // e.g. addModulePath( \"QtQuick.Controls\",\"http://someserver.com/controls\" )\r\n    // will force system to `import QtQuick.Controls` module from `http://someserver.com/controls/qmldir`\r\n\r\n    this.addModulePath = function( moduleName, dirPath ) {\r\n\r\n        // remove trailing slash as it required for `readQmlDir`\r\n        if (dirPath[ dirPath.length-1 ] == \"/\")\r\n            dirPath = dirPath.substr( 0, dirPath.length-1 );\r\n\r\n        // keep the mapping. It will be used in loadImports() function .\r\n        if (!this.userAddedModulePaths) this.userAddedModulePaths = {};\r\n        this.userAddedModulePaths[ moduleName ] = dirPath;\r\n    }\r\n\r\n//Intern\r\n\r\n    // Load file, parse and construct as Component (.qml)\r\n    this.loadComponent = function(name)\r\n    {\r\n        if (name in this.components)\r\n            return this.components[name];\r\n\r\n        var file = qmlEngine.$basePath + name + \".qml\";\r\n\r\n        this.ensureFileIsLoadedInQrc(file);\r\n        tree = convertToEngine(qrc[file]);\r\n        this.components[name] = tree;\r\n        return tree;\r\n    }\r\n\r\n    this.$initializePropertyBindings = function() {\r\n        // Initialize property bindings\r\n        for (var i = 0; i < this.bindedProperties.length; i++) {\r\n            var property = this.bindedProperties[i];\r\n            property.binding.compile();\r\n            property.update();\r\n        }\r\n        this.bindedProperties = [];\r\n    }\r\n\r\n    this.$getTextMetrics = function(text, fontCss)\r\n    {\r\n        canvas.save();\r\n        canvas.font = fontCss;\r\n        var metrics = canvas.measureText(text);\r\n        canvas.restore();\r\n        return metrics;\r\n    }\r\n\r\n    // Return a path to load the file\r\n    this.$resolvePath = function(file)\r\n    {\r\n        // probably, replace :// with :/ ?\r\n        if (file == \"\" || file.indexOf(\"://\") != -1 || file.indexOf(\"/\") == 0 || file.indexOf(\"data:\") == 0 || file.indexOf(\"blob:\") == 0) {\r\n            return file;\r\n        }\r\n        return this.$basePath + file;\r\n    }\r\n\r\n    this.$registerStart = function(f)\r\n    {\r\n        whenStart.push(f);\r\n    }\r\n\r\n    this.$registerStop = function(f)\r\n    {\r\n        whenStop.push(f);\r\n    }\r\n\r\n    this.$addTicker = function(t)\r\n    {\r\n        tickers.push(t);\r\n    }\r\n\r\n    this.$removeTicker = function(t)\r\n    {\r\n        var index = tickers.indexOf(t);\r\n        if (index != -1) {\r\n            tickers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    this.size = function()\r\n    {\r\n        return { width: this.rootObject.getWidth(), height: this.rootObject.getHeight() };\r\n    }\r\n\r\n    // Performance measurements\r\n    this.$perfDraw = function(canvas)\r\n    {\r\n        this.rootObject.$draw(canvas);\r\n    }\r\n\r\n//----------Private Methods----------\r\n    // In JS we cannot easily access public members from\r\n    // private members so self acts as a bridge\r\n    var self = this;\r\n\r\n    // Listen also to touchstart events on supporting devices\r\n    // Makes clicks more responsive (do not wait for click event anymore)\r\n    function touchHandler(e)\r\n    {\r\n        // preventDefault also disables pinching and scrolling while touching\r\n        // on qml application\r\n        e.preventDefault();\r\n        var at = {\r\n            layerX: e.touches[0].pageX - element.offsetLeft,\r\n            layerY: e.touches[0].pageY - element.offsetTop,\r\n            button: 1\r\n        }\r\n        element.onclick(at);\r\n\r\n    }\r\n\r\n    function mousemoveHandler(e)\r\n    {\r\n        var i;\r\n        for (i in self.mouseAreas) {\r\n            var l = self.mouseAreas[i];\r\n            if (l && l.hoverEnabled\r\n                  && (self.oldMousePos.x >= l.left\r\n                      && self.oldMousePos.x <= l.right\r\n                      && self.oldMousePos.y >= l.top\r\n                      && self.oldMousePos.y <= l.bottom)\r\n                  && !(e.pageX - element.offsetLeft >= l.left\r\n                       && e.pageX - element.offsetLeft <= l.right\r\n                       && e.pageY - element.offsetTop >= l.top\r\n                       && e.pageY - element.offsetTop <= l.bottom) )\r\n                l.exited();\r\n        }\r\n        for (i in self.mouseAreas) {\r\n            var l = self.mouseAreas[i];\r\n            if (l && l.hoverEnabled\r\n                  && (e.pageX - element.offsetLeft >= l.left\r\n                      && e.pageX - element.offsetLeft <= l.right\r\n                      && e.pageY - element.offsetTop >= l.top\r\n                      && e.pageY - element.offsetTop <= l.bottom)\r\n                  && !(self.oldMousePos.x >= l.left\r\n                       && self.oldMousePos.x <= l.right\r\n                       && self.oldMousePos.y >= l.top\r\n                       && self.oldMousePos.y <= l.bottom))\r\n                l.entered();\r\n        }\r\n        self.oldMousePos = { x: e.pageX - element.offsetLeft,\r\n                            y: e.pageY - element.offsetTop };\r\n    }\r\n\r\n    function tick()\r\n    {\r\n        var i,\r\n            now = (new Date).getTime(),\r\n            elapsed = now - lastTick;\r\n        lastTick = now;\r\n        for (i = 0; i < tickers.length; i++) {\r\n            tickers[i](now, elapsed);\r\n        }\r\n    }\r\n\r\n\r\n//----------Private Members----------\r\n    // Target canvas\r\n    var // Callbacks for stopping or starting the engine\r\n        whenStop = [],\r\n        whenStart = [],\r\n        // Ticker resource id and ticker callbacks\r\n        tickerId,\r\n        tickers = [],\r\n        lastTick = new Date().getTime(),\r\n        i;\r\n\r\n\r\n//----------Construct----------\r\n\r\n    options = options || {};\r\n\r\n    if (options.debugConsole) {\r\n        // Replace QML-side console.log\r\n        console = {};\r\n        console.log = function() {\r\n            var args = Array.prototype.slice.call(arguments);\r\n            options.debugConsole.apply(undefined, args);\r\n        };\r\n    }\r\n}\r\n\r\n\nfunction QMLInteger(val) {\r\n    return (val|0);\r\n}\r\n\nfunction QMLItem(meta) {\r\n    QMLBaseObject.call(this, meta);\r\n    var child,\r\n        o, i;\r\n\r\n    this.completed = Signal();\r\n    this.completedAlreadyCalled = false;\r\n\r\n    if (this.$parent === null) { // This is the root element. Initialize it.\r\n        this.dom = engine.rootElement || document.body;\r\n        this.dom.innerHTML = \"\";\r\n        var self = this;\r\n        this.dom.style.position = \"relative\"; // Needed to make absolute positioning work\r\n        this.dom.style.top = \"0\";\r\n        this.dom.style.left = \"0\";\r\n        this.dom.style.overflow = \"hidden\"; // No QML stuff should stand out the root element\r\n    } else {\r\n        if (!this.dom) // Create a dom element for this item.\r\n            this.dom = document.createElement(\"div\");\r\n        this.dom.style.position = \"absolute\";\r\n    }\r\n    this.dom.style.pointerEvents = \"none\";\r\n    this.dom.className = meta.object.$class + (this.id ? \" \" + this.id : \"\");\r\n    this.dom.qml = this;\r\n    this.css = this.dom.style;\r\n\r\n    this.css.boxSizing = 'border-box';\r\n\r\n    createSimpleProperty(\"list\", this, \"data\");\r\n    this.$defaultProperty = \"data\";\r\n    createSimpleProperty(\"list\", this, \"children\");\r\n    createSimpleProperty(\"list\", this, \"resources\");\r\n    createSimpleProperty(\"Item\", this, \"parent\");\r\n    this.children = [];\r\n    this.resources = [];\r\n    this.parentChanged.connect(this, function(newParent, oldParent) {\r\n        if (oldParent) {\r\n            oldParent.children.splice(oldParent.children.indexOf(this), 1);\r\n            oldParent.childrenChanged();\r\n            oldParent.dom.removeChild(this.dom);\r\n        }\r\n        if (newParent && newParent.children.indexOf(this) == -1) {\r\n            newParent.children.push(this);\r\n            newParent.childrenChanged();\r\n        }\r\n        if (newParent)\r\n            newParent.dom.appendChild(this.dom);\r\n    });\r\n    this.parentChanged.connect(this, updateHGeometry);\r\n    this.parentChanged.connect(this, updateVGeometry);\r\n    this.dataChanged.connect(this, function(newData) {\r\n        for (var i in newData) {\r\n            var child = newData[i];\r\n            if (child.hasOwnProperty(\"parent\")) // Seems to be an Item. TODO: Use real inheritance and ask using instanceof.\r\n                child.parent = this; // This will also add it to children.\r\n            else\r\n                this.resources.push(child);\r\n        }\r\n    });\r\n\r\n    if (this.$isComponentRoot)\r\n      createSimpleProperty(\"var\", this, \"activeFocus\");\r\n    createSimpleProperty(\"real\", this, \"x\");\r\n    createSimpleProperty(\"real\", this, \"y\");\r\n    createSimpleProperty(\"real\", this, \"width\");\r\n    createSimpleProperty(\"real\", this, \"height\");\r\n    createSimpleProperty(\"real\", this, \"implicitWidth\");\r\n    createSimpleProperty(\"real\", this, \"implicitHeight\");\r\n    createSimpleProperty(\"real\", this, \"left\");\r\n    createSimpleProperty(\"real\", this, \"right\");\r\n    createSimpleProperty(\"real\", this, \"top\");\r\n    createSimpleProperty(\"real\", this, \"bottom\");\r\n    createSimpleProperty(\"real\", this, \"horizontalCenter\");\r\n    createSimpleProperty(\"real\", this, \"verticalCenter\");\r\n    createSimpleProperty(\"real\", this, \"rotation\");\r\n    createSimpleProperty(\"real\", this, \"scale\");\r\n    createSimpleProperty(\"real\", this, \"z\");\r\n    createSimpleProperty(\"list\", this, \"transform\");\r\n    createSimpleProperty(\"bool\", this, \"visible\");\r\n    createSimpleProperty(\"real\", this, \"opacity\");\r\n    createSimpleProperty(\"bool\", this, \"clip\");\r\n    createSimpleProperty(\"bool\", this, \"focus\");\r\n    this.xChanged.connect(this, updateHGeometry);\r\n    this.yChanged.connect(this, updateVGeometry);\r\n    this.widthChanged.connect(this, updateHGeometry);\r\n    this.heightChanged.connect(this, updateVGeometry);\r\n    this.implicitWidthChanged.connect(this, updateHGeometry);\r\n    this.implicitHeightChanged.connect(this, updateVGeometry);\r\n    this.focus = false;\r\n\r\n    this.setupFocusOnDom = (function(element) {\r\n      var updateFocus = (function() {\r\n        var hasFocus = document.activeElement == this.dom || document.activeElement == this.dom.firstChild;\r\n\r\n        if (this.focus != hasFocus)\r\n          this.focus = hasFocus;\r\n      }).bind(this);\r\n      element.addEventListener(\"focus\", updateFocus);\r\n      element.addEventListener(\"blur\",  updateFocus);\r\n    }).bind(this);\r\n\r\n    this.focusChanged.connect(this, (function(newVal) {\r\n      if (newVal == true) {\r\n        if (this.dom.firstChild != null)\r\n          this.dom.firstChild.focus();\r\n        document.qmlFocus = this;\r\n        this.$context.activeFocus = this;\r\n      } else if (document.qmlFocus == this) {\r\n        document.getElementsByTagName(\"BODY\")[0].focus();\r\n        document.qmlFocus = qmlEngine.rootContext().base;\r\n        this.$context.activeFocus = null;\r\n      }\r\n    }).bind(this));\r\n\r\n    this.$isUsingImplicitWidth = true;\r\n    this.$isUsingImplicitHeight = true;\r\n\r\n    this.anchors = new QObject(this);\r\n    createSimpleProperty(\"real\", this.anchors, \"left\");\r\n    createSimpleProperty(\"real\", this.anchors, \"right\");\r\n    createSimpleProperty(\"real\", this.anchors, \"top\");\r\n    createSimpleProperty(\"real\", this.anchors, \"bottom\");\r\n    createSimpleProperty(\"real\", this.anchors, \"horizontalCenter\");\r\n    createSimpleProperty(\"real\", this.anchors, \"verticalCenter\");\r\n    createSimpleProperty(\"real\", this.anchors, \"fill\");\r\n    createSimpleProperty(\"real\", this.anchors, \"centerIn\");\r\n    createSimpleProperty(\"real\", this.anchors, \"margins\");\r\n    createSimpleProperty(\"real\", this.anchors, \"leftMargin\");\r\n    createSimpleProperty(\"real\", this.anchors, \"rightMargin\");\r\n    createSimpleProperty(\"real\", this.anchors, \"topMargin\");\r\n    createSimpleProperty(\"real\", this.anchors, \"bottomMargin\");\r\n    this.anchors.leftChanged.connect(this, updateHGeometry);\r\n    this.anchors.rightChanged.connect(this, updateHGeometry);\r\n    this.anchors.topChanged.connect(this, updateVGeometry);\r\n    this.anchors.bottomChanged.connect(this, updateVGeometry);\r\n    this.anchors.horizontalCenterChanged.connect(this, updateHGeometry);\r\n    this.anchors.verticalCenterChanged.connect(this, updateVGeometry);\r\n    this.anchors.fillChanged.connect(this, updateHGeometry);\r\n    this.anchors.fillChanged.connect(this, updateVGeometry);\r\n    this.anchors.centerInChanged.connect(this, updateHGeometry);\r\n    this.anchors.centerInChanged.connect(this, updateVGeometry);\r\n    this.anchors.leftMarginChanged.connect(this, updateHGeometry);\r\n    this.anchors.rightMarginChanged.connect(this, updateHGeometry);\r\n    this.anchors.topMarginChanged.connect(this, updateVGeometry);\r\n    this.anchors.bottomMarginChanged.connect(this, updateVGeometry);\r\n    this.anchors.marginsChanged.connect(this, updateHGeometry);\r\n    this.anchors.marginsChanged.connect(this, updateVGeometry);\r\n\r\n    createSimpleProperty(\"list\", this, \"states\");\r\n    createSimpleProperty(\"string\", this, \"state\");\r\n    createSimpleProperty(\"list\", this, \"transitions\");\r\n    this.stateChanged.connect(this, function(newVal, oldVal) {\r\n        var oldState, newState, i, j, k;\r\n        for (i = 0; i < this.states.length; i++)\r\n            if (this.states[i].name === newVal)\r\n                newState = this.states[i];\r\n            else if (this.states[i].name === oldVal)\r\n                oldState = this.states[i];\r\n\r\n        var actions = this.$revertActions.slice();\r\n\r\n        // Get current values for revert actions\r\n        for (i in actions) {\r\n            var action  = actions[i];\r\n            action.from = action.target[action.property];\r\n        }\r\n        if (newState) {\r\n            var changes = newState.$getAllChanges();\r\n\r\n            // Get all actions we need to do and create actions to revert them\r\n            for (i = 0; i < changes.length; i++) {\r\n                var change = changes[i];\r\n\r\n                for (j = 0; j < change.$actions.length; j++) {\r\n                    var item = change.$actions[j];\r\n\r\n                    var action = {\r\n                        target: change.target,\r\n                        property: item.property,\r\n                        origValue: change.target.$properties[item.property].binding\r\n                                    || change.target.$properties[item.property].val,\r\n                        value: item.value,\r\n                        from: change.target[item.property],\r\n                        to: undefined,\r\n                        explicit: change.explicit\r\n                    };\r\n                    var found = false;\r\n                    for (k in actions)\r\n                        if (actions[k].target == action.target\r\n                            && actions[k].property == action.property) {\r\n                            found = true;\r\n                            actions[k] = action;\r\n                            break;\r\n                        }\r\n                    if (!found)\r\n                        actions.push(action);\r\n\r\n                    // Look for existing revert action, else create it\r\n                    var found = false;\r\n                    for (k = 0; k < this.$revertActions.length; k++)\r\n                        if (this.$revertActions[k].target == change.target\r\n                            && this.$revertActions[k].property == item.property) {\r\n                            if (!change.restoreEntryValues)\r\n                                this.$revertActions.splice(k, 1); // We don't want to revert, so remove it\r\n                            found = true;\r\n                            break;\r\n                        }\r\n                    if (!found && change.restoreEntryValues)\r\n                        this.$revertActions.push({\r\n                            target: change.target,\r\n                            property: item.property,\r\n                            value: change.target.$properties[item.property].binding\r\n                                        || change.target.$properties[item.property].val,\r\n                            from: undefined,\r\n                            to: change.target[item.property]\r\n                        });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Set all property changes and fetch the actual values afterwards\r\n        // The latter is needed for transitions. We need to set all properties\r\n        // before we fetch the values because properties can be interdependent.\r\n        for (i in actions) {\r\n            var action = actions[i];\r\n            action.target.$properties[action.property].set(action.value, false, action.target,\r\n                                                           newState ? newState.$context: action.target.$context);\r\n        }\r\n        for (i in actions) {\r\n            var action = actions[i];\r\n            action.to = action.target[action.property];\r\n            if (action.explicit) {\r\n                action.target[action.property] = action.target[action.property]; //Remove binding\r\n                action.value = action.target[action.property];\r\n            }\r\n        }\r\n\r\n        // Find the best transition to use\r\n        var transition,\r\n            rating = 0;\r\n        for (var i = 0; i < this.transitions.length; i++) {\r\n            this.transitions[i].$stop(); // We need to stop running transitions, so let's do\r\n                                        // it while iterating through the transitions anyway\r\n            var curTransition = this.transitions[i],\r\n                curRating = 0;\r\n            if (curTransition.from == oldVal || curTransition.reversible && curTransition.from == newVal)\r\n                curRating += 2;\r\n            else if (curTransition.from == \"*\")\r\n                curRating++;\r\n            else\r\n                continue;\r\n            if (curTransition.to == newVal || curTransition.reversible && curTransition.to == oldVal)\r\n                curRating += 2;\r\n            else if (curTransition.to == \"*\")\r\n                curRating++;\r\n            else\r\n                continue;\r\n            if (curRating > rating) {\r\n                rating = curRating;\r\n                transition = curTransition;\r\n            }\r\n        }\r\n        if (transition)\r\n            transition.$start(actions);\r\n    });\r\n\r\n    var QMLRotation  = getConstructor('QtQuick', '2.0', 'Rotation');\r\n    var QMLScale     = getConstructor('QtQuick', '2.0', 'Scale');\r\n    var QMLTranslate = getConstructor('QtQuick', '2.0', 'Translate');\r\n\r\n    this.$updateTransform = function() {\r\n            var transform = \"rotate(\" + this.rotation + \"deg) scale(\" + this.scale + \")\";\r\n            var filter = \"\";\r\n            var transformStyle = \"preserve-3d\";\r\n\r\n            for (var i = 0; i < this.transform.length; i++) {\r\n                var t = this.transform[i];\r\n                if (t instanceof QMLRotation)\r\n                    transform += \" rotate3d(\" + t.axis.x + \", \" + t.axis.y + \", \" + t.axis.z + \", \" + t.angle + \"deg)\";\r\n                else if (t instanceof QMLScale)\r\n                    transform += \" scale(\" + t.xScale + \", \" + t.yScale + \")\";\r\n                else if (t instanceof QMLTranslate)\r\n                    transform += \" translate(\" + t.x + \"px, \" + t.y + \"px)\";\r\n                else if (typeof t.transformType != 'undefined') {\r\n                    if (t.transformType == 'filter')\r\n                      filter += t.operation + '(' + t.parameters + ') ';\r\n                }\r\n                else if (typeof t == 'string')\r\n                    transform += t;\r\n            }\r\n            if (typeof this.z == \"number\")\r\n              transform += \" translate3d(0, 0, \" + this.z + \"px)\";\r\n            this.dom.style.transform = transform;\r\n            this.dom.style.transformStyle = transformStyle;\r\n            this.dom.style.MozTransform = transform;    // Firefox\r\n            this.dom.style.webkitTransform = transform; // Chrome, Safari and Opera\r\n            this.dom.style.webkitTransformStyle = transformStyle;\r\n            this.dom.style.OTransform = transform;      // Opera\r\n            this.dom.style.msTransform = transform;     // IE\r\n            this.dom.style.filter = filter;\r\n            this.dom.style.msFilter = filter;     // IE\r\n            this.dom.style.webkitFilter = filter; // Chrome, Safari and Opera\r\n            this.dom.style.MozFilter = filter;    // Firefox\r\n    }\r\n    this.rotationChanged.connect(this, this.$updateTransform);\r\n    this.scaleChanged.connect(this, this.$updateTransform);\r\n    this.transformChanged.connect(this, this.$updateTransform);\r\n    this.visibleChanged.connect(this, function(newVal) {\r\n        this.css.visibility = newVal ? \"inherit\" : \"hidden\";\r\n    });\r\n    this.opacityChanged.connect(this, function(newVal) {\r\n        this.css.opacity = newVal;\r\n    });\r\n    this.clipChanged.connect(this, function(newVal) {\r\n        this.css.overflow = newVal ? \"hidden\" : \"visible\";\r\n    });\r\n    this.zChanged.connect(this, function(newVal) {\r\n        this.$updateTransform();\r\n    });\r\n    this.xChanged.connect(this, function(newVal) {\r\n        this.css.left = newVal + \"px\";\r\n    });\r\n    this.yChanged.connect(this, function(newVal) {\r\n        this.css.top = newVal + \"px\";\r\n    });\r\n    this.widthChanged.connect(this, function(newVal) {\r\n        this.css.width = newVal ? newVal + \"px\" : \"auto\";\r\n    });\r\n    this.heightChanged.connect(this, function(newVal) {\r\n        this.css.height = newVal ? newVal + \"px\" : \"auto\";\r\n    });\r\n\r\n    this.implicitHeight = 0;\r\n    this.implicitWidth = 0;\r\n    this.spacing = 0;\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.anchors.margins = 0;\r\n    this.visible = true;\r\n    this.opacity = 1;\r\n    this.$revertActions = [];\r\n    this.states = [];\r\n    this.transitions = [];\r\n    this.state = \"\";\r\n    this.transform = [];\r\n    this.rotation = 0;\r\n    this.scale = 1;\r\n\r\n    // Init size of root element\r\n    if (this.$parent === null) {\r\n        if (engine.rootElement == undefined) {\r\n            window.onresize = function() {\r\n                self.implicitHeight = window.innerHeight;\r\n                self.implicitWidth = window.innerWidth;\r\n            }\r\n            window.onresize();\r\n        } else {\r\n            this.implicitHeight = this.dom.offsetHeight;\r\n            this.implicitWidth = this.dom.offsetWidth;\r\n        }\r\n    }\r\n\r\n    this.$draw = function(c) {\r\n        var i;\r\n        if (this.visible !== false) { // Undefined means inherit, means true\r\n            if (this.$drawItem ) {\r\n                var rotRad = (this.rotation || 0) / 180 * Math.PI,\r\n                    rotOffsetX = Math.sin(rotRad) * this.width,\r\n                    rotOffsetY = Math.sin(rotRad) * this.height;\r\n                c.save();\r\n\r\n                // Handle rotation\r\n                // todo: implement transformOrigin\r\n                c.globalAlpha = this.opacity;\r\n                c.translate(this.left + rotOffsetX, this.top + rotOffsetY);\r\n                c.rotate(rotRad);\r\n                c.translate(-this.left, -this.top);\r\n                // Leave offset for drawing...\r\n                this.$drawItem(c);\r\n                c.translate(-rotOffsetX, -rotOffsetY);\r\n                c.restore();\r\n            }\r\n            for (i = 0; i < this.children.length; i++) {\r\n                if (this.children[i]\r\n                    && this.children[i].$draw) {\r\n                    this.children[i].$draw(c);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\ninherit(QMLItem, QMLBaseObject);\r\n\r\nconstructors['Item'] = QMLItem;\r\n\n\nfunction QMLList(meta) {\r\n    var list = [];\r\n    if (meta.object instanceof Array)\r\n        for (var i in meta.object)\r\n            list.push(construct({object: meta.object[i], parent: meta.parent, context: meta.context }));\r\n    else if (meta.object instanceof QMLMetaElement)\r\n        list.push(construct({object: meta.object, parent: meta.parent, context: meta.context }));\r\n\r\n    return list;\r\n}\r\n\nQMLOperationState = {\r\n    Idle: 1,\r\n    Init: 2,\r\n    Running: 3\r\n};\r\n\nfunction QMLPositioner(meta) {\r\n    QMLItem.call(this, meta);\r\n\r\n    createSimpleProperty(\"int\", this, \"spacing\");\r\n    this.spacingChanged.connect(this, this.layoutChildren);\r\n    this.childrenChanged.connect(this, this.layoutChildren);\r\n    this.childrenChanged.connect(this, QMLPositioner.slotChildrenChanged);\r\n\r\n    this.spacing = 0;\r\n}\r\ninherit(QMLPositioner, QMLItem);\r\n\r\nQMLPositioner.slotChildrenChanged = function() {\r\n    for (var i = 0; i < this.children.length; i++) {\r\n        var child = this.children[i];\r\n        if (!child.widthChanged.isConnected(this, this.layoutChildren))\r\n            child.widthChanged.connect(this, this.layoutChildren);\r\n        if (!child.heightChanged.isConnected(this, this.layoutChildren))\r\n            child.heightChanged.connect(this, this.layoutChildren);\r\n        if (!child.visibleChanged.isConnected(this, this.layoutChildren))\r\n            child.visibleChanged.connect(this, this.layoutChildren);\r\n        if (!child.opacityChanged.isConnected(this, this.layoutChildren))\r\n            child.opacityChanged.connect(this, this.layoutChildren);\r\n    }\r\n}\r\n\r\n\nfunction QMLProperty(type, obj, name) {\r\n    this.obj = obj;\r\n    this.name = name;\r\n    this.changed = Signal([], {obj:obj});\r\n    this.binding = null;\r\n    this.objectScope = null;\r\n    this.componentScope = null;\r\n    this.value = undefined;\r\n    this.type = type;\r\n    this.animation = null;\r\n\r\n    // This list contains all signals that hold references to this object.\r\n    // It is needed when deleting, as we need to tidy up all references to this object.\r\n    this.$tidyupList = [];\r\n}\r\n\r\n// Updater recalculates the value of a property if one of the\r\n// dependencies changed\r\nQMLProperty.prototype.update = function() {\r\n    if (!this.binding)\r\n        return;\r\n\r\n    var oldVal = this.val;\r\n    evaluatingProperty = this;\r\n    this.val = this.binding.eval(this.objectScope, this.componentScope);\r\n    evaluatingProperty = undefined;\r\n\r\n    if (this.animation) {\r\n        this.animation.$actions = [{\r\n            target: this.animation.target || this.obj,\r\n            property: this.animation.property || this.name,\r\n            from: this.animation.from || oldVal,\r\n            to: this.animation.to || this.val\r\n        }];\r\n        this.animation.restart();\r\n    }\r\n\r\n    if (this.val !== oldVal)\r\n        this.changed(this.val, oldVal, this.name);\r\n}\r\n\r\n// Define getter\r\nQMLProperty.prototype.get = function() {\r\n    // If this call to the getter is due to a property that is dependant on this\r\n    // one, we need it to take track of changes\r\n    if (evaluatingProperty && !this.changed.isConnected(evaluatingProperty, QMLProperty.prototype.update))\r\n        this.changed.connect(evaluatingProperty, QMLProperty.prototype.update);\r\n\r\n    return this.val;\r\n}\r\n\r\n// Define setter\r\nQMLProperty.prototype.set = function(newVal, fromAnimation, objectScope, componentScope) {\r\n    var i,\r\n        oldVal = this.val;\r\n\r\n    if (newVal instanceof QMLBinding) {\r\n        if (!objectScope || !componentScope)\r\n            throw \"Internal error: binding assigned without scope\";\r\n        this.binding = newVal;\r\n        this.objectScope = objectScope;\r\n        this.componentScope = componentScope;\r\n\r\n        if (engine.operationState !== QMLOperationState.Init) {\r\n            if (!newVal.eval)\r\n                newVal.compile();\r\n\r\n            evaluatingProperty = this;\r\n            newVal = this.binding.eval(objectScope, componentScope);\r\n            evaluatingProperty = null;\r\n        } else {\r\n            engine.bindedProperties.push(this);\r\n            return;\r\n        }\r\n    } else {\r\n        if (!fromAnimation)\r\n            this.binding = null;\r\n        if (newVal instanceof Array)\r\n            newVal = newVal.slice(); // Copies the array\r\n    }\r\n\r\n    if (constructors[this.type] == QMLList) {\r\n        this.val = QMLList({ object: newVal, parent: this.obj, context: componentScope });\r\n    } else if (newVal instanceof QMLMetaElement) {\r\n        if (constructors[newVal.$class] == QMLComponent || constructors[this.type] == QMLComponent)\r\n            this.val = new QMLComponent({ object: newVal, parent: this.obj, context: componentScope });\r\n        else\r\n            this.val = construct({ object: newVal, parent: this.obj, context: componentScope });\r\n    } else if (newVal instanceof Object || !newVal) {\r\n        this.val = newVal;\r\n    } else {\r\n        this.val = constructors[this.type](newVal);\r\n    }\r\n\r\n    if (this.val !== oldVal) {\r\n        if (this.animation && !fromAnimation) {\r\n            this.animation.running = false;\r\n            this.animation.$actions = [{\r\n                target: this.animation.target || this.obj,\r\n                property: this.animation.property || this.name,\r\n                from: this.animation.from || oldVal,\r\n                to: this.animation.to || this.val\r\n            }];\r\n            this.animation.running = true;\r\n        }\r\n        if (this.obj.$syncPropertyToRemote instanceof Function && !fromAnimation) { // is a remote object from e.g. a QWebChannel\r\n            this.obj.$syncPropertyToRemote(this.name, newVal);\r\n        } else {\r\n            this.changed(this.val, oldVal, this.name);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\nfunction QMLPropertyChanges(meta) {\r\n    QMLBaseObject.call(this, meta);\r\n\r\n    createSimpleProperty(\"QtObject\", this, \"target\");\r\n    createSimpleProperty(\"bool\", this, \"explicit\");\r\n    createSimpleProperty(\"bool\", this, \"restoreEntryValues\");\r\n\r\n    this.explicit = false;\r\n    this.restoreEntryValues = true;\r\n    this.$actions = [];\r\n\r\n    this.$setCustomData = function(propName, value) {\r\n        this.$actions.push({\r\n            property: propName,\r\n            value: value\r\n        });\r\n    }\r\n}\r\ninherit(QMLPropertyChanges, QMLBaseObject);\r\n\r\nregisterQmlType('PropertyChanges', QMLPropertyChanges);\r\n\nfunction QMLVariant(val) {\r\n    return val;\r\n}\r\n\n// Base object for all qml thingies\r\nvar objectIds = 0;\r\nfunction QObject(parent) {\r\n    this.$parent = parent;\r\n    if (parent && parent.$tidyupList)\r\n        parent.$tidyupList.push(this);\r\n    // List of things to tidy up when deleting this object.\r\n    this.$tidyupList = [];\r\n    this.$properties = {};\r\n\r\n    this.objectId = objectIds++;\r\n    this.$delete = function() {\r\n        if (this.$Component)\r\n          this.$Component.destruction();\r\n\r\n        while (this.$tidyupList.length > 0) {\r\n            var item = this.$tidyupList[0];\r\n            if (item.$delete) // It's a QObject\r\n                item.$delete();\r\n            else // It must be a signal\r\n                item.disconnect(this);\r\n        }\r\n\r\n        for (var i in this.$properties) {\r\n            var prop = this.$properties[i];\r\n            while (prop.$tidyupList.length > 0)\r\n                prop.$tidyupList[0].disconnect(prop);\r\n        }\r\n\r\n        if (this.$parent && this.$parent.$tidyupList)\r\n            this.$parent.$tidyupList.splice(this.$parent.$tidyupList.indexOf(this), 1);\r\n\r\n        // must do this:\r\n        // 1) parent will be notified and erase object from it's children.\r\n        // 2) DOM node will be removed.\r\n        this.parent = undefined;\r\n    }\r\n}\r\n\nfunction updateHGeometry(newVal, oldVal, propName) {\r\n    var anchors = this.anchors || this;\r\n    if (this.$updatingGeometry)\r\n        return;\r\n    this.$updatingGeometry = true;\r\n\r\n    var t, w, width, x, left, hC, right,\r\n        lM = anchors.leftMargin || anchors.margins,\r\n        rM = anchors.rightMargin || anchors.margins;\r\n\r\n    // Width\r\n    if (this.$isUsingImplicitWidth && propName == \"implicitWidth\")\r\n        width = this.implicitWidth;\r\n    else if (propName == \"width\")\r\n        this.$isUsingImplicitWidth = false;\r\n\r\n    // Position TODO: Layouts\r\n    if ((t = anchors.fill) !== undefined) {\r\n        if (!t.$properties.left.changed.isConnected(this, updateHGeometry))\r\n            t.$properties.left.changed.connect(this, updateHGeometry);\r\n        if (!t.$properties.width.changed.isConnected(this, updateHGeometry))\r\n            t.$properties.width.changed.connect(this, updateHGeometry);\r\n\r\n        this.$isUsingImplicitWidth = false;\r\n        width = t.width - lM - rM;\r\n        x = t.left - (this.parent ? this.parent.left : 0) + lM;\r\n        left = t.left + lM;\r\n        right = t.right - rM;\r\n        hC = (left + right) / 2;\r\n    } else if ((t = anchors.centerIn) !== undefined) {\r\n        if (!t.$properties.horizontalCenter.changed.isConnected(this, updateHGeometry))\r\n            t.$properties.horizontalCenter.changed.connect(this, updateHGeometry);\r\n\r\n        w = width || this.width;\r\n        hC = t.horizontalCenter;\r\n        x = hC - w / 2 - (this.parent ? this.parent.left : 0);\r\n        left = hC - w / 2;\r\n        right = hC + w / 2;\r\n    } else if ((t = anchors.left) !== undefined) {\r\n        left = t + lM\r\n        if ((u = anchors.right) !== undefined) {\r\n            right = u - rM;\r\n            this.$isUsingImplicitWidth = false;\r\n            width = right - left;\r\n            x = left - (this.parent ? this.parent.left : 0);\r\n            hC = (right + left) / 2;\r\n        } else if ((hC = anchors.horizontalCenter) !== undefined) {\r\n            this.$isUsingImplicitWidth = false;\r\n            width = (hC - left) * 2;\r\n            x = left - (this.parent ? this.parent.left : 0);\r\n            right = 2 * hC - left;\r\n        } else {\r\n            w = width || this.width;\r\n            x = left - (this.parent ? this.parent.left : 0);\r\n            right = left + w;\r\n            hC = left + w / 2;\r\n        }\r\n    } else if ((t = anchors.right) !== undefined) {\r\n        right = t - rM;\r\n        if ((hC = anchors.horizontalCenter) !== undefined) {\r\n            this.$isUsingImplicitWidth = false;\r\n            width = (right - hC) * 2;\r\n            x = 2 * hC - right - (this.parent ? this.parent.left : 0);\r\n            left = 2 * hC - right;\r\n        } else {\r\n            w = width || this.width;\r\n            x = right - w - (this.parent ? this.parent.left : 0);\r\n            left = right - w;\r\n            hC = right - w / 2;\r\n        }\r\n    } else if ((hC = anchors.horizontalCenter) !== undefined) {\r\n        w = width || this.width;\r\n        x = hC - w / 2 - (this.parent ? this.parent.left : 0);\r\n        left = hC - w / 2;\r\n        right = hC + w / 2;\r\n    } else {\r\n        if (this.parent && !this.parent.$properties.left.changed.isConnected(this, updateHGeometry))\r\n            this.parent.$properties.left.changed.connect(this, updateHGeometry);\r\n\r\n        w = width || this.width;\r\n        left = this.x + (this.parent ? this.parent.left : 0);\r\n        right = left + w;\r\n        hC = left + w / 2;\r\n    }\r\n\r\n    if (left !== undefined)\r\n        this.left = left;\r\n    if (hC !== undefined)\r\n        this.horizontalCenter = hC;\r\n    if (right !== undefined)\r\n        this.right = right;\r\n    if (x !== undefined)\r\n        this.x = x;\r\n    if (width !== undefined)\r\n        this.width = width;\r\n\r\n    this.$updatingGeometry = false;\r\n}\r\n\r\nfunction updateVGeometry(newVal, oldVal, propName) {\r\n    var anchors = this.anchors || this;\r\n    if (this.$updatingGeometry)\r\n        return;\r\n    this.$updatingGeometry = true;\r\n\r\n    var t, w, height, y, top, vC, bottom,\r\n        tM = anchors.topMargin || anchors.margins,\r\n        bM = anchors.bottomMargin || anchors.margins;\r\n\r\n    // Height\r\n    if (this.$isUsingImplicitHeight && propName == \"implicitHeight\")\r\n        height = this.implicitHeight;\r\n    else if (propName == \"height\")\r\n        this.$isUsingImplicitHeight = false;\r\n\r\n    // Position TODO: Layouts\r\n    if ((t = anchors.fill) !== undefined) {\r\n        if (!t.$properties.top.changed.isConnected(this, updateVGeometry))\r\n            t.$properties.top.changed.connect(this, updateVGeometry);\r\n        if (!t.$properties.height.changed.isConnected(this, updateVGeometry))\r\n            t.$properties.height.changed.connect(this, updateVGeometry);\r\n\r\n        this.$isUsingImplicitHeight = false;\r\n        height = t.height - tM - bM;\r\n        y = t.top - (this.parent ? this.parent.top : 0) + tM;\r\n        top = t.top + tM;\r\n        bottom = t.bottom - bM;\r\n        vC = (top + bottom) / 2;\r\n    } else if ((t = anchors.centerIn) !== undefined) {\r\n        if (!t.$properties.verticalCenter.changed.isConnected(this, updateVGeometry))\r\n            t.$properties.verticalCenter.changed.connect(this, updateVGeometry);\r\n\r\n        w = height || this.height;\r\n        vC = t.verticalCenter;\r\n        y = vC - w / 2 - (this.parent ? this.parent.top : 0);\r\n        top = vC - w / 2;\r\n        bottom = vC + w / 2;\r\n    } else if ((t = anchors.top) !== undefined) {\r\n        top = t + tM\r\n        if ((u = anchors.bottom) !== undefined) {\r\n            bottom = u - bM;\r\n            this.$isUsingImplicitHeight = false;\r\n            height = bottom - top;\r\n            y = top - (this.parent ? this.parent.top : 0);\r\n            vC = (bottom + top) / 2;\r\n        } else if ((vC = anchors.verticalCenter) !== undefined) {\r\n            this.$isUsingImplicitHeight = false;\r\n            height = (vC - top) * 2;\r\n            y = top - (this.parent ? this.parent.top : 0);\r\n            bottom = 2 * vC - top;\r\n        } else {\r\n            w = height || this.height;\r\n            y = top - (this.parent ? this.parent.top : 0);\r\n            bottom = top + w;\r\n            vC = top + w / 2;\r\n        }\r\n    } else if ((t = anchors.bottom) !== undefined) {\r\n        bottom = t - bM;\r\n        if ((vC = anchors.verticalCenter) !== undefined) {\r\n            this.$isUsingImplicitHeight = false;\r\n            height = (bottom - vC) * 2;\r\n            y = 2 * vC - bottom - (this.parent ? this.parent.top : 0);\r\n            top = 2 * vC - bottom;\r\n        } else {\r\n            w = height || this.height;\r\n            y = bottom - w - (this.parent ? this.parent.top : 0);\r\n            top = bottom - w;\r\n            vC = bottom - w / 2;\r\n        }\r\n    } else if ((vC = anchors.verticalCenter) !== undefined) {\r\n        w = height || this.height;\r\n        y = vC - w / 2 - (this.parent ? this.parent.top : 0);\r\n        top = vC - w / 2;\r\n        bottom = vC + w / 2;\r\n    } else {\r\n        if (this.parent && !this.parent.$properties.top.changed.isConnected(this, updateVGeometry))\r\n            this.parent.$properties.top.changed.connect(this, updateVGeometry);\r\n\r\n        w = height || this.height;\r\n        top = this.y + (this.parent ? this.parent.top : 0);\r\n        bottom = top + w;\r\n        vC = top + w / 2;\r\n    }\r\n\r\n    if (top !== undefined)\r\n        this.top = top;\r\n    if (vC !== undefined)\r\n        this.verticalCenter = vC;\r\n    if (bottom !== undefined)\r\n        this.bottom = bottom;\r\n    if (y !== undefined)\r\n        this.y = y;\r\n    if (height !== undefined)\r\n        this.height = height;\r\n\r\n    this.$updatingGeometry = false;\r\n}\r\n\r\n\r\n\nregisterQmlType({\r\n  module:   'QmlWeb',\r\n  name:     'RestModel',\r\n  versions: /.*/,\r\n  baseClass: QMLItem,\r\n  constructor: function QMLRestModel(meta) {\r\n    QMLItem.call(this, meta);\r\n    var self = this;\r\n    var attributes = this.getAttributes();\r\n\r\n    createSimpleProperty(\"string\", this, \"url\");\r\n    createSimpleProperty(\"bool\",   this, \"isLoading\");\r\n    createSimpleProperty(\"string\", this, \"mimeType\");\r\n    createSimpleProperty(\"string\", this, \"queryMimeType\");\r\n\r\n    this.mimeType      = \"application/json\";\r\n    this.queryMimeType = \"application/x-www-urlencoded\";\r\n    this.isLoading     = false;\r\n    this.attributes    = attributes;\r\n\r\n    this.fetched = Signal();\r\n    this.saved   = Signal();\r\n\r\n    this.runningRequests = 0;\r\n\r\n    this.fetch = function() {\r\n      ajax({\r\n        method:   'GET',\r\n        mimeType: self.mimetype,\r\n        success: function(xhr) {\r\n          xhrReadResponse(xhr);\r\n          self.fetched();\r\n        }\r\n      });\r\n    };\r\n\r\n    this.create = function() {\r\n      sendToServer('POST');\r\n    };\r\n\r\n    this.save = function() {\r\n      sendToServer('PUT');\r\n    };\r\n\r\n    function sendToServer(method) {\r\n      var body = generateBodyForPostQuery();\r\n\r\n      ajax({\r\n        method:   method,\r\n        mimeType: self.queryMimeType,\r\n        body:     body,\r\n        success:  function(xhr) {\r\n          xhrReadResponse(xhr);\r\n          self.saved();\r\n        }\r\n      });\r\n    }\r\n\r\n    this.remove = function() {\r\n      ajax({\r\n        method: 'DELETE',\r\n        success: function(xhr) {\r\n          self.destroy();\r\n        }\r\n      });\r\n    };\r\n\r\n    function generateBodyForPostQuery() {\r\n      var object     = {};\r\n      var body;\r\n\r\n      for (var i = 0 ; i < self.attributes.length ; ++i)\r\n        object[self.attributes[i]] = self.$properties[self.attributes[i]].get();\r\n      console.log(object);\r\n      if (self.queryMimeType == 'application/json' || self.queryMimeType == 'text/json')\r\n        body = JSON.stringify(object);\r\n      else if (self.queryMimeType == 'application/x-www-urlencoded')\r\n        body = objectToUrlEncoded(object);\r\n      return body;\r\n    }\r\n\r\n    function myEncodeURIComponent(str) {\r\n      return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {\r\n        return '%' + c.charCodeAt(0).toString(16);\r\n      });\r\n    }\r\n\r\n    function objectToUrlEncoded(object, prefix) {\r\n      var str = '';\r\n      for (var key in object) {\r\n        if (object.hasOwnProperty(key)) {\r\n          var value = object[key];\r\n          if (str != '')\r\n            str += '&';\r\n          if (typeof prefix != 'undefined')\r\n            key  = prefix + '[' + key + ']';\r\n          if (typeof value == 'object')\r\n            str += objectToUrlEncoded(value, key);\r\n          else\r\n            str += myEncodeURIComponent(key) + '=' + myEncodeURIComponent(value);\r\n        }\r\n      }\r\n      return str;\r\n    }\r\n\r\n    function ajax(options) {\r\n      var xhr = new XMLHttpRequest();\r\n\r\n      xhr.overrideMimeType(self.mimeType);\r\n      xhr.onreadystatechange = function() {\r\n        if (xhr.readyState == XMLHttpRequest.DONE) {\r\n          if (xhr.status == 200)\r\n            options.success(xhr);\r\n          else\r\n            options.failure(xhr);\r\n          self.runningRequests -= 1;\r\n          if (self.runningRequests <= 0)\r\n            self.isLoading = false;\r\n        }\r\n      }\r\n      xhr.open(options.method, self.url, true);\r\n      if (typeof options.body != 'undefined') {\r\n        xhr.setRequestHeader('Content-Type', self.queryMimeType);\r\n        xhr.send(options.body);\r\n      }\r\n      else\r\n        xhr.send(null);\r\n      self.runningRequests += 1;\r\n      self.isLoading = true;\r\n    }\r\n\r\n    function xhrReadResponse(xhr) {\r\n      var responseObject;\r\n\r\n      if (self.mimeType == 'application/json' || self.mimeType == 'text/json') {\r\n        responseObject = JSON.parse(xhr.responseText);\r\n      }\r\n      updatePropertiesFromResponseObject(responseObject);\r\n    }\r\n\r\n    function updatePropertiesFromResponseObject(responseObject) {\r\n      for (var key in responseObject) {\r\n        if (responseObject.hasOwnProperty(key) && self.$hasProperty(key)) {\r\n          self.$properties[key].set(responseObject[key]);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.$hasProperty = function(name) {\r\n      return (typeof self.$properties[name] != 'undefined');\r\n    }\r\n  }\r\n});\r\n\nregisterQmlType({\r\n  module: 'QtQuick',\r\n  name:   'Settings',\r\n  versions: /.*/,\r\n  baseClass: QMLItem,\r\n  constructor: function QMLSettings(meta) {\r\n    QMLItem.call(this, meta);\r\n\r\n    createSimpleProperty(\"string\", this, \"category\");\r\n\r\n    if (typeof window.localStorage == 'undefined')\r\n      return ;\r\n\r\n    var attributes;\r\n\r\n    var getKey = (function(attrName) {\r\n      return this.category + '/' + attrName;\r\n    }).bind(this);\r\n\r\n    var loadProperties = (function() {\r\n      for (var i = 0 ; i < attributes.length ; ++i) {\r\n        this[attributes[i]] = localStorage.getItem(getKey(attributes[i]));\r\n      }\r\n    }).bind(this);\r\n\r\n    var initializeProperties = (function() {\r\n      for (var i = 0 ; i < attributes.length ; ++i) {\r\n        var attrName   = attributes[i];\r\n        var signalName = attrName + 'Changed';\r\n        var emitter    = this;\r\n\r\n        if (this.$properties[attrName].type == 'alias') {\r\n          emitter    = this.$context[this.$properties[attrName].val.objectName];\r\n          signalName = this.$properties[attrName].val.propertyName + 'Changed';\r\n        }\r\n        emitter[signalName].connect(this, (function() {\r\n          localStorage.setItem(getKey(this.attrName), this.self[this.attrName]);\r\n        }).bind({ self: this, attrName: attrName }));\r\n      }\r\n    }).bind(this);\r\n\r\n    this.Component.completed.connect(this, (function() {\r\n      attributes = this.getAttributes();\r\n      loadProperties();\r\n      initializeProperties();\r\n    }).bind(this));\r\n  }\r\n});\r\n\n})(typeof global != 'undefined' ? global : typeof window != 'undefined' ? window : this);","(function(global){\r\n\n/**\r\n * Create QML binding.\r\n * @param {Variant} val Sourcecode or function representing the binding\r\n * @param {Array} tree Parser tree of the binding\r\n * @return {Object} Object representing the binding\r\n */\r\nglobal.QMLBinding = function(val, tree) {\r\n    // this.function states whether the binding is a simple js statement or a function containing a\r\n    // return statement. We decide this on whether it is a code block or not. If it is, we require a\r\n    // return statement. If it is a code block it could though also be a object definition, so we\r\n    // need to check that as well (it is, if the content is labels).\r\n    this.function = tree && tree[0] == \"block\" && tree[1][0] && tree[1][0][0] !== \"label\";\r\n    this.src = val;\r\n}\r\n\r\nglobal.QMLBinding.prototype.toJSON = function() {\r\n    return {src: this.src,\r\n        deps: JSON.stringify(this.deps),\r\n        tree: JSON.stringify(this.tree) };\r\n}\r\n\r\n/**\r\n * Compile binding. Afterwards you may call binding.eval to evaluate.\r\n */\r\nQMLBinding.prototype.compile = function() {\r\n    this.eval = new Function('__executionObject', '__executionContext', \"with(__executionContext) with(__executionObject) \" + ( this.function ? \"\" : \"return \" ) + this.src);\r\n}\r\n\n/* @license\r\n\r\n  Copyright (c) 2010 Mihai Bazon <mihai.bazon@gmail.com>\r\n  Copyright (c) 2011 Lauri Paimen <lauri@paimen.info>\r\n  Copyright (c) 2013 Anton Kreuzkamp <akreuzkamp@web.de>\r\n  Based on parse-js (http://marijn.haverbeke.nl/parse-js/).\r\n\r\n  Redistribution and use in source and binary forms, with or without\r\n  modification, are permitted provided that the following conditions\r\n  are met:\r\n\r\n      * Redistributions of source code must retain the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer.\r\n\r\n      * Redistributions in binary form must reproduce the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer in the documentation and/or other materials\r\n        provided with the distribution.\r\n\r\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AS IS AND ANY\r\n  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\r\n  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\r\n  OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\r\n  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\r\n  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\r\n  SUCH DAMAGE.\r\n*/\r\n\r\n\r\n/*\r\n * QML parser and parsetree'er.\r\n *\r\n * Based on Javascript parser written by Mihai Bazon for UglifyJS project.\r\n * That, again, is a port of Javascript parser by Marijn Haverbeke.\r\n * Big thanks to both of you (and others involved)!\r\n * UglifyJS: https://github.com/mishoo/UglifyJS\r\n * Marijn's parser: http://marijn.haverbeke.nl/parse-js/\r\n *\r\n * The primary goal of this file is to offer QML parsing *on top of UglifyJS\r\n * parser* and to change Javascript parts as little as possible. If you find\r\n * bugs/improvements to Javascript parsing parts, check if those are fixed to\r\n * UglifyJS parser first. If not, fix them there. After UglifyJS has been fixed,\r\n * backport the changes to this file. Less changes to Javascript, more easy it\r\n * will be to keep up with UglifyJS.\r\n * Ultimately it would be great to keep the original parser and QML additions in\r\n * different files but the structure of code does not support that.\r\n *\r\n * Exports:\r\n *\r\n * - QMLBinding(src, tree) to pass qml bindings along.\r\n *\r\n * - parseQML(src) -- parses QML source and returns it as output tree expected\r\n *   by the QML engine\r\n *\r\n * - qmlweb_parse(src) -- parses QML or JS source and returns tree a la uglifyjs parser.\r\n *   Currently used for debugging purposes.\r\n */\r\n\r\n// Object cloning for debug prints.\r\nfunction clone(obj){\r\n    if(obj == null || typeof(obj) != 'object')\r\n        return obj;\r\n\r\n    var temp = {}; // changed\r\n\r\n    for(var key in obj)\r\n        temp[key] = clone(obj[key]);\r\n    return temp;\r\n}\r\n\r\n/* -----[ Tokenizer (constants) ]----- */\r\n\r\nvar KEYWORDS = array_to_hash([\r\n        \"break\",\r\n        \"case\",\r\n        \"catch\",\r\n        \"const\",\r\n        \"continue\",\r\n        \"default\",\r\n        \"delete\",\r\n        \"do\",\r\n        \"else\",\r\n        \"finally\",\r\n        \"for\",\r\n        \"function\",\r\n        \"if\",\r\n        \"in\",\r\n        \"instanceof\",\r\n        \"new\",\r\n        \"return\",\r\n        \"switch\",\r\n        \"throw\",\r\n        \"try\",\r\n        \"typeof\",\r\n        \"var\",\r\n        \"void\",\r\n        \"while\",\r\n        \"with\"\r\n]);\r\n\r\nvar RESERVED_WORDS = array_to_hash([\r\n        \"abstract\",\r\n        \"boolean\",\r\n        \"byte\",\r\n        \"char\",\r\n        \"class\",\r\n        \"debugger\",\r\n        \"double\",\r\n        \"enum\",\r\n        \"export\",\r\n        \"extends\",\r\n        \"final\",\r\n        \"float\",\r\n        \"goto\",\r\n        \"implements\",\r\n        \"import\",\r\n        \"int\",\r\n        \"interface\",\r\n        \"long\",\r\n        \"native\",\r\n        \"package\",\r\n        \"private\",\r\n        \"protected\",\r\n        \"public\",\r\n        \"short\",\r\n        \"static\",\r\n        \"super\",\r\n        \"synchronized\",\r\n        \"throws\",\r\n        \"transient\",\r\n        \"volatile\"\r\n]);\r\n\r\nvar KEYWORDS_BEFORE_EXPRESSION = array_to_hash([\r\n        \"return\",\r\n        \"new\",\r\n        \"delete\",\r\n        \"throw\",\r\n        \"else\",\r\n        \"case\"\r\n]);\r\n\r\nvar KEYWORDS_ATOM = array_to_hash([\r\n        \"false\",\r\n        \"null\",\r\n        \"true\",\r\n        \"undefined\"\r\n]);\r\n\r\nvar OPERATOR_CHARS = array_to_hash(characters(\"+-*&%=<>!?|~^\"));\r\n\r\nvar RE_HEX_NUMBER = /^0x[0-9a-f]+$/i;\r\nvar RE_OCT_NUMBER = /^0[0-7]+$/;\r\nvar RE_DEC_NUMBER = /^\\d*\\.?\\d*(?:e[+-]?\\d*(?:\\d\\.?|\\.?\\d)\\d*)?$/i;\r\n\r\nvar OPERATORS = array_to_hash([\r\n        \"in\",\r\n        \"instanceof\",\r\n        \"typeof\",\r\n        \"new\",\r\n        \"void\",\r\n        \"delete\",\r\n        \"++\",\r\n        \"--\",\r\n        \"+\",\r\n        \"-\",\r\n        \"!\",\r\n        \"~\",\r\n        \"&\",\r\n        \"|\",\r\n        \"^\",\r\n        \"*\",\r\n        \"/\",\r\n        \"%\",\r\n        \">>\",\r\n        \"<<\",\r\n        \">>>\",\r\n        \"<\",\r\n        \">\",\r\n        \"<=\",\r\n        \">=\",\r\n        \"==\",\r\n        \"===\",\r\n        \"!=\",\r\n        \"!==\",\r\n        \"?\",\r\n        \"=\",\r\n        \"+=\",\r\n        \"-=\",\r\n        \"/=\",\r\n        \"*=\",\r\n        \"%=\",\r\n        \">>=\",\r\n        \"<<=\",\r\n        \">>>=\",\r\n        \"|=\",\r\n        \"^=\",\r\n        \"&=\",\r\n        \"&&\",\r\n        \"||\"\r\n]);\r\n\r\nvar WHITESPACE_CHARS = array_to_hash(characters(\" \\n\\r\\t\\u200b\"));\r\n\r\nvar PUNC_BEFORE_EXPRESSION = array_to_hash(characters(\"[{}(,.;:\"));\r\n\r\nvar PUNC_CHARS = array_to_hash(characters(\"[]{}(),;:\"));\r\n\r\nvar REGEXP_MODIFIERS = array_to_hash(characters(\"gmsiy\"));\r\n\r\n/* -----[ Tokenizer ]----- */\r\n\r\n// regexps adapted from http://xregexp.com/plugins/#unicode\r\nvar UNICODE = {\r\n        letter: new RegExp(\"[\\\\u0041-\\\\u005A\\\\u0061-\\\\u007A\\\\u00AA\\\\u00B5\\\\u00BA\\\\u00C0-\\\\u00D6\\\\u00D8-\\\\u00F6\\\\u00F8-\\\\u02C1\\\\u02C6-\\\\u02D1\\\\u02E0-\\\\u02E4\\\\u02EC\\\\u02EE\\\\u0370-\\\\u0374\\\\u0376\\\\u0377\\\\u037A-\\\\u037D\\\\u0386\\\\u0388-\\\\u038A\\\\u038C\\\\u038E-\\\\u03A1\\\\u03A3-\\\\u03F5\\\\u03F7-\\\\u0481\\\\u048A-\\\\u0523\\\\u0531-\\\\u0556\\\\u0559\\\\u0561-\\\\u0587\\\\u05D0-\\\\u05EA\\\\u05F0-\\\\u05F2\\\\u0621-\\\\u064A\\\\u066E\\\\u066F\\\\u0671-\\\\u06D3\\\\u06D5\\\\u06E5\\\\u06E6\\\\u06EE\\\\u06EF\\\\u06FA-\\\\u06FC\\\\u06FF\\\\u0710\\\\u0712-\\\\u072F\\\\u074D-\\\\u07A5\\\\u07B1\\\\u07CA-\\\\u07EA\\\\u07F4\\\\u07F5\\\\u07FA\\\\u0904-\\\\u0939\\\\u093D\\\\u0950\\\\u0958-\\\\u0961\\\\u0971\\\\u0972\\\\u097B-\\\\u097F\\\\u0985-\\\\u098C\\\\u098F\\\\u0990\\\\u0993-\\\\u09A8\\\\u09AA-\\\\u09B0\\\\u09B2\\\\u09B6-\\\\u09B9\\\\u09BD\\\\u09CE\\\\u09DC\\\\u09DD\\\\u09DF-\\\\u09E1\\\\u09F0\\\\u09F1\\\\u0A05-\\\\u0A0A\\\\u0A0F\\\\u0A10\\\\u0A13-\\\\u0A28\\\\u0A2A-\\\\u0A30\\\\u0A32\\\\u0A33\\\\u0A35\\\\u0A36\\\\u0A38\\\\u0A39\\\\u0A59-\\\\u0A5C\\\\u0A5E\\\\u0A72-\\\\u0A74\\\\u0A85-\\\\u0A8D\\\\u0A8F-\\\\u0A91\\\\u0A93-\\\\u0AA8\\\\u0AAA-\\\\u0AB0\\\\u0AB2\\\\u0AB3\\\\u0AB5-\\\\u0AB9\\\\u0ABD\\\\u0AD0\\\\u0AE0\\\\u0AE1\\\\u0B05-\\\\u0B0C\\\\u0B0F\\\\u0B10\\\\u0B13-\\\\u0B28\\\\u0B2A-\\\\u0B30\\\\u0B32\\\\u0B33\\\\u0B35-\\\\u0B39\\\\u0B3D\\\\u0B5C\\\\u0B5D\\\\u0B5F-\\\\u0B61\\\\u0B71\\\\u0B83\\\\u0B85-\\\\u0B8A\\\\u0B8E-\\\\u0B90\\\\u0B92-\\\\u0B95\\\\u0B99\\\\u0B9A\\\\u0B9C\\\\u0B9E\\\\u0B9F\\\\u0BA3\\\\u0BA4\\\\u0BA8-\\\\u0BAA\\\\u0BAE-\\\\u0BB9\\\\u0BD0\\\\u0C05-\\\\u0C0C\\\\u0C0E-\\\\u0C10\\\\u0C12-\\\\u0C28\\\\u0C2A-\\\\u0C33\\\\u0C35-\\\\u0C39\\\\u0C3D\\\\u0C58\\\\u0C59\\\\u0C60\\\\u0C61\\\\u0C85-\\\\u0C8C\\\\u0C8E-\\\\u0C90\\\\u0C92-\\\\u0CA8\\\\u0CAA-\\\\u0CB3\\\\u0CB5-\\\\u0CB9\\\\u0CBD\\\\u0CDE\\\\u0CE0\\\\u0CE1\\\\u0D05-\\\\u0D0C\\\\u0D0E-\\\\u0D10\\\\u0D12-\\\\u0D28\\\\u0D2A-\\\\u0D39\\\\u0D3D\\\\u0D60\\\\u0D61\\\\u0D7A-\\\\u0D7F\\\\u0D85-\\\\u0D96\\\\u0D9A-\\\\u0DB1\\\\u0DB3-\\\\u0DBB\\\\u0DBD\\\\u0DC0-\\\\u0DC6\\\\u0E01-\\\\u0E30\\\\u0E32\\\\u0E33\\\\u0E40-\\\\u0E46\\\\u0E81\\\\u0E82\\\\u0E84\\\\u0E87\\\\u0E88\\\\u0E8A\\\\u0E8D\\\\u0E94-\\\\u0E97\\\\u0E99-\\\\u0E9F\\\\u0EA1-\\\\u0EA3\\\\u0EA5\\\\u0EA7\\\\u0EAA\\\\u0EAB\\\\u0EAD-\\\\u0EB0\\\\u0EB2\\\\u0EB3\\\\u0EBD\\\\u0EC0-\\\\u0EC4\\\\u0EC6\\\\u0EDC\\\\u0EDD\\\\u0F00\\\\u0F40-\\\\u0F47\\\\u0F49-\\\\u0F6C\\\\u0F88-\\\\u0F8B\\\\u1000-\\\\u102A\\\\u103F\\\\u1050-\\\\u1055\\\\u105A-\\\\u105D\\\\u1061\\\\u1065\\\\u1066\\\\u106E-\\\\u1070\\\\u1075-\\\\u1081\\\\u108E\\\\u10A0-\\\\u10C5\\\\u10D0-\\\\u10FA\\\\u10FC\\\\u1100-\\\\u1159\\\\u115F-\\\\u11A2\\\\u11A8-\\\\u11F9\\\\u1200-\\\\u1248\\\\u124A-\\\\u124D\\\\u1250-\\\\u1256\\\\u1258\\\\u125A-\\\\u125D\\\\u1260-\\\\u1288\\\\u128A-\\\\u128D\\\\u1290-\\\\u12B0\\\\u12B2-\\\\u12B5\\\\u12B8-\\\\u12BE\\\\u12C0\\\\u12C2-\\\\u12C5\\\\u12C8-\\\\u12D6\\\\u12D8-\\\\u1310\\\\u1312-\\\\u1315\\\\u1318-\\\\u135A\\\\u1380-\\\\u138F\\\\u13A0-\\\\u13F4\\\\u1401-\\\\u166C\\\\u166F-\\\\u1676\\\\u1681-\\\\u169A\\\\u16A0-\\\\u16EA\\\\u1700-\\\\u170C\\\\u170E-\\\\u1711\\\\u1720-\\\\u1731\\\\u1740-\\\\u1751\\\\u1760-\\\\u176C\\\\u176E-\\\\u1770\\\\u1780-\\\\u17B3\\\\u17D7\\\\u17DC\\\\u1820-\\\\u1877\\\\u1880-\\\\u18A8\\\\u18AA\\\\u1900-\\\\u191C\\\\u1950-\\\\u196D\\\\u1970-\\\\u1974\\\\u1980-\\\\u19A9\\\\u19C1-\\\\u19C7\\\\u1A00-\\\\u1A16\\\\u1B05-\\\\u1B33\\\\u1B45-\\\\u1B4B\\\\u1B83-\\\\u1BA0\\\\u1BAE\\\\u1BAF\\\\u1C00-\\\\u1C23\\\\u1C4D-\\\\u1C4F\\\\u1C5A-\\\\u1C7D\\\\u1D00-\\\\u1DBF\\\\u1E00-\\\\u1F15\\\\u1F18-\\\\u1F1D\\\\u1F20-\\\\u1F45\\\\u1F48-\\\\u1F4D\\\\u1F50-\\\\u1F57\\\\u1F59\\\\u1F5B\\\\u1F5D\\\\u1F5F-\\\\u1F7D\\\\u1F80-\\\\u1FB4\\\\u1FB6-\\\\u1FBC\\\\u1FBE\\\\u1FC2-\\\\u1FC4\\\\u1FC6-\\\\u1FCC\\\\u1FD0-\\\\u1FD3\\\\u1FD6-\\\\u1FDB\\\\u1FE0-\\\\u1FEC\\\\u1FF2-\\\\u1FF4\\\\u1FF6-\\\\u1FFC\\\\u2071\\\\u207F\\\\u2090-\\\\u2094\\\\u2102\\\\u2107\\\\u210A-\\\\u2113\\\\u2115\\\\u2119-\\\\u211D\\\\u2124\\\\u2126\\\\u2128\\\\u212A-\\\\u212D\\\\u212F-\\\\u2139\\\\u213C-\\\\u213F\\\\u2145-\\\\u2149\\\\u214E\\\\u2183\\\\u2184\\\\u2C00-\\\\u2C2E\\\\u2C30-\\\\u2C5E\\\\u2C60-\\\\u2C6F\\\\u2C71-\\\\u2C7D\\\\u2C80-\\\\u2CE4\\\\u2D00-\\\\u2D25\\\\u2D30-\\\\u2D65\\\\u2D6F\\\\u2D80-\\\\u2D96\\\\u2DA0-\\\\u2DA6\\\\u2DA8-\\\\u2DAE\\\\u2DB0-\\\\u2DB6\\\\u2DB8-\\\\u2DBE\\\\u2DC0-\\\\u2DC6\\\\u2DC8-\\\\u2DCE\\\\u2DD0-\\\\u2DD6\\\\u2DD8-\\\\u2DDE\\\\u2E2F\\\\u3005\\\\u3006\\\\u3031-\\\\u3035\\\\u303B\\\\u303C\\\\u3041-\\\\u3096\\\\u309D-\\\\u309F\\\\u30A1-\\\\u30FA\\\\u30FC-\\\\u30FF\\\\u3105-\\\\u312D\\\\u3131-\\\\u318E\\\\u31A0-\\\\u31B7\\\\u31F0-\\\\u31FF\\\\u3400\\\\u4DB5\\\\u4E00\\\\u9FC3\\\\uA000-\\\\uA48C\\\\uA500-\\\\uA60C\\\\uA610-\\\\uA61F\\\\uA62A\\\\uA62B\\\\uA640-\\\\uA65F\\\\uA662-\\\\uA66E\\\\uA67F-\\\\uA697\\\\uA717-\\\\uA71F\\\\uA722-\\\\uA788\\\\uA78B\\\\uA78C\\\\uA7FB-\\\\uA801\\\\uA803-\\\\uA805\\\\uA807-\\\\uA80A\\\\uA80C-\\\\uA822\\\\uA840-\\\\uA873\\\\uA882-\\\\uA8B3\\\\uA90A-\\\\uA925\\\\uA930-\\\\uA946\\\\uAA00-\\\\uAA28\\\\uAA40-\\\\uAA42\\\\uAA44-\\\\uAA4B\\\\uAC00\\\\uD7A3\\\\uF900-\\\\uFA2D\\\\uFA30-\\\\uFA6A\\\\uFA70-\\\\uFAD9\\\\uFB00-\\\\uFB06\\\\uFB13-\\\\uFB17\\\\uFB1D\\\\uFB1F-\\\\uFB28\\\\uFB2A-\\\\uFB36\\\\uFB38-\\\\uFB3C\\\\uFB3E\\\\uFB40\\\\uFB41\\\\uFB43\\\\uFB44\\\\uFB46-\\\\uFBB1\\\\uFBD3-\\\\uFD3D\\\\uFD50-\\\\uFD8F\\\\uFD92-\\\\uFDC7\\\\uFDF0-\\\\uFDFB\\\\uFE70-\\\\uFE74\\\\uFE76-\\\\uFEFC\\\\uFF21-\\\\uFF3A\\\\uFF41-\\\\uFF5A\\\\uFF66-\\\\uFFBE\\\\uFFC2-\\\\uFFC7\\\\uFFCA-\\\\uFFCF\\\\uFFD2-\\\\uFFD7\\\\uFFDA-\\\\uFFDC]\"),\r\n        non_spacing_mark: new RegExp(\"[\\\\u0300-\\\\u036F\\\\u0483-\\\\u0487\\\\u0591-\\\\u05BD\\\\u05BF\\\\u05C1\\\\u05C2\\\\u05C4\\\\u05C5\\\\u05C7\\\\u0610-\\\\u061A\\\\u064B-\\\\u065E\\\\u0670\\\\u06D6-\\\\u06DC\\\\u06DF-\\\\u06E4\\\\u06E7\\\\u06E8\\\\u06EA-\\\\u06ED\\\\u0711\\\\u0730-\\\\u074A\\\\u07A6-\\\\u07B0\\\\u07EB-\\\\u07F3\\\\u0816-\\\\u0819\\\\u081B-\\\\u0823\\\\u0825-\\\\u0827\\\\u0829-\\\\u082D\\\\u0900-\\\\u0902\\\\u093C\\\\u0941-\\\\u0948\\\\u094D\\\\u0951-\\\\u0955\\\\u0962\\\\u0963\\\\u0981\\\\u09BC\\\\u09C1-\\\\u09C4\\\\u09CD\\\\u09E2\\\\u09E3\\\\u0A01\\\\u0A02\\\\u0A3C\\\\u0A41\\\\u0A42\\\\u0A47\\\\u0A48\\\\u0A4B-\\\\u0A4D\\\\u0A51\\\\u0A70\\\\u0A71\\\\u0A75\\\\u0A81\\\\u0A82\\\\u0ABC\\\\u0AC1-\\\\u0AC5\\\\u0AC7\\\\u0AC8\\\\u0ACD\\\\u0AE2\\\\u0AE3\\\\u0B01\\\\u0B3C\\\\u0B3F\\\\u0B41-\\\\u0B44\\\\u0B4D\\\\u0B56\\\\u0B62\\\\u0B63\\\\u0B82\\\\u0BC0\\\\u0BCD\\\\u0C3E-\\\\u0C40\\\\u0C46-\\\\u0C48\\\\u0C4A-\\\\u0C4D\\\\u0C55\\\\u0C56\\\\u0C62\\\\u0C63\\\\u0CBC\\\\u0CBF\\\\u0CC6\\\\u0CCC\\\\u0CCD\\\\u0CE2\\\\u0CE3\\\\u0D41-\\\\u0D44\\\\u0D4D\\\\u0D62\\\\u0D63\\\\u0DCA\\\\u0DD2-\\\\u0DD4\\\\u0DD6\\\\u0E31\\\\u0E34-\\\\u0E3A\\\\u0E47-\\\\u0E4E\\\\u0EB1\\\\u0EB4-\\\\u0EB9\\\\u0EBB\\\\u0EBC\\\\u0EC8-\\\\u0ECD\\\\u0F18\\\\u0F19\\\\u0F35\\\\u0F37\\\\u0F39\\\\u0F71-\\\\u0F7E\\\\u0F80-\\\\u0F84\\\\u0F86\\\\u0F87\\\\u0F90-\\\\u0F97\\\\u0F99-\\\\u0FBC\\\\u0FC6\\\\u102D-\\\\u1030\\\\u1032-\\\\u1037\\\\u1039\\\\u103A\\\\u103D\\\\u103E\\\\u1058\\\\u1059\\\\u105E-\\\\u1060\\\\u1071-\\\\u1074\\\\u1082\\\\u1085\\\\u1086\\\\u108D\\\\u109D\\\\u135F\\\\u1712-\\\\u1714\\\\u1732-\\\\u1734\\\\u1752\\\\u1753\\\\u1772\\\\u1773\\\\u17B7-\\\\u17BD\\\\u17C6\\\\u17C9-\\\\u17D3\\\\u17DD\\\\u180B-\\\\u180D\\\\u18A9\\\\u1920-\\\\u1922\\\\u1927\\\\u1928\\\\u1932\\\\u1939-\\\\u193B\\\\u1A17\\\\u1A18\\\\u1A56\\\\u1A58-\\\\u1A5E\\\\u1A60\\\\u1A62\\\\u1A65-\\\\u1A6C\\\\u1A73-\\\\u1A7C\\\\u1A7F\\\\u1B00-\\\\u1B03\\\\u1B34\\\\u1B36-\\\\u1B3A\\\\u1B3C\\\\u1B42\\\\u1B6B-\\\\u1B73\\\\u1B80\\\\u1B81\\\\u1BA2-\\\\u1BA5\\\\u1BA8\\\\u1BA9\\\\u1C2C-\\\\u1C33\\\\u1C36\\\\u1C37\\\\u1CD0-\\\\u1CD2\\\\u1CD4-\\\\u1CE0\\\\u1CE2-\\\\u1CE8\\\\u1CED\\\\u1DC0-\\\\u1DE6\\\\u1DFD-\\\\u1DFF\\\\u20D0-\\\\u20DC\\\\u20E1\\\\u20E5-\\\\u20F0\\\\u2CEF-\\\\u2CF1\\\\u2DE0-\\\\u2DFF\\\\u302A-\\\\u302F\\\\u3099\\\\u309A\\\\uA66F\\\\uA67C\\\\uA67D\\\\uA6F0\\\\uA6F1\\\\uA802\\\\uA806\\\\uA80B\\\\uA825\\\\uA826\\\\uA8C4\\\\uA8E0-\\\\uA8F1\\\\uA926-\\\\uA92D\\\\uA947-\\\\uA951\\\\uA980-\\\\uA982\\\\uA9B3\\\\uA9B6-\\\\uA9B9\\\\uA9BC\\\\uAA29-\\\\uAA2E\\\\uAA31\\\\uAA32\\\\uAA35\\\\uAA36\\\\uAA43\\\\uAA4C\\\\uAAB0\\\\uAAB2-\\\\uAAB4\\\\uAAB7\\\\uAAB8\\\\uAABE\\\\uAABF\\\\uAAC1\\\\uABE5\\\\uABE8\\\\uABED\\\\uFB1E\\\\uFE00-\\\\uFE0F\\\\uFE20-\\\\uFE26]\"),\r\n        space_combining_mark: new RegExp(\"[\\\\u0903\\\\u093E-\\\\u0940\\\\u0949-\\\\u094C\\\\u094E\\\\u0982\\\\u0983\\\\u09BE-\\\\u09C0\\\\u09C7\\\\u09C8\\\\u09CB\\\\u09CC\\\\u09D7\\\\u0A03\\\\u0A3E-\\\\u0A40\\\\u0A83\\\\u0ABE-\\\\u0AC0\\\\u0AC9\\\\u0ACB\\\\u0ACC\\\\u0B02\\\\u0B03\\\\u0B3E\\\\u0B40\\\\u0B47\\\\u0B48\\\\u0B4B\\\\u0B4C\\\\u0B57\\\\u0BBE\\\\u0BBF\\\\u0BC1\\\\u0BC2\\\\u0BC6-\\\\u0BC8\\\\u0BCA-\\\\u0BCC\\\\u0BD7\\\\u0C01-\\\\u0C03\\\\u0C41-\\\\u0C44\\\\u0C82\\\\u0C83\\\\u0CBE\\\\u0CC0-\\\\u0CC4\\\\u0CC7\\\\u0CC8\\\\u0CCA\\\\u0CCB\\\\u0CD5\\\\u0CD6\\\\u0D02\\\\u0D03\\\\u0D3E-\\\\u0D40\\\\u0D46-\\\\u0D48\\\\u0D4A-\\\\u0D4C\\\\u0D57\\\\u0D82\\\\u0D83\\\\u0DCF-\\\\u0DD1\\\\u0DD8-\\\\u0DDF\\\\u0DF2\\\\u0DF3\\\\u0F3E\\\\u0F3F\\\\u0F7F\\\\u102B\\\\u102C\\\\u1031\\\\u1038\\\\u103B\\\\u103C\\\\u1056\\\\u1057\\\\u1062-\\\\u1064\\\\u1067-\\\\u106D\\\\u1083\\\\u1084\\\\u1087-\\\\u108C\\\\u108F\\\\u109A-\\\\u109C\\\\u17B6\\\\u17BE-\\\\u17C5\\\\u17C7\\\\u17C8\\\\u1923-\\\\u1926\\\\u1929-\\\\u192B\\\\u1930\\\\u1931\\\\u1933-\\\\u1938\\\\u19B0-\\\\u19C0\\\\u19C8\\\\u19C9\\\\u1A19-\\\\u1A1B\\\\u1A55\\\\u1A57\\\\u1A61\\\\u1A63\\\\u1A64\\\\u1A6D-\\\\u1A72\\\\u1B04\\\\u1B35\\\\u1B3B\\\\u1B3D-\\\\u1B41\\\\u1B43\\\\u1B44\\\\u1B82\\\\u1BA1\\\\u1BA6\\\\u1BA7\\\\u1BAA\\\\u1C24-\\\\u1C2B\\\\u1C34\\\\u1C35\\\\u1CE1\\\\u1CF2\\\\uA823\\\\uA824\\\\uA827\\\\uA880\\\\uA881\\\\uA8B4-\\\\uA8C3\\\\uA952\\\\uA953\\\\uA983\\\\uA9B4\\\\uA9B5\\\\uA9BA\\\\uA9BB\\\\uA9BD-\\\\uA9C0\\\\uAA2F\\\\uAA30\\\\uAA33\\\\uAA34\\\\uAA4D\\\\uAA7B\\\\uABE3\\\\uABE4\\\\uABE6\\\\uABE7\\\\uABE9\\\\uABEA\\\\uABEC]\"),\r\n        connector_punctuation: new RegExp(\"[\\\\u005F\\\\u203F\\\\u2040\\\\u2054\\\\uFE33\\\\uFE34\\\\uFE4D-\\\\uFE4F\\\\uFF3F]\")\r\n};\r\n\r\nfunction is_letter(ch) {\r\n        return UNICODE.letter.test(ch);\r\n};\r\n\r\nfunction is_digit(ch) {\r\n        ch = ch.charCodeAt(0);\r\n        return ch >= 48 && ch <= 57; //XXX: find out if \"UnicodeDigit\" means something else than 0..9\r\n};\r\n\r\nfunction is_alphanumeric_char(ch) {\r\n        return is_digit(ch) || is_letter(ch);\r\n};\r\n\r\nfunction is_unicode_combining_mark(ch) {\r\n        return UNICODE.non_spacing_mark.test(ch) || UNICODE.space_combining_mark.test(ch);\r\n};\r\n\r\nfunction is_unicode_connector_punctuation(ch) {\r\n        return UNICODE.connector_punctuation.test(ch);\r\n};\r\n\r\nfunction is_identifier_start(ch) {\r\n        return ch == \"$\" || ch == \"_\" || is_letter(ch);\r\n};\r\n\r\nfunction is_identifier_char(ch) {\r\n        return is_identifier_start(ch)\r\n                || is_unicode_combining_mark(ch)\r\n                || is_digit(ch)\r\n                || is_unicode_connector_punctuation(ch)\r\n                || ch == \"\\u200c\" // zero-width non-joiner <ZWNJ>\r\n                || ch == \"\\u200d\" // zero-width joiner <ZWJ> (in my ECMA-262 PDF, this is also 200c)\r\n        ;\r\n};\r\n\r\nfunction parse_js_number(num) {\r\n        if (RE_HEX_NUMBER.test(num)) {\r\n                return parseInt(num.substr(2), 16);\r\n        } else if (RE_OCT_NUMBER.test(num)) {\r\n                return parseInt(num.substr(1), 8);\r\n        } else if (RE_DEC_NUMBER.test(num)) {\r\n                return parseFloat(num);\r\n        }\r\n};\r\n\r\nfunction JS_Parse_Error(message, line, col, pos, comment) {\r\n        this.message = message;\r\n        this.line = line + 1;\r\n        this.col = col;\r\n        this.pos = pos;\r\n        this.comment = comment ? comment : \"\";\r\n        try {\r\n                ({})();\r\n        } catch(ex) {\r\n                this.stack = ex.stack;\r\n        };\r\n};\r\n\r\nJS_Parse_Error.prototype.toString = function() {\r\n        return this.message + \" (line: \" + this.line + \", col: \" + this.col + \", pos: \" + this.pos + \")\" + \"\\n\" + this.comment + \"\\n\" + this.stack;\r\n};\r\n\r\nfunction js_error(message, line, col, pos, comment) {\r\n        throw new JS_Parse_Error(message, line, col, pos, comment);\r\n};\r\n\r\nfunction is_token(token, type, val) {\r\n        return token.type == type && (val == null || token.value == val);\r\n};\r\n// CJK characters in the console display longer lengths, calculate the length of a string of actual display\r\nvar normal_c = \" \";\r\nvar cjk_c = \"\";\r\nvar cjk = function(char_code) {\r\n    return 0x4E00 <= char_code && char_code <= 0x9FFF ||\r\n        0x3400 <= char_code && char_code <= 0x4DFF ||\r\n        0x20000 <= char_code && char_code <= 0x2A6DF ||\r\n        0xF900 <= char_code && char_code <= 0xFAFF ||\r\n        0x2F800 <= char_code && char_code <= 0x2FA1F;\r\n};\r\nfunction replacerConsoleRange(str) {\r\n    var res = \"\";\r\n    for (var i = 0, len = str.length, cc; i < len; i += 1) {\r\n        cc = str.charCodeAt(i);\r\n        if (cc === 9) { // \\t\r\n            res += '\\t' // tabtab\r\n        } else if (cjk(cc)) {\r\n            res += cjk_c\r\n        } else {\r\n            res += normal_c\r\n        }\r\n    }\r\n    return res;\r\n};\r\n\r\nfunction extractLinesForErrorDiag(code_text, line, column, options) {\r\n    options || (options = {});\r\n    var line_range = options.line_range << 0 || 3;\r\n\r\n    var codeLines = code_text.split(\"\\n\");\r\n\r\n    // Error line number index\r\n    var show_line_index = line;\r\n    // The starting line of the display code number\r\n    var show_start_line = Math.max(show_line_index - line_range, 0);\r\n    // End line of code displays the number of\r\n    var show_end_line = show_line_index + line_range;\r\n\r\n    // The number of characters required to display line, blank spaces + 1\r\n    var index_len = (\"\" + show_end_line).length + 1;\r\n\r\n    var show_code = \"\";\r\n\r\n    for (var index = show_start_line; index <= show_end_line; index++) {\r\n        var suffix = (index + 1 + ' '.repeat(index_len)).substr(0, index_len + 1);\r\n        var one_line_code = codeLines[index];\r\n        if (index === show_line_index) {\r\n            var prefix = '>>';\r\n            one_line_code += '\\n' + normal_c.repeat(prefix.length + suffix.length) +\r\n                replacerConsoleRange(one_line_code.substr(0, column)) + // Replaced as blank character string\r\n                \"\";\r\n        } else {\r\n            var prefix = '  ';\r\n        }\r\n        show_code += prefix + suffix + one_line_code + \"\\n\";\r\n    }\r\n    return show_code\r\n};\r\n\r\nvar EX_EOF = {};\r\n\r\nfunction tokenizer($TEXT) {\r\n\r\n        var S = {\r\n                text            : $TEXT.replace(/\\r\\n?|[\\n\\u2028\\u2029]/g, \"\\n\").replace(/^\\uFEFF/, ''),\r\n                pos             : 0,\r\n                tokpos          : 0,\r\n                line            : 0,\r\n                tokline         : 0,\r\n                col             : 0,\r\n                tokcol          : 0,\r\n                newline_before  : false,\r\n                regex_allowed   : false,\r\n                comments_before : []\r\n        };\r\n\r\n        function peek() { return S.text.charAt(S.pos); };\r\n\r\n        function next(signal_eof) {\r\n                var ch = S.text.charAt(S.pos++);\r\n                if (signal_eof && !ch)\r\n                        throw EX_EOF;\r\n                if (ch == \"\\n\") {\r\n                        S.newline_before = true;\r\n                        ++S.line;\r\n                        S.col = 0;\r\n                } else {\r\n                        ++S.col;\r\n                }\r\n                return ch;\r\n        };\r\n\r\n        function eof() {\r\n                return !S.peek();\r\n        };\r\n\r\n        function find(what, signal_eof) {\r\n                var pos = S.text.indexOf(what, S.pos);\r\n                if (signal_eof && pos == -1) throw EX_EOF;\r\n                return pos;\r\n        };\r\n\r\n        function start_token() {\r\n                S.tokline = S.line;\r\n                S.tokcol = S.col;\r\n                S.tokpos = S.pos;\r\n        };\r\n\r\n        function token(type, value, is_comment) {\r\n                S.regex_allowed = ((type == \"operator\" && !HOP(UNARY_POSTFIX, value)) ||\r\n                                   (type == \"keyword\" && HOP(KEYWORDS_BEFORE_EXPRESSION, value)) ||\r\n                                   (type == \"punc\" && HOP(PUNC_BEFORE_EXPRESSION, value)));\r\n                var ret = {\r\n                        type  : type,\r\n                        value : value,\r\n                        line  : S.tokline,\r\n                        col   : S.tokcol,\r\n                        pos   : S.tokpos,\r\n                        nlb   : S.newline_before\r\n                };\r\n                if (!is_comment) {\r\n                        ret.comments_before = S.comments_before;\r\n                        S.comments_before = [];\r\n                }\r\n                S.newline_before = false;\r\n                return ret;\r\n        };\r\n\r\n        function skip_whitespace() {\r\n                while (HOP(WHITESPACE_CHARS, peek()))\r\n                        next();\r\n        };\r\n\r\n        function read_while(pred) {\r\n                var ret = \"\", ch = peek(), i = 0;\r\n                while (ch && pred(ch, i++)) {\r\n                        ret += next();\r\n                        ch = peek();\r\n                }\r\n                return ret;\r\n        };\r\n\r\n        function parse_error(err) {\r\n                js_error(err, S.tokline, S.tokcol, S.tokpos, extractLinesForErrorDiag( S.text, S.tokline, S.tokcol ) );\r\n        };\r\n\r\n        function read_num(prefix) {\r\n                var has_e = false, after_e = false, has_x = false, has_dot = prefix == \".\";\r\n                var num = read_while(function(ch, i){\r\n                        if (ch == \"x\" || ch == \"X\") {\r\n                                if (has_x) return false;\r\n                                return has_x = true;\r\n                        }\r\n                        if (!has_x && (ch == \"E\" || ch == \"e\")) {\r\n                                if (has_e) return false;\r\n                                return has_e = after_e = true;\r\n                        }\r\n                        if (ch == \"-\") {\r\n                                if (after_e || (i == 0 && !prefix)) return true;\r\n                                return false;\r\n                        }\r\n                        if (ch == \"+\") return after_e;\r\n                        after_e = false;\r\n                        if (ch == \".\") {\r\n                                if (!has_dot && !has_x)\r\n                                        return has_dot = true;\r\n                                return false;\r\n                        }\r\n                        return is_alphanumeric_char(ch);\r\n                });\r\n                if (prefix)\r\n                        num = prefix + num;\r\n                var valid = parse_js_number(num);\r\n                if (!isNaN(valid)) {\r\n                        return token(\"num\", valid);\r\n                } else {\r\n                        parse_error(\"Invalid syntax: \" + num);\r\n                }\r\n        };\r\n\r\n        function read_escaped_char() {\r\n                var ch = next(true);\r\n                switch (ch) {\r\n                    case \"n\" : return \"\\n\";\r\n                    case \"r\" : return \"\\r\";\r\n                    case \"t\" : return \"\\t\";\r\n                    case \"b\" : return \"\\b\";\r\n                    case \"v\" : return \"\\v\";\r\n                    case \"f\" : return \"\\f\";\r\n                    case \"0\" : return \"\\0\";\r\n                    case \"x\" : return String.fromCharCode(hex_bytes(2));\r\n                    case \"u\" : return String.fromCharCode(hex_bytes(4));\r\n                    case \"\\n\": return \"\";\r\n                    default  : return ch;\r\n                }\r\n        };\r\n\r\n        function hex_bytes(n) {\r\n                var num = 0;\r\n                for (; n > 0; --n) {\r\n                        var digit = parseInt(next(true), 16);\r\n                        if (isNaN(digit))\r\n                                parse_error(\"Invalid hex-character pattern in string\");\r\n                        num = (num << 4) | digit;\r\n                }\r\n                return num;\r\n        };\r\n\r\n        function read_string() {\r\n                return with_eof_error(\"Unterminated string constant\", function(){\r\n                        var quote = next(), ret = \"\";\r\n                        for (;;) {\r\n                                var ch = next(true);\r\n                                if (ch == \"\\\\\") ch = read_escaped_char();\r\n                                else if (ch == quote) break;\r\n                                ret += ch;\r\n                        }\r\n                        return token(\"string\", ret);\r\n                });\r\n        };\r\n\r\n        function read_line_comment() {\r\n                next();\r\n                var i = find(\"\\n\"), ret;\r\n                if (i == -1) {\r\n                        ret = S.text.substr(S.pos);\r\n                        S.pos = S.text.length;\r\n                } else {\r\n                        ret = S.text.substring(S.pos, i);\r\n                        S.pos = i;\r\n                }\r\n                return token(\"comment1\", ret, true);\r\n        };\r\n\r\n        function read_multiline_comment() {\r\n                next();\r\n                return with_eof_error(\"Unterminated multiline comment\", function(){\r\n                        var i = find(\"*/\", true),\r\n                            text = S.text.substring(S.pos, i),\r\n                            tok = token(\"comment2\", text, true);\r\n                        S.pos = i + 2;\r\n                        S.line += text.split(\"\\n\").length - 1;\r\n                        S.newline_before = text.indexOf(\"\\n\") >= 0;\r\n\r\n                        // https://github.com/mishoo/UglifyJS/issues/#issue/100\r\n                        if (/^@cc_on/i.test(text)) {\r\n                                warn(\"WARNING: at line \" + S.line);\r\n                                warn(\"*** Found \\\"conditional comment\\\": \" + text);\r\n                                warn(\"*** UglifyJS DISCARDS ALL COMMENTS.  This means your code might no longer work properly in Internet Explorer.\");\r\n                        }\r\n\r\n                        return tok;\r\n                });\r\n        };\r\n\r\n        function read_name() {\r\n                var backslash = false, name = \"\", ch;\r\n                while ((ch = peek()) != null) {\r\n                        if (!backslash) {\r\n                                if (ch == \"\\\\\") backslash = true, next();\r\n                                else if (is_identifier_char(ch)) name += next();\r\n                                else break;\r\n                        }\r\n                        else {\r\n                                if (ch != \"u\") parse_error(\"Expecting UnicodeEscapeSequence -- uXXXX\");\r\n                                ch = read_escaped_char();\r\n                                if (!is_identifier_char(ch)) parse_error(\"Unicode char: \" + ch.charCodeAt(0) + \" is not valid in identifier\");\r\n                                name += ch;\r\n                                backslash = false;\r\n                        }\r\n                }\r\n                return name;\r\n        };\r\n\r\n        function read_regexp() {\r\n                return with_eof_error(\"Unterminated regular expression\", function(){\r\n                        var prev_backslash = false, regexp = \"\", ch, in_class = false;\r\n                        while ((ch = next(true))) if (prev_backslash) {\r\n                                regexp += \"\\\\\" + ch;\r\n                                prev_backslash = false;\r\n                        } else if (ch == \"[\") {\r\n                                in_class = true;\r\n                                regexp += ch;\r\n                        } else if (ch == \"]\" && in_class) {\r\n                                in_class = false;\r\n                                regexp += ch;\r\n                        } else if (ch == \"/\" && !in_class) {\r\n                                break;\r\n                        } else if (ch == \"\\\\\") {\r\n                                prev_backslash = true;\r\n                        } else {\r\n                                regexp += ch;\r\n                        }\r\n                        var mods = read_name();\r\n                        return token(\"regexp\", [ regexp, mods ]);\r\n                });\r\n        };\r\n\r\n        function read_operator(prefix) {\r\n                function grow(op) {\r\n                        if (!peek()) return op;\r\n                        var bigger = op + peek();\r\n                        if (HOP(OPERATORS, bigger)) {\r\n                                next();\r\n                                return grow(bigger);\r\n                        } else {\r\n                                return op;\r\n                        }\r\n                };\r\n                return token(\"operator\", grow(prefix || next()));\r\n        };\r\n\r\n        function handle_slash() {\r\n                next();\r\n                var regex_allowed = S.regex_allowed;\r\n                switch (peek()) {\r\n                    case \"/\":\r\n                        S.comments_before.push(read_line_comment());\r\n                        S.regex_allowed = regex_allowed;\r\n                        return next_token();\r\n                    case \"*\":\r\n                        S.comments_before.push(read_multiline_comment());\r\n                        S.regex_allowed = regex_allowed;\r\n                        return next_token();\r\n                }\r\n                return S.regex_allowed ? read_regexp() : read_operator(\"/\");\r\n        };\r\n\r\n        function handle_dot() {\r\n                next();\r\n                return is_digit(peek())\r\n                        ? read_num(\".\")\r\n                        : token(\"punc\", \".\");\r\n        };\r\n\r\n        function read_word() {\r\n                var word = read_name();\r\n                return !HOP(KEYWORDS, word)\r\n                        ? token(\"name\", word)\r\n                        : HOP(OPERATORS, word)\r\n                        ? token(\"operator\", word)\r\n                        : HOP(KEYWORDS_ATOM, word)\r\n                        ? token(\"atom\", word)\r\n                        : token(\"keyword\", word);\r\n        };\r\n\r\n        function with_eof_error(eof_error, cont) {\r\n                try {\r\n                        return cont();\r\n                } catch(ex) {\r\n                        if (ex === EX_EOF) parse_error(eof_error);\r\n                        else throw ex;\r\n                }\r\n        };\r\n\r\n        function next_token(force_regexp) {\r\n                if (force_regexp)\r\n                        return read_regexp();\r\n                skip_whitespace();\r\n                start_token();\r\n                var ch = peek();\r\n                if (!ch) return token(\"eof\");\r\n                if (is_digit(ch)) return read_num();\r\n                if (ch == '\"' || ch == \"'\") return read_string();\r\n                if (HOP(PUNC_CHARS, ch)) return token(\"punc\", next());\r\n                if (ch == \".\") return handle_dot();\r\n                if (ch == \"/\") return handle_slash();\r\n                if (HOP(OPERATOR_CHARS, ch)) return read_operator();\r\n                if (ch == \"\\\\\" || is_identifier_start(ch)) return read_word();\r\n                parse_error(\"Unexpected character '\" + ch + \"'\");\r\n        };\r\n\r\n        next_token.context = function(nc) {\r\n                if (nc) S = nc;\r\n                return S;\r\n        };\r\n\r\n        return next_token;\r\n\r\n};\r\n\r\n/* -----[ Parser (constants) ]----- */\r\n\r\nvar UNARY_PREFIX = array_to_hash([\r\n        \"typeof\",\r\n        \"void\",\r\n        \"delete\",\r\n        \"--\",\r\n        \"++\",\r\n        \"!\",\r\n        \"~\",\r\n        \"-\",\r\n        \"+\"\r\n]);\r\n\r\nvar UNARY_POSTFIX = array_to_hash([ \"--\", \"++\" ]);\r\n\r\nvar ASSIGNMENT = (function(a, ret, i){\r\n        while (i < a.length) {\r\n                ret[a[i]] = a[i].substr(0, a[i].length - 1);\r\n                i++;\r\n        }\r\n        return ret;\r\n})(\r\n        [\"+=\", \"-=\", \"/=\", \"*=\", \"%=\", \">>=\", \"<<=\", \">>>=\", \"|=\", \"^=\", \"&=\"],\r\n        { \"=\": true },\r\n        0\r\n);\r\n\r\nvar PRECEDENCE = (function(a, ret){\r\n        for (var i = 0, n = 1; i < a.length; ++i, ++n) {\r\n                var b = a[i];\r\n                for (var j = 0; j < b.length; ++j) {\r\n                        ret[b[j]] = n;\r\n                }\r\n        }\r\n        return ret;\r\n})(\r\n        [\r\n                [\"||\"],\r\n                [\"&&\"],\r\n                [\"|\"],\r\n                [\"^\"],\r\n                [\"&\"],\r\n                [\"==\", \"===\", \"!=\", \"!==\"],\r\n                [\"<\", \">\", \"<=\", \">=\", \"in\", \"instanceof\"],\r\n                [\">>\", \"<<\", \">>>\"],\r\n                [\"+\", \"-\"],\r\n                [\"*\", \"/\", \"%\"]\r\n        ],\r\n        {}\r\n);\r\n\r\nvar STATEMENTS_WITH_LABELS = array_to_hash([ \"for\", \"do\", \"while\", \"switch\" ]);\r\n\r\nvar ATOMIC_START_TOKEN = array_to_hash([ \"atom\", \"num\", \"string\", \"regexp\", \"name\" ]);\r\n\r\n/* -----[ Parser ]----- */\r\n\r\nfunction NodeWithToken(str, start, end) {\r\n        this.name = str;\r\n        this.start = start;\r\n        this.end = end;\r\n};\r\n\r\nNodeWithToken.prototype.toString = function() { return this.name; };\r\n\r\nqmlweb_parse.QMLDocument = 1;\r\nqmlweb_parse.JSResource = 2;\r\nfunction qmlweb_parse($TEXT, document_type, exigent_mode, embed_tokens) {\r\n\r\n        var S = {\r\n                text        : $TEXT.replace(/\\r\\n?|[\\n\\u2028\\u2029]/g, \"\\n\").replace(/^\\uFEFF/, ''),\r\n                input       : typeof $TEXT == \"string\" ? tokenizer($TEXT, true) : $TEXT,\r\n                token       : null,\r\n                prev        : null,\r\n                peeked      : null,\r\n                in_function : 0,\r\n                in_loop     : 0,\r\n                labels      : []\r\n        };\r\n\r\n        S.token = next();\r\n\r\n        function is(type, value) {\r\n                return is_token(S.token, type, value);\r\n        };\r\n\r\n        function peek() { return S.peeked || (S.peeked = S.input()); };\r\n\r\n        function next() {\r\n                S.prev = S.token;\r\n                if (S.peeked) {\r\n                        S.token = S.peeked;\r\n                        S.peeked = null;\r\n                } else {\r\n                        S.token = S.input();\r\n                }\r\n                return S.token;\r\n        };\r\n\r\n        function prev() {\r\n                return S.prev;\r\n        };\r\n\r\n        function croak(msg, line, col, pos) {\r\n                var ctx = S.input.context();\r\n                var eLine = line != null ? line : ctx.tokline;\r\n                var eCol = col != null ? col : ctx.tokcol;\r\n                js_error(msg,\r\n                         eLine,\r\n                         eCol,\r\n                         pos != null ? pos : ctx.tokpos,\r\n                         extractLinesForErrorDiag( S.text, eLine, eCol ) );\r\n        };\r\n\r\n        function token_error(token, msg) {\r\n                croak(msg, token.line, token.col);\r\n        };\r\n\r\n        function unexpected(token) {\r\n                if (token == null)\r\n                        token = S.token;\r\n                token_error(token, \"Unexpected token: \" + token.type + \" (\" + token.value + \")\");\r\n        };\r\n\r\n        function expect_token(type, val) {\r\n                if (is(type, val)) {\r\n                        return next();\r\n                }\r\n                token_error(S.token, \"Unexpected token \" + S.token.type + \" \" + S.token.val + \", expected \" + type + \" \" + val);\r\n        };\r\n\r\n        function expect(punc) { return expect_token(\"punc\", punc); };\r\n\r\n        function can_insert_semicolon() {\r\n                return !exigent_mode && (\r\n                        S.token.nlb || is(\"eof\") || is(\"punc\", \"}\")\r\n                );\r\n        };\r\n\r\n        function semicolon() {\r\n                if (is(\"punc\", \";\")) next();\r\n                else if (!can_insert_semicolon()) unexpected();\r\n        };\r\n\r\n        function as() {\r\n                return slice(arguments);\r\n        };\r\n\r\n        function parenthesised() {\r\n                expect(\"(\");\r\n                var ex = expression();\r\n                expect(\")\");\r\n                return ex;\r\n        };\r\n\r\n        function add_tokens(str, start, end) {\r\n                return str instanceof NodeWithToken ? str : new NodeWithToken(str, start, end);\r\n        };\r\n\r\n        function maybe_embed_tokens(parser) {\r\n                if (embed_tokens) return function() {\r\n                        var start = S.token;\r\n                        var ast = parser.apply(this, arguments);\r\n                        ast[0] = add_tokens(ast[0], start, prev());\r\n                        return ast;\r\n                };\r\n                else return parser;\r\n        };\r\n\r\n        var statement = maybe_embed_tokens(function() {\r\n                if (is(\"operator\", \"/\")) {\r\n                        S.peeked = null;\r\n                        S.token = S.input(true); // force regexp\r\n                }\r\n                switch (S.token.type) {\r\n                    case \"num\":\r\n                    case \"string\":\r\n                    case \"regexp\":\r\n                    case \"operator\":\r\n                    case \"atom\":\r\n                        return simple_statement();\r\n\r\n                    case \"name\":\r\n                        return is_token(peek(), \"punc\", \":\")\r\n                                ? labeled_statement(prog1(S.token.value, next, next))\r\n                                : simple_statement();\r\n\r\n                    case \"punc\":\r\n                        switch (S.token.value) {\r\n                            case \"{\":\r\n                                return as(\"block\", block_());\r\n                            case \"[\":\r\n                            case \"(\":\r\n                                return simple_statement();\r\n                            case \";\":\r\n                                next();\r\n                                return as(\"block\");\r\n                            default:\r\n                                unexpected();\r\n                        }\r\n\r\n                    case \"keyword\":\r\n                        switch (prog1(S.token.value, next)) {\r\n                            case \"break\":\r\n                                return break_cont(\"break\");\r\n\r\n                            case \"continue\":\r\n                                return break_cont(\"continue\");\r\n\r\n                            case \"debugger\":\r\n                                semicolon();\r\n                                return as(\"debugger\");\r\n\r\n                            case \"do\":\r\n                                return (function(body){\r\n                                        expect_token(\"keyword\", \"while\");\r\n                                        return as(\"do\", prog1(parenthesised, semicolon), body);\r\n                                })(in_loop(statement));\r\n\r\n                            case \"for\":\r\n                                return for_();\r\n\r\n                            case \"function\":\r\n                                return function_(true);\r\n\r\n                            case \"if\":\r\n                                return if_();\r\n\r\n                            case \"return\":\r\n                                if (S.in_function == 0)\r\n                                        croak(\"'return' outside of function\");\r\n                                return as(\"return\",\r\n                                          is(\"punc\", \";\")\r\n                                          ? (next(), null)\r\n                                          : can_insert_semicolon()\r\n                                          ? null\r\n                                          : prog1(expression, semicolon));\r\n\r\n                            case \"switch\":\r\n                                return as(\"switch\", parenthesised(), switch_block_());\r\n\r\n                            case \"throw\":\r\n                                return as(\"throw\", prog1(expression, semicolon));\r\n\r\n                            case \"try\":\r\n                                return try_();\r\n\r\n                            case \"var\":\r\n                                return prog1(var_, semicolon);\r\n\r\n                            case \"const\":\r\n                                return prog1(const_, semicolon);\r\n\r\n                            case \"while\":\r\n                                return as(\"while\", parenthesised(), in_loop(statement));\r\n\r\n                            case \"with\":\r\n                                return as(\"with\", parenthesised(), statement());\r\n\r\n                            default:\r\n                                unexpected();\r\n                        }\r\n                }\r\n        });\r\n\r\n        function labeled_statement(label) {\r\n                S.labels.push(label);\r\n                var start = S.token, stat = statement();\r\n                if (exigent_mode && !HOP(STATEMENTS_WITH_LABELS, stat[0]))\r\n                        unexpected(start);\r\n                S.labels.pop();\r\n                return as(\"label\", label, stat);\r\n        };\r\n\r\n        function simple_statement() {\r\n                return as(\"stat\", prog1(expression, semicolon));\r\n        };\r\n\r\n        function break_cont(type) {\r\n                var name = is(\"name\") ? S.token.value : null;\r\n                if (name != null) {\r\n                        next();\r\n                        if (!member(name, S.labels))\r\n                                croak(\"Label \" + name + \" without matching loop or statement\");\r\n                }\r\n                else if (S.in_loop == 0)\r\n                        croak(type + \" not inside a loop or switch\");\r\n                semicolon();\r\n                return as(type, name);\r\n        };\r\n\r\n        function for_() {\r\n                expect(\"(\");\r\n                var init = null;\r\n                if (!is(\"punc\", \";\")) {\r\n                        init = is(\"keyword\", \"var\")\r\n                                ? (next(), var_(true))\r\n                                : expression(true, true);\r\n                        if (is(\"operator\", \"in\"))\r\n                                return for_in(init);\r\n                }\r\n                return regular_for(init);\r\n        };\r\n\r\n        function regular_for(init) {\r\n                expect(\";\");\r\n                var test = is(\"punc\", \";\") ? null : expression();\r\n                expect(\";\");\r\n                var step = is(\"punc\", \")\") ? null : expression();\r\n                expect(\")\");\r\n                return as(\"for\", init, test, step, in_loop(statement));\r\n        };\r\n\r\n        function for_in(init) {\r\n                var lhs = init[0] == \"var\" ? as(\"name\", init[1][0]) : init;\r\n                next();\r\n                var obj = expression();\r\n                expect(\")\");\r\n                return as(\"for-in\", init, lhs, obj, in_loop(statement));\r\n        };\r\n\r\n        var function_ = maybe_embed_tokens(function(in_statement) {\r\n                var name = is(\"name\") ? prog1(S.token.value, next) : null;\r\n                if (in_statement && !name)\r\n                        unexpected();\r\n                expect(\"(\");\r\n                return as(in_statement ? \"defun\" : \"function\",\r\n                          name,\r\n                          // arguments\r\n                          (function(first, a){\r\n                                  while (!is(\"punc\", \")\")) {\r\n                                          if (first) first = false; else expect(\",\");\r\n                                          if (!is(\"name\")) unexpected();\r\n                                          a.push(S.token.value);\r\n                                          next();\r\n                                  }\r\n                                  next();\r\n                                  return a;\r\n                          })(true, []),\r\n                          // body\r\n                          (function(){\r\n                                  ++S.in_function;\r\n                                  var loop = S.in_loop;\r\n                                  S.in_loop = 0;\r\n                                  var a = block_();\r\n                                  --S.in_function;\r\n                                  S.in_loop = loop;\r\n                                  return a;\r\n                          })());\r\n        });\r\n\r\n        function if_() {\r\n                var cond = parenthesised(), body = statement(), belse;\r\n                if (is(\"keyword\", \"else\")) {\r\n                        next();\r\n                        belse = statement();\r\n                }\r\n                return as(\"if\", cond, body, belse);\r\n        };\r\n\r\n        function block_() {\r\n                expect(\"{\");\r\n                var a = [];\r\n                while (!is(\"punc\", \"}\")) {\r\n                        if (is(\"eof\")) unexpected();\r\n                        a.push(statement());\r\n                }\r\n                next();\r\n                return a;\r\n        };\r\n\r\n        var switch_block_ = curry(in_loop, function(){\r\n                expect(\"{\");\r\n                var a = [], cur = null;\r\n                while (!is(\"punc\", \"}\")) {\r\n                        if (is(\"eof\")) unexpected();\r\n                        if (is(\"keyword\", \"case\")) {\r\n                                next();\r\n                                cur = [];\r\n                                a.push([ expression(), cur ]);\r\n                                expect(\":\");\r\n                        }\r\n                        else if (is(\"keyword\", \"default\")) {\r\n                                next();\r\n                                expect(\":\");\r\n                                cur = [];\r\n                                a.push([ null, cur ]);\r\n                        }\r\n                        else {\r\n                                if (!cur) unexpected();\r\n                                cur.push(statement());\r\n                        }\r\n                }\r\n                next();\r\n                return a;\r\n        });\r\n\r\n        function try_() {\r\n                var body = block_(), bcatch, bfinally;\r\n                if (is(\"keyword\", \"catch\")) {\r\n                        next();\r\n                        expect(\"(\");\r\n                        if (!is(\"name\"))\r\n                                croak(\"Name expected\");\r\n                        var name = S.token.value;\r\n                        next();\r\n                        expect(\")\");\r\n                        bcatch = [ name, block_() ];\r\n                }\r\n                if (is(\"keyword\", \"finally\")) {\r\n                        next();\r\n                        bfinally = block_();\r\n                }\r\n                if (!bcatch && !bfinally)\r\n                        croak(\"Missing catch/finally blocks\");\r\n                return as(\"try\", body, bcatch, bfinally);\r\n        };\r\n\r\n        function vardefs(no_in) {\r\n                var a = [];\r\n                for (;;) {\r\n                        if (!is(\"name\"))\r\n                                unexpected();\r\n                        var name = S.token.value;\r\n                        next();\r\n                        if (is(\"operator\", \"=\")) {\r\n                                next();\r\n                                a.push([ name, expression(false, no_in) ]);\r\n                        } else {\r\n                                a.push([ name ]);\r\n                        }\r\n                        if (!is(\"punc\", \",\"))\r\n                                break;\r\n                        next();\r\n                }\r\n                return a;\r\n        };\r\n\r\n        function var_(no_in) {\r\n                return as(\"var\", vardefs(no_in));\r\n        };\r\n\r\n        function const_() {\r\n                return as(\"const\", vardefs());\r\n        };\r\n\r\n        function new_() {\r\n                var newexp = expr_atom(false), args;\r\n                if (is(\"punc\", \"(\")) {\r\n                        next();\r\n                        args = expr_list(\")\");\r\n                } else {\r\n                        args = [];\r\n                }\r\n                return subscripts(as(\"new\", newexp, args), true);\r\n        };\r\n\r\n        var expr_atom = maybe_embed_tokens(function(allow_calls) {\r\n                if (is(\"operator\", \"new\")) {\r\n                        next();\r\n                        return new_();\r\n                }\r\n                if (is(\"operator\") && HOP(UNARY_PREFIX, S.token.value)) {\r\n                        return make_unary(\"unary-prefix\",\r\n                                          prog1(S.token.value, next),\r\n                                          expr_atom(allow_calls));\r\n                }\r\n                if (is(\"punc\")) {\r\n                        switch (S.token.value) {\r\n                            case \"(\":\r\n                                next();\r\n                                return subscripts(prog1(expression, curry(expect, \")\")), allow_calls);\r\n                            case \"[\":\r\n                                next();\r\n                                return subscripts(array_(), allow_calls);\r\n                            case \"{\":\r\n                                next();\r\n                                return subscripts(object_(), allow_calls);\r\n                        }\r\n                        unexpected();\r\n                }\r\n                if (is(\"keyword\", \"function\")) {\r\n                        next();\r\n                        return subscripts(function_(false), allow_calls);\r\n                }\r\n                if (HOP(ATOMIC_START_TOKEN, S.token.type)) {\r\n                        var atom = S.token.type == \"regexp\"\r\n                                ? as(\"regexp\", S.token.value[0], S.token.value[1])\r\n                                : as(S.token.type, S.token.value);\r\n                        return subscripts(prog1(atom, next), allow_calls);\r\n                }\r\n                unexpected();\r\n        });\r\n\r\n        function expr_list(closing, allow_trailing_comma, allow_empty) {\r\n                var first = true, a = [];\r\n                while (!is(\"punc\", closing)) {\r\n                        if (first) first = false; else expect(\",\");\r\n                        if (allow_trailing_comma && is(\"punc\", closing)) break;\r\n                        if (is(\"punc\", \",\") && allow_empty) {\r\n                                a.push([ \"atom\", \"undefined\" ]);\r\n                        } else {\r\n                                a.push(expression(false));\r\n                        }\r\n                }\r\n                next();\r\n                return a;\r\n        };\r\n\r\n        function array_() {\r\n                var from = S.token.pos,\r\n                    stat = expr_list(\"]\", !exigent_mode, true),\r\n                    to = S.token.pos;\r\n                return as(\"array\", stat, \"[\" + S.text.substr(from, to - from));\r\n        };\r\n\r\n        function object_() {\r\n                var first = true, a = [];\r\n                while (!is(\"punc\", \"}\")) {\r\n                        if (first) first = false; else expect(\",\");\r\n                        if (!exigent_mode && is(\"punc\", \"}\"))\r\n                                // allow trailing comma\r\n                                break;\r\n                        var type = S.token.type;\r\n                        var name = as_property_name();\r\n                        if (type == \"name\" && (name == \"get\" || name == \"set\") && !is(\"punc\", \":\")) {\r\n                                a.push([ as_name(), function_(false), name ]);\r\n                        } else {\r\n                                expect(\":\");\r\n                                a.push([ name, expression(false) ]);\r\n                        }\r\n                }\r\n                next();\r\n                return as(\"object\", a);\r\n        };\r\n\r\n        function as_property_name() {\r\n                switch (S.token.type) {\r\n                    case \"num\":\r\n                    case \"string\":\r\n                        return prog1(S.token.value, next);\r\n                }\r\n                return as_name();\r\n        };\r\n\r\n        function as_name() {\r\n                switch (S.token.type) {\r\n                    case \"name\":\r\n                    case \"operator\":\r\n                    case \"keyword\":\r\n                    case \"atom\":\r\n                        return prog1(S.token.value, next);\r\n                    default:\r\n                        unexpected();\r\n                }\r\n        };\r\n\r\n        function subscripts(expr, allow_calls) {\r\n                if (is(\"punc\", \".\")) {\r\n                        next();\r\n                        return subscripts(as(\"dot\", expr, as_name()), allow_calls);\r\n                }\r\n                if (is(\"punc\", \"[\")) {\r\n                        next();\r\n                        return subscripts(as(\"sub\", expr, prog1(expression, curry(expect, \"]\"))), allow_calls);\r\n                }\r\n                if (allow_calls && is(\"punc\", \"(\")) {\r\n                        next();\r\n                        return subscripts(as(\"call\", expr, expr_list(\")\")), true);\r\n                }\r\n                if (allow_calls && is(\"operator\") && HOP(UNARY_POSTFIX, S.token.value)) {\r\n                        return prog1(curry(make_unary, \"unary-postfix\", S.token.value, expr),\r\n                                     next);\r\n                }\r\n                return expr;\r\n        };\r\n\r\n        function make_unary(tag, op, expr) {\r\n                if ((op == \"++\" || op == \"--\") && !is_assignable(expr))\r\n                        croak(\"Invalid use of \" + op + \" operator\");\r\n                return as(tag, op, expr);\r\n        };\r\n\r\n        function expr_op(left, min_prec, no_in) {\r\n                var op = is(\"operator\") ? S.token.value : null;\r\n                if (op && op == \"in\" && no_in) op = null;\r\n                var prec = op != null ? PRECEDENCE[op] : null;\r\n                if (prec != null && prec > min_prec) {\r\n                        next();\r\n                        var right = expr_op(expr_atom(true), prec, no_in);\r\n                        return expr_op(as(\"binary\", op, left, right), min_prec, no_in);\r\n                }\r\n                return left;\r\n        };\r\n\r\n        function expr_ops(no_in) {\r\n                return expr_op(expr_atom(true), 0, no_in);\r\n        };\r\n\r\n        function maybe_conditional(no_in) {\r\n                var expr = expr_ops(no_in);\r\n                if (is(\"operator\", \"?\")) {\r\n                        next();\r\n                        var yes = expression(false);\r\n                        expect(\":\");\r\n                        return as(\"conditional\", expr, yes, expression(false, no_in));\r\n                }\r\n                return expr;\r\n        };\r\n\r\n        function is_assignable(expr) {\r\n                if (!exigent_mode) return true;\r\n                switch (expr[0]) {\r\n                    case \"dot\":\r\n                    case \"sub\":\r\n                    case \"new\":\r\n                    case \"call\":\r\n                        return true;\r\n                    case \"name\":\r\n                        return expr[1] != \"this\";\r\n                }\r\n        };\r\n\r\n        function maybe_assign(no_in) {\r\n                var left = maybe_conditional(no_in), val = S.token.value;\r\n                if (is(\"operator\") && HOP(ASSIGNMENT, val)) {\r\n                        if (is_assignable(left)) {\r\n                                next();\r\n                                return as(\"assign\", ASSIGNMENT[val], left, maybe_assign(no_in));\r\n                        }\r\n                        croak(\"Invalid assignment\");\r\n                }\r\n                return left;\r\n        };\r\n\r\n        function maybe_qmlelem(no_in) {\r\n                var expr = maybe_assign(no_in);\r\n                if (is(\"punc\", \"{\"))\r\n                    return as(\"qmlelem\", expr[1], undefined, qmlblock());\r\n                return expr;\r\n        };\r\n\r\n        var expression = maybe_embed_tokens(function(commas, no_in) {\r\n                if (arguments.length == 0)\r\n                        commas = true;\r\n                var expr = maybe_qmlelem(no_in);\r\n                if (commas && is(\"punc\", \",\")) {\r\n                        next();\r\n                        return as(\"seq\", expr, expression(true, no_in));\r\n                }\r\n                return expr;\r\n        });\r\n\r\n        function in_loop(cont) {\r\n                try {\r\n                        ++S.in_loop;\r\n                        return cont();\r\n                } finally {\r\n                        --S.in_loop;\r\n                }\r\n        };\r\n\r\n        function qml_is_element(str) {\r\n            return str[0].toUpperCase() == str[0];\r\n        }\r\n\r\n        function qmlblock() {\r\n            expect(\"{\");\r\n            var a = [];\r\n            while (!is(\"punc\", \"}\")) {\r\n                if (is(\"eof\")) unexpected();\r\n                a.push(qmlstatement());\r\n            }\r\n            expect(\"}\");\r\n            return a;\r\n        }\r\n\r\n        function qmlproperty() {\r\n            switch (S.token.type) {\r\n                case \"name\":\r\n                    return as(\"qmlbinding\", statement());\r\n                case \"num\":\r\n                case \"string\":\r\n                    return as(\"qmlvalue\", prog1(S.token.value, next,\r\n                        semicolon));\r\n                default:\r\n                    todo();\r\n            }\r\n        }\r\n\r\n        function qmlpropdef() {\r\n            var type = S.token.value;\r\n            next();\r\n            var name = S.token.value;\r\n            next();\r\n            if (type == \"alias\") {\r\n                expect(\":\");\r\n                if (!is(\"name\")) unexpected();\r\n                var objName = S.token.value;\r\n                next();\r\n                if (is(\"punc\", \".\")) {\r\n                    next();\r\n                    if (!is(\"name\")) unexpected();\r\n                    var propName = S.token.value;\r\n                    next();\r\n                }\r\n                return as(\"qmlaliasdef\", name, objName, propName);\r\n            }\r\n            if (is(\"punc\", \":\")) {\r\n                next();\r\n                S.in_function++;\r\n                var from = S.token.pos,\r\n                    stat = statement(),\r\n                    to = S.token.pos;\r\n                S.in_function--;\r\n                return as(\"qmlpropdef\", name, type, stat,\r\n                        S.text.substr(from, to - from));\r\n            } else if (is(\"punc\", \";\"))\r\n                next();\r\n            return as(\"qmlpropdef\", name, type);\r\n\r\n        }\r\n\r\n        function qmldefaultprop() {\r\n            next();\r\n            expect_token(\"name\", \"property\");\r\n\r\n            return as(\"qmldefaultprop\", qmlpropdef());\r\n        }\r\n\r\n        function qmlsignaldef() {\r\n            var name = S.token.value;\r\n            next();\r\n            var args = [];\r\n            if (is(\"punc\", \"(\")) {\r\n                next();\r\n                var first = true;\r\n                while (!is(\"punc\", \")\")) {\r\n                        if (first) first = false; else expect(\",\");\r\n                        if (!is(\"name\")) unexpected();\r\n                        var type = S.token.value;\r\n                        next();\r\n                        if (!is(\"name\")) unexpected();\r\n                        args.push({type: type, name: S.token.value});\r\n                        next();\r\n                }\r\n                next();\r\n            }\r\n            if (is(\"punc\", \";\"))\r\n                next();\r\n            return as(\"qmlsignaldef\", name, args);\r\n\r\n        }\r\n\r\n        function qmlstatement() {\r\n            if (is(\"keyword\", \"function\")) {\r\n                var from = S.token.pos;\r\n                next();\r\n                var stat = function_(true);\r\n                var to = S.token.pos;\r\n                var name = stat[1];\r\n                return as(\"qmlmethod\", name, stat,\r\n                    S.text.substr(from, to - from));\r\n            } else if (is(\"name\", \"signal\")) {\r\n                next();\r\n                if (is(\"punc\", \":\")) {\r\n                    next();\r\n                    S.in_function++;\r\n                    var from = S.token.pos,\r\n                        stat = statement(),\r\n                        to = S.token.pos;\r\n                    S.in_function--;\r\n                    return as(\"qmlprop\", propname, stat,\r\n                        S.text.substr(from, to - from));\r\n                } else {\r\n                    return qmlsignaldef();\r\n                }\r\n            } else if (S.token.type == \"name\") {\r\n                var propname = S.token.value;\r\n                next();\r\n                if (propname == \"property\" && (S.token.type == \"name\" || S.token.value == \"var\")) {\r\n                    return qmlpropdef();\r\n                } else if (qml_is_element(propname) && !is(\"punc\", \".\")) {\r\n                    // Element\r\n                    var onProp;\r\n                    if (is(\"name\", \"on\")) {\r\n                        next();\r\n                        onProp = S.token.value;\r\n                        next();\r\n                    }\r\n                    return as(\"qmlelem\", propname, onProp, qmlblock());\r\n                } else {\r\n                    // property statement\r\n                    if (is(\"punc\", \".\")) {\r\n                        // anchors, fonts etc, a.b: statement;\r\n                        // Can also be Component.onCompleted: ...\r\n                        // Assume only one subproperty\r\n                        next();\r\n                        var subname = S.token.value;\r\n                        next();\r\n                        expect(\":\");\r\n                        S.in_function++;\r\n                        var from = S.token.pos,\r\n                            stat = statement(),\r\n                            to = S.token.pos;\r\n                        S.in_function--;\r\n                        return as(\"qmlobjdef\", propname, subname, stat,\r\n                            S.text.substr(from, to - from));\r\n                    } else if (is(\"punc\", \"{\")) {\r\n                        return as(\"qmlobj\", propname, qmlblock());\r\n                    } else {\r\n                        // Evaluatable item\r\n                        expect(\":\");\r\n                        S.in_function++;\r\n                        var from = S.token.pos,\r\n                            stat = statement(),\r\n                            to = S.token.pos;\r\n                        S.in_function--;\r\n                        return as(\"qmlprop\", propname, stat,\r\n                            S.text.substr(from, to - from));\r\n                    }\r\n                }\r\n            } else if (is(\"keyword\", \"default\")) {\r\n                return qmldefaultprop();\r\n            } else {\r\n                todo();\r\n            }\r\n        }\r\n\r\n        function qmlimport() {\r\n            // todo\r\n            next();\r\n            var moduleName = S.token.value;\r\n            var isDottedNotation = (S.token.type == \"name\");\r\n            next();\r\n            \r\n            while (is(\"punc\", \".\")) {\r\n                next();\r\n                moduleName += \".\" + S.token.value;\r\n                next();\r\n            }\r\n            if (is(\"num\")) {\r\n                var version = S.token.value\r\n                next();\r\n            }\r\n            var namespace = \"\";\r\n            if (is(\"name\", \"as\")) {\r\n                next();\r\n                namespace = S.token.value;\r\n                next();\r\n            }\r\n            return as(\"qmlimport\", moduleName, version, namespace, isDottedNotation);\r\n        }\r\n\r\n        function qmldocument() {\r\n            var imports = [];\r\n            while (is(\"name\", \"import\")) {\r\n                imports.push(qmlimport());\r\n            }\r\n            var root = qmlstatement();\r\n            if (!is(\"eof\"))\r\n                unexpected();\r\n\r\n            return as(\"toplevel\", imports, root);\r\n        }\r\n\r\n        function jsdocument() {\r\n            var statements = [];\r\n            while (!is(\"eof\")) {\r\n                statements.push(statement());\r\n            }\r\n            return as(\"jsresource\", statements);\r\n        }\r\n\r\n        function amIn(s) {\r\n            console && console.log(s, clone(S), S.token.type, S.token.value);\r\n        }\r\n        function todo() {\r\n            amIn(\"todo parse:\");\r\n            next();\r\n        }\r\n\r\n        if (document_type === qmlweb_parse.JSResource) {\r\n            return jsdocument();\r\n        } else {\r\n            return qmldocument();\r\n        }\r\n\r\n};\r\n\r\n/* -----[ Utilities ]----- */\r\n\r\nfunction curry(f) {\r\n        var args = slice(arguments, 1);\r\n        return function() { return f.apply(this, args.concat(slice(arguments))); };\r\n};\r\n\r\nfunction prog1(ret) {\r\n        if (ret instanceof Function)\r\n                ret = ret();\r\n        for (var i = 1, n = arguments.length; --n > 0; ++i)\r\n                arguments[i]();\r\n        return ret;\r\n};\r\n\r\nfunction array_to_hash(a) {\r\n        var ret = {};\r\n        for (var i = 0; i < a.length; ++i)\r\n                ret[a[i]] = true;\r\n        return ret;\r\n};\r\n\r\nfunction slice(a, start) {\r\n        return Array.prototype.slice.call(a, start == null ? 0 : start);\r\n};\r\n\r\nfunction characters(str) {\r\n        return str.split(\"\");\r\n};\r\n\r\nfunction member(name, array) {\r\n        for (var i = array.length; --i >= 0;)\r\n                if (array[i] === name)\r\n                        return true;\r\n        return false;\r\n};\r\n\r\nfunction HOP(obj, prop) {\r\n        return Object.prototype.hasOwnProperty.call(obj, prop);\r\n};\r\n\r\nvar warn = function() {};\r\n\r\nQMLMethod.prototype = new QMLBinding();\r\nfunction QMLMethod(src) {\r\n    this.src = src;\r\n}\r\n\r\n/**\r\n * Create an object representing a QML property definition.\r\n * @param {String} type The type of the property\r\n * @param {Array} value The default value of the property\r\n * @return {Object} Object representing the defintion\r\n */\r\nfunction QMLPropertyDefinition(type, value) {\r\n    this.type = type;\r\n    this.value = value;\r\n}\r\n\r\nfunction QMLAliasDefinition(objName, propName) {\r\n    this.objectName = objName;\r\n    this.propertyName = propName;\r\n}\r\n\r\n/**\r\n * Create an object representing a QML signal definition.\r\n * @param {Array} params The parameters the signal ships\r\n * @return {Object} Object representing the defintion\r\n */\r\nfunction QMLSignalDefinition(params) {\r\n    this.parameters = params;\r\n}\r\n\r\n/**\r\n * Create an object representing a group of QML properties (like anchors).\r\n * @return {Object} Object representing the group\r\n */\r\nfunction QMLMetaPropertyGroup() {}\r\n\r\n/**\r\n * Create an object representing a QML element.\r\n * @param {String} type The type of the element\r\n * @param {String} onProp The name of the property specified with the \"on\" keyword\r\n */\r\nfunction QMLMetaElement(type, onProp) {\r\n    this.$class = type;\r\n    this.$children = [];\r\n    this.$on = onProp;\r\n}\r\n\r\n// Convert parser tree to the format understood by engine\r\nfunction convertToEngine(tree) {\r\n\r\n    // Help logger\r\n    function amIn(str, tree) {\r\n        console.log(str);\r\n        if (tree) console.log(JSON.stringify(tree, null, \"  \"));\r\n    }\r\n\r\n    var walkers = {\r\n        \"toplevel\": function(imports, statement) {\r\n            var item = { $class: \"QMLDocument\" };\r\n            item.$imports = imports;\r\n            item.$children = [ walk(statement) ];\r\n            return item;\r\n        },\r\n        \"qmlelem\": function(elem, onProp, statements) {\r\n            var item = new QMLMetaElement(elem, onProp);\r\n\r\n            for (var i in statements) {\r\n                var statement = statements[i],\r\n                    name = statement[1],\r\n                    val = walk(statement);\r\n                switch (statement[0]) {\r\n                    case \"qmldefaultprop\":\r\n                        item.$defaultProperty = name;\r\n                    case \"qmlprop\":\r\n                    case \"qmlpropdef\":\r\n                    case \"qmlaliasdef\":\r\n                    case \"qmlmethod\":\r\n                    case \"qmlsignaldef\":\r\n                        item[name] = val;\r\n                        break;\r\n                    case \"qmlelem\":\r\n                        item.$children.push(val);\r\n                        break;\r\n                    case \"qmlobjdef\":\r\n                        // Create object to item\r\n                        item[name] = item[name] || new QMLMetaPropertyGroup();\r\n                        item[name][statement[2]] = val;\r\n                        break;\r\n                    case \"qmlobj\":\r\n                        // Create object to item\r\n                        item[name] = item[name] || new QMLMetaPropertyGroup();\r\n                        for (var i in val)\r\n                            item[name][i] = val[i];\r\n                        break;\r\n                    default:\r\n                        console.log(\"Unknown statement\", statement);\r\n\r\n                }\r\n            }\r\n            // Make $children be either a single item or an array, if it's more than one\r\n            if (item.$children.length === 1)\r\n                item.$children = item.$children[0];\r\n\r\n            return item;\r\n        },\r\n        \"qmlprop\": function(name, tree, src) {\r\n            if (name == \"id\") {\r\n                // id property\r\n                return tree[1][1];\r\n            }\r\n            return bindout(tree, src);\r\n        },\r\n        \"qmlobjdef\": function(name, property, tree, src) {\r\n            return bindout(tree, src);\r\n        },\r\n        \"qmlobj\": function(elem, statements) {\r\n            var item = {};\r\n\r\n            for (var i in statements) {\r\n                var statement = statements[i],\r\n                    name = statement[1],\r\n                    val = walk(statement);\r\n                if (statement[0] == \"qmlprop\")\r\n                    item[name] = val;\r\n            }\r\n\r\n            return item;\r\n        },\r\n        \"qmlmethod\": function(name, tree, src) {\r\n            return new QMLMethod(src);\r\n        },\r\n        \"qmlpropdef\": function(name, type, tree, src) {\r\n            return new QMLPropertyDefinition(type, tree ? bindout(tree, src) : \"\");\r\n        },\r\n        \"qmlaliasdef\": function(name, objName, propName) {\r\n            return new QMLAliasDefinition(objName, propName);\r\n        },\r\n        \"qmlsignaldef\": function(name, params) {\r\n            return new QMLSignalDefinition(params);\r\n        },\r\n        \"qmldefaultprop\": function(tree) {\r\n            return walk(tree);\r\n        },\r\n        \"name\": function(src) {\r\n            if (src == \"true\" || src == \"false\")\r\n                return src == \"true\";\r\n            return new QMLBinding(src, [\"name\", src]);\r\n        },\r\n        \"num\": function(src) {\r\n            return +src;\r\n        },\r\n        \"string\": function(src) {\r\n            return String(src);\r\n        },\r\n        \"array\": function(tree, src) {\r\n            var a = [];\r\n            var isList = false;\r\n            var hasBinding = false;\r\n            for (var i in tree) {\r\n                var val = bindout(tree[i]);\r\n                a.push(val);\r\n\r\n                if (val instanceof QMLMetaElement)\r\n                    isList = true;\r\n                else if (val instanceof QMLBinding)\r\n                    hasBinding = true;\r\n            }\r\n\r\n            if (hasBinding) {\r\n                if (isList)\r\n                    throw new TypeError(\"An array may either contain bindings or Element definitions.\");\r\n                return new QMLBinding(src, tree);\r\n            }\r\n\r\n            return a;\r\n        }\r\n    };\r\n\r\n    function walk(tree) {\r\n        var type = tree[0];\r\n        var walker = walkers[type];\r\n        if (!walker) {\r\n            console.log(\"No walker for \" + type);\r\n            return;\r\n        } else {\r\n            return walker.apply(type, tree.slice(1));\r\n        }\r\n    }\r\n\r\n    return walk(tree);\r\n\r\n    // Try to bind out tree and return static variable instead of binding\r\n    function bindout(tree, binding) {\r\n        if (tree[0] === \"stat\") // We want to process the content of the statement\r\n            tree = tree[1];     // (but still handle the case, we get the content directly)\r\n        var type = tree[0];\r\n        var walker = walkers[type];\r\n        if (walker) {\r\n            return walker.apply(type, tree.slice(1));\r\n        } else {\r\n            return new QMLBinding(binding, tree);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// Function to parse qml and output tree expected by engine\r\nfunction parseQML(src) {\r\n    var parsetree = qmlweb_parse(src, qmlweb_parse.QmlDocument);\r\n    return convertToEngine(parsetree);\r\n}\r\n\r\nif (typeof global != \"undefined\") {\r\n  global.qmlweb_parse = qmlweb_parse;\r\n}\r\n\n/***********************************************************************\r\n\r\n  A JavaScript tokenizer / parser / beautifier / compressor.\r\n\r\n  This version is suitable for Node.js.  With minimal changes (the\r\n  exports stuff) it should work on any JS platform.\r\n\r\n  This file implements some AST processors.  They work on data built\r\n  by parse-js.\r\n\r\n  Exported functions:\r\n\r\n    - ast_mangle(ast, options) -- mangles the variable/function names\r\n      in the AST.  Returns an AST.\r\n\r\n    - ast_squeeze(ast) -- employs various optimizations to make the\r\n      final generated code even smaller.  Returns an AST.\r\n\r\n    - gen_code(ast, options) -- generates JS code from the AST.  Pass\r\n      true (or an object, see the code for some options) as second\r\n      argument to get \"pretty\" (indented) code.\r\n\r\n  -------------------------------- (C) ---------------------------------\r\n\r\n                           Author: Mihai Bazon\r\n                         <mihai.bazon@gmail.com>\r\n                       http://mihai.bazon.net/blog\r\n\r\n  Distributed under the BSD license:\r\n\r\n    Copyright 2011 (c) Lauri Paimen <lauri@paimen.info>\r\n    Copyright 2010 (c) Mihai Bazon <mihai.bazon@gmail.com>\r\n\r\n    Redistribution and use in source and binary forms, with or without\r\n    modification, are permitted provided that the following conditions\r\n    are met:\r\n\r\n        * Redistributions of source code must retain the above\r\n          copyright notice, this list of conditions and the following\r\n          disclaimer.\r\n\r\n        * Redistributions in binary form must reproduce the above\r\n          copyright notice, this list of conditions and the following\r\n          disclaimer in the documentation and/or other materials\r\n          provided with the distribution.\r\n\r\n    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AS IS AND ANY\r\n    EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\r\n    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\r\n    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\r\n    TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\r\n    THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\r\n    SUCH DAMAGE.\r\n\r\n ***********************************************************************/\r\n\r\n/*\r\n * Based on Javascript parser written by Mihai Bazon for UglifyJS project.\r\n * That, again, is a port of Javascript parser by Marijn Haverbeke.\r\n * Big thanks to both of you (and others involved)!\r\n * UglifyJS: https://github.com/mishoo/UglifyJS\r\n * Marijn's parser: http://marijn.haverbeke.nl/parse-js/\r\n *\r\n * The primary goal of this file is to offer QML parsing *on top of UglifyJS\r\n * parser* and to change Javascript parts as little as possible. If you find\r\n * bugs/improvements to Javascript parsing parts, check if those are fixed to\r\n * UglifyJS parser first. If not, fix them there. After UglifyJS has been fixed,\r\n * backport the changes to this file. Less changes to Javascript, more easy it\r\n * will be to keep up with UglifyJS.\r\n * Ultimately it would be great to keep the original parser and QML additions in\r\n * different files but the structure of code does not support that.\r\n */\r\n\r\n/*\r\nvar jsp = require(\"./parse-js\"),\r\n    slice = jsp.slice,\r\n    member = jsp.member,\r\n    PRECEDENCE = jsp.PRECEDENCE,\r\n    OPERATORS = jsp.OPERATORS;\r\n*/\r\n\r\n/* -----[ helper for AST traversal ]----- */\r\n\r\nfunction ast_walker(ast) {\r\n        function _vardefs(defs) {\r\n                return [ this[0], MAP(defs, function(def){\r\n                        var a = [ def[0] ];\r\n                        if (def.length > 1)\r\n                                a[1] = walk(def[1]);\r\n                        return a;\r\n                }) ];\r\n        };\r\n        function _block(statements) {\r\n                var out = [ this[0] ];\r\n                if (statements != null)\r\n                        out.push(MAP(statements, walk));\r\n                return out;\r\n        };\r\n        var walkers = {\r\n                \"string\": function(str) {\r\n                        return [ this[0], str ];\r\n                },\r\n                \"num\": function(num) {\r\n                        return [ this[0], num ];\r\n                },\r\n                \"name\": function(name) {\r\n                        return [ this[0], name ];\r\n                },\r\n                \"toplevel\": function(statements) {\r\n                        return [ this[0], MAP(statements, walk) ];\r\n                },\r\n                \"block\": _block,\r\n                \"splice\": _block,\r\n                \"var\": _vardefs,\r\n                \"const\": _vardefs,\r\n                \"try\": function(t, c, f) {\r\n                        return [\r\n                                this[0],\r\n                                MAP(t, walk),\r\n                                c != null ? [ c[0], MAP(c[1], walk) ] : null,\r\n                                f != null ? MAP(f, walk) : null\r\n                        ];\r\n                },\r\n                \"throw\": function(expr) {\r\n                        return [ this[0], walk(expr) ];\r\n                },\r\n                \"new\": function(ctor, args) {\r\n                        return [ this[0], walk(ctor), MAP(args, walk) ];\r\n                },\r\n                \"switch\": function(expr, body) {\r\n                        return [ this[0], walk(expr), MAP(body, function(branch){\r\n                                return [ branch[0] ? walk(branch[0]) : null,\r\n                                         MAP(branch[1], walk) ];\r\n                        }) ];\r\n                },\r\n                \"break\": function(label) {\r\n                        return [ this[0], label ];\r\n                },\r\n                \"continue\": function(label) {\r\n                        return [ this[0], label ];\r\n                },\r\n                \"conditional\": function(cond, t, e) {\r\n                        return [ this[0], walk(cond), walk(t), walk(e) ];\r\n                },\r\n                \"assign\": function(op, lvalue, rvalue) {\r\n                        return [ this[0], op, walk(lvalue), walk(rvalue) ];\r\n                },\r\n                \"dot\": function(expr) {\r\n                        return [ this[0], walk(expr) ].concat(slice(arguments, 1));\r\n                },\r\n                \"call\": function(expr, args) {\r\n                        return [ this[0], walk(expr), MAP(args, walk) ];\r\n                },\r\n                \"function\": function(name, args, body) {\r\n                        return [ this[0], name, args.slice(), MAP(body, walk) ];\r\n                },\r\n                \"defun\": function(name, args, body) {\r\n                        return [ this[0], name, args.slice(), MAP(body, walk) ];\r\n                },\r\n                \"if\": function(conditional, t, e) {\r\n                        return [ this[0], walk(conditional), walk(t), walk(e) ];\r\n                },\r\n                \"for\": function(init, cond, step, block) {\r\n                        return [ this[0], walk(init), walk(cond), walk(step), walk(block) ];\r\n                },\r\n                \"for-in\": function(vvar, key, hash, block) {\r\n                        return [ this[0], walk(vvar), walk(key), walk(hash), walk(block) ];\r\n                },\r\n                \"while\": function(cond, block) {\r\n                        return [ this[0], walk(cond), walk(block) ];\r\n                },\r\n                \"do\": function(cond, block) {\r\n                        return [ this[0], walk(cond), walk(block) ];\r\n                },\r\n                \"return\": function(expr) {\r\n                        return [ this[0], walk(expr) ];\r\n                },\r\n                \"binary\": function(op, left, right) {\r\n                        return [ this[0], op, walk(left), walk(right) ];\r\n                },\r\n                \"unary-prefix\": function(op, expr) {\r\n                        return [ this[0], op, walk(expr) ];\r\n                },\r\n                \"unary-postfix\": function(op, expr) {\r\n                        return [ this[0], op, walk(expr) ];\r\n                },\r\n                \"sub\": function(expr, subscript) {\r\n                        return [ this[0], walk(expr), walk(subscript) ];\r\n                },\r\n                \"object\": function(props) {\r\n                        return [ this[0], MAP(props, function(p){\r\n                                return p.length == 2\r\n                                        ? [ p[0], walk(p[1]) ]\r\n                                        : [ p[0], walk(p[1]), p[2] ]; // get/set-ter\r\n                        }) ];\r\n                },\r\n                \"regexp\": function(rx, mods) {\r\n                        return [ this[0], rx, mods ];\r\n                },\r\n                \"array\": function(elements) {\r\n                        return [ this[0], MAP(elements, walk) ];\r\n                },\r\n                \"stat\": function(stat) {\r\n                        return [ this[0], walk(stat) ];\r\n                },\r\n                \"seq\": function() {\r\n                        return [ this[0] ].concat(MAP(slice(arguments), walk));\r\n                },\r\n                \"label\": function(name, block) {\r\n                        return [ this[0], name, walk(block) ];\r\n                },\r\n                \"with\": function(expr, block) {\r\n                        return [ this[0], walk(expr), walk(block) ];\r\n                },\r\n                \"atom\": function(name) {\r\n                        return [ this[0], name ];\r\n                }\r\n        };\r\n\r\n        var user = {};\r\n        var stack = [];\r\n        function walk(ast) {\r\n                if (ast == null)\r\n                        return null;\r\n                try {\r\n                        stack.push(ast);\r\n                        var type = ast[0];\r\n                        var gen = user[type];\r\n                        if (gen) {\r\n                                var ret = gen.apply(ast, ast.slice(1));\r\n                                if (ret != null)\r\n                                        return ret;\r\n                        }\r\n                        gen = walkers[type];\r\n                        return gen.apply(ast, ast.slice(1));\r\n                } finally {\r\n                        stack.pop();\r\n                }\r\n        };\r\n\r\n        function with_walkers(walkers, cont){\r\n                var save = {}, i;\r\n                for (i in walkers) if (HOP(walkers, i)) {\r\n                        save[i] = user[i];\r\n                        user[i] = walkers[i];\r\n                }\r\n                var ret = cont();\r\n                for (i in save) if (HOP(save, i)) {\r\n                        if (!save[i]) delete user[i];\r\n                        else user[i] = save[i];\r\n                }\r\n                return ret;\r\n        };\r\n\r\n        return {\r\n                walk: walk,\r\n                with_walkers: with_walkers,\r\n                parent: function() {\r\n                        return stack[stack.length - 2]; // last one is current node\r\n                },\r\n                stack: function() {\r\n                        return stack;\r\n                }\r\n        };\r\n};\r\n\r\n/* -----[ Scope and mangling ]----- */\r\n\r\nfunction Scope(parent) {\r\n        this.names = {};        // names defined in this scope\r\n        this.mangled = {};      // mangled names (orig.name => mangled)\r\n        this.rev_mangled = {};  // reverse lookup (mangled => orig.name)\r\n        this.cname = -1;        // current mangled name\r\n        this.refs = {};         // names referenced from this scope\r\n        this.uses_with = false; // will become TRUE if with() is detected in this or any subscopes\r\n        this.uses_eval = false; // will become TRUE if eval() is detected in this or any subscopes\r\n        this.parent = parent;   // parent scope\r\n        this.children = [];     // sub-scopes\r\n        if (parent) {\r\n                this.level = parent.level + 1;\r\n                parent.children.push(this);\r\n        } else {\r\n                this.level = 0;\r\n        }\r\n};\r\n\r\nvar base54 = (function(){\r\n        var DIGITS = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_\";\r\n        return function(num) {\r\n                var ret = \"\";\r\n                do {\r\n                        ret = DIGITS.charAt(num % 54) + ret;\r\n                        num = Math.floor(num / 54);\r\n                } while (num > 0);\r\n                return ret;\r\n        };\r\n})();\r\n\r\nScope.prototype = {\r\n        has: function(name) {\r\n                for (var s = this; s; s = s.parent)\r\n                        if (HOP(s.names, name))\r\n                                return s;\r\n        },\r\n        has_mangled: function(mname) {\r\n                for (var s = this; s; s = s.parent)\r\n                        if (HOP(s.rev_mangled, mname))\r\n                                return s;\r\n        },\r\n        toJSON: function() {\r\n                return {\r\n                        names: this.names,\r\n                        uses_eval: this.uses_eval,\r\n                        uses_with: this.uses_with\r\n                };\r\n        },\r\n\r\n        next_mangled: function() {\r\n                // we must be careful that the new mangled name:\r\n                //\r\n                // 1. doesn't shadow a mangled name from a parent\r\n                //    scope, unless we don't reference the original\r\n                //    name from this scope OR from any sub-scopes!\r\n                //    This will get slow.\r\n                //\r\n                // 2. doesn't shadow an original name from a parent\r\n                //    scope, in the event that the name is not mangled\r\n                //    in the parent scope and we reference that name\r\n                //    here OR IN ANY SUBSCOPES!\r\n                //\r\n                // 3. doesn't shadow a name that is referenced but not\r\n                //    defined (possibly global defined elsewhere).\r\n                for (;;) {\r\n                        var m = base54(++this.cname), prior;\r\n\r\n                        // case 1.\r\n                        prior = this.has_mangled(m);\r\n                        if (prior && this.refs[prior.rev_mangled[m]] === prior)\r\n                                continue;\r\n\r\n                        // case 2.\r\n                        prior = this.has(m);\r\n                        if (prior && prior !== this && this.refs[m] === prior && !prior.has_mangled(m))\r\n                                continue;\r\n\r\n                        // case 3.\r\n                        if (HOP(this.refs, m) && this.refs[m] == null)\r\n                                continue;\r\n\r\n                        // I got \"do\" once. :-/\r\n                        if (!is_identifier(m))\r\n                                continue;\r\n\r\n                        return m;\r\n                }\r\n        },\r\n        set_mangle: function(name, m) {\r\n                this.rev_mangled[m] = name;\r\n                return this.mangled[name] = m;\r\n        },\r\n        get_mangled: function(name, newMangle) {\r\n                if (this.uses_eval || this.uses_with) return name; // no mangle if eval or with is in use\r\n                var s = this.has(name);\r\n                if (!s) return name; // not in visible scope, no mangle\r\n                if (HOP(s.mangled, name)) return s.mangled[name]; // already mangled in this scope\r\n                if (!newMangle) return name;                      // not found and no mangling requested\r\n                return s.set_mangle(name, s.next_mangled());\r\n        },\r\n        references: function(name) {\r\n                return name && !this.parent || this.uses_with || this.uses_eval || this.refs[name];\r\n        },\r\n        define: function(name, type) {\r\n                if (name != null) {\r\n                        if (type == \"var\" || !HOP(this.names, name))\r\n                                this.names[name] = type || \"var\";\r\n                        return name;\r\n                }\r\n        }\r\n};\r\n\r\nfunction ast_add_scope(ast) {\r\n\r\n        var current_scope = null;\r\n        var w = ast_walker(), walk = w.walk;\r\n        var having_eval = [];\r\n\r\n        function with_new_scope(cont) {\r\n                current_scope = new Scope(current_scope);\r\n                var ret = current_scope.body = cont();\r\n                ret.scope = current_scope;\r\n                current_scope = current_scope.parent;\r\n                return ret;\r\n        };\r\n\r\n        function define(name, type) {\r\n                return current_scope.define(name, type);\r\n        };\r\n\r\n        function reference(name) {\r\n                current_scope.refs[name] = true;\r\n        };\r\n\r\n        function _lambda(name, args, body) {\r\n                var is_defun = this[0] == \"defun\";\r\n                return [ this[0], is_defun ? define(name, \"defun\") : name, args, with_new_scope(function(){\r\n                        if (!is_defun) define(name, \"lambda\");\r\n                        MAP(args, function(name){ define(name, \"arg\") });\r\n                        return MAP(body, walk);\r\n                })];\r\n        };\r\n\r\n        function _vardefs(type) {\r\n                return function(defs) {\r\n                        MAP(defs, function(d){\r\n                                define(d[0], type);\r\n                                if (d[1]) reference(d[0]);\r\n                        });\r\n                };\r\n        };\r\n\r\n        return with_new_scope(function(){\r\n                // process AST\r\n                var ret = w.with_walkers({\r\n                        \"function\": _lambda,\r\n                        \"defun\": _lambda,\r\n                        \"label\": function(name, stat) { define(name, \"label\") },\r\n                        \"break\": function(label) { if (label) reference(label) },\r\n                        \"continue\": function(label) { if (label) reference(label) },\r\n                        \"with\": function(expr, block) {\r\n                                for (var s = current_scope; s; s = s.parent)\r\n                                        s.uses_with = true;\r\n                        },\r\n                        \"var\": _vardefs(\"var\"),\r\n                        \"const\": _vardefs(\"const\"),\r\n                        \"try\": function(t, c, f) {\r\n                                if (c != null) return [\r\n                                        this[0],\r\n                                        MAP(t, walk),\r\n                                        [ define(c[0], \"catch\"), MAP(c[1], walk) ],\r\n                                        f != null ? MAP(f, walk) : null\r\n                                ];\r\n                        },\r\n                        \"name\": function(name) {\r\n                                if (name == \"eval\")\r\n                                        having_eval.push(current_scope);\r\n                                reference(name);\r\n                        }\r\n                }, function(){\r\n                        return walk(ast);\r\n                });\r\n\r\n                // the reason why we need an additional pass here is\r\n                // that names can be used prior to their definition.\r\n\r\n                // scopes where eval was detected and their parents\r\n                // are marked with uses_eval, unless they define the\r\n                // \"eval\" name.\r\n                MAP(having_eval, function(scope){\r\n                        if (!scope.has(\"eval\")) while (scope) {\r\n                                scope.uses_eval = true;\r\n                                scope = scope.parent;\r\n                        }\r\n                });\r\n\r\n                // for referenced names it might be useful to know\r\n                // their origin scope.  current_scope here is the\r\n                // toplevel one.\r\n                function fixrefs(scope, i) {\r\n                        // do children first; order shouldn't matter\r\n                        for (i = scope.children.length; --i >= 0;)\r\n                                fixrefs(scope.children[i]);\r\n                        for (i in scope.refs) if (HOP(scope.refs, i)) {\r\n                                // find origin scope and propagate the reference to origin\r\n                                for (var origin = scope.has(i), s = scope; s; s = s.parent) {\r\n                                        s.refs[i] = origin;\r\n                                        if (s === origin) break;\r\n                                }\r\n                        }\r\n                };\r\n                fixrefs(current_scope);\r\n\r\n                return ret;\r\n        });\r\n\r\n};\r\n\r\n/* -----[ mangle names ]----- */\r\n\r\nfunction ast_mangle(ast, options) {\r\n        var w = ast_walker(), walk = w.walk, scope;\r\n        options = options || {};\r\n\r\n        function get_mangled(name, newMangle) {\r\n                if (!options.toplevel && !scope.parent) return name; // don't mangle toplevel\r\n                if (options.except && member(name, options.except))\r\n                        return name;\r\n                return scope.get_mangled(name, newMangle);\r\n        };\r\n\r\n        function get_define(name) {\r\n                if (options.defines) {\r\n                        // we always lookup a defined symbol for the current scope FIRST, so declared\r\n                        // vars trump a DEFINE symbol, but if no such var is found, then match a DEFINE value\r\n                        if (!scope.has(name)) {\r\n                                if (HOP(options.defines, name)) {\r\n                                        return options.defines[name];\r\n                                }\r\n                        }\r\n                        return null;\r\n                }\r\n        };\r\n\r\n        function _lambda(name, args, body) {\r\n                var is_defun = this[0] == \"defun\", extra;\r\n                if (name) {\r\n                        if (is_defun) name = get_mangled(name);\r\n                        else {\r\n                                extra = {};\r\n                                if (!(scope.uses_eval || scope.uses_with))\r\n                                        name = extra[name] = scope.next_mangled();\r\n                                else\r\n                                        extra[name] = name;\r\n                        }\r\n                }\r\n                body = with_scope(body.scope, function(){\r\n                        args = MAP(args, function(name){ return get_mangled(name) });\r\n                        return MAP(body, walk);\r\n                }, extra);\r\n                return [ this[0], name, args, body ];\r\n        };\r\n\r\n        function with_scope(s, cont, extra) {\r\n                var _scope = scope;\r\n                scope = s;\r\n                if (extra) for (var i in extra) if (HOP(extra, i)) {\r\n                        s.set_mangle(i, extra[i]);\r\n                }\r\n                for (var i in s.names) if (HOP(s.names, i)) {\r\n                        get_mangled(i, true);\r\n                }\r\n                var ret = cont();\r\n                ret.scope = s;\r\n                scope = _scope;\r\n                return ret;\r\n        };\r\n\r\n        function _vardefs(defs) {\r\n                return [ this[0], MAP(defs, function(d){\r\n                        return [ get_mangled(d[0]), walk(d[1]) ];\r\n                }) ];\r\n        };\r\n\r\n        return w.with_walkers({\r\n                \"function\": _lambda,\r\n                \"defun\": function() {\r\n                        // move function declarations to the top when\r\n                        // they are not in some block.\r\n                        var ast = _lambda.apply(this, arguments);\r\n                        switch (w.parent()[0]) {\r\n                            case \"toplevel\":\r\n                            case \"function\":\r\n                            case \"defun\":\r\n                                return MAP.at_top(ast);\r\n                        }\r\n                        return ast;\r\n                },\r\n                \"label\": function(label, stat) { return [ this[0], get_mangled(label), walk(stat) ] },\r\n                \"break\": function(label) { if (label) return [ this[0], get_mangled(label) ] },\r\n                \"continue\": function(label) { if (label) return [ this[0], get_mangled(label) ] },\r\n                \"var\": _vardefs,\r\n                \"const\": _vardefs,\r\n                \"name\": function(name) {\r\n                        return get_define(name) || [ this[0], get_mangled(name) ];\r\n                },\r\n                \"try\": function(t, c, f) {\r\n                        return [ this[0],\r\n                                 MAP(t, walk),\r\n                                 c != null ? [ get_mangled(c[0]), MAP(c[1], walk) ] : null,\r\n                                 f != null ? MAP(f, walk) : null ];\r\n                },\r\n                \"toplevel\": function(body) {\r\n                        var self = this;\r\n                        return with_scope(self.scope, function(){\r\n                                return [ self[0], MAP(body, walk) ];\r\n                        });\r\n                }\r\n        }, function() {\r\n                return walk(ast_add_scope(ast));\r\n        });\r\n};\r\n\r\n/* -----[\r\n   - compress foo[\"bar\"] into foo.bar,\r\n   - remove block brackets {} where possible\r\n   - join consecutive var declarations\r\n   - various optimizations for IFs:\r\n     - if (cond) foo(); else bar();  ==>  cond?foo():bar();\r\n     - if (cond) foo();  ==>  cond&&foo();\r\n     - if (foo) return bar(); else return baz();  ==> return foo?bar():baz(); // also for throw\r\n     - if (foo) return bar(); else something();  ==> {if(foo)return bar();something()}\r\n   ]----- */\r\n\r\nvar warn = function(){};\r\n\r\nfunction best_of(ast1, ast2) {\r\n        return gen_code(ast1).length > gen_code(ast2[0] == \"stat\" ? ast2[1] : ast2).length ? ast2 : ast1;\r\n};\r\n\r\nfunction last_stat(b) {\r\n        if (b[0] == \"block\" && b[1] && b[1].length > 0)\r\n                return b[1][b[1].length - 1];\r\n        return b;\r\n}\r\n\r\nfunction aborts(t) {\r\n        if (t) switch (last_stat(t)[0]) {\r\n            case \"return\":\r\n            case \"break\":\r\n            case \"continue\":\r\n            case \"throw\":\r\n                return true;\r\n        }\r\n};\r\n\r\nfunction boolean_expr(expr) {\r\n        return ( (expr[0] == \"unary-prefix\"\r\n                  && member(expr[1], [ \"!\", \"delete\" ])) ||\r\n\r\n                 (expr[0] == \"binary\"\r\n                  && member(expr[1], [ \"in\", \"instanceof\", \"==\", \"!=\", \"===\", \"!==\", \"<\", \"<=\", \">=\", \">\" ])) ||\r\n\r\n                 (expr[0] == \"binary\"\r\n                  && member(expr[1], [ \"&&\", \"||\" ])\r\n                  && boolean_expr(expr[2])\r\n                  && boolean_expr(expr[3])) ||\r\n\r\n                 (expr[0] == \"conditional\"\r\n                  && boolean_expr(expr[2])\r\n                  && boolean_expr(expr[3])) ||\r\n\r\n                 (expr[0] == \"assign\"\r\n                  && expr[1] === true\r\n                  && boolean_expr(expr[3])) ||\r\n\r\n                 (expr[0] == \"seq\"\r\n                  && boolean_expr(expr[expr.length - 1]))\r\n               );\r\n};\r\n\r\nfunction make_conditional(c, t, e) {\r\n    var make_real_conditional = function() {\r\n        if (c[0] == \"unary-prefix\" && c[1] == \"!\") {\r\n            return e ? [ \"conditional\", c[2], e, t ] : [ \"binary\", \"||\", c[2], t ];\r\n        } else {\r\n            return e ? [ \"conditional\", c, t, e ] : [ \"binary\", \"&&\", c, t ];\r\n        }\r\n    };\r\n    // shortcut the conditional if the expression has a constant value\r\n    return when_constant(c, function(ast, val){\r\n        warn_unreachable(val ? e : t);\r\n        return          (val ? t : e);\r\n    }, make_real_conditional);\r\n};\r\n\r\nfunction empty(b) {\r\n        return !b || (b[0] == \"block\" && (!b[1] || b[1].length == 0));\r\n};\r\n\r\nfunction is_string(node) {\r\n        return (node[0] == \"string\" ||\r\n                node[0] == \"unary-prefix\" && node[1] == \"typeof\" ||\r\n                node[0] == \"binary\" && node[1] == \"+\" &&\r\n                (is_string(node[2]) || is_string(node[3])));\r\n};\r\n\r\nvar when_constant = (function(){\r\n\r\n        var $NOT_CONSTANT = {};\r\n\r\n        // this can only evaluate constant expressions.  If it finds anything\r\n        // not constant, it throws $NOT_CONSTANT.\r\n        function evaluate(expr) {\r\n                switch (expr[0]) {\r\n                    case \"string\":\r\n                    case \"num\":\r\n                        return expr[1];\r\n                    case \"name\":\r\n                    case \"atom\":\r\n                        switch (expr[1]) {\r\n                            case \"true\": return true;\r\n                            case \"false\": return false;\r\n                        }\r\n                        break;\r\n                    case \"unary-prefix\":\r\n                        switch (expr[1]) {\r\n                            case \"!\": return !evaluate(expr[2]);\r\n                            case \"typeof\": return typeof evaluate(expr[2]);\r\n                            case \"~\": return ~evaluate(expr[2]);\r\n                            case \"-\": return -evaluate(expr[2]);\r\n                            case \"+\": return +evaluate(expr[2]);\r\n                        }\r\n                        break;\r\n                    case \"binary\":\r\n                        var left = expr[2], right = expr[3];\r\n                        switch (expr[1]) {\r\n                            case \"&&\"         : return evaluate(left) &&         evaluate(right);\r\n                            case \"||\"         : return evaluate(left) ||         evaluate(right);\r\n                            case \"|\"          : return evaluate(left) |          evaluate(right);\r\n                            case \"&\"          : return evaluate(left) &          evaluate(right);\r\n                            case \"^\"          : return evaluate(left) ^          evaluate(right);\r\n                            case \"+\"          : return evaluate(left) +          evaluate(right);\r\n                            case \"*\"          : return evaluate(left) *          evaluate(right);\r\n                            case \"/\"          : return evaluate(left) /          evaluate(right);\r\n                            case \"-\"          : return evaluate(left) -          evaluate(right);\r\n                            case \"<<\"         : return evaluate(left) <<         evaluate(right);\r\n                            case \">>\"         : return evaluate(left) >>         evaluate(right);\r\n                            case \">>>\"        : return evaluate(left) >>>        evaluate(right);\r\n                            case \"==\"         : return evaluate(left) ==         evaluate(right);\r\n                            case \"===\"        : return evaluate(left) ===        evaluate(right);\r\n                            case \"!=\"         : return evaluate(left) !=         evaluate(right);\r\n                            case \"!==\"        : return evaluate(left) !==        evaluate(right);\r\n                            case \"<\"          : return evaluate(left) <          evaluate(right);\r\n                            case \"<=\"         : return evaluate(left) <=         evaluate(right);\r\n                            case \">\"          : return evaluate(left) >          evaluate(right);\r\n                            case \">=\"         : return evaluate(left) >=         evaluate(right);\r\n                            case \"in\"         : return evaluate(left) in         evaluate(right);\r\n                            case \"instanceof\" : return evaluate(left) instanceof evaluate(right);\r\n                        }\r\n                }\r\n                throw $NOT_CONSTANT;\r\n        };\r\n\r\n        return function(expr, yes, no) {\r\n                try {\r\n                        var val = evaluate(expr), ast;\r\n                        switch (typeof val) {\r\n                            case \"string\": ast =  [ \"string\", val ]; break;\r\n                            case \"number\": ast =  [ \"num\", val ]; break;\r\n                            case \"boolean\": ast =  [ \"name\", String(val) ]; break;\r\n                            default: throw new Error(\"Can't handle constant of type: \" + (typeof val));\r\n                        }\r\n                        return yes.call(expr, ast, val);\r\n                } catch(ex) {\r\n                        if (ex === $NOT_CONSTANT) {\r\n                                if (expr[0] == \"binary\"\r\n                                    && (expr[1] == \"===\" || expr[1] == \"!==\")\r\n                                    && ((is_string(expr[2]) && is_string(expr[3]))\r\n                                        || (boolean_expr(expr[2]) && boolean_expr(expr[3])))) {\r\n                                        expr[1] = expr[1].substr(0, 2);\r\n                                }\r\n                                else if (no && expr[0] == \"binary\"\r\n                                         && (expr[1] == \"||\" || expr[1] == \"&&\")) {\r\n                                    // the whole expression is not constant but the lval may be...\r\n                                    try {\r\n                                        var lval = evaluate(expr[2]);\r\n                                        expr = ((expr[1] == \"&&\" && (lval ? expr[3] : lval))    ||\r\n                                                (expr[1] == \"||\" && (lval ? lval    : expr[3])) ||\r\n                                                expr);\r\n                                    } catch(ex2) {\r\n                                        // IGNORE... lval is not constant\r\n                                    }\r\n                                }\r\n                                return no ? no.call(expr, expr) : null;\r\n                        }\r\n                        else throw ex;\r\n                }\r\n        };\r\n\r\n})();\r\n\r\nfunction warn_unreachable(ast) {\r\n        if (!empty(ast))\r\n                warn(\"Dropping unreachable code: \" + gen_code(ast, true));\r\n};\r\n\r\nfunction prepare_ifs(ast) {\r\n        var w = ast_walker(), walk = w.walk;\r\n        // In this first pass, we rewrite ifs which abort with no else with an\r\n        // if-else.  For example:\r\n        //\r\n        // if (x) {\r\n        //     blah();\r\n        //     return y;\r\n        // }\r\n        // foobar();\r\n        //\r\n        // is rewritten into:\r\n        //\r\n        // if (x) {\r\n        //     blah();\r\n        //     return y;\r\n        // } else {\r\n        //     foobar();\r\n        // }\r\n        function redo_if(statements) {\r\n                statements = MAP(statements, walk);\r\n\r\n                for (var i = 0; i < statements.length; ++i) {\r\n                        var fi = statements[i];\r\n                        if (fi[0] != \"if\") continue;\r\n\r\n                        if (fi[3] && walk(fi[3])) continue;\r\n\r\n                        var t = walk(fi[2]);\r\n                        if (!aborts(t)) continue;\r\n\r\n                        var conditional = walk(fi[1]);\r\n\r\n                        var e_body = statements.slice(i + 1);\r\n                        var e = e_body.length == 1 ? e_body[0] : [ \"block\", e_body ];\r\n\r\n                        var ret = statements.slice(0, i).concat([ [\r\n                                fi[0],          // \"if\"\r\n                                conditional,    // conditional\r\n                                t,              // then\r\n                                e               // else\r\n                        ] ]);\r\n\r\n                        return redo_if(ret);\r\n                }\r\n\r\n                return statements;\r\n        };\r\n\r\n        function redo_if_lambda(name, args, body) {\r\n                body = redo_if(body);\r\n                return [ this[0], name, args, body ];\r\n        };\r\n\r\n        function redo_if_block(statements) {\r\n                return [ this[0], statements != null ? redo_if(statements) : null ];\r\n        };\r\n\r\n        return w.with_walkers({\r\n                \"defun\": redo_if_lambda,\r\n                \"function\": redo_if_lambda,\r\n                \"block\": redo_if_block,\r\n                \"splice\": redo_if_block,\r\n                \"toplevel\": function(statements) {\r\n                        return [ this[0], redo_if(statements) ];\r\n                },\r\n                \"try\": function(t, c, f) {\r\n                        return [\r\n                                this[0],\r\n                                redo_if(t),\r\n                                c != null ? [ c[0], redo_if(c[1]) ] : null,\r\n                                f != null ? redo_if(f) : null\r\n                        ];\r\n                }\r\n        }, function() {\r\n                return walk(ast);\r\n        });\r\n};\r\n\r\nfunction for_side_effects(ast, handler) {\r\n        var w = ast_walker(), walk = w.walk;\r\n        var $stop = {}, $restart = {};\r\n        function stop() { throw $stop };\r\n        function restart() { throw $restart };\r\n        function found(){ return handler.call(this, this, w, stop, restart) };\r\n        function unary(op) {\r\n                if (op == \"++\" || op == \"--\")\r\n                        return found.apply(this, arguments);\r\n        };\r\n        return w.with_walkers({\r\n                \"try\": found,\r\n                \"throw\": found,\r\n                \"return\": found,\r\n                \"new\": found,\r\n                \"switch\": found,\r\n                \"break\": found,\r\n                \"continue\": found,\r\n                \"assign\": found,\r\n                \"call\": found,\r\n                \"if\": found,\r\n                \"for\": found,\r\n                \"for-in\": found,\r\n                \"while\": found,\r\n                \"do\": found,\r\n                \"return\": found,\r\n                \"unary-prefix\": unary,\r\n                \"unary-postfix\": unary,\r\n                \"defun\": found\r\n        }, function(){\r\n                while (true) try {\r\n                        walk(ast);\r\n                        break;\r\n                } catch(ex) {\r\n                        if (ex === $stop) break;\r\n                        if (ex === $restart) continue;\r\n                        throw ex;\r\n                }\r\n        });\r\n};\r\n\r\nfunction ast_lift_variables(ast) {\r\n        var w = ast_walker(), walk = w.walk, scope;\r\n        function do_body(body, env) {\r\n                var _scope = scope;\r\n                scope = env;\r\n                body = MAP(body, walk);\r\n                var hash = {}, names = MAP(env.names, function(type, name){\r\n                        if (type != \"var\") return MAP.skip;\r\n                        if (!env.references(name)) return MAP.skip;\r\n                        hash[name] = true;\r\n                        return [ name ];\r\n                });\r\n                if (names.length > 0) {\r\n                        // looking for assignments to any of these variables.\r\n                        // we can save considerable space by moving the definitions\r\n                        // in the var declaration.\r\n                        for_side_effects([ \"block\", body ], function(ast, walker, stop, restart) {\r\n                                if (ast[0] == \"assign\"\r\n                                    && ast[1] === true\r\n                                    && ast[2][0] == \"name\"\r\n                                    && HOP(hash, ast[2][1])) {\r\n                                        // insert the definition into the var declaration\r\n                                        for (var i = names.length; --i >= 0;) {\r\n                                                if (names[i][0] == ast[2][1]) {\r\n                                                        if (names[i][1]) // this name already defined, we must stop\r\n                                                                stop();\r\n                                                        names[i][1] = ast[3]; // definition\r\n                                                        names.push(names.splice(i, 1)[0]);\r\n                                                        break;\r\n                                                }\r\n                                        }\r\n                                        // remove this assignment from the AST.\r\n                                        var p = walker.parent();\r\n                                        if (p[0] == \"seq\") {\r\n                                                var a = p[2];\r\n                                                a.unshift(0, p.length);\r\n                                                p.splice.apply(p, a);\r\n                                        }\r\n                                        else if (p[0] == \"stat\") {\r\n                                                p.splice(0, p.length, \"block\"); // empty statement\r\n                                        }\r\n                                        else {\r\n                                                stop();\r\n                                        }\r\n                                        restart();\r\n                                }\r\n                                stop();\r\n                        });\r\n                        body.unshift([ \"var\", names ]);\r\n                }\r\n                scope = _scope;\r\n                return body;\r\n        };\r\n        function _vardefs(defs) {\r\n                var ret = null;\r\n                for (var i = defs.length; --i >= 0;) {\r\n                        var d = defs[i];\r\n                        if (!d[1]) continue;\r\n                        d = [ \"assign\", true, [ \"name\", d[0] ], d[1] ];\r\n                        if (ret == null) ret = d;\r\n                        else ret = [ \"seq\", d, ret ];\r\n                }\r\n                if (ret == null) {\r\n                        if (w.parent()[0] == \"for-in\")\r\n                                return [ \"name\", defs[0][0] ];\r\n                        return MAP.skip;\r\n                }\r\n                return [ \"stat\", ret ];\r\n        };\r\n        function _toplevel(body) {\r\n                return [ this[0], do_body(body, this.scope) ];\r\n        };\r\n        return w.with_walkers({\r\n                \"function\": function(name, args, body){\r\n                        for (var i = args.length; --i >= 0 && !body.scope.references(args[i]);)\r\n                                args.pop();\r\n                        if (!body.scope.references(name)) name = null;\r\n                        return [ this[0], name, args, do_body(body, body.scope) ];\r\n                },\r\n                \"defun\": function(name, args, body){\r\n                        if (!scope.references(name)) return MAP.skip;\r\n                        for (var i = args.length; --i >= 0 && !body.scope.references(args[i]);)\r\n                                args.pop();\r\n                        return [ this[0], name, args, do_body(body, body.scope) ];\r\n                },\r\n                \"var\": _vardefs,\r\n                \"toplevel\": _toplevel\r\n        }, function(){\r\n                return walk(ast_add_scope(ast));\r\n        });\r\n};\r\n\r\nfunction ast_squeeze(ast, options) {\r\n        options = defaults(options, {\r\n                make_seqs   : true,\r\n                dead_code   : true,\r\n                keep_comps  : true,\r\n                no_warnings : false\r\n        });\r\n\r\n        var w = ast_walker(), walk = w.walk, scope;\r\n\r\n        function negate(c) {\r\n                var not_c = [ \"unary-prefix\", \"!\", c ];\r\n                switch (c[0]) {\r\n                    case \"unary-prefix\":\r\n                        return c[1] == \"!\" && boolean_expr(c[2]) ? c[2] : not_c;\r\n                    case \"seq\":\r\n                        c = slice(c);\r\n                        c[c.length - 1] = negate(c[c.length - 1]);\r\n                        return c;\r\n                    case \"conditional\":\r\n                        return best_of(not_c, [ \"conditional\", c[1], negate(c[2]), negate(c[3]) ]);\r\n                    case \"binary\":\r\n                        var op = c[1], left = c[2], right = c[3];\r\n                        if (!options.keep_comps) switch (op) {\r\n                            case \"<=\"  : return [ \"binary\", \">\", left, right ];\r\n                            case \"<\"   : return [ \"binary\", \">=\", left, right ];\r\n                            case \">=\"  : return [ \"binary\", \"<\", left, right ];\r\n                            case \">\"   : return [ \"binary\", \"<=\", left, right ];\r\n                        }\r\n                        switch (op) {\r\n                            case \"==\"  : return [ \"binary\", \"!=\", left, right ];\r\n                            case \"!=\"  : return [ \"binary\", \"==\", left, right ];\r\n                            case \"===\" : return [ \"binary\", \"!==\", left, right ];\r\n                            case \"!==\" : return [ \"binary\", \"===\", left, right ];\r\n                            case \"&&\"  : return best_of(not_c, [ \"binary\", \"||\", negate(left), negate(right) ]);\r\n                            case \"||\"  : return best_of(not_c, [ \"binary\", \"&&\", negate(left), negate(right) ]);\r\n                        }\r\n                        break;\r\n                }\r\n                return not_c;\r\n        };\r\n\r\n        function with_scope(s, cont) {\r\n                var _scope = scope;\r\n                scope = s;\r\n                var ret = cont();\r\n                ret.scope = s;\r\n                scope = _scope;\r\n                return ret;\r\n        };\r\n\r\n        function rmblock(block) {\r\n                if (block != null && block[0] == \"block\" && block[1]) {\r\n                        if (block[1].length == 1)\r\n                                block = block[1][0];\r\n                        else if (block[1].length == 0)\r\n                                block = [ \"block\" ];\r\n                }\r\n                return block;\r\n        };\r\n\r\n        function _lambda(name, args, body) {\r\n                var is_defun = this[0] == \"defun\";\r\n                body = with_scope(body.scope, function(){\r\n                        var ret = tighten(body, \"lambda\");\r\n                        if (!is_defun && name && !scope.references(name))\r\n                                name = null;\r\n                        return ret;\r\n                });\r\n                return [ this[0], name, args, body ];\r\n        };\r\n\r\n        // this function does a few things:\r\n        // 1. discard useless blocks\r\n        // 2. join consecutive var declarations\r\n        // 3. remove obviously dead code\r\n        // 4. transform consecutive statements using the comma operator\r\n        // 5. if block_type == \"lambda\" and it detects constructs like if(foo) return ... - rewrite like if (!foo) { ... }\r\n        function tighten(statements, block_type) {\r\n                statements = MAP(statements, walk);\r\n\r\n                statements = statements.reduce(function(a, stat){\r\n                        if (stat[0] == \"block\") {\r\n                                if (stat[1]) {\r\n                                        a.push.apply(a, stat[1]);\r\n                                }\r\n                        } else {\r\n                                a.push(stat);\r\n                        }\r\n                        return a;\r\n                }, []);\r\n\r\n                statements = (function(a, prev){\r\n                        statements.forEach(function(cur){\r\n                                if (prev && ((cur[0] == \"var\" && prev[0] == \"var\") ||\r\n                                             (cur[0] == \"const\" && prev[0] == \"const\"))) {\r\n                                        prev[1] = prev[1].concat(cur[1]);\r\n                                } else {\r\n                                        a.push(cur);\r\n                                        prev = cur;\r\n                                }\r\n                        });\r\n                        return a;\r\n                })([]);\r\n\r\n                if (options.dead_code) statements = (function(a, has_quit){\r\n                        statements.forEach(function(st){\r\n                                if (has_quit) {\r\n                                        if (st[0] == \"function\" || st[0] == \"defun\") {\r\n                                                a.push(st);\r\n                                        }\r\n                                        else if (st[0] == \"var\" || st[0] == \"const\") {\r\n                                                if (!options.no_warnings)\r\n                                                        warn(\"Variables declared in unreachable code\");\r\n                                                st[1] = MAP(st[1], function(def){\r\n                                                        if (def[1] && !options.no_warnings)\r\n                                                                warn_unreachable([ \"assign\", true, [ \"name\", def[0] ], def[1] ]);\r\n                                                        return [ def[0] ];\r\n                                                });\r\n                                                a.push(st);\r\n                                        }\r\n                                        else if (!options.no_warnings)\r\n                                                warn_unreachable(st);\r\n                                }\r\n                                else {\r\n                                        a.push(st);\r\n                                        if (member(st[0], [ \"return\", \"throw\", \"break\", \"continue\" ]))\r\n                                                has_quit = true;\r\n                                }\r\n                        });\r\n                        return a;\r\n                })([]);\r\n\r\n                if (options.make_seqs) statements = (function(a, prev) {\r\n                        statements.forEach(function(cur){\r\n                                if (prev && prev[0] == \"stat\" && cur[0] == \"stat\") {\r\n                                        prev[1] = [ \"seq\", prev[1], cur[1] ];\r\n                                } else {\r\n                                        a.push(cur);\r\n                                        prev = cur;\r\n                                }\r\n                        });\r\n                        if (a.length >= 2\r\n                            && a[a.length-2][0] == \"stat\"\r\n                            && (a[a.length-1][0] == \"return\" || a[a.length-1][0] == \"throw\")\r\n                            && a[a.length-1][1])\r\n                        {\r\n                                a.splice(a.length - 2, 2,\r\n                                         [ a[a.length-1][0],\r\n                                           [ \"seq\", a[a.length-2][1], a[a.length-1][1] ]]);\r\n                        }\r\n                        return a;\r\n                })([]);\r\n\r\n                // this increases jQuery by 1K.  Probably not such a good idea after all..\r\n                // part of this is done in prepare_ifs anyway.\r\n                // if (block_type == \"lambda\") statements = (function(i, a, stat){\r\n                //         while (i < statements.length) {\r\n                //                 stat = statements[i++];\r\n                //                 if (stat[0] == \"if\" && !stat[3]) {\r\n                //                         if (stat[2][0] == \"return\" && stat[2][1] == null) {\r\n                //                                 a.push(make_if(negate(stat[1]), [ \"block\", statements.slice(i) ]));\r\n                //                                 break;\r\n                //                         }\r\n                //                         var last = last_stat(stat[2]);\r\n                //                         if (last[0] == \"return\" && last[1] == null) {\r\n                //                                 a.push(make_if(stat[1], [ \"block\", stat[2][1].slice(0, -1) ], [ \"block\", statements.slice(i) ]));\r\n                //                                 break;\r\n                //                         }\r\n                //                 }\r\n                //                 a.push(stat);\r\n                //         }\r\n                //         return a;\r\n                // })(0, []);\r\n\r\n                return statements;\r\n        };\r\n\r\n        function make_if(c, t, e) {\r\n                return when_constant(c, function(ast, val){\r\n                        if (val) {\r\n                                warn_unreachable(e);\r\n                                return t;\r\n                        } else {\r\n                                warn_unreachable(t);\r\n                                return e;\r\n                        }\r\n                }, function() {\r\n                        return make_real_if(c, t, e);\r\n                });\r\n        };\r\n\r\n        function make_real_if(c, t, e) {\r\n                c = walk(c);\r\n                t = walk(t);\r\n                e = walk(e);\r\n\r\n                if (empty(t)) {\r\n                        c = negate(c);\r\n                        t = e;\r\n                        e = null;\r\n                } else if (empty(e)) {\r\n                        e = null;\r\n                } else {\r\n                        // if we have both else and then, maybe it makes sense to switch them?\r\n                        (function(){\r\n                                var a = gen_code(c);\r\n                                var n = negate(c);\r\n                                var b = gen_code(n);\r\n                                if (b.length < a.length) {\r\n                                        var tmp = t;\r\n                                        t = e;\r\n                                        e = tmp;\r\n                                        c = n;\r\n                                }\r\n                        })();\r\n                }\r\n                if (empty(e) && empty(t))\r\n                        return [ \"stat\", c ];\r\n                var ret = [ \"if\", c, t, e ];\r\n                if (t[0] == \"if\" && empty(t[3]) && empty(e)) {\r\n                        ret = best_of(ret, walk([ \"if\", [ \"binary\", \"&&\", c, t[1] ], t[2] ]));\r\n                }\r\n                else if (t[0] == \"stat\") {\r\n                        if (e) {\r\n                                if (e[0] == \"stat\") {\r\n                                        ret = best_of(ret, [ \"stat\", make_conditional(c, t[1], e[1]) ]);\r\n                                }\r\n                        }\r\n                        else {\r\n                                ret = best_of(ret, [ \"stat\", make_conditional(c, t[1]) ]);\r\n                        }\r\n                }\r\n                else if (e && t[0] == e[0] && (t[0] == \"return\" || t[0] == \"throw\") && t[1] && e[1]) {\r\n                        ret = best_of(ret, [ t[0], make_conditional(c, t[1], e[1] ) ]);\r\n                }\r\n                else if (e && aborts(t)) {\r\n                        ret = [ [ \"if\", c, t ] ];\r\n                        if (e[0] == \"block\") {\r\n                                if (e[1]) ret = ret.concat(e[1]);\r\n                        }\r\n                        else {\r\n                                ret.push(e);\r\n                        }\r\n                        ret = walk([ \"block\", ret ]);\r\n                }\r\n                else if (t && aborts(e)) {\r\n                        ret = [ [ \"if\", negate(c), e ] ];\r\n                        if (t[0] == \"block\") {\r\n                                if (t[1]) ret = ret.concat(t[1]);\r\n                        } else {\r\n                                ret.push(t);\r\n                        }\r\n                        ret = walk([ \"block\", ret ]);\r\n                }\r\n                return ret;\r\n        };\r\n\r\n        function _do_while(cond, body) {\r\n                return when_constant(cond, function(cond, val){\r\n                        if (!val) {\r\n                                warn_unreachable(body);\r\n                                return [ \"block\" ];\r\n                        } else {\r\n                                return [ \"for\", null, null, null, walk(body) ];\r\n                        }\r\n                });\r\n        };\r\n\r\n        return w.with_walkers({\r\n                \"sub\": function(expr, subscript) {\r\n                        if (subscript[0] == \"string\") {\r\n                                var name = subscript[1];\r\n                                if (is_identifier(name))\r\n                                        return [ \"dot\", walk(expr), name ];\r\n                                else if (/^[1-9][0-9]*$/.test(name) || name === \"0\")\r\n                                        return [ \"sub\", walk(expr), [ \"num\", parseInt(name, 10) ] ];\r\n                        }\r\n                },\r\n                \"if\": make_if,\r\n                \"toplevel\": function(body) {\r\n                        return [ \"toplevel\", with_scope(this.scope, function(){\r\n                                return tighten(body);\r\n                        }) ];\r\n                },\r\n                \"switch\": function(expr, body) {\r\n                        var last = body.length - 1;\r\n                        return [ \"switch\", walk(expr), MAP(body, function(branch, i){\r\n                                var block = tighten(branch[1]);\r\n                                if (i == last && block.length > 0) {\r\n                                        var node = block[block.length - 1];\r\n                                        if (node[0] == \"break\" && !node[1])\r\n                                                block.pop();\r\n                                }\r\n                                return [ branch[0] ? walk(branch[0]) : null, block ];\r\n                        }) ];\r\n                },\r\n                \"function\": _lambda,\r\n                \"defun\": _lambda,\r\n                \"block\": function(body) {\r\n                        if (body) return rmblock([ \"block\", tighten(body) ]);\r\n                },\r\n                \"binary\": function(op, left, right) {\r\n                        return when_constant([ \"binary\", op, walk(left), walk(right) ], function yes(c){\r\n                                return best_of(walk(c), this);\r\n                        }, function no() {\r\n                                return this;\r\n                        });\r\n                },\r\n                \"conditional\": function(c, t, e) {\r\n                        return make_conditional(walk(c), walk(t), walk(e));\r\n                },\r\n                \"try\": function(t, c, f) {\r\n                        return [\r\n                                \"try\",\r\n                                tighten(t),\r\n                                c != null ? [ c[0], tighten(c[1]) ] : null,\r\n                                f != null ? tighten(f) : null\r\n                        ];\r\n                },\r\n                \"unary-prefix\": function(op, expr) {\r\n                        expr = walk(expr);\r\n                        var ret = [ \"unary-prefix\", op, expr ];\r\n                        if (op == \"!\")\r\n                                ret = best_of(ret, negate(expr));\r\n                        return when_constant(ret, function(ast, val){\r\n                                return walk(ast); // it's either true or false, so minifies to !0 or !1\r\n                        }, function() { return ret });\r\n                },\r\n                \"name\": function(name) {\r\n                        switch (name) {\r\n                            case \"true\": return [ \"unary-prefix\", \"!\", [ \"num\", 0 ]];\r\n                            case \"false\": return [ \"unary-prefix\", \"!\", [ \"num\", 1 ]];\r\n                        }\r\n                },\r\n                \"new\": function(ctor, args) {\r\n                        if (ctor[0] == \"name\" && ctor[1] == \"Array\" && !scope.has(\"Array\")) {\r\n                                if (args.length != 1) {\r\n                                        return [ \"array\", args ];\r\n                                } else {\r\n                                        return [ \"call\", [ \"name\", \"Array\" ], args ];\r\n                                }\r\n                        }\r\n                },\r\n                \"call\": function(expr, args) {\r\n                        if (expr[0] == \"name\" && expr[1] == \"Array\" && args.length != 1 && !scope.has(\"Array\")) {\r\n                                return [ \"array\", args ];\r\n                        }\r\n                },\r\n                \"while\": _do_while\r\n        }, function() {\r\n                for (var i = 0; i < 2; ++i) {\r\n                        ast = prepare_ifs(ast);\r\n                        ast = ast_add_scope(ast);\r\n                        ast = walk(ast);\r\n                }\r\n                return ast;\r\n        });\r\n};\r\n\r\n/* -----[ re-generate code from the AST ]----- */\r\n\r\nvar DOT_CALL_NO_PARENS = /*jsp.*/array_to_hash([\r\n        \"name\",\r\n        \"array\",\r\n        \"object\",\r\n        \"string\",\r\n        \"dot\",\r\n        \"sub\",\r\n        \"call\",\r\n        \"regexp\"\r\n]);\r\n\r\nfunction make_string(str, ascii_only) {\r\n        var dq = 0, sq = 0;\r\n        str = str.replace(/[\\\\\\b\\f\\n\\r\\t\\x22\\x27\\u2028\\u2029]/g, function(s){\r\n                switch (s) {\r\n                    case \"\\\\\": return \"\\\\\\\\\";\r\n                    case \"\\b\": return \"\\\\b\";\r\n                    case \"\\f\": return \"\\\\f\";\r\n                    case \"\\n\": return \"\\\\n\";\r\n                    case \"\\r\": return \"\\\\r\";\r\n                    case \"\\t\": return \"\\\\t\";\r\n                    case \"\\u2028\": return \"\\\\u2028\";\r\n                    case \"\\u2029\": return \"\\\\u2029\";\r\n                    case '\"': ++dq; return '\"';\r\n                    case \"'\": ++sq; return \"'\";\r\n                }\r\n                return s;\r\n        });\r\n        if (ascii_only) str = to_ascii(str);\r\n        if (dq > sq) return \"'\" + str.replace(/\\x27/g, \"\\\\'\") + \"'\";\r\n        else return '\"' + str.replace(/\\x22/g, '\\\\\"') + '\"';\r\n};\r\n\r\nfunction to_ascii(str) {\r\n        return str.replace(/[\\u0080-\\uffff]/g, function(ch) {\r\n                var code = ch.charCodeAt(0).toString(16);\r\n                while (code.length < 4) code = \"0\" + code;\r\n                return \"\\\\u\" + code;\r\n        });\r\n};\r\n\r\nvar SPLICE_NEEDS_BRACKETS = /*jsp.*/array_to_hash([ \"if\", \"while\", \"do\", \"for\", \"for-in\", \"with\" ]);\r\n\r\nfunction gen_code(ast, options) {\r\n        options = defaults(options, {\r\n                indent_start : 0,\r\n                indent_level : 4,\r\n                quote_keys   : false,\r\n                space_colon  : false,\r\n                beautify     : false,\r\n                ascii_only   : false,\r\n                inline_script: false\r\n        });\r\n        var beautify = !!options.beautify;\r\n        var indentation = 0,\r\n            newline = beautify ? \"\\n\" : \"\",\r\n            space = beautify ? \" \" : \"\";\r\n\r\n        function encode_string(str) {\r\n                var ret = make_string(str, options.ascii_only);\r\n                if (options.inline_script)\r\n                        ret = ret.replace(/<\\x2fscript([>/\\t\\n\\f\\r ])/gi, \"<\\\\/script$1\");\r\n                return ret;\r\n        };\r\n\r\n        function make_name(name) {\r\n                name = name.toString();\r\n                if (options.ascii_only)\r\n                        name = to_ascii(name);\r\n                return name;\r\n        };\r\n\r\n        function indent(line) {\r\n                if (line == null)\r\n                        line = \"\";\r\n                if (beautify)\r\n                        line = repeat_string(\" \", options.indent_start + indentation * options.indent_level) + line;\r\n                return line;\r\n        };\r\n\r\n        function with_indent(cont, incr) {\r\n                if (incr == null) incr = 1;\r\n                indentation += incr;\r\n                try { return cont.apply(null, slice(arguments, 1)); }\r\n                finally { indentation -= incr; }\r\n        };\r\n\r\n        function add_spaces(a) {\r\n                if (beautify)\r\n                        return a.join(\" \");\r\n                var b = [];\r\n                for (var i = 0; i < a.length; ++i) {\r\n                        var next = a[i + 1];\r\n                        b.push(a[i]);\r\n                        if (next &&\r\n                            ((/[a-z0-9_\\x24]$/i.test(a[i].toString()) && /^[a-z0-9_\\x24]/i.test(next.toString())) ||\r\n                             (/[\\+\\-]$/.test(a[i].toString()) && /^[\\+\\-]/.test(next.toString())))) {\r\n                                b.push(\" \");\r\n                        }\r\n                }\r\n                return b.join(\"\");\r\n        };\r\n\r\n        function add_commas(a) {\r\n                return a.join(\",\" + space);\r\n        };\r\n\r\n        function parenthesize(expr) {\r\n                var gen = make(expr);\r\n                for (var i = 1; i < arguments.length; ++i) {\r\n                        var el = arguments[i];\r\n                        if ((el instanceof Function && el(expr)) || expr[0] == el)\r\n                                return \"(\" + gen + \")\";\r\n                }\r\n                return gen;\r\n        };\r\n\r\n        function best_of(a) {\r\n                if (a.length == 1) {\r\n                        return a[0];\r\n                }\r\n                if (a.length == 2) {\r\n                        var b = a[1];\r\n                        a = a[0];\r\n                        return a.length <= b.length ? a : b;\r\n                }\r\n                return best_of([ a[0], best_of(a.slice(1)) ]);\r\n        };\r\n\r\n        function needs_parens(expr) {\r\n                if (expr[0] == \"function\" || expr[0] == \"object\") {\r\n                        // dot/call on a literal function requires the\r\n                        // function literal itself to be parenthesized\r\n                        // only if it's the first \"thing\" in a\r\n                        // statement.  This means that the parent is\r\n                        // \"stat\", but it could also be a \"seq\" and\r\n                        // we're the first in this \"seq\" and the\r\n                        // parent is \"stat\", and so on.  Messy stuff,\r\n                        // but it worths the trouble.\r\n                        var a = slice(w.stack()), self = a.pop(), p = a.pop();\r\n                        while (p) {\r\n                                if (p[0] == \"stat\") return true;\r\n                                if (((p[0] == \"seq\" || p[0] == \"call\" || p[0] == \"dot\" || p[0] == \"sub\" || p[0] == \"conditional\") && p[1] === self) ||\r\n                                    ((p[0] == \"binary\" || p[0] == \"assign\" || p[0] == \"unary-postfix\") && p[2] === self)) {\r\n                                        self = p;\r\n                                        p = a.pop();\r\n                                } else {\r\n                                        return false;\r\n                                }\r\n                        }\r\n                }\r\n                return !HOP(DOT_CALL_NO_PARENS, expr[0]);\r\n        };\r\n\r\n        function make_num(num) {\r\n                var str = num.toString(10), a = [ str.replace(/^0\\./, \".\") ], m;\r\n                if (Math.floor(num) === num) {\r\n                        a.push(\"0x\" + num.toString(16).toLowerCase(), // probably pointless\r\n                               \"0\" + num.toString(8)); // same.\r\n                        if ((m = /^(.*?)(0+)$/.exec(num))) {\r\n                                a.push(m[1] + \"e\" + m[2].length);\r\n                        }\r\n                } else if ((m = /^0?\\.(0+)(.*)$/.exec(num))) {\r\n                        a.push(m[2] + \"e-\" + (m[1].length + m[2].length),\r\n                               str.substr(str.indexOf(\".\")));\r\n                }\r\n                return best_of(a);\r\n        };\r\n\r\n        var w = ast_walker();\r\n        var make = w.walk;\r\n        return w.with_walkers({\r\n                \"string\": encode_string,\r\n                \"num\": make_num,\r\n                \"name\": make_name,\r\n                \"toplevel\": function(statements) {\r\n                        return make_block_statements(statements)\r\n                                .join(newline + newline);\r\n                },\r\n                \"splice\": function(statements) {\r\n                        var parent = w.parent();\r\n                        if (HOP(SPLICE_NEEDS_BRACKETS, parent)) {\r\n                                // we need block brackets in this case\r\n                                return make_block.apply(this, arguments);\r\n                        } else {\r\n                                return MAP(make_block_statements(statements, true),\r\n                                           function(line, i) {\r\n                                                   // the first line is already indented\r\n                                                   return i > 0 ? indent(line) : line;\r\n                                           }).join(newline);\r\n                        }\r\n                },\r\n                \"block\": make_block,\r\n                \"var\": function(defs) {\r\n                        return \"var \" + add_commas(MAP(defs, make_1vardef)) + \";\";\r\n                },\r\n                \"const\": function(defs) {\r\n                        return \"const \" + add_commas(MAP(defs, make_1vardef)) + \";\";\r\n                },\r\n                \"try\": function(tr, ca, fi) {\r\n                        var out = [ \"try\", make_block(tr) ];\r\n                        if (ca) out.push(\"catch\", \"(\" + ca[0] + \")\", make_block(ca[1]));\r\n                        if (fi) out.push(\"finally\", make_block(fi));\r\n                        return add_spaces(out);\r\n                },\r\n                \"throw\": function(expr) {\r\n                        return add_spaces([ \"throw\", make(expr) ]) + \";\";\r\n                },\r\n                \"new\": function(ctor, args) {\r\n                        args = args.length > 0 ? \"(\" + add_commas(MAP(args, make)) + \")\" : \"\";\r\n                        return add_spaces([ \"new\", parenthesize(ctor, \"seq\", \"binary\", \"conditional\", \"assign\", function(expr){\r\n                                var w = ast_walker(), has_call = {};\r\n                                try {\r\n                                        w.with_walkers({\r\n                                                \"call\": function() { throw has_call },\r\n                                                \"function\": function() { return this }\r\n                                        }, function(){\r\n                                                w.walk(expr);\r\n                                        });\r\n                                } catch(ex) {\r\n                                        if (ex === has_call)\r\n                                                return true;\r\n                                        throw ex;\r\n                                }\r\n                        }) + args ]);\r\n                },\r\n                \"switch\": function(expr, body) {\r\n                        return add_spaces([ \"switch\", \"(\" + make(expr) + \")\", make_switch_block(body) ]);\r\n                },\r\n                \"break\": function(label) {\r\n                        var out = \"break\";\r\n                        if (label != null)\r\n                                out += \" \" + make_name(label);\r\n                        return out + \";\";\r\n                },\r\n                \"continue\": function(label) {\r\n                        var out = \"continue\";\r\n                        if (label != null)\r\n                                out += \" \" + make_name(label);\r\n                        return out + \";\";\r\n                },\r\n                \"conditional\": function(co, th, el) {\r\n                        return add_spaces([ parenthesize(co, \"assign\", \"seq\", \"conditional\"), \"?\",\r\n                                            parenthesize(th, \"seq\"), \":\",\r\n                                            parenthesize(el, \"seq\") ]);\r\n                },\r\n                \"assign\": function(op, lvalue, rvalue) {\r\n                        if (op && op !== true) op += \"=\";\r\n                        else op = \"=\";\r\n                        return add_spaces([ make(lvalue), op, parenthesize(rvalue, \"seq\") ]);\r\n                },\r\n                \"dot\": function(expr) {\r\n                        var out = make(expr), i = 1;\r\n                        if (expr[0] == \"num\") {\r\n                                if (!/\\./.test(expr[1]))\r\n                                        out += \".\";\r\n                        } else if (needs_parens(expr))\r\n                                out = \"(\" + out + \")\";\r\n                        while (i < arguments.length)\r\n                                out += \".\" + make_name(arguments[i++]);\r\n                        return out;\r\n                },\r\n                \"call\": function(func, args) {\r\n                        var f = make(func);\r\n                        if (needs_parens(func))\r\n                                f = \"(\" + f + \")\";\r\n                        return f + \"(\" + add_commas(MAP(args, function(expr){\r\n                                return parenthesize(expr, \"seq\");\r\n                        })) + \")\";\r\n                },\r\n                \"function\": make_function,\r\n                \"defun\": make_function,\r\n                \"if\": function(co, th, el) {\r\n                        var out = [ \"if\", \"(\" + make(co) + \")\", el ? make_then(th) : make(th) ];\r\n                        if (el) {\r\n                                out.push(\"else\", make(el));\r\n                        }\r\n                        return add_spaces(out);\r\n                },\r\n                \"for\": function(init, cond, step, block) {\r\n                        var out = [ \"for\" ];\r\n                        init = (init != null ? make(init) : \"\").replace(/;*\\s*$/, \";\" + space);\r\n                        cond = (cond != null ? make(cond) : \"\").replace(/;*\\s*$/, \";\" + space);\r\n                        step = (step != null ? make(step) : \"\").replace(/;*\\s*$/, \"\");\r\n                        var args = init + cond + step;\r\n                        if (args == \"; ; \") args = \";;\";\r\n                        out.push(\"(\" + args + \")\", make(block));\r\n                        return add_spaces(out);\r\n                },\r\n                \"for-in\": function(vvar, key, hash, block) {\r\n                        return add_spaces([ \"for\", \"(\" +\r\n                                            (vvar ? make(vvar).replace(/;+$/, \"\") : make(key)),\r\n                                            \"in\",\r\n                                            make(hash) + \")\", make(block) ]);\r\n                },\r\n                \"while\": function(condition, block) {\r\n                        return add_spaces([ \"while\", \"(\" + make(condition) + \")\", make(block) ]);\r\n                },\r\n                \"do\": function(condition, block) {\r\n                        return add_spaces([ \"do\", make(block), \"while\", \"(\" + make(condition) + \")\" ]) + \";\";\r\n                },\r\n                \"return\": function(expr) {\r\n                        var out = [ \"return\" ];\r\n                        if (expr != null) out.push(make(expr));\r\n                        return add_spaces(out) + \";\";\r\n                },\r\n                \"binary\": function(operator, lvalue, rvalue) {\r\n                        var left = make(lvalue), right = make(rvalue);\r\n                        // XXX: I'm pretty sure other cases will bite here.\r\n                        //      we need to be smarter.\r\n                        //      adding parens all the time is the safest bet.\r\n                        if (member(lvalue[0], [ \"assign\", \"conditional\", \"seq\" ]) ||\r\n                            lvalue[0] == \"binary\" && PRECEDENCE[operator] > PRECEDENCE[lvalue[1]]) {\r\n                                left = \"(\" + left + \")\";\r\n                        }\r\n                        if (member(rvalue[0], [ \"assign\", \"conditional\", \"seq\" ]) ||\r\n                            rvalue[0] == \"binary\" && PRECEDENCE[operator] >= PRECEDENCE[rvalue[1]] &&\r\n                            !(rvalue[1] == operator && member(operator, [ \"&&\", \"||\", \"*\" ]))) {\r\n                                right = \"(\" + right + \")\";\r\n                        }\r\n                        else if (!beautify && options.inline_script && (operator == \"<\" || operator == \"<<\")\r\n                                 && rvalue[0] == \"regexp\" && /^script/i.test(rvalue[1])) {\r\n                                right = \" \" + right;\r\n                        }\r\n                        return add_spaces([ left, operator, right ]);\r\n                },\r\n                \"unary-prefix\": function(operator, expr) {\r\n                        var val = make(expr);\r\n                        if (!(expr[0] == \"num\" || (expr[0] == \"unary-prefix\" && !HOP(OPERATORS, operator + expr[1])) || !needs_parens(expr)))\r\n                                val = \"(\" + val + \")\";\r\n                        return operator + (jsp.is_alphanumeric_char(operator.charAt(0)) ? \" \" : \"\") + val;\r\n                },\r\n                \"unary-postfix\": function(operator, expr) {\r\n                        var val = make(expr);\r\n                        if (!(expr[0] == \"num\" || (expr[0] == \"unary-postfix\" && !HOP(OPERATORS, operator + expr[1])) || !needs_parens(expr)))\r\n                                val = \"(\" + val + \")\";\r\n                        return val + operator;\r\n                },\r\n                \"sub\": function(expr, subscript) {\r\n                        var hash = make(expr);\r\n                        if (needs_parens(expr))\r\n                                hash = \"(\" + hash + \")\";\r\n                        return hash + \"[\" + make(subscript) + \"]\";\r\n                },\r\n                \"object\": function(props) {\r\n                        if (props.length == 0)\r\n                                return \"{}\";\r\n                        return \"{\" + newline + with_indent(function(){\r\n                                return MAP(props, function(p){\r\n                                        if (p.length == 3) {\r\n                                                // getter/setter.  The name is in p[0], the arg.list in p[1][2], the\r\n                                                // body in p[1][3] and type (\"get\" / \"set\") in p[2].\r\n                                                return indent(make_function(p[0], p[1][2], p[1][3], p[2]));\r\n                                        }\r\n                                        var key = p[0], val = parenthesize(p[1], \"seq\");\r\n                                        if (options.quote_keys) {\r\n                                                key = encode_string(key);\r\n                                        } else if ((typeof key == \"number\" || !beautify && +key + \"\" == key)\r\n                                                   && parseFloat(key) >= 0) {\r\n                                                key = make_num(+key);\r\n                                        } else if (!is_identifier(key)) {\r\n                                                key = encode_string(key);\r\n                                        }\r\n                                        return indent(add_spaces(beautify && options.space_colon\r\n                                                                 ? [ key, \":\", val ]\r\n                                                                 : [ key + \":\", val ]));\r\n                                }).join(\",\" + newline);\r\n                        }) + newline + indent(\"}\");\r\n                },\r\n                \"regexp\": function(rx, mods) {\r\n                        return \"/\" + rx + \"/\" + mods;\r\n                },\r\n                \"array\": function(elements) {\r\n                        if (elements.length == 0) return \"[]\";\r\n                        return add_spaces([ \"[\", add_commas(MAP(elements, function(el){\r\n                                if (!beautify && el[0] == \"atom\" && el[1] == \"undefined\") return \"\";\r\n                                return parenthesize(el, \"seq\");\r\n                        })), \"]\" ]);\r\n                },\r\n                \"stat\": function(stmt) {\r\n                        return make(stmt).replace(/;*\\s*$/, \";\");\r\n                },\r\n                \"seq\": function() {\r\n                        return add_commas(MAP(slice(arguments), make));\r\n                },\r\n                \"label\": function(name, block) {\r\n                        return add_spaces([ make_name(name), \":\", make(block) ]);\r\n                },\r\n                \"with\": function(expr, block) {\r\n                        return add_spaces([ \"with\", \"(\" + make(expr) + \")\", make(block) ]);\r\n                },\r\n                \"atom\": function(name) {\r\n                        return make_name(name);\r\n                }\r\n        }, function(){ return make(ast) });\r\n\r\n        // The squeezer replaces \"block\"-s that contain only a single\r\n        // statement with the statement itself; technically, the AST\r\n        // is correct, but this can create problems when we output an\r\n        // IF having an ELSE clause where the THEN clause ends in an\r\n        // IF *without* an ELSE block (then the outer ELSE would refer\r\n        // to the inner IF).  This function checks for this case and\r\n        // adds the block brackets if needed.\r\n        function make_then(th) {\r\n                if (th[0] == \"do\") {\r\n                        // https://github.com/mishoo/UglifyJS/issues/#issue/57\r\n                        // IE croaks with \"syntax error\" on code like this:\r\n                        //     if (foo) do ... while(cond); else ...\r\n                        // we need block brackets around do/while\r\n                        return make_block([ th ]);\r\n                }\r\n                var b = th;\r\n                while (true) {\r\n                        var type = b[0];\r\n                        if (type == \"if\") {\r\n                                if (!b[3])\r\n                                        // no else, we must add the block\r\n                                        return make([ \"block\", [ th ]]);\r\n                                b = b[3];\r\n                        }\r\n                        else if (type == \"while\" || type == \"do\") b = b[2];\r\n                        else if (type == \"for\" || type == \"for-in\") b = b[4];\r\n                        else break;\r\n                }\r\n                return make(th);\r\n        };\r\n\r\n        function make_function(name, args, body, keyword) {\r\n                var out = keyword || \"function\";\r\n                if (name) {\r\n                        out += \" \" + make_name(name);\r\n                }\r\n                out += \"(\" + add_commas(MAP(args, make_name)) + \")\";\r\n                return add_spaces([ out, make_block(body) ]);\r\n        };\r\n\r\n        function must_has_semicolon(node) {\r\n                switch (node[0]) {\r\n                    case \"with\":\r\n                    case \"while\":\r\n                        return empty(node[2]); // `with' or `while' with empty body?\r\n                    case \"for\":\r\n                    case \"for-in\":\r\n                        return empty(node[4]); // `for' with empty body?\r\n                    case \"if\":\r\n                        if (empty(node[2]) && !node[3]) return true; // `if' with empty `then' and no `else'\r\n                        if (node[3]) {\r\n                                if (empty(node[3])) return true; // `else' present but empty\r\n                                return must_has_semicolon(node[3]); // dive into the `else' branch\r\n                        }\r\n                        return must_has_semicolon(node[2]); // dive into the `then' branch\r\n                }\r\n        };\r\n\r\n        function make_block_statements(statements, noindent) {\r\n                for (var a = [], last = statements.length - 1, i = 0; i <= last; ++i) {\r\n                        var stat = statements[i];\r\n                        var code = make(stat);\r\n                        if (code != \";\") {\r\n                                if (!beautify && i == last && !must_has_semicolon(stat)) {\r\n                                        code = code.replace(/;+\\s*$/, \"\");\r\n                                }\r\n                                a.push(code);\r\n                        }\r\n                }\r\n                return noindent ? a : MAP(a, indent);\r\n        };\r\n\r\n        function make_switch_block(body) {\r\n                var n = body.length;\r\n                if (n == 0) return \"{}\";\r\n                return \"{\" + newline + MAP(body, function(branch, i){\r\n                        var has_body = branch[1].length > 0, code = with_indent(function(){\r\n                                return indent(branch[0]\r\n                                              ? add_spaces([ \"case\", make(branch[0]) + \":\" ])\r\n                                              : \"default:\");\r\n                        }, 0.5) + (has_body ? newline + with_indent(function(){\r\n                                return make_block_statements(branch[1]).join(newline);\r\n                        }) : \"\");\r\n                        if (!beautify && has_body && i < n - 1)\r\n                                code += \";\";\r\n                        return code;\r\n                }).join(newline) + newline + indent(\"}\");\r\n        };\r\n\r\n        function make_block(statements) {\r\n                if (!statements) return \";\";\r\n                if (statements.length == 0) return \"{}\";\r\n                return \"{\" + newline + with_indent(function(){\r\n                        return make_block_statements(statements).join(newline);\r\n                }) + newline + indent(\"}\");\r\n        };\r\n\r\n        function make_1vardef(def) {\r\n                var name = def[0], val = def[1];\r\n                if (val != null)\r\n                        name = add_spaces([ make_name(name), \"=\", parenthesize(val, \"seq\") ]);\r\n                return name;\r\n        };\r\n\r\n};\r\n\r\nfunction split_lines(code, max_line_length) {\r\n        var splits = [ 0 ];\r\n        jsp.parse(function(){\r\n                var next_token = jsp.tokenizer(code);\r\n                var last_split = 0;\r\n                var prev_token;\r\n                function current_length(tok) {\r\n                        return tok.pos - last_split;\r\n                };\r\n                function split_here(tok) {\r\n                        last_split = tok.pos;\r\n                        splits.push(last_split);\r\n                };\r\n                function custom(){\r\n                        var tok = next_token.apply(this, arguments);\r\n                        out: {\r\n                                if (prev_token) {\r\n                                        if (prev_token.type == \"keyword\") break out;\r\n                                }\r\n                                if (current_length(tok) > max_line_length) {\r\n                                        switch (tok.type) {\r\n                                            case \"keyword\":\r\n                                            case \"atom\":\r\n                                            case \"name\":\r\n                                            case \"punc\":\r\n                                                split_here(tok);\r\n                                                break out;\r\n                                        }\r\n                                }\r\n                        }\r\n                        prev_token = tok;\r\n                        return tok;\r\n                };\r\n                custom.context = function() {\r\n                        return next_token.context.apply(this, arguments);\r\n                };\r\n                return custom;\r\n        }());\r\n        return splits.map(function(pos, i){\r\n                return code.substring(pos, splits[i + 1] || code.length);\r\n        }).join(\"\\n\");\r\n};\r\n\r\n/* -----[ Utilities ]----- */\r\n\r\nfunction repeat_string(str, i) {\r\n        if (i <= 0) return \"\";\r\n        if (i == 1) return str;\r\n        var d = repeat_string(str, i >> 1);\r\n        d += d;\r\n        if (i & 1) d += str;\r\n        return d;\r\n};\r\n\r\nfunction defaults(args, defs) {\r\n        var ret = {};\r\n        if (args === true)\r\n                args = {};\r\n        for (var i in defs) if (HOP(defs, i)) {\r\n                ret[i] = (args && HOP(args, i)) ? args[i] : defs[i];\r\n        }\r\n        return ret;\r\n};\r\n\r\nfunction is_identifier(name) {\r\n        return /^[a-z_$][a-z0-9_$]*$/i.test(name)\r\n                && name != \"this\"\r\n                && !HOP(jsp.KEYWORDS_ATOM, name)\r\n                && !HOP(jsp.RESERVED_WORDS, name)\r\n                && !HOP(jsp.KEYWORDS, name);\r\n};\r\n\r\nfunction HOP(obj, prop) {\r\n        return Object.prototype.hasOwnProperty.call(obj, prop);\r\n};\r\n\r\n// some utilities\r\n\r\nvar MAP;\r\n\r\n(function(){\r\n        MAP = function(a, f, o) {\r\n                var ret = [], top = [], i;\r\n                function doit() {\r\n                        var val = f.call(o, a[i], i);\r\n                        if (val instanceof AtTop) {\r\n                                val = val.v;\r\n                                if (val instanceof Splice) {\r\n                                        top.push.apply(top, val.v);\r\n                                } else {\r\n                                        top.push(val);\r\n                                }\r\n                        }\r\n                        else if (val != skip) {\r\n                                if (val instanceof Splice) {\r\n                                        ret.push.apply(ret, val.v);\r\n                                } else {\r\n                                        ret.push(val);\r\n                                }\r\n                        }\r\n                };\r\n                if (a instanceof Array) for (i = 0; i < a.length; ++i) doit();\r\n                else for (i in a) if (HOP(a, i)) doit();\r\n                return top.concat(ret);\r\n        };\r\n        MAP.at_top = function(val) { return new AtTop(val) };\r\n        MAP.splice = function(val) { return new Splice(val) };\r\n        var skip = MAP.skip = {};\r\n        function AtTop(val) { this.v = val };\r\n        function Splice(val) { this.v = val };\r\n})();\r\n\r\n/* -----[ Exports ]----- */\r\n/*\r\nexports.ast_walker = ast_walker;\r\nexports.ast_mangle = ast_mangle;\r\nexports.ast_squeeze = ast_squeeze;\r\nexports.ast_lift_variables = ast_lift_variables;\r\nexports.gen_code = gen_code;\r\nexports.ast_add_scope = ast_add_scope;\r\nexports.set_logger = function(logger) { warn = logger };\r\nexports.make_string = make_string;\r\nexports.split_lines = split_lines;\r\nexports.MAP = MAP;\r\n\r\n// keep this last!\r\nexports.ast_squeeze_more = require(\"./squeeze-more\").ast_squeeze_more;\r\n*/\r\n\n/* @license\r\n\r\n  Copyright (c) 2011 Lauri Paimen <lauri@paimen.info>\r\n  Copyright (c) 2015 Pavel Vasev <pavel.vasev@gmail.com> - initial\r\n                     and working import implementation.\r\n\r\n  Redistribution and use in source and binary forms, with or without\r\n  modification, are permitted provided that the following conditions\r\n  are met:\r\n\r\n      * Redistributions of source code must retain the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer.\r\n\r\n      * Redistributions in binary form must reproduce the above\r\n        copyright notice, this list of conditions and the following\r\n        disclaimer in the documentation and/or other materials\r\n        provided with the distribution.\r\n\r\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AS IS AND ANY\r\n  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\r\n  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\r\n  OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\r\n  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\r\n  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\r\n  SUCH DAMAGE.\r\n*/\r\n\r\n\r\n/*\r\n * Misc classes for importing files.\r\n *\r\n * Currently the file contains a lot of unused code for future\r\n * purposes. Most of it can be rewritten as there is now Javascript parser\r\n * available.\r\n *\r\n * Exports:\r\n *\r\n * - getUrlContents(url) -- get URL contents. Returns contents or false in\r\n *   error.\r\n *\r\n * - Some other stuff not currently used/needed.\r\n *\r\n *\r\n */\r\n(function() {\r\n\r\nfunction parseQML(file) {\r\n    var contents = getUrlContents(file + \".js\");\r\n    if (contents) {\r\n        console.log(\"Using pre-processed content for \" + file);\r\n        return new Function(\"return \" + contents)();\r\n    } else {\r\n        contents = getUrlContents(file);\r\n        if (contents) {\r\n            // todo: use parser/compiler here\r\n            console.log(\"todo: add parser to import.js \" + file);\r\n        } else {\r\n            console.log(\"warn: Fetch failed for \" + file);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Get URL contents. EXPORTED.\r\n * @param url {String} Url to fetch.\r\n * @param skipExceptions {bool} when turned on, ignore exeptions and return false. This feature is used by readQmlDir.\r\n * @private\r\n * @return {mixed} String of contents or false in errors.\r\n *\r\n * Q1: can someone provide use-case when we need caching here?\r\n * A1:\r\n * Q2: should errors be cached? (now they aren't)\r\n * A2:\r\n \r\n * Q3: split getUrlContents into: getUrlContents, getUrlContentsWithCaching, getUrlContentsWithoutErrors..\r\n */\r\ngetUrlContents = function (url, skipExceptions) {\r\n    if (typeof urlContentCache[url] == 'undefined') {\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.open(\"GET\", url, false);\r\n\r\n      if (skipExceptions)\r\n        { try { xhr.send(null); } catch (e) { return false; } } /* it is OK to not have logging here, because DeveloperTools already will have red log record */\r\n      else\r\n        xhr.send(null);\r\n\r\n      if (xhr.status != 200 && xhr.status != 0) { // 0 if accessing with file://\r\n          console.log(\"Retrieving \" + url + \" failed: \" + xhr.responseText, xhr);\r\n          return false;\r\n      }\r\n      urlContentCache[url] = xhr.responseText;\r\n    }\r\n    return urlContentCache[url];\r\n}\r\nif (typeof global.urlContentCache == 'undefined')\r\n  global.urlContentCache = {};\r\n\r\n/**\r\n * Read qmldir spec file at directory. EXPORTED.\r\n * @param url Url of the directory\r\n * @return {Object} Object, where .internals lists qmldir internal references\r\n *                          and .externals lists qmldir external references.\r\n */\r\n\r\n/*  Note on how importing works.\r\n\r\n   * parseQML gives us `tree.$imports` variable, which contains information from `import` statements.\r\n\r\n   * After each call to parseQML, we call engine.loadImports(tree.$imports).\r\n     It in turn invokes readQmlDir() calls for each import, with respect to current component base path and engine.importPathList().\r\n\r\n   * We keep all component names from all qmldir files in global variable `engine.qmldir`.\r\n   \r\n   * In construct() function, we use `engine.qmldir` for component url lookup.\r\n\r\n   Reference import info: http://doc.qt.io/qt-5/qtqml-syntax-imports.html \r\n   Also please look at notes and TODO's in qtcore.js::loadImports() and qtcore.js::construct() methods.\r\n*/\r\n \r\nreadQmlDir = function (url) {\r\n    // in case 'url' is empty, do not attach \"/\"\r\n    // Q1: when this happen?\r\n    var qmldirFileUrl = url.length > 0 ? (url + \"/qmldir\") : \"qmldir\";\r\n\r\n    var qmldir = getUrlContents( qmldirFileUrl, true), // loading url contents with skipping errors\r\n        lines,\r\n        line,\r\n        internals = {},\r\n        externals = {},\r\n        match,\r\n        i;\r\n\r\n    if (qmldir === false) {\r\n        return false;\r\n    }\r\n\r\n    // we have to check for \"://\" \r\n    // In that case, item path is meant to be absolute, and we have no need to prefix it with base url\r\n    function makeurl( path ) {\r\n       if (path.indexOf(\"://\") > 0) return path;\r\n       return url + \"/\" + path;\r\n    }\r\n\r\n    lines = qmldir.split(/\\r?\\n/);\r\n    for (i = 0; i < lines.length; i++) {\r\n        // trim\r\n        line = lines[i].replace(/^\\s+|\\s+$/g, \"\");\r\n        if (!line.length || line[0] == \"#\") {\r\n            // Empty line or comment\r\n            continue;\r\n        }\r\n        match = line.split(/\\s+/);\r\n        if (match.length == 2 || match.length == 3) {\r\n            if (match[0] == \"plugin\") {\r\n                console.log(url + \": qmldir plugins are not supported!\");\r\n            } else if (match[0] == \"internal\") {\r\n                internals[match[1]] = { url: makeurl( match[2] ) };\r\n            } else {\r\n                if (match.length == 2) {\r\n                    externals[match[0]] = { url: makeurl( match[1] ) };\r\n                } else {\r\n                    externals[match[0]] = { url: makeurl( match[2] ), version: match[1] };\r\n                }\r\n            }\r\n        } else {\r\n            console.log(url + \": unmatched: \" + line);\r\n        }\r\n    }\r\n    return {internals: internals, externals: externals};\r\n}\r\n\r\n\r\n/**\r\n * Import and parse javascript file. EXPORTED.\r\n * @return {object} Object which has \"var\"s and functions from file as keys, or\r\n *         undefined if operation fails\r\n */\r\nimportJs = function (filename) {\r\n\r\n    // todo: .pragma support\r\n\r\n    // Exports as follow:\r\n    // function a() { function b() {} } exports only a.\r\n    // var a = function b(){} exports a and b. Not sure if b should be exported.\r\n    //                        rare case, however.\r\n    // var a = function(){} exports only a.\r\n\r\n    var i,\r\n        src = getUrlContents(filename),\r\n        exports = [];\r\n\r\n    if (src === false) {\r\n        return;\r\n    }\r\n\r\n    // Analyse source\r\n    exports = readExports(src);\r\n    console.log(filename + \" exports:\", exports);\r\n\r\n    // Wrap source to function to retain private scope of the variables.\r\n    // Make that function return an object.\r\n    // That object contains getters and setters for exported stuff.\r\n    // Add () to execute the function.\r\n    src += \";return {\";\r\n    for (i = 0; i < exports.length; i++) {\r\n        // create getters and setters for properties\r\n        // keeps variables synced better\r\n        src += \"get \" + exports[i] + \"(){return \" + exports[i] + \"},\";\r\n        src += \"set \" + exports[i] + \"(){\" + exports[i] + \" = arguments[0]},\";\r\n        // without getters and setters:\r\n        // src += exports[i] + \":\" + exports[i] + \",\";\r\n    }\r\n    src += \"}\";\r\n\r\n    // evaluate source to get the object.\r\n    return new Function(src)();\r\n}\r\n\r\n/**\r\n * Read code for variables and functions which are exported to qml\r\n * @private\r\n * @param src source code\r\n * @return Array Array of local variable names to export\r\n */\r\nfunction readExports(src) {\r\n\r\n    // Eat src until str is found. Recurse if recursive set.\r\n    function eatUntil(src, str, recursive) {\r\n        var i;\r\n        if (!recursive) {\r\n            i = src.indexOf(str);\r\n            if (i == -1) {\r\n                console.log(\"eof encountered, \" + str + \" expected.\");\r\n                return \"\";\r\n            }\r\n        } else {\r\n            i = 0;\r\n            while (i < src.length) {\r\n                if (src.substr(i, str.length) == str) {\r\n                    break;\r\n                }\r\n                switch(src[i]) {\r\n                 case \"{\": // inner block\r\n                    src = eatUntil(src.substr(i + 1), \"}\", true );\r\n                    i = 0;\r\n                    break;\r\n                 case \"(\": // Parentheses\r\n                    src = eatUntil(src.substr(i + 1), \")\", true );\r\n                    i = 0;\r\n                    break;\r\n                 case \"/\": // Possible beginning of comment\r\n                    if (src[i + 1] == \"/\") {\r\n                        src = eatUntil(src.substr(i + 1), \"\\n\");\r\n                        i = 0;\r\n                    } else if (src[i + 1] == \"*\") {\r\n                        src = eatUntil(src.substr(i + 1), \"*/\");\r\n                        i = 0;\r\n                    } else {\r\n                        i++;\r\n                    }\r\n                    break;\r\n                 default:\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n        return src.substr(i + str.length);\r\n    }\r\n\r\n    // Strip comments and code blocks from the input source\r\n    // This is quite similar with eatCodeBlock but still a bit different.\r\n    // If either section has bugs, check the other section, too!\r\n    var i = 0,\r\n        // Code without blocks and comments\r\n        semi = \"\",\r\n        // todo: these doesn't match with exports containing \"$\"\r\n        matcher = /var\\s+\\w+|function\\s+\\w+/g,\r\n        matches,\r\n        tmp,\r\n        exports = [];\r\n\r\n    while (i < src.length) {\r\n        switch (src[i]) {\r\n         case \"{\": // code block\r\n            src = eatUntil(src.substr(i + 1), \"}\", true);\r\n            i = 0;\r\n            break;\r\n         case \"(\": // parentheses\r\n            src = eatUntil(src.substr(i + 1), \")\", true);\r\n            i = 0;\r\n            break;\r\n         case \"/\": // comment\r\n            if (src[i + 1] == \"/\") {\r\n                src = eatUntil(src.substr(i + 1), \"\\n\");\r\n                i = 0;\r\n            } else if (src[i + 1] == \"*\") {\r\n                src = eatUntil(src.substr(i + 1), \"*/\");\r\n                i = 0;\r\n            } else {\r\n                semi += src[i];\r\n                i++;\r\n            }\r\n            break;\r\n        default:\r\n            semi += src[i];\r\n            i++;\r\n            break;\r\n        }\r\n    }\r\n\r\n    // Search exports from semi\r\n    matches = semi.match(matcher);\r\n\r\n    // matches now contain strings defined in matcher. Re-match these to get\r\n    // exports. Matching can be done in one step, but I couldn't get it working\r\n    // so bear this extra step.\r\n    for (i = 0; i < matches.length; i++) {\r\n        tmp = /\\w+\\s+(\\w+)/.exec(matches[i]);\r\n        if (tmp) {\r\n            exports.push(tmp[1]);\r\n        }\r\n    }\r\n    return exports;\r\n}\r\n\r\n})();\r\n\nglobal.Easing = {\r\n  Linear: 1,\r\n  InQuad: 2,          OutQuad: 3,     InOutQuad: 4,           OutInQuad: 5,\r\n  InCubic: 6,         OutCubic: 7,    InOutCubic: 8,          OutInCubic: 9,\r\n  InQuart: 10,        OutQuart: 11,   InOutQuart: 12,         OutInQuart: 13,\r\n  InQuint: 14,        OutQuint: 15,   InOutQuint: 16,         OutInQuint: 17,\r\n  InSine: 18,         OutSine: 19,    InOutSine: 20,          OutInSine: 21,\r\n  InExpo: 22,         OutExpo: 23,    InOutExpo: 24,          OutInExpo: 25,\r\n  InCirc: 26,         OutCirc: 27,    InOutCirc: 28,          OutInCirc: 29,\r\n  InElastic: 30,      OutElastic: 31, InOutElastic: 32,       OutInElastic: 33,\r\n  InBack: 34,         OutBack: 35,    InOutBack: 36,          OutInBack: 37,\r\n  InBounce: 38,       OutBounce: 39,  InOutBounce: 40,        OutInBounce: 41\r\n}\r\n\nglobal.Font = {\r\n  // Capitalization\r\n  MixedCase: \"none\",\r\n  AllUppercase: \"uppercase\",\r\n  AllLowercase: \"lowercase\",\r\n  SmallCaps: \"smallcaps\",\r\n  Capitalize: \"capitalize\",\r\n  // Weight\r\n  Light: \"lighter\",\r\n  Normal: \"normal\",\r\n  DemiBold: \"600\",\r\n  Bold: \"bold\",\r\n  Black: \"bolder\",\r\n}\r\n\nglobal.qrc = {\r\n  includesFile: function(path) {\r\n    return typeof qrc[path] != 'undefined';\r\n  }\r\n};\r\n\nglobal.Qt = {\r\n  rgba: function(r,g,b,a) {\r\n    return \"rgba(\"\r\n      + Math.round(r * 255) + \",\"\r\n      + Math.round(g * 255) + \",\"\r\n      + Math.round(b * 255) + \",\"\r\n      + a + \")\";\r\n  },\r\n  openUrlExternally: function(url) {\r\n    page = window.open(url, '_blank');\r\n    page.focus();\r\n  },\r\n  // Load file, parse and construct as Component (.qml)\r\n  //FIXME: remove the parameter executionContext and get it autonomously.\r\n  createComponent: function(name, executionContext) {\r\n    if (name in engine.components)\r\n        return engine.components[name];\r\n\r\n    var nameIsUrl = name.indexOf(\"//\") >= 0 || name.indexOf(\":/\") >= 0; // e.g. // in protocol, or :/ in disk urls (D:/)\r\n\r\n    // Do not perform path lookups if name starts with @ sign.\r\n    // This is used when we load components from qmldir files\r\n    // because in that case we do not need any lookups.\r\n    if (name.length > 0 && name[0] == \"@\") {\r\n      nameIsUrl = true;\r\n      name = name.substr( 1,name.length-1 );\r\n    }\r\n\r\n    var file = nameIsUrl ? name : engine.$basePath + name;\r\n\r\n    var src = getUrlContents(file, true);\r\n    // if failed to load, and provided name is not direct url, try to load from dirs in importPathList()\r\n    if (src==false && !nameIsUrl) {\r\n      var moredirs = engine.importPathList();\r\n\r\n      for (var i=0; i<moredirs.length; i++) {\r\n        file = moredirs[i] + name;\r\n        src = getUrlContents(file, true);\r\n        if (src !== false) break;\r\n      }\r\n    }\r\n\r\n    // When createComponent failed to load content from all probable sources, it should return undefined.\r\n    if (src === false)\r\n      return undefined;\r\n\r\n    var tree = parseQML(src);\r\n\r\n    if (tree.$children.length !== 1)\r\n        console.error(\"A QML component must only contain one root element!\");\r\n\r\n    var component = new QMLComponent({ object: tree, context: executionContext });\r\n    component.$basePath = engine.extractBasePath( file );\r\n    component.$imports = tree.$imports;\r\n    component.$file = file; // just for debugging\r\n\r\n    engine.loadImports( tree.$imports,component.$basePath );\r\n\r\n    engine.components[name] = component;\r\n    return component;\r\n  },\r\n\r\n    // Returns url resolved relative to the URL of the caller.\r\n  // http://doc.qt.io/qt-5/qml-qtqml-qt.html#resolvedUrl-method\r\n  resolvedUrl: function(url)\r\n  {\r\n    if (!url || !url.substr) // url is not a string object\r\n      return url;\r\n\r\n    // Must check for cases: D:/, file://, http://, or slash at the beginning. \r\n    // This means the url is absolute => we have to skip processing (except removing dot segments).\r\n    if (url == \"\" || url.indexOf(\":/\") != -1 || url.indexOf(\"/\") == 0)\r\n      return engine.removeDotSegments( url );\r\n\r\n    // we have $basePath variable placed in context of \"current\" document\r\n    // this is done in construct() function\r\n\r\n    // let's go to the callers and inspect their arguments\r\n    // The 2-nd argument of the callers we hope is context object\r\n    // e.g. see calling signature of bindings and signals\r\n\r\n    // Actually Qt cpp code is doing the same; the difference is that they know calling context\r\n    // https://qt.gitorious.org/qt/qtdeclarative/source/eeaba26596d447c531dfac9d6e6bf5cfe4537813:src/qml/qml/v8/qqmlbuiltinfunctions.cpp#L833\r\n\r\n    var detectedBasePath = \"\";\r\n    var currentCaller = Qt.resolvedUrl.caller;\r\n    var maxcount = 10;\r\n    while (maxcount-- > 0 && currentCaller) {\r\n      if (currentCaller.arguments[1] && currentCaller.arguments[1][\"$basePath\"])\r\n      {\r\n        detectedBasePath = currentCaller.arguments[1][\"$basePath\"];\r\n        break;\r\n      }\r\n      currentCaller = currentCaller.caller;\r\n    }\r\n\r\n    return engine.removeDotSegments( detectedBasePath + url )\r\n  },\r\n\r\n  // Buttons masks\r\n  LeftButton: 1,\r\n  RightButton: 2,\r\n  MiddleButton: 4,\r\n  // Modifiers masks\r\n  NoModifier: 0,\r\n  ShiftModifier: 1,\r\n  ControlModifier: 2,\r\n  AltModifier: 4,\r\n  MetaModifier: 8,\r\n  KeypadModifier: 16, // Note: Not available in web\r\n  // Layout directions\r\n  LeftToRight: 0,\r\n  RightToLeft: 1,\r\n  // Orientations\r\n  Vertical: 0,\r\n  Horizontal: 1,\r\n  // Keys\r\n  Key_Escape: 27,\r\n  Key_Tab: 9,\r\n  Key_Backtab: 245,\r\n  Key_Backspace: 8,\r\n  Key_Return: 13,\r\n  Key_Enter: 13,\r\n  Key_Insert: 45,\r\n  Key_Delete: 46,\r\n  Key_Pause: 19,\r\n  Key_Print: 42,\r\n  Key_SysReq: 0,\r\n  Key_Clear: 12,\r\n  Key_Home: 36,\r\n  Key_End: 35,\r\n  Key_Left: 37,\r\n  Key_Up: 38,\r\n  Key_Right: 39,\r\n  Key_Down: 40,\r\n  Key_PageUp: 33,\r\n  Key_PageDown: 34,\r\n  Key_Shift: 16,\r\n  Key_Control: 17,\r\n  Key_Meta: 91,\r\n  Key_Alt: 18,\r\n  Key_AltGr: 0,\r\n  Key_CapsLock: 20,\r\n  Key_NumLock: 144,\r\n  Key_ScrollLock: 145,\r\n  Key_F1: 112, Key_F2: 113, Key_F3: 114, Key_F4: 115, Key_F5: 116, Key_F6: 117, Key_F7: 118, Key_F8: 119, Key_F9: 120, Key_F10: 121, Key_F11: 122, Key_F12: 123, Key_F13: 124, Key_F14: 125, Key_F15: 126, Key_F16: 127, Key_F17: 128, Key_F18: 129, Key_F19: 130, Key_F20: 131, Key_F21: 132, Key_F22: 133, Key_F23: 134, Key_F24: 135, Key_F25: 0, Key_F26: 0, Key_F27: 0, Key_F28: 0, Key_F29: 0, Key_F30: 0, Key_F31: 0, Key_F32: 0, Key_F33: 0, Key_F34: 0, Key_F35: 0,\r\n  Key_Super_L: 0,\r\n  Key_Super_R: 0,\r\n  Key_Menu: 0,\r\n  Key_Hyper_L: 0,\r\n  Key_Hyper_R: 0,\r\n  Key_Help: 6,\r\n  Key_Direction_L: 0,\r\n  Key_Direction_R: 0,\r\n  Key_Space: 32,\r\n  Key_Any:   32,\r\n  Key_Exclam: 161,\r\n  Key_QuoteDbl: 162,\r\n  Key_NumberSign: 163,\r\n  Key_Dollar: 164,\r\n  Key_Percent: 165,\r\n  Key_Ampersant: 166,\r\n  Key_Apostrophe: 222,\r\n  Key_ParenLeft: 168,\r\n  Key_ParenRight: 169,\r\n  Key_Asterisk: 170,\r\n  Key_Plus: 171,\r\n  Key_Comma: 188,\r\n  Key_Minus: 173,\r\n  Key_Period: 190,\r\n  Key_Slash: 191,\r\n  Key_0: 48, Key_1: 49, Key_2: 50, Key_3: 51, Key_4: 52, Key_5: 53, Key_6: 54, Key_7: 55, Key_8: 56, Key_9: 57,\r\n  Key_Colon: 58,\r\n  Key_Semicolon: 59,\r\n  Key_Less: 60,\r\n  Key_Equal: 61,\r\n  Key_Greater: 62,\r\n  Key_Question: 63,\r\n  Key_At: 64,\r\n  Key_A: 65, Key_B: 66, Key_C: 67, Key_D: 68, Key_E: 69, Key_F: 70, Key_G: 71, Key_H: 72, Key_I: 73, Key_J: 74, Key_K: 75, Key_L: 76, Key_M: 77, Key_N: 78, Key_O: 79, Key_P: 80, Key_Q: 81, Key_R: 82, Key_S: 83, Key_T: 84, Key_U: 85, Key_V: 86, Key_W: 87, Key_X: 88, Key_Y: 89, Key_Z: 90,\r\n  Key_BracketLeft: 219,\r\n  Key_Backslash: 220,\r\n  Key_BracketRight: 221,\r\n  Key_AsciiCircum: 160,\r\n  Key_Underscore: 167,\r\n  Key_QuoteLeft: 0,\r\n  Key_BraceLeft: 174,\r\n  Key_Bar: 172,\r\n  Key_BraceRight: 175,\r\n  Key_AsciiTilde: 176,\r\n  Key_Back: 0,\r\n  Key_Forward: 0,\r\n  Key_Stop: 0,\r\n  Key_VolumeDown: 182,\r\n  Key_VolumeUp: 183,\r\n  Key_VolumeMute: 181,\r\n  Key_Yes: 0,\r\n  Key_multiply: 106,\r\n  Key_add: 107,\r\n  Key_substract: 109,\r\n  Key_divide: 111,\r\n  Key_News: 0,\r\n  Key_OfficeHome: 0,\r\n  Key_Option: 0,\r\n  Key_Paste: 0,\r\n  Key_Phone: 0,\r\n  Key_Calendar: 0,\r\n  Key_Reply: 0,\r\n  Key_Reload: 0,\r\n  Key_RotateWindows: 0,\r\n  Key_RotationPB: 0,\r\n  Key_RotationKB: 0,\r\n  Key_Save: 0,\r\n  Key_Send: 0,\r\n  Key_Spell: 0,\r\n  Key_SplitScreen: 0,\r\n  Key_Support: 0,\r\n  Key_TaskPane: 0,\r\n  Key_Terminal: 0,\r\n  Key_Tools: 0,\r\n  Key_Travel: 0,\r\n  Key_Video: 0,\r\n  Key_Word: 0,\r\n  Key_Xfer: 0,\r\n  Key_ZoomIn: 0,\r\n  Key_ZoomOut: 0,\r\n  Key_Away: 0,\r\n  Key_Messenger: 0,\r\n  Key_WebCam: 0,\r\n  Key_MailForward: 0,\r\n  Key_Pictures: 0,\r\n  Key_Music: 0,\r\n  Key_Battery: 0,\r\n  Key_Bluetooth: 0,\r\n  Key_WLAN: 0,\r\n  Key_UWB: 0,\r\n  Key_AudioForward: 0,\r\n  Key_AudioRepeat: 0,\r\n  Key_AudioRandomPlay: 0,\r\n  Key_Subtitle: 0,\r\n  Key_AudioCycleTrack: 0,\r\n  Key_Time: 0,\r\n  Key_Hibernate: 0,\r\n  Key_View: 0,\r\n  Key_TopMenu: 0,\r\n  Key_PowerDown: 0,\r\n  Key_Suspend: 0,\r\n  Key_ContrastAdjust: 0,\r\n  Key_MediaLast: 0,\r\n  Key_unknown: -1,\r\n  Key_Call: 0,\r\n  Key_Camera: 0,\r\n  Key_CameraFocus: 0,\r\n  Key_Context1: 0,\r\n  Key_Context2: 0,\r\n  Key_Context3: 0,\r\n  Key_Context4: 0,\r\n  Key_Flip: 0,\r\n  Key_Hangup: 0,\r\n  Key_No: 0,\r\n  Key_Select: 93,\r\n  Key_Yes: 0,\r\n  Key_ToggleCallHangup: 0,\r\n  Key_VoiceDial: 0,\r\n  Key_LastNumberRedial: 0,\r\n  Key_Execute: 43,\r\n  Key_Printer: 42,\r\n  Key_Play: 250,\r\n  Key_Sleep: 95,\r\n  Key_Zoom: 251,\r\n  Key_Cancel: 3\r\n}\r\n\n/**\r\n * Creates and returns a signal with the parameters specified in @p params.\r\n *\r\n * @param params Array with the parameters of the signal. Each element has to be\r\n *               an object with the two properties \"type\" and \"name\" specifying\r\n *               the datatype of the parameter and its name. The type is\r\n *               currently ignored.\r\n * @param options Options that allow finetuning of the signal.\r\n */\r\nglobal.Signal = function Signal(params, options) {\r\n    options = options || {};\r\n    var connectedSlots = [];\r\n    var obj = options.obj\r\n\r\n    var signal = function() {\r\n        for (var i in connectedSlots)\r\n            try {\r\n                connectedSlots[i].slot.apply(connectedSlots[i].thisObj, arguments);\r\n            } catch(err) {\r\n                console.log(err.message);\r\n            }\r\n    };\r\n    signal.parameters = params || [];\r\n    signal.connect = function() {\r\n        if (arguments.length == 1)\r\n            connectedSlots.push({thisObj: global, slot: arguments[0]});\r\n        else if (typeof arguments[1] == 'string' || arguments[1] instanceof String) {\r\n            if (arguments[0].$tidyupList && arguments[0] !== obj)\r\n                arguments[0].$tidyupList.push(this);\r\n            connectedSlots.push({thisObj: arguments[0], slot: arguments[0][arguments[1]]});\r\n        } else {\r\n            if (arguments[0].$tidyupList && (!obj || (arguments[0] !== obj && arguments[0] !== obj.$parent)))\r\n                arguments[0].$tidyupList.push(this);\r\n            connectedSlots.push({thisObj: arguments[0], slot: arguments[1]});\r\n        }\r\n\r\n        // Notify object of connect\r\n        if (options.obj && options.obj.$connectNotify) {\r\n            options.obj.$connectNotify(options);\r\n        }\r\n\r\n    }\r\n    signal.disconnect = function() {\r\n        var callType = arguments.length == 1 ? (arguments[0] instanceof Function ? 1 : 2)\r\n                       : (typeof arguments[1] == 'string' || arguments[1] instanceof String) ? 3 : 4;\r\n        for (var i = 0; i < connectedSlots.length; i++) {\r\n            var item = connectedSlots[i];\r\n            if ((callType == 1 && item.slot == arguments[0])\r\n                || (callType == 2 && item.thisObj == arguments[0])\r\n                || (callType == 3 && item.thisObj == arguments[0] && item.slot == arguments[0][arguments[1]])\r\n                || (item.thisObj == arguments[0] && item.slot == arguments[1])\r\n            ) {\r\n                if (item.thisObj)\r\n                    item.thisObj.$tidyupList.splice(item.thisObj.$tidyupList.indexOf(this), 1);\r\n                connectedSlots.splice(i, 1);\r\n                i--; // We have removed an item from the list so the indexes shifted one backwards\r\n            }\r\n        }\r\n\r\n        // Notify object of disconnect\r\n        if (options.obj && options.obj.$disconnectNotify) {\r\n            options.obj.$disconnectNotify(options);\r\n        }\r\n    }\r\n    signal.isConnected = function() {\r\n        var callType = arguments.length == 1 ? 1\r\n                       : (typeof arguments[1] == 'string' || arguments[1] instanceof String) ? 2 : 3;\r\n        for (var i in connectedSlots) {\r\n            var item = connectedSlots[i];\r\n            if ((callType == 1 && item.slot == arguments[0])\r\n                || (callType == 2 && item.thisObj == arguments[0] && item.slot == arguments[0][arguments[1]])\r\n                || (item.thisObj == arguments[0] && item.slot == arguments[1])\r\n            )\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n    return signal;\r\n}\r\n\r\n\nvar GETTER = \"__defineGetter__\",\r\n    SETTER = \"__defineSetter__\",\r\n    // Property that is currently beeing evaluated. Used to get the information\r\n    // which property called the getter of a certain other property for\r\n    // evaluation and is thus dependant on it.\r\n    evaluatingProperty = undefined,\r\n    // All object constructors\r\n    constructors = {\r\n      int:         QMLInteger,\r\n      real:        Number,\r\n      double:      Number,\r\n      string:      String,\r\n      bool:        Boolean,\r\n      list:        QMLList,\r\n      color:       QMLColor,\r\n      enum:        Number,\r\n      url:         String,\r\n      variant:     QMLVariant,\r\n      'var':       QMLVariant,\r\n      QMLDocument: QMLComponent\r\n    };\r\nvar modules = {\r\n    Main: constructors\r\n  };\r\n\r\n// Helper. Adds a type to the constructor list\r\nglobal.registerGlobalQmlType = function (name, type) {\r\n  global[type.name]  = type;\r\n  constructors[name] = type;\r\n  modules.Main[name] = type;\r\n};\r\n\r\n// Helper. Register a type to a module\r\nglobal.registerQmlType = function(options) {\r\n  if (typeof options != 'object') {\r\n    registerGlobalQmlType(arguments[0], arguments[1]);\r\n  } else {\r\n    var moduleDescriptor = {\r\n      name:        options.name,\r\n      versions:    options.versions,\r\n      constructor: options.constructor\r\n    };\r\n\r\n    if (typeof modules[options.module] == 'undefined')\r\n      modules[options.module] = [];\r\n    modules[options.module].push(moduleDescriptor);\r\n\r\n    if (typeof options.baseClass !== 'undefined') {\r\n      inherit(options.constructor, options.baseClass);\r\n    }\r\n  }\r\n};\r\n\r\nglobal.getConstructor = function (moduleName, version, name) {\r\n  if (typeof modules[moduleName] != 'undefined') {\r\n    for (var i = 0 ; i < modules[moduleName].length ; ++i) {\r\n      var type = modules[moduleName][i];\r\n\r\n      if (type.name == name && type.versions.test(version))\r\n        return type.constructor;\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\nglobal.collectConstructorsForModule = function (moduleName, version) {\r\n  var constructors = {};\r\n\r\n  if (typeof modules[moduleName] == 'undefined') {\r\n    console.warn(\"module `\" + moduleName + \"` not found\");\r\n    return constructors;\r\n  }\r\n  for (var i = 0 ; i < modules[moduleName].length ; ++i) {\r\n    var module = modules[moduleName][i];\r\n\r\n    if (module.versions.test(version)) {\r\n      constructors[module.name] = module.constructor;\r\n    }\r\n  }\r\n  return constructors;\r\n};\r\n\r\nglobal.mergeObjects = function (obj1, obj2) {\r\n  var mergedObject = {};\r\n\r\n  if (typeof obj1 != 'undefined' && obj1 != null) {\r\n    for (var key in obj1) { mergedObject[key] = obj1[key]; }\r\n  }\r\n  if (typeof obj2 != 'undefined' && obj2 != null) {\r\n    for (var key in obj2) { mergedObject[key] = obj2[key]; }\r\n  }\r\n  return mergedObject;\r\n}\r\n\r\nglobal.perContextConstructors = {};\r\n\r\nglobal.loadImports = function (self, imports) {\r\n  constructors = mergeObjects(modules.Main, null);\r\n  for (var i = 0 ; i < imports.length ; ++i) {\r\n    var moduleName = imports[i][1],\r\n        moduleVersion = imports[i][2],\r\n        moduleAlias = imports[i][3],\r\n        moduleConstructors = collectConstructorsForModule(moduleName, moduleVersion);\r\n\r\n    if (moduleAlias !== \"\")\r\n      constructors[moduleAlias] = mergeObjects(constructors[moduleAlias], moduleConstructors);\r\n    else\r\n      constructors = mergeObjects(constructors, moduleConstructors);\r\n  }\r\n  perContextConstructors[self.objectId] = constructors;\r\n}\r\n\r\nglobal.inherit = function(constructor, baseClass) {\r\n  var oldProto = constructor.prototype;\r\n  constructor.prototype = Object.create(baseClass.prototype);\r\n  Object.keys(oldProto).forEach(function(prop) {\r\n    constructor.prototype[prop] = oldProto[prop];\r\n  });\r\n  constructor.prototype.constructor = baseClass;\r\n}\r\n\r\n/**\r\n * QML Object constructor.\r\n * @param {Object} meta Meta information about the object and the creation context\r\n * @return {Object} New qml object\r\n */\r\nfunction construct(meta) {\r\n    var item,\r\n        component;\r\n\r\n    if (meta.object.$class in constructors) {\r\n        item = new constructors[meta.object.$class](meta);\r\n    }\r\n    else {\r\n        // Load component from file. Please look at import.js for main notes.\r\n        // Actually, we have to use that order:\r\n        // 1) try to load component from current basePath\r\n        // 2) from importPathList\r\n        // 3) from directories in imports statements and then\r\n        // 4) from qmldir files\r\n        // Currently we support only 1,2 and 4 and use order: 4,1,2\r\n        // TODO: engine.qmldirs is global for all loaded components. That's not qml's original behaviour.\r\n        var qdirInfo = engine.qmldirs[meta.object.$class]; // Are we have info on that component in some imported qmldir files?\r\n        if (qdirInfo) {\r\n            // We have that component in some qmldir, load it from qmldir's url\r\n            component = Qt.createComponent( \"@\" + qdirInfo.url, meta.context);\r\n        }\r\n        else\r\n            component = Qt.createComponent(meta.object.$class + \".qml\", meta.context);\r\n\r\n        if (component) {\r\n            var item = component.createObject(meta.parent);\r\n\r\n            if (typeof item.dom != 'undefined')\r\n                item.dom.className += \" \" + meta.object.$class + (meta.object.id ? \" \" + meta.object.id : \"\");\r\n            var dProp; // Handle default properties\r\n        } else {\r\n            console.log(\"No constructor found for \" + meta.object.$class);\r\n            return;\r\n        }\r\n    }\r\n\r\n    // id\r\n    if (meta.object.id)\r\n        meta.context[meta.object.id] = item;\r\n\r\n    // keep path in item for probale use it later in Qt.resolvedUrl\r\n    item.$context[\"$basePath\"] = engine.$basePath; //gut\r\n\r\n    // Apply properties (Bindings won't get evaluated, yet)\r\n    applyProperties(meta.object, item, item, item.$context);\r\n\r\n    return item;\r\n}\r\n\r\n/**\r\n * Create property getters and setters for object.\r\n * @param {Object} obj Object for which gsetters will be set\r\n * @param {String} propName Property name\r\n * @param {Object} [options] Options that allow finetuning of the property\r\n */\r\nfunction createSimpleProperty(type, obj, propName, options) {\r\n    var prop = new QMLProperty(type, obj, propName);\r\n    var getter, setter;\r\n\r\n    if (typeof options == 'undefined')\r\n      options = {};\r\n    else if (typeof options != 'object')\r\n      options = { default: options }\r\n\r\n    obj[propName + \"Changed\"] = prop.changed;\r\n    obj.$properties[propName] = prop;\r\n    obj.$properties[propName].set(options.default);\r\n    getter = function()       { return obj.$properties[propName].get(); };\r\n    if (!options.readOnly)\r\n      setter = function(newVal) { return obj.$properties[propName].set(newVal); };\r\n    else {\r\n      setter = function(newVal) {\r\n        if (obj.$canEditReadOnlyProperties != true)\r\n          throw \"property '\" + propName + \"' has read only access\";\r\n        return obj.$properties[propName].set(newVal);\r\n      }\r\n    }\r\n    setupGetterSetter(obj, propName, getter, setter);\r\n    if (obj.$isComponentRoot)\r\n        setupGetterSetter(obj.$context, propName, getter, setter);\r\n}\r\n\r\n/**\r\n * Set up simple getter function for property\r\n */\r\nvar setupGetter,\r\n    setupSetter,\r\n    setupGetterSetter;\r\n(function() {\r\n\r\n// todo: What's wrong with Object.defineProperty on some browsers?\r\n// Object.defineProperty is the standard way to setup getters and setters.\r\n// However, the following way to use Object.defineProperty don't work on some\r\n// webkit-based browsers, namely Safari, iPad, iPhone and Nokia N9 browser.\r\n// Chrome, firefox and opera still digest them fine.\r\n\r\n// So, if the deprecated __defineGetter__ is available, use those, and if not\r\n// use the standard Object.defineProperty (IE for example).\r\n\r\n    var useDefineProperty = !(Object[GETTER] && Object[SETTER]);\r\n\r\n    if (useDefineProperty) {\r\n\r\n        if (!Object.defineProperty) {\r\n            console.log(\"No __defineGetter__ or defineProperty available!\");\r\n        }\r\n\r\n        setupGetter = function(obj, propName, func) {\r\n            Object.defineProperty(obj, propName,\r\n                { get: func, configurable: true, enumerable: true } );\r\n        }\r\n        setupSetter = function(obj, propName, func) {\r\n            Object.defineProperty(obj, propName,\r\n                { set: func, configurable: true, enumerable: false });\r\n        }\r\n        setupGetterSetter = function(obj, propName, getter, setter) {\r\n            Object.defineProperty(obj, propName,\r\n                {get: getter, set: setter, configurable: true, enumerable: false });\r\n        }\r\n    } else {\r\n        setupGetter = function(obj, propName, func) {\r\n            obj[GETTER](propName, func);\r\n        }\r\n        setupSetter = function(obj, propName, func) {\r\n            obj[SETTER](propName, func);\r\n        }\r\n        setupGetterSetter = function(obj, propName, getter, setter) {\r\n            obj[GETTER](propName, getter);\r\n            obj[SETTER](propName, setter);\r\n        }\r\n    }\r\n\r\n})();\r\n/**\r\n * Apply properties from metaObject to item.\r\n * @param {Object} metaObject Source of properties\r\n * @param {Object} item Target of property apply\r\n * @param {Object} objectScope Scope in which properties should be evaluated\r\n * @param {Object} componentScope Component scope in which properties should be evaluated\r\n */\r\nfunction applyProperties(metaObject, item, objectScope, componentScope) {\r\n    var i;\r\n    objectScope = objectScope || item;\r\n    for (i in metaObject) {\r\n        var value = metaObject[i];\r\n        // skip global id's and internal values\r\n        if (i == \"id\" || i[0] == \"$\") {\r\n            continue;\r\n        }\r\n        // slots\r\n        if (i.indexOf(\"on\") == 0 && i[2].toUpperCase() == i[2]) {\r\n            var signalName =  i[2].toLowerCase() + i.slice(3);\r\n            if (!item[signalName]) {\r\n                console.warn(\"No signal called \" + signalName + \" found!\");\r\n                continue;\r\n            }\r\n            else if (typeof item[signalName].connect != 'function') {\r\n                console.warn(signalName + \" is not a signal!\");\r\n                continue;\r\n            }\r\n            if (!value.eval) {\r\n                var params = \"\";\r\n                for (var j in item[signalName].parameters) {\r\n                    params += j==0 ? \"\" : \", \";\r\n                    params += item[signalName].parameters[j].name;\r\n                }\r\n                value.src = \"(function(\" + params + \") {\" + value.src + \"})\";\r\n                value.function = false;\r\n                value.compile();\r\n            }\r\n            item[signalName].connect(item, value.eval(objectScope, componentScope));\r\n            continue;\r\n        }\r\n\r\n        if (value instanceof Object) {\r\n            if (value instanceof QMLSignalDefinition) {\r\n                item[i] = Signal(value.parameters);\r\n                if (item.$isComponentRoot)\r\n                    componentScope[i] = item[i];\r\n                continue;\r\n            } else if (value instanceof QMLMethod) {\r\n                value.compile();\r\n                item[i] = value.eval(objectScope, componentScope);\r\n                if (item.$isComponentRoot)\r\n                    componentScope[i] = item[i];\r\n                continue;\r\n            } else if (value instanceof QMLAliasDefinition) {\r\n                createSimpleProperty(\"alias\", item, i);\r\n                item.$properties[i].componentScope = componentScope;\r\n                item.$properties[i].val = value;\r\n                item.$properties[i].get = function() {\r\n                    var obj = this.componentScope[this.val.objectName];\r\n                    return this.val.propertyName ? obj.$properties[this.val.propertyName].get() : obj;\r\n                }\r\n                item.$properties[i].set = function(newVal, fromAnimation, objectScope, componentScope) {\r\n                    if (!this.val.propertyName)\r\n                        throw \"Cannot set alias property pointing to an QML object.\";\r\n                    this.componentScope[this.val.objectName].$properties[this.val.propertyName].set(newVal, fromAnimation, objectScope, componentScope);\r\n                }\r\n                continue;\r\n            } else if (value instanceof QMLPropertyDefinition) {\r\n                createSimpleProperty(value.type, item, i);\r\n                item.$properties[i].set(value.value, true, objectScope, componentScope);\r\n                continue;\r\n            } else if (item[i] && value instanceof QMLMetaPropertyGroup) {\r\n                // Apply properties one by one, otherwise apply at once\r\n                applyProperties(value, item[i], objectScope, componentScope);\r\n                continue;\r\n            }\r\n        }\r\n        if (item.$properties && i in item.$properties)\r\n            item.$properties[i].set(value, true, objectScope, componentScope);\r\n        else if (i in item)\r\n            item[i] = value;\r\n        else if (item.$setCustomData)\r\n            item.$setCustomData(i, value);\r\n        else\r\n            console.warn(\"Cannot assign to non-existent property \\\"\" + i + \"\\\". Ignoring assignment.\");\r\n    }\r\n    if (metaObject.$children && metaObject.$children.length !== 0) {\r\n        if (item.$defaultProperty)\r\n            item.$properties[item.$defaultProperty].set(metaObject.$children, true, objectScope, componentScope);\r\n        else\r\n            throw \"Cannot assign to unexistant default property\";\r\n    }\r\n    // We purposefully set the default property AFTER using it, in order to only have it applied for\r\n    // instanciations of this component, but not for its internal children\r\n    if (metaObject.$defaultProperty)\r\n        item.$defaultProperty = metaObject.$defaultProperty;\r\n    if (typeof item.completed != 'undefined' && item.completedAlreadyCalled == false) {\r\n      item.completedAlreadyCalled = true;\r\n      item.completed();\r\n    }\r\n}\r\n\r\n// ItemModel. EXPORTED.\r\nJSItemModel = function() {\r\n    this.roleNames = [];\r\n\r\n    this.setRoleNames = function(names) {\r\n        this.roleNames = names;\r\n    }\r\n\r\n    this.dataChanged = Signal([\r\n        {type:\"int\", name:\"startIndex\"},\r\n        {type:\"int\", name:\"endIndex\"}\r\n    ]);\r\n    this.rowsInserted = Signal([\r\n        {type:\"int\", name:\"startIndex\"},\r\n        {type:\"int\", name:\"endIndex\"}\r\n    ]);\r\n    this.rowsMoved = Signal([\r\n        {type:\"int\", name:\"sourceStartIndex\"},\r\n        {type:\"int\", name:\"sourceEndIndex\"},\r\n        {type:\"int\", name:\"destinationIndex\"}\r\n    ]);\r\n    this.rowsRemoved = Signal([\r\n        {type:\"int\", name:\"startIndex\"},\r\n        {type:\"int\", name:\"endIndex\"}\r\n    ]);\r\n    this.modelReset = Signal();\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\n// Stuff below defines QML things\r\n// -----------------------------------------------------------------------------\r\n\r\n// Helper\r\nfunction unboundMethod() {\r\n    console.log(\"Unbound method for\", this);\r\n}\r\n\n(function() {\r\n  global.importJavascriptInContext = function (jsData, $context) {\r\n    with($context) {\r\n      eval(jsData.source);\r\n      for (var i = 0 ; i < jsData.exports.length ; ++i) {\r\n        var symbolName = jsData.exports[i];\r\n        $context[symbolName] = eval(symbolName);\r\n      }\r\n    }\r\n  }\r\n\r\n  global.jsparse = function (source) {\r\n    var obj = { exports: [], source: source };\r\n    var AST_Tree = qmlweb_parse(source, qmlweb_parse.JSResource);\r\n    var foo_function_scope = AST_Tree[2][2][3];\r\n\r\n    for (var i = 0 ; i < foo_function_scope.length ; ++i) {\r\n      var item = foo_function_scope[i];\r\n\r\n      switch (item[0]) {\r\n        case \"var\":\r\n          obj.exports.push(item[1][0][0]);\r\n          break ;\r\n        case \"defun\":\r\n          obj.exports.push(item[1]);\r\n          break ;\r\n      }\r\n    }\r\n    return obj;\r\n  }\r\n\r\n})();\r\n\n// Base object for all qml elements\r\nfunction QMLBaseObject(meta) {\r\n    QObject.call(this, meta.parent);\r\n    var i,\r\n        prop;\r\n\r\n    this.$draw = function(){};\r\n    this.$isComponentRoot = meta.isComponentRoot;\r\n    this.$context = meta.context;\r\n\r\n    // Component.onCompleted\r\n    this.Component = new QObject(this);\r\n    this.Component.completed = Signal([]);\r\n    engine.completedSignals.push(this.Component.completed);\r\n    this.completed = this.Component.completed;\r\n\r\n    this.Component.destruction = Signal([]);\r\n    this.destruction = this.Component.destruction;\r\n\r\n    // Component get own properties\r\n    var attributes = [];\r\n    for (var key in meta.object) {\r\n      if (meta.object.hasOwnProperty(key) &&\r\n          typeof meta.object[key] != 'undefined' && meta.object[key] != null &&\r\n          (meta.object[key].__proto__.constructor.name == 'QMLPropertyDefinition' ||\r\n           meta.object[key].__proto__.constructor.name == 'QMLAliasDefinition')) {\r\n        attributes.push(key);\r\n      }\r\n    }\r\n\r\n    this.Keys = new QObject(this);\r\n    this.Keys.asteriskPresed = Signal();\r\n    this.Keys.backPressed = Signal();\r\n    this.Keys.backtabPressed = Signal();\r\n    this.Keys.callPressed = Signal();\r\n    this.Keys.cancelPressed = Signal();\r\n    this.Keys.deletePressed = Signal();\r\n    for (var i = 0 ; i < 10 ; ++i)\r\n      this.Keys['digit'+i+'Pressed'] = Signal();\r\n    this.Keys.escapePressed = Signal();\r\n    this.Keys.flipPressed = Signal();\r\n    this.Keys.hangupPressed = Signal();\r\n    this.Keys.leftPressed = Signal();\r\n    this.Keys.menuPressed = Signal();\r\n    this.Keys.noPressed = Signal();\r\n    this.Keys.pressed = Signal();\r\n    this.Keys.released = Signal();\r\n    this.Keys.returnPressed = Signal();\r\n    this.Keys.rightPressed = Signal();\r\n    this.Keys.selectPressed = Signal();\r\n    this.Keys.spacePressed = Signal();\r\n    this.Keys.tabPressed = Signal();\r\n    this.Keys.upPressed = Signal();\r\n    this.Keys.volumeDownPressed = Signal();\r\n    this.Keys.volumeUpPressed = Signal();\r\n    this.Keys.yesPressed = Signal();\r\n\r\n    this.getAttributes = function() { return (attributes); }\r\n}\r\n\r\nregisterQmlType({\r\n    module: 'QtQuick',\r\n    name: 'QtObject',\r\n    versions: /.*/,\r\n    constructor: QMLBaseObject\r\n});\r\n\n// TODO\r\nfunction QMLColor(val) {\r\n  if (typeof val === \"number\") {\r\n    // we assume it is int value and must be converted to css hex with padding\r\n    // http://stackoverflow.com/questions/57803/how-to-convert-decimal-to-hex-in-javascript\r\n    val = \"#\" + (Math.round(val) + 0x1000000).toString(16).substr(-6).toUpperCase();\r\n  } else {\r\n    if(typeof val === \"array\" && val.length >= 3) {\r\n      // array like [r,g,b] where r,g,b are in 0..1 range\r\n      var m = 255;\r\n      val = \"rgb(\" + Math.round(m * val[0]) + \",\" + Math.round(m * val[1]) + \",\" + Math.round(m * val[2]) + \")\";\r\n    }\r\n  }\r\n  return val;\r\n};\r\n\nfunction QMLContext() {\r\n    this.nameForObject = function(obj) {\r\n        for (var name in this) {\r\n            if (this[name] == obj)\r\n                return name;\r\n        }\r\n    }\r\n}\r\n\r\nQMLComponent.prototype.createObject = function(parent, properties) {\r\n    var oldState = engine.operationState;\r\n    engine.operationState = QMLOperationState.Init;\r\n    // change base path to current component base path\r\n    var bp = engine.$basePath; engine.$basePath = this.$basePath ? this.$basePath : engine.$basePath;\r\n\r\n    var item = construct({\r\n        object: this.$metaObject,\r\n        parent: parent,\r\n        context: this.$context ? Object.create(this.$context) : new QMLContext(),\r\n        isComponentRoot: true\r\n    });\r\n\r\n    // change base path back\r\n    //TODO looks a bit hacky\r\n    engine.$basePath = bp;\r\n\r\n    engine.operationState = oldState;\r\n    return item;\r\n}\r\n\r\nfunction QMLComponent(meta) {\r\n    if (constructors[meta.object.$class] == QMLComponent)\r\n        this.$metaObject = meta.object.$children[0];\r\n    else\r\n        this.$metaObject = meta.object;\r\n    this.$context = meta.context;\r\n\r\n    var jsImports = [];\r\n\r\n    this.finalizeImports = (function($context) {\r\n      for (var i = 0 ; i < jsImports.length ; ++i) {\r\n        var importDesc = jsImports[i];\r\n        var src = importDesc[1];\r\n        var js;\r\n\r\n        if (typeof qmlEngine.$basePath != 'undefined')\r\n          src = qmlEngine.$basePath + src;\r\n        if (typeof qrc[src] != 'undefined')\r\n          js = qrc[src];\r\n        else\r\n          js = global.jsparse(getUrlContents(src));\r\n        if (importDesc[3] !== \"\") {\r\n          $context[importDesc[3]] = {};\r\n          importJavascriptInContext(js, $context[importDesc[3]]);\r\n        }\r\n        else\r\n          importJavascriptInContext(js, $context);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (meta.object.$imports instanceof Array)\r\n    {\r\n      var moduleImports = [];\r\n      var loadImport    = (function(importDesc) {\r\n        if (/\\.js$/.test(importDesc[1]))\r\n          jsImports.push(importDesc);\r\n        else\r\n          moduleImports.push(importDesc);\r\n      }).bind(this);\r\n\r\n      for (var i = 0 ; i < meta.object.$imports.length ; ++i) {\r\n        loadImport(meta.object.$imports[i]);\r\n      }\r\n      loadImports(this, moduleImports);\r\n      if (typeof this.$context != 'undefined' && this.$context != null)\r\n        this.finalizeImports(this.$context);\r\n    }\r\n}\r\ninherit(QMLComponent, QMLBaseObject);\r\n\r\nregisterQmlType('Component',   QMLComponent);\r\nregisterQmlType('QMLDocument', QMLComponent);\r\n\n/*\r\n * - QMLEngine(element, options) -- Returns new qml engine object, for which:\r\n *   - loadFile(file) -- Load file to the engine (.qml or .qml.js atm)\r\n *   - start() -- start the engine/application\r\n *   - stop() -- stop the engine/application. Restarting is experimental.\r\n *   element is HTMLCanvasElement and options are for debugging.\r\n *   For further reference, see testpad and qml viewer applications.\r\n */\r\n\r\n// There can only be one running QMLEngine. This variable points to the currently running engine.\r\nvar engine = null;\r\n\r\n// QML engine. EXPORTED.\r\nQMLEngine = function (element, options) {\r\n//----------Public Members----------\r\n    this.fps = 60;\r\n    this.$interval = Math.floor(1000 / this.fps); // Math.floor, causes bugs to timing?\r\n    this.running = false;\r\n\r\n    // Mouse Handling\r\n    this.mouseAreas = [];\r\n    this.oldMousePos = {x:0, y:0};\r\n\r\n    // List of available Components\r\n    this.components = {};\r\n\r\n    this.rootElement = element;\r\n\r\n    // List of Component.completed signals\r\n    this.completedSignals = [];\r\n\r\n    // Current operation state of the engine (Idle, init, etc.)\r\n    this.operationState = 1;\r\n\r\n    // List of properties whose values are bindings. For internal use only.\r\n    this.bindedProperties = [];\r\n\r\n    // Root object of the engine\r\n    this.rootObject = null;\r\n\r\n    // Base path of qml engine (used for resource loading)\r\n    this.$basePath = \"\";\r\n\r\n\r\n//----------Public Methods----------\r\n    // Start the engine\r\n    this.start = function()\r\n    {\r\n        engine = this;\r\n        var i;\r\n        if (this.operationState !== QMLOperationState.Running) {\r\n            this.operationState = QMLOperationState.Running;\r\n            tickerId = setInterval(tick, this.$interval);\r\n            for (i = 0; i < whenStart.length; i++) {\r\n                whenStart[i]();\r\n            }\r\n        }\r\n    }\r\n\r\n    // Stop the engine\r\n    this.stop = function()\r\n    {\r\n        var i;\r\n        if (this.operationState == QMLOperationState.Running) {\r\n            element.removeEventListener(\"touchstart\", touchHandler);\r\n            element.removeEventListener(\"mousemove\", mousemoveHandler);\r\n            clearInterval(tickerId);\r\n            this.operationState = QMLOperationState.Idle;\r\n            for (i = 0; i < whenStop.length; i++) {\r\n                whenStop[i]();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    this.ensureFileIsLoadedInQrc = function(file) {\r\n      if (!qrc.includesFile(file)) {\r\n        var src = getUrlContents(file);\r\n\r\n        if (src) {\r\n            console.log('Loading file [', file, ']');\r\n            qrc[file] = qmlparse(src);\r\n        } else {\r\n            console.log('Can not load file [', file, ']');\r\n        }\r\n      }\r\n    }\r\n\r\n    this.extractBasePath = function( file ) {\r\n       var basePath = file.split(/[\\/\\\\]/); // work both in url (\"/\") and windows (\"\\\", from file://d:\\test\\) notation\r\n       basePath[basePath.length - 1] = \"\";\r\n       basePath = basePath.join(\"/\");\r\n       return basePath;\r\n    }\r\n    // Load file, parse and construct (.qml or .qml.js)\r\n    this.loadFile = function(file) {\r\n        var tree;\r\n\r\n        this.$basePath = this.extractBasePath(file);\r\n        this.ensureFileIsLoadedInQrc(file);\r\n        tree = convertToEngine(qrc[file]);\r\n        this.loadQMLTree(tree);\r\n    }\r\n\r\n    // parse and construct qml\r\n    this.loadQML = function(src) {\r\n        this.loadQMLTree(parseQML(src));\r\n    }\r\n\r\n    this.loadQMLTree = function(tree, file) {\r\n        engine = this;\r\n        if (options.debugTree) {\r\n            options.debugTree(tree);\r\n        }\r\n\r\n        // Create and initialize objects\r\n        var component = new QMLComponent({ object: tree, parent: null });\r\n\r\n        this.loadImports( tree.$imports );\r\n        component.$basePath = engine.$basePath;\r\n        component.$imports = tree.$imports; // for later use\r\n        component.$file = file; // just for debugging\r\n\r\n        this.rootObject = component.createObject(null);\r\n        component.finalizeImports(this.rootContext());\r\n        this.$initializePropertyBindings();\r\n\r\n        this.start();\r\n\r\n        // Call completed signals\r\n        for (var i in this.completedSignals) {\r\n            this.completedSignals[i]();\r\n        }\r\n    }\r\n\r\n    /** from http://docs.closure-library.googlecode.com/git/local_closure_goog_uri_uri.js.source.html\r\n     *\r\n     * Removes dot segments in given path component, as described in\r\n     * RFC 3986, section 5.2.4.\r\n     *\r\n     * @param {string} path A non-empty path component.\r\n     * @return {string} Path component with removed dot segments.\r\n     */\r\n    this.removeDotSegments = function(path) {\r\n        var leadingSlash = (path && path[0] == \"/\");   // path.startsWith('/'); -- startsWith seems to be undefined in some browsers\r\n        var segments = path.split('/');\r\n        var out = [];\r\n\r\n        for (var pos = 0; pos < segments.length; ) {\r\n            var segment = segments[pos++];\r\n\r\n            if (segment == '.') {\r\n                if (leadingSlash && pos == segments.length) {\r\n                    out.push('');\r\n                }\r\n            } else if (segment == '..') {\r\n                if (out.length > 1 || out.length == 1 && out[0] != '') {\r\n                    out.pop();\r\n                }\r\n                if (leadingSlash && pos == segments.length) {\r\n                    out.push('');\r\n                }\r\n            } else {\r\n                out.push(segment);\r\n                leadingSlash = true;\r\n            }\r\n        }\r\n\r\n        return out.join('/');\r\n    };\r\n\r\n    /*\r\n      engine.loadImports( imports, currentDir ) : performs loading of qmldir files from given qml import records.\r\n\r\n      Input:\r\n      * parameter `importsArray` - import statements. It is in parser notation, e.g. [import1, import2, ...] where each importN is also array: [\"qmlimport\",\"name\",version,as,isQualifiedName]\r\n      * parameter `currentFileDir` - base dir for imports lookup. It will be used together with importPathList()\r\n\r\n      Implicit input:\r\n      * engine object function `importPathList()` - list of urls bases used for qmldir files lookup\r\n\r\n      Additional implicit input/output:\r\n      * engine object variable `qmldirsContents` - used for caching, e.g. memory for previously loaded qmldir files\r\n\r\n      Output: \r\n      * engine object variable `qmldirs` - new records will be added there\r\n\r\n      Return value: \r\n      * nothing\r\n\r\n      Details:\r\n\r\n      For each of given import statements, loadImports \r\n      1. computes qmldir file location according to http://doc.qt.io/qt-5/qtqml-syntax-imports.html\r\n      2. calls `readQmlDir` for actual reading and parsing of qmldir file content\r\n      3. gets `external` declarations of that qmldir file and pushes them to `engine.qmldirs` hash.\r\n\r\n      `engine.qmldirs` is a hash of form: { componentName => componentFileUrl }\r\n      This hash then used by `qml.js::construct` method for computing component urls.\r\n\r\n      Notes:\r\n      1. This method is not suited for loading js imports. This may be done probably after answering to Q1 (below).\r\n      2. Please look for additional notes at readQmlDir function.\r\n\r\n      QNA\r\n      Q1: How and where in engine component names might be prefixed? E.g. names with dot inside: SomeModule.Component1\r\n      A1: Seems it doesn't matter. Seems we may just save name with dot-inside right to qmldirs, and it may be used by construct() seamlessly. Check it..\r\n\r\n      Q2: How we may access component object from here, to store qmldirs info in components logical scope, and not at engine scope?\r\n      A2: Probably, answer is in Component.js and in global.loadImports\r\n\r\n      TODO \r\n      * We have to keep output in component scope, not in engine scope.\r\n      * We have to add module \"as\"-names to component's names (which is possible after keeping imports in component scope).\r\n      * Determine how this stuff is related to `global.loadImports`\r\n      * Check A1\r\n      * Make a complete picture of what going in with imports, including Component.js own imports loading\r\n      * Note importJs method in import.js \r\n    */\r\n\r\n    this.loadImports = function(importsArray, currentFileDir) {\r\n        if (!this.qmldirsContents) this.qmldirsContents = { \"QtQuick\":{}, \"QtQuick.Controls\":{} }; // cache\r\n        // putting initial keys in qmldirsContents - is a hack. We should find a way to explain to qmlweb, is this built-in module or qmldir-style module.\r\n\r\n        if (!this.qmldirs) this.qmldirs = {};                 // resulting components lookup table\r\n\r\n        if (!importsArray || importsArray.length == 0) return;\r\n        if (!currentFileDir) currentFileDir = this.$basePath;     // use this.$basePath by default\r\n\r\n        for (var i=0; i<importsArray.length; i++) {\r\n            var entry = importsArray[i];\r\n\r\n            var name = entry[1];\r\n\r\n            var nameIsUrl = name.indexOf(\"//\") == 0 || name.indexOf(\"://\") >= 0;  // is it url to remote resource\r\n            var nameIsQualifiedModuleName = entry[4]; // e.g. QtQuick, QtQuick.Controls, etc\r\n            var nameIsDir = !nameIsQualifiedModuleName && !nameIsUrl; // local [relative] dir\r\n\r\n            if (nameIsDir) {\r\n                // resolve name from relative to full dir path\r\n                // we hope all dirs are relative\r\n                name = this.removeDotSegments( currentFileDir + name );\r\n                if (name[ name.length-1 ] == \"/\")\r\n                    name = name.substr( 0, name.length-1 ); // remove trailing slash as it required for `readQmlDir`\r\n            }\r\n            // TODO if nameIsDir, we have also to add `name` to importPathList() for current component...\r\n\r\n            // check if we have already loaded that qmldir file\r\n            if (this.qmldirsContents[ name ]) continue;\r\n\r\n            var content = false;\r\n            if (nameIsQualifiedModuleName && this.userAddedModulePaths && this.userAddedModulePaths[ name ]) {\r\n                // 1. we have qualified module and user had configured path for that module with this.addModulePath\r\n                content = readQmlDir( this.userAddedModulePaths[ name ] );\r\n            }\r\n            else if (nameIsUrl || nameIsDir)\r\n            {\r\n                // 2. direct load\r\n                // nameIsUrl => url do not need dirs\r\n                // nameIsDir => already computed full path above\r\n                content = readQmlDir( name );\r\n            }\r\n            else\r\n            {\r\n                // 3. qt-style lookup for qualified module\r\n                var probableDirs = [currentFileDir].concat( this.importPathList() )\r\n                var diredName = name.replace( /\\./g,\"/\" );\r\n\r\n                for (var k=0; k<probableDirs.length; k++) {\r\n                    var file = probableDirs[k] + diredName;\r\n                    content = readQmlDir( file );\r\n                    if (content) break;\r\n                }\r\n            }\r\n\r\n            if (!content) {\r\n                console.log(\"qmlengine::loadImports: cannot load qmldir file for import name=\",name );\r\n                // save blank info, meaning that we failed to load import\r\n                // this prevents repeated lookups\r\n                this.qmldirsContents[ name ] = {};\r\n\r\n               // NEW\r\n               // add that dir to import path list\r\n               // that means, lookup qml files in that failed dir by trying to load them directly\r\n               // this is not the same behavior as in Qt for \"url\" schemes,\r\n               // but it is same as for ordirnal disk files. \r\n               // So, we do it for experimental purposes.\r\n               if (nameIsDir) \r\n                 this.addImportPath( name + \"/\" );\r\n\r\n               continue;\r\n            }\r\n\r\n            // copy founded externals to global var\r\n            // TODO actually we have to copy it to current component\r\n            for (var attrname in content.externals) { this.qmldirs[attrname] = content.externals[attrname]; }\r\n\r\n            // keep already loaded qmldir files\r\n            this.qmldirsContents[ name ] = content;\r\n        }\r\n\r\n    }\r\n\r\n    this.rootContext = function() {\r\n      return this.rootObject.$context;\r\n    }\r\n\r\n    this.focusedElement = (function() {\r\n      return this.rootContext().activeFocus;\r\n    }).bind(this);\r\n\r\n    // KEYBOARD MANAGEMENT\r\n    var keyboardSignals = {};\r\n    keyboardSignals[Qt.Key_Asterisk]   = 'asteriskPressed';\r\n    keyboardSignals[Qt.Key_Back]       = 'backPressed';\r\n    keyboardSignals[Qt.Key_Backtab]    = 'backtabPressed';\r\n    keyboardSignals[Qt.Key_Call]       = 'callPressed';\r\n    keyboardSignals[Qt.Key_Cancel]     = 'cancelPressed';\r\n    keyboardSignals[Qt.Key_Delete]     = 'deletePressed';\r\n    keyboardSignals[Qt.Key_0]          = 'digit0Pressed';\r\n    keyboardSignals[Qt.Key_1]          = 'digit1Pressed';\r\n    keyboardSignals[Qt.Key_2]          = 'digit2Pressed';\r\n    keyboardSignals[Qt.Key_3]          = 'digit3Pressed';\r\n    keyboardSignals[Qt.Key_4]          = 'digit4Pressed';\r\n    keyboardSignals[Qt.Key_5]          = 'digit5Pressed';\r\n    keyboardSignals[Qt.Key_6]          = 'digit6Pressed';\r\n    keyboardSignals[Qt.Key_7]          = 'digit7Pressed';\r\n    keyboardSignals[Qt.Key_8]          = 'digit8Pressed';\r\n    keyboardSignals[Qt.Key_9]          = 'digit9Pressed';\r\n    keyboardSignals[Qt.Key_Escape]     = 'escapePressed';\r\n    keyboardSignals[Qt.Key_Flip]       = 'flipPressed';\r\n    keyboardSignals[Qt.Key_Hangup]     = 'hangupPressed';\r\n    keyboardSignals[Qt.Key_Menu]       = 'menuPressed';\r\n    keyboardSignals[Qt.Key_No]         = 'noPressed';\r\n    keyboardSignals[Qt.Key_Return]     = 'returnPressed';\r\n    keyboardSignals[Qt.Key_Select]     = 'selectPressed';\r\n    keyboardSignals[Qt.Key_Space]      = 'spacePressed';\r\n    keyboardSignals[Qt.Key_Tab]        = 'tabPressed';\r\n    keyboardSignals[Qt.Key_VolumeDown] = 'volumeDownPressed';\r\n    keyboardSignals[Qt.Key_VolumeUp]   = 'volumeUpPressed';\r\n    keyboardSignals[Qt.Key_Yes]        = 'yesPressed';\r\n    keyboardSignals[Qt.Key_Up]         = 'upPressed';\r\n    keyboardSignals[Qt.Key_Right]      = 'rightPressed';\r\n    keyboardSignals[Qt.Key_Down]       = 'downPressed';\r\n    keyboardSignals[Qt.Key_Left]       = 'leftPressed';\r\n\r\n    function keyCodeToQt(e) {\r\n      if (e.keyCode >= 96 && e.keyCode <= 111) {\r\n        e.keypad = true;\r\n      }\r\n      if (e.keyCode == Qt.Key_Tab && e.shiftKey == true)\r\n        return Qt.Key_Backtab;\r\n      else if (e.keyCode >= 97 && e.keyCode <= 122)\r\n        return e.keyCode - (97 - Qt.Key_A);\r\n      return e.keyCode;\r\n    }\r\n\r\n    function eventToKeyboard(e) {\r\n        return {\r\n            accepted: false,\r\n            count: 1,\r\n            isAutoRepeat: false,\r\n            key: keyCodeToQt(e),\r\n            modifiers: (e.ctrlKey * Qt.CtrlModifier)\r\n                    | (e.altKey   * Qt.AltModifier)\r\n                    | (e.shiftKey * Qt.ShiftModifier)\r\n                    | (e.metaKey  * Qt.MetaModifier)\r\n                    | (e.keypad   * Qt.KeypadModifier),\r\n            text: String.fromCharCode(e.charCode)\r\n        };\r\n    }\r\n\r\n    document.onkeypress = (function(e) {\r\n      var focusedElement = this.focusedElement();\r\n      var event          = eventToKeyboard(e || window.event);\r\n      var eventName      = keyboardSignals[event.key];\r\n\r\n      while (event.accepted != true && focusedElement != null) {\r\n        var backup       = focusedElement.$context.event;\r\n\r\n        focusedElement.$context.event = event;\r\n        focusedElement.Keys.pressed(event);\r\n        if (eventName != null)\r\n          focusedElement.Keys[eventName](event);\r\n        focusedElement.$context.event = backup;\r\n        if (event.accepted == true)\r\n          e.preventDefault();\r\n        else\r\n          focusedElement = focusedElement.$parent;\r\n      }\r\n    }).bind(this);\r\n\r\n    document.onkeyup = (function(e) {\r\n      var focusedElement = this.focusedElement();\r\n      var event          = eventToKeyboard(e || window.event);\r\n\r\n      while (event.accepted != true && focusedElement != null) {\r\n        var backup       = focusedElement.$context.event;\r\n\r\n        focusedElement.$context.event = event;\r\n        focusedElement.Keys.released(event);\r\n        focusedElement.$context.event = backup;\r\n        if (event.accepted == true)\r\n          e.preventDefault();\r\n        else\r\n          focusedElement = focusedElement.$parent;\r\n      }\r\n    }).bind(this);\r\n    // END KEYBOARD MANAGEMENT\r\n\r\n    this.registerProperty = function(obj, propName)\r\n    {\r\n        var dependantProperties = [];\r\n        var value = obj[propName];\r\n\r\n        function getter() {\r\n            if (evaluatingProperty && dependantProperties.indexOf(evaluatingProperty) == -1)\r\n                dependantProperties.push(evaluatingProperty);\r\n\r\n            return value;\r\n        }\r\n\r\n        function setter(newVal) {\r\n            value = newVal;\r\n\r\n            for (i in dependantProperties)\r\n                dependantProperties[i].update();\r\n        }\r\n\r\n        setupGetterSetter(obj, propName, getter, setter);\r\n    }\r\n\r\n    // next 3 methods used in Qt.createComponent for qml files lookup\r\n    // please open qt site for documentation\r\n    // http://doc.qt.io/qt-5/qqmlengine.html#addImportPath\r\n\r\n    this.addImportPath = function( dirpath ) {\r\n        if (!this.userAddedImportPaths) this.userAddedImportPaths = [];\r\n        this.userAddedImportPaths.push( dirpath );\r\n    }\r\n\r\n    this.setImportPathList = function( arrayOfDirs )\r\n    {\r\n        this.userAddedImportPaths = arrayOfDirs;\r\n    }\r\n\r\n    this.importPathList = function() {\r\n        return (this.userAddedImportPaths || []);\r\n    }\r\n\r\n    // `addModulePath` defines conrete path for module lookup\r\n    // e.g. addModulePath( \"QtQuick.Controls\",\"http://someserver.com/controls\" )\r\n    // will force system to `import QtQuick.Controls` module from `http://someserver.com/controls/qmldir`\r\n\r\n    this.addModulePath = function( moduleName, dirPath ) {\r\n\r\n        // remove trailing slash as it required for `readQmlDir`\r\n        if (dirPath[ dirPath.length-1 ] == \"/\")\r\n            dirPath = dirPath.substr( 0, dirPath.length-1 );\r\n\r\n        // keep the mapping. It will be used in loadImports() function .\r\n        if (!this.userAddedModulePaths) this.userAddedModulePaths = {};\r\n        this.userAddedModulePaths[ moduleName ] = dirPath;\r\n    }\r\n\r\n//Intern\r\n\r\n    // Load file, parse and construct as Component (.qml)\r\n    this.loadComponent = function(name)\r\n    {\r\n        if (name in this.components)\r\n            return this.components[name];\r\n\r\n        var file = qmlEngine.$basePath + name + \".qml\";\r\n\r\n        this.ensureFileIsLoadedInQrc(file);\r\n        tree = convertToEngine(qrc[file]);\r\n        this.components[name] = tree;\r\n        return tree;\r\n    }\r\n\r\n    this.$initializePropertyBindings = function() {\r\n        // Initialize property bindings\r\n        for (var i = 0; i < this.bindedProperties.length; i++) {\r\n            var property = this.bindedProperties[i];\r\n            property.binding.compile();\r\n            property.update();\r\n        }\r\n        this.bindedProperties = [];\r\n    }\r\n\r\n    this.$getTextMetrics = function(text, fontCss)\r\n    {\r\n        canvas.save();\r\n        canvas.font = fontCss;\r\n        var metrics = canvas.measureText(text);\r\n        canvas.restore();\r\n        return metrics;\r\n    }\r\n\r\n    // Return a path to load the file\r\n    this.$resolvePath = function(file)\r\n    {\r\n        // probably, replace :// with :/ ?\r\n        if (file == \"\" || file.indexOf(\"://\") != -1 || file.indexOf(\"/\") == 0 || file.indexOf(\"data:\") == 0 || file.indexOf(\"blob:\") == 0) {\r\n            return file;\r\n        }\r\n        return this.$basePath + file;\r\n    }\r\n\r\n    this.$registerStart = function(f)\r\n    {\r\n        whenStart.push(f);\r\n    }\r\n\r\n    this.$registerStop = function(f)\r\n    {\r\n        whenStop.push(f);\r\n    }\r\n\r\n    this.$addTicker = function(t)\r\n    {\r\n        tickers.push(t);\r\n    }\r\n\r\n    this.$removeTicker = function(t)\r\n    {\r\n        var index = tickers.indexOf(t);\r\n        if (index != -1) {\r\n            tickers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    this.size = function()\r\n    {\r\n        return { width: this.rootObject.getWidth(), height: this.rootObject.getHeight() };\r\n    }\r\n\r\n    // Performance measurements\r\n    this.$perfDraw = function(canvas)\r\n    {\r\n        this.rootObject.$draw(canvas);\r\n    }\r\n\r\n//----------Private Methods----------\r\n    // In JS we cannot easily access public members from\r\n    // private members so self acts as a bridge\r\n    var self = this;\r\n\r\n    // Listen also to touchstart events on supporting devices\r\n    // Makes clicks more responsive (do not wait for click event anymore)\r\n    function touchHandler(e)\r\n    {\r\n        // preventDefault also disables pinching and scrolling while touching\r\n        // on qml application\r\n        e.preventDefault();\r\n        var at = {\r\n            layerX: e.touches[0].pageX - element.offsetLeft,\r\n            layerY: e.touches[0].pageY - element.offsetTop,\r\n            button: 1\r\n        }\r\n        element.onclick(at);\r\n\r\n    }\r\n\r\n    function mousemoveHandler(e)\r\n    {\r\n        var i;\r\n        for (i in self.mouseAreas) {\r\n            var l = self.mouseAreas[i];\r\n            if (l && l.hoverEnabled\r\n                  && (self.oldMousePos.x >= l.left\r\n                      && self.oldMousePos.x <= l.right\r\n                      && self.oldMousePos.y >= l.top\r\n                      && self.oldMousePos.y <= l.bottom)\r\n                  && !(e.pageX - element.offsetLeft >= l.left\r\n                       && e.pageX - element.offsetLeft <= l.right\r\n                       && e.pageY - element.offsetTop >= l.top\r\n                       && e.pageY - element.offsetTop <= l.bottom) )\r\n                l.exited();\r\n        }\r\n        for (i in self.mouseAreas) {\r\n            var l = self.mouseAreas[i];\r\n            if (l && l.hoverEnabled\r\n                  && (e.pageX - element.offsetLeft >= l.left\r\n                      && e.pageX - element.offsetLeft <= l.right\r\n                      && e.pageY - element.offsetTop >= l.top\r\n                      && e.pageY - element.offsetTop <= l.bottom)\r\n                  && !(self.oldMousePos.x >= l.left\r\n                       && self.oldMousePos.x <= l.right\r\n                       && self.oldMousePos.y >= l.top\r\n                       && self.oldMousePos.y <= l.bottom))\r\n                l.entered();\r\n        }\r\n        self.oldMousePos = { x: e.pageX - element.offsetLeft,\r\n                            y: e.pageY - element.offsetTop };\r\n    }\r\n\r\n    function tick()\r\n    {\r\n        var i,\r\n            now = (new Date).getTime(),\r\n            elapsed = now - lastTick;\r\n        lastTick = now;\r\n        for (i = 0; i < tickers.length; i++) {\r\n            tickers[i](now, elapsed);\r\n        }\r\n    }\r\n\r\n\r\n//----------Private Members----------\r\n    // Target canvas\r\n    var // Callbacks for stopping or starting the engine\r\n        whenStop = [],\r\n        whenStart = [],\r\n        // Ticker resource id and ticker callbacks\r\n        tickerId,\r\n        tickers = [],\r\n        lastTick = new Date().getTime(),\r\n        i;\r\n\r\n\r\n//----------Construct----------\r\n\r\n    options = options || {};\r\n\r\n    if (options.debugConsole) {\r\n        // Replace QML-side console.log\r\n        console = {};\r\n        console.log = function() {\r\n            var args = Array.prototype.slice.call(arguments);\r\n            options.debugConsole.apply(undefined, args);\r\n        };\r\n    }\r\n}\r\n\r\n\nfunction QMLInteger(val) {\r\n    return (val|0);\r\n}\r\n\nfunction QMLItem(meta) {\r\n    QMLBaseObject.call(this, meta);\r\n    var child,\r\n        o, i;\r\n\r\n    this.completed = Signal();\r\n    this.completedAlreadyCalled = false;\r\n\r\n    if (this.$parent === null) { // This is the root element. Initialize it.\r\n        this.dom = engine.rootElement || document.body;\r\n        this.dom.innerHTML = \"\";\r\n        var self = this;\r\n        this.dom.style.position = \"relative\"; // Needed to make absolute positioning work\r\n        this.dom.style.top = \"0\";\r\n        this.dom.style.left = \"0\";\r\n        this.dom.style.overflow = \"hidden\"; // No QML stuff should stand out the root element\r\n    } else {\r\n        if (!this.dom) // Create a dom element for this item.\r\n            this.dom = document.createElement(\"div\");\r\n        this.dom.style.position = \"absolute\";\r\n    }\r\n    this.dom.style.pointerEvents = \"none\";\r\n    this.dom.className = meta.object.$class + (this.id ? \" \" + this.id : \"\");\r\n    this.dom.qml = this;\r\n    this.css = this.dom.style;\r\n\r\n    this.css.boxSizing = 'border-box';\r\n\r\n    createSimpleProperty(\"list\", this, \"data\");\r\n    this.$defaultProperty = \"data\";\r\n    createSimpleProperty(\"list\", this, \"children\");\r\n    createSimpleProperty(\"list\", this, \"resources\");\r\n    createSimpleProperty(\"Item\", this, \"parent\");\r\n    this.children = [];\r\n    this.resources = [];\r\n    this.parentChanged.connect(this, function(newParent, oldParent) {\r\n        if (oldParent) {\r\n            oldParent.children.splice(oldParent.children.indexOf(this), 1);\r\n            oldParent.childrenChanged();\r\n            oldParent.dom.removeChild(this.dom);\r\n        }\r\n        if (newParent && newParent.children.indexOf(this) == -1) {\r\n            newParent.children.push(this);\r\n            newParent.childrenChanged();\r\n        }\r\n        if (newParent)\r\n            newParent.dom.appendChild(this.dom);\r\n    });\r\n    this.parentChanged.connect(this, updateHGeometry);\r\n    this.parentChanged.connect(this, updateVGeometry);\r\n    this.dataChanged.connect(this, function(newData) {\r\n        for (var i in newData) {\r\n            var child = newData[i];\r\n            if (child.hasOwnProperty(\"parent\")) // Seems to be an Item. TODO: Use real inheritance and ask using instanceof.\r\n                child.parent = this; // This will also add it to children.\r\n            else\r\n                this.resources.push(child);\r\n        }\r\n    });\r\n\r\n    if (this.$isComponentRoot)\r\n      createSimpleProperty(\"var\", this, \"activeFocus\");\r\n    createSimpleProperty(\"real\", this, \"x\");\r\n    createSimpleProperty(\"real\", this, \"y\");\r\n    createSimpleProperty(\"real\", this, \"width\");\r\n    createSimpleProperty(\"real\", this, \"height\");\r\n    createSimpleProperty(\"real\", this, \"implicitWidth\");\r\n    createSimpleProperty(\"real\", this, \"implicitHeight\");\r\n    createSimpleProperty(\"real\", this, \"left\");\r\n    createSimpleProperty(\"real\", this, \"right\");\r\n    createSimpleProperty(\"real\", this, \"top\");\r\n    createSimpleProperty(\"real\", this, \"bottom\");\r\n    createSimpleProperty(\"real\", this, \"horizontalCenter\");\r\n    createSimpleProperty(\"real\", this, \"verticalCenter\");\r\n    createSimpleProperty(\"real\", this, \"rotation\");\r\n    createSimpleProperty(\"real\", this, \"scale\");\r\n    createSimpleProperty(\"real\", this, \"z\");\r\n    createSimpleProperty(\"list\", this, \"transform\");\r\n    createSimpleProperty(\"bool\", this, \"visible\");\r\n    createSimpleProperty(\"real\", this, \"opacity\");\r\n    createSimpleProperty(\"bool\", this, \"clip\");\r\n    createSimpleProperty(\"bool\", this, \"focus\");\r\n    this.xChanged.connect(this, updateHGeometry);\r\n    this.yChanged.connect(this, updateVGeometry);\r\n    this.widthChanged.connect(this, updateHGeometry);\r\n    this.heightChanged.connect(this, updateVGeometry);\r\n    this.implicitWidthChanged.connect(this, updateHGeometry);\r\n    this.implicitHeightChanged.connect(this, updateVGeometry);\r\n    this.focus = false;\r\n\r\n    this.setupFocusOnDom = (function(element) {\r\n      var updateFocus = (function() {\r\n        var hasFocus = document.activeElement == this.dom || document.activeElement == this.dom.firstChild;\r\n\r\n        if (this.focus != hasFocus)\r\n          this.focus = hasFocus;\r\n      }).bind(this);\r\n      element.addEventListener(\"focus\", updateFocus);\r\n      element.addEventListener(\"blur\",  updateFocus);\r\n    }).bind(this);\r\n\r\n    this.focusChanged.connect(this, (function(newVal) {\r\n      if (newVal == true) {\r\n        if (this.dom.firstChild != null)\r\n          this.dom.firstChild.focus();\r\n        document.qmlFocus = this;\r\n        this.$context.activeFocus = this;\r\n      } else if (document.qmlFocus == this) {\r\n        document.getElementsByTagName(\"BODY\")[0].focus();\r\n        document.qmlFocus = qmlEngine.rootContext().base;\r\n        this.$context.activeFocus = null;\r\n      }\r\n    }).bind(this));\r\n\r\n    this.$isUsingImplicitWidth = true;\r\n    this.$isUsingImplicitHeight = true;\r\n\r\n    this.anchors = new QObject(this);\r\n    createSimpleProperty(\"real\", this.anchors, \"left\");\r\n    createSimpleProperty(\"real\", this.anchors, \"right\");\r\n    createSimpleProperty(\"real\", this.anchors, \"top\");\r\n    createSimpleProperty(\"real\", this.anchors, \"bottom\");\r\n    createSimpleProperty(\"real\", this.anchors, \"horizontalCenter\");\r\n    createSimpleProperty(\"real\", this.anchors, \"verticalCenter\");\r\n    createSimpleProperty(\"real\", this.anchors, \"fill\");\r\n    createSimpleProperty(\"real\", this.anchors, \"centerIn\");\r\n    createSimpleProperty(\"real\", this.anchors, \"margins\");\r\n    createSimpleProperty(\"real\", this.anchors, \"leftMargin\");\r\n    createSimpleProperty(\"real\", this.anchors, \"rightMargin\");\r\n    createSimpleProperty(\"real\", this.anchors, \"topMargin\");\r\n    createSimpleProperty(\"real\", this.anchors, \"bottomMargin\");\r\n    this.anchors.leftChanged.connect(this, updateHGeometry);\r\n    this.anchors.rightChanged.connect(this, updateHGeometry);\r\n    this.anchors.topChanged.connect(this, updateVGeometry);\r\n    this.anchors.bottomChanged.connect(this, updateVGeometry);\r\n    this.anchors.horizontalCenterChanged.connect(this, updateHGeometry);\r\n    this.anchors.verticalCenterChanged.connect(this, updateVGeometry);\r\n    this.anchors.fillChanged.connect(this, updateHGeometry);\r\n    this.anchors.fillChanged.connect(this, updateVGeometry);\r\n    this.anchors.centerInChanged.connect(this, updateHGeometry);\r\n    this.anchors.centerInChanged.connect(this, updateVGeometry);\r\n    this.anchors.leftMarginChanged.connect(this, updateHGeometry);\r\n    this.anchors.rightMarginChanged.connect(this, updateHGeometry);\r\n    this.anchors.topMarginChanged.connect(this, updateVGeometry);\r\n    this.anchors.bottomMarginChanged.connect(this, updateVGeometry);\r\n    this.anchors.marginsChanged.connect(this, updateHGeometry);\r\n    this.anchors.marginsChanged.connect(this, updateVGeometry);\r\n\r\n    createSimpleProperty(\"list\", this, \"states\");\r\n    createSimpleProperty(\"string\", this, \"state\");\r\n    createSimpleProperty(\"list\", this, \"transitions\");\r\n    this.stateChanged.connect(this, function(newVal, oldVal) {\r\n        var oldState, newState, i, j, k;\r\n        for (i = 0; i < this.states.length; i++)\r\n            if (this.states[i].name === newVal)\r\n                newState = this.states[i];\r\n            else if (this.states[i].name === oldVal)\r\n                oldState = this.states[i];\r\n\r\n        var actions = this.$revertActions.slice();\r\n\r\n        // Get current values for revert actions\r\n        for (i in actions) {\r\n            var action  = actions[i];\r\n            action.from = action.target[action.property];\r\n        }\r\n        if (newState) {\r\n            var changes = newState.$getAllChanges();\r\n\r\n            // Get all actions we need to do and create actions to revert them\r\n            for (i = 0; i < changes.length; i++) {\r\n                var change = changes[i];\r\n\r\n                for (j = 0; j < change.$actions.length; j++) {\r\n                    var item = change.$actions[j];\r\n\r\n                    var action = {\r\n                        target: change.target,\r\n                        property: item.property,\r\n                        origValue: change.target.$properties[item.property].binding\r\n                                    || change.target.$properties[item.property].val,\r\n                        value: item.value,\r\n                        from: change.target[item.property],\r\n                        to: undefined,\r\n                        explicit: change.explicit\r\n                    };\r\n                    var found = false;\r\n                    for (k in actions)\r\n                        if (actions[k].target == action.target\r\n                            && actions[k].property == action.property) {\r\n                            found = true;\r\n                            actions[k] = action;\r\n                            break;\r\n                        }\r\n                    if (!found)\r\n                        actions.push(action);\r\n\r\n                    // Look for existing revert action, else create it\r\n                    var found = false;\r\n                    for (k = 0; k < this.$revertActions.length; k++)\r\n                        if (this.$revertActions[k].target == change.target\r\n                            && this.$revertActions[k].property == item.property) {\r\n                            if (!change.restoreEntryValues)\r\n                                this.$revertActions.splice(k, 1); // We don't want to revert, so remove it\r\n                            found = true;\r\n                            break;\r\n                        }\r\n                    if (!found && change.restoreEntryValues)\r\n                        this.$revertActions.push({\r\n                            target: change.target,\r\n                            property: item.property,\r\n                            value: change.target.$properties[item.property].binding\r\n                                        || change.target.$properties[item.property].val,\r\n                            from: undefined,\r\n                            to: change.target[item.property]\r\n                        });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Set all property changes and fetch the actual values afterwards\r\n        // The latter is needed for transitions. We need to set all properties\r\n        // before we fetch the values because properties can be interdependent.\r\n        for (i in actions) {\r\n            var action = actions[i];\r\n            action.target.$properties[action.property].set(action.value, false, action.target,\r\n                                                           newState ? newState.$context: action.target.$context);\r\n        }\r\n        for (i in actions) {\r\n            var action = actions[i];\r\n            action.to = action.target[action.property];\r\n            if (action.explicit) {\r\n                action.target[action.property] = action.target[action.property]; //Remove binding\r\n                action.value = action.target[action.property];\r\n            }\r\n        }\r\n\r\n        // Find the best transition to use\r\n        var transition,\r\n            rating = 0;\r\n        for (var i = 0; i < this.transitions.length; i++) {\r\n            this.transitions[i].$stop(); // We need to stop running transitions, so let's do\r\n                                        // it while iterating through the transitions anyway\r\n            var curTransition = this.transitions[i],\r\n                curRating = 0;\r\n            if (curTransition.from == oldVal || curTransition.reversible && curTransition.from == newVal)\r\n                curRating += 2;\r\n            else if (curTransition.from == \"*\")\r\n                curRating++;\r\n            else\r\n                continue;\r\n            if (curTransition.to == newVal || curTransition.reversible && curTransition.to == oldVal)\r\n                curRating += 2;\r\n            else if (curTransition.to == \"*\")\r\n                curRating++;\r\n            else\r\n                continue;\r\n            if (curRating > rating) {\r\n                rating = curRating;\r\n                transition = curTransition;\r\n            }\r\n        }\r\n        if (transition)\r\n            transition.$start(actions);\r\n    });\r\n\r\n    var QMLRotation  = getConstructor('QtQuick', '2.0', 'Rotation');\r\n    var QMLScale     = getConstructor('QtQuick', '2.0', 'Scale');\r\n    var QMLTranslate = getConstructor('QtQuick', '2.0', 'Translate');\r\n\r\n    this.$updateTransform = function() {\r\n            var transform = \"rotate(\" + this.rotation + \"deg) scale(\" + this.scale + \")\";\r\n            var filter = \"\";\r\n            var transformStyle = \"preserve-3d\";\r\n\r\n            for (var i = 0; i < this.transform.length; i++) {\r\n                var t = this.transform[i];\r\n                if (t instanceof QMLRotation)\r\n                    transform += \" rotate3d(\" + t.axis.x + \", \" + t.axis.y + \", \" + t.axis.z + \", \" + t.angle + \"deg)\";\r\n                else if (t instanceof QMLScale)\r\n                    transform += \" scale(\" + t.xScale + \", \" + t.yScale + \")\";\r\n                else if (t instanceof QMLTranslate)\r\n                    transform += \" translate(\" + t.x + \"px, \" + t.y + \"px)\";\r\n                else if (typeof t.transformType != 'undefined') {\r\n                    if (t.transformType == 'filter')\r\n                      filter += t.operation + '(' + t.parameters + ') ';\r\n                }\r\n                else if (typeof t == 'string')\r\n                    transform += t;\r\n            }\r\n            if (typeof this.z == \"number\")\r\n              transform += \" translate3d(0, 0, \" + this.z + \"px)\";\r\n            this.dom.style.transform = transform;\r\n            this.dom.style.transformStyle = transformStyle;\r\n            this.dom.style.MozTransform = transform;    // Firefox\r\n            this.dom.style.webkitTransform = transform; // Chrome, Safari and Opera\r\n            this.dom.style.webkitTransformStyle = transformStyle;\r\n            this.dom.style.OTransform = transform;      // Opera\r\n            this.dom.style.msTransform = transform;     // IE\r\n            this.dom.style.filter = filter;\r\n            this.dom.style.msFilter = filter;     // IE\r\n            this.dom.style.webkitFilter = filter; // Chrome, Safari and Opera\r\n            this.dom.style.MozFilter = filter;    // Firefox\r\n    }\r\n    this.rotationChanged.connect(this, this.$updateTransform);\r\n    this.scaleChanged.connect(this, this.$updateTransform);\r\n    this.transformChanged.connect(this, this.$updateTransform);\r\n    this.visibleChanged.connect(this, function(newVal) {\r\n        this.css.visibility = newVal ? \"inherit\" : \"hidden\";\r\n    });\r\n    this.opacityChanged.connect(this, function(newVal) {\r\n        this.css.opacity = newVal;\r\n    });\r\n    this.clipChanged.connect(this, function(newVal) {\r\n        this.css.overflow = newVal ? \"hidden\" : \"visible\";\r\n    });\r\n    this.zChanged.connect(this, function(newVal) {\r\n        this.$updateTransform();\r\n    });\r\n    this.xChanged.connect(this, function(newVal) {\r\n        this.css.left = newVal + \"px\";\r\n    });\r\n    this.yChanged.connect(this, function(newVal) {\r\n        this.css.top = newVal + \"px\";\r\n    });\r\n    this.widthChanged.connect(this, function(newVal) {\r\n        this.css.width = newVal ? newVal + \"px\" : \"auto\";\r\n    });\r\n    this.heightChanged.connect(this, function(newVal) {\r\n        this.css.height = newVal ? newVal + \"px\" : \"auto\";\r\n    });\r\n\r\n    this.implicitHeight = 0;\r\n    this.implicitWidth = 0;\r\n    this.spacing = 0;\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.anchors.margins = 0;\r\n    this.visible = true;\r\n    this.opacity = 1;\r\n    this.$revertActions = [];\r\n    this.states = [];\r\n    this.transitions = [];\r\n    this.state = \"\";\r\n    this.transform = [];\r\n    this.rotation = 0;\r\n    this.scale = 1;\r\n\r\n    // Init size of root element\r\n    if (this.$parent === null) {\r\n        if (engine.rootElement == undefined) {\r\n            window.onresize = function() {\r\n                self.implicitHeight = window.innerHeight;\r\n                self.implicitWidth = window.innerWidth;\r\n            }\r\n            window.onresize();\r\n        } else {\r\n            this.implicitHeight = this.dom.offsetHeight;\r\n            this.implicitWidth = this.dom.offsetWidth;\r\n        }\r\n    }\r\n\r\n    this.$draw = function(c) {\r\n        var i;\r\n        if (this.visible !== false) { // Undefined means inherit, means true\r\n            if (this.$drawItem ) {\r\n                var rotRad = (this.rotation || 0) / 180 * Math.PI,\r\n                    rotOffsetX = Math.sin(rotRad) * this.width,\r\n                    rotOffsetY = Math.sin(rotRad) * this.height;\r\n                c.save();\r\n\r\n                // Handle rotation\r\n                // todo: implement transformOrigin\r\n                c.globalAlpha = this.opacity;\r\n                c.translate(this.left + rotOffsetX, this.top + rotOffsetY);\r\n                c.rotate(rotRad);\r\n                c.translate(-this.left, -this.top);\r\n                // Leave offset for drawing...\r\n                this.$drawItem(c);\r\n                c.translate(-rotOffsetX, -rotOffsetY);\r\n                c.restore();\r\n            }\r\n            for (i = 0; i < this.children.length; i++) {\r\n                if (this.children[i]\r\n                    && this.children[i].$draw) {\r\n                    this.children[i].$draw(c);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\ninherit(QMLItem, QMLBaseObject);\r\n\r\nconstructors['Item'] = QMLItem;\r\n\n\nfunction QMLList(meta) {\r\n    var list = [];\r\n    if (meta.object instanceof Array)\r\n        for (var i in meta.object)\r\n            list.push(construct({object: meta.object[i], parent: meta.parent, context: meta.context }));\r\n    else if (meta.object instanceof QMLMetaElement)\r\n        list.push(construct({object: meta.object, parent: meta.parent, context: meta.context }));\r\n\r\n    return list;\r\n}\r\n\nQMLOperationState = {\r\n    Idle: 1,\r\n    Init: 2,\r\n    Running: 3\r\n};\r\n\nfunction QMLPositioner(meta) {\r\n    QMLItem.call(this, meta);\r\n\r\n    createSimpleProperty(\"int\", this, \"spacing\");\r\n    this.spacingChanged.connect(this, this.layoutChildren);\r\n    this.childrenChanged.connect(this, this.layoutChildren);\r\n    this.childrenChanged.connect(this, QMLPositioner.slotChildrenChanged);\r\n\r\n    this.spacing = 0;\r\n}\r\ninherit(QMLPositioner, QMLItem);\r\n\r\nQMLPositioner.slotChildrenChanged = function() {\r\n    for (var i = 0; i < this.children.length; i++) {\r\n        var child = this.children[i];\r\n        if (!child.widthChanged.isConnected(this, this.layoutChildren))\r\n            child.widthChanged.connect(this, this.layoutChildren);\r\n        if (!child.heightChanged.isConnected(this, this.layoutChildren))\r\n            child.heightChanged.connect(this, this.layoutChildren);\r\n        if (!child.visibleChanged.isConnected(this, this.layoutChildren))\r\n            child.visibleChanged.connect(this, this.layoutChildren);\r\n        if (!child.opacityChanged.isConnected(this, this.layoutChildren))\r\n            child.opacityChanged.connect(this, this.layoutChildren);\r\n    }\r\n}\r\n\r\n\nfunction QMLProperty(type, obj, name) {\r\n    this.obj = obj;\r\n    this.name = name;\r\n    this.changed = Signal([], {obj:obj});\r\n    this.binding = null;\r\n    this.objectScope = null;\r\n    this.componentScope = null;\r\n    this.value = undefined;\r\n    this.type = type;\r\n    this.animation = null;\r\n\r\n    // This list contains all signals that hold references to this object.\r\n    // It is needed when deleting, as we need to tidy up all references to this object.\r\n    this.$tidyupList = [];\r\n}\r\n\r\n// Updater recalculates the value of a property if one of the\r\n// dependencies changed\r\nQMLProperty.prototype.update = function() {\r\n    if (!this.binding)\r\n        return;\r\n\r\n    var oldVal = this.val;\r\n    evaluatingProperty = this;\r\n    this.val = this.binding.eval(this.objectScope, this.componentScope);\r\n    evaluatingProperty = undefined;\r\n\r\n    if (this.animation) {\r\n        this.animation.$actions = [{\r\n            target: this.animation.target || this.obj,\r\n            property: this.animation.property || this.name,\r\n            from: this.animation.from || oldVal,\r\n            to: this.animation.to || this.val\r\n        }];\r\n        this.animation.restart();\r\n    }\r\n\r\n    if (this.val !== oldVal)\r\n        this.changed(this.val, oldVal, this.name);\r\n}\r\n\r\n// Define getter\r\nQMLProperty.prototype.get = function() {\r\n    // If this call to the getter is due to a property that is dependant on this\r\n    // one, we need it to take track of changes\r\n    if (evaluatingProperty && !this.changed.isConnected(evaluatingProperty, QMLProperty.prototype.update))\r\n        this.changed.connect(evaluatingProperty, QMLProperty.prototype.update);\r\n\r\n    return this.val;\r\n}\r\n\r\n// Define setter\r\nQMLProperty.prototype.set = function(newVal, fromAnimation, objectScope, componentScope) {\r\n    var i,\r\n        oldVal = this.val;\r\n\r\n    if (newVal instanceof QMLBinding) {\r\n        if (!objectScope || !componentScope)\r\n            throw \"Internal error: binding assigned without scope\";\r\n        this.binding = newVal;\r\n        this.objectScope = objectScope;\r\n        this.componentScope = componentScope;\r\n\r\n        if (engine.operationState !== QMLOperationState.Init) {\r\n            if (!newVal.eval)\r\n                newVal.compile();\r\n\r\n            evaluatingProperty = this;\r\n            newVal = this.binding.eval(objectScope, componentScope);\r\n            evaluatingProperty = null;\r\n        } else {\r\n            engine.bindedProperties.push(this);\r\n            return;\r\n        }\r\n    } else {\r\n        if (!fromAnimation)\r\n            this.binding = null;\r\n        if (newVal instanceof Array)\r\n            newVal = newVal.slice(); // Copies the array\r\n    }\r\n\r\n    if (constructors[this.type] == QMLList) {\r\n        this.val = QMLList({ object: newVal, parent: this.obj, context: componentScope });\r\n    } else if (newVal instanceof QMLMetaElement) {\r\n        if (constructors[newVal.$class] == QMLComponent || constructors[this.type] == QMLComponent)\r\n            this.val = new QMLComponent({ object: newVal, parent: this.obj, context: componentScope });\r\n        else\r\n            this.val = construct({ object: newVal, parent: this.obj, context: componentScope });\r\n    } else if (newVal instanceof Object || !newVal) {\r\n        this.val = newVal;\r\n    } else {\r\n        this.val = constructors[this.type](newVal);\r\n    }\r\n\r\n    if (this.val !== oldVal) {\r\n        if (this.animation && !fromAnimation) {\r\n            this.animation.running = false;\r\n            this.animation.$actions = [{\r\n                target: this.animation.target || this.obj,\r\n                property: this.animation.property || this.name,\r\n                from: this.animation.from || oldVal,\r\n                to: this.animation.to || this.val\r\n            }];\r\n            this.animation.running = true;\r\n        }\r\n        if (this.obj.$syncPropertyToRemote instanceof Function && !fromAnimation) { // is a remote object from e.g. a QWebChannel\r\n            this.obj.$syncPropertyToRemote(this.name, newVal);\r\n        } else {\r\n            this.changed(this.val, oldVal, this.name);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\nfunction QMLPropertyChanges(meta) {\r\n    QMLBaseObject.call(this, meta);\r\n\r\n    createSimpleProperty(\"QtObject\", this, \"target\");\r\n    createSimpleProperty(\"bool\", this, \"explicit\");\r\n    createSimpleProperty(\"bool\", this, \"restoreEntryValues\");\r\n\r\n    this.explicit = false;\r\n    this.restoreEntryValues = true;\r\n    this.$actions = [];\r\n\r\n    this.$setCustomData = function(propName, value) {\r\n        this.$actions.push({\r\n            property: propName,\r\n            value: value\r\n        });\r\n    }\r\n}\r\ninherit(QMLPropertyChanges, QMLBaseObject);\r\n\r\nregisterQmlType('PropertyChanges', QMLPropertyChanges);\r\n\nfunction QMLVariant(val) {\r\n    return val;\r\n}\r\n\n// Base object for all qml thingies\r\nvar objectIds = 0;\r\nfunction QObject(parent) {\r\n    this.$parent = parent;\r\n    if (parent && parent.$tidyupList)\r\n        parent.$tidyupList.push(this);\r\n    // List of things to tidy up when deleting this object.\r\n    this.$tidyupList = [];\r\n    this.$properties = {};\r\n\r\n    this.objectId = objectIds++;\r\n    this.$delete = function() {\r\n        if (this.$Component)\r\n          this.$Component.destruction();\r\n\r\n        while (this.$tidyupList.length > 0) {\r\n            var item = this.$tidyupList[0];\r\n            if (item.$delete) // It's a QObject\r\n                item.$delete();\r\n            else // It must be a signal\r\n                item.disconnect(this);\r\n        }\r\n\r\n        for (var i in this.$properties) {\r\n            var prop = this.$properties[i];\r\n            while (prop.$tidyupList.length > 0)\r\n                prop.$tidyupList[0].disconnect(prop);\r\n        }\r\n\r\n        if (this.$parent && this.$parent.$tidyupList)\r\n            this.$parent.$tidyupList.splice(this.$parent.$tidyupList.indexOf(this), 1);\r\n\r\n        // must do this:\r\n        // 1) parent will be notified and erase object from it's children.\r\n        // 2) DOM node will be removed.\r\n        this.parent = undefined;\r\n    }\r\n}\r\n\nfunction updateHGeometry(newVal, oldVal, propName) {\r\n    var anchors = this.anchors || this;\r\n    if (this.$updatingGeometry)\r\n        return;\r\n    this.$updatingGeometry = true;\r\n\r\n    var t, w, width, x, left, hC, right,\r\n        lM = anchors.leftMargin || anchors.margins,\r\n        rM = anchors.rightMargin || anchors.margins;\r\n\r\n    // Width\r\n    if (this.$isUsingImplicitWidth && propName == \"implicitWidth\")\r\n        width = this.implicitWidth;\r\n    else if (propName == \"width\")\r\n        this.$isUsingImplicitWidth = false;\r\n\r\n    // Position TODO: Layouts\r\n    if ((t = anchors.fill) !== undefined) {\r\n        if (!t.$properties.left.changed.isConnected(this, updateHGeometry))\r\n            t.$properties.left.changed.connect(this, updateHGeometry);\r\n        if (!t.$properties.width.changed.isConnected(this, updateHGeometry))\r\n            t.$properties.width.changed.connect(this, updateHGeometry);\r\n\r\n        this.$isUsingImplicitWidth = false;\r\n        width = t.width - lM - rM;\r\n        x = t.left - (this.parent ? this.parent.left : 0) + lM;\r\n        left = t.left + lM;\r\n        right = t.right - rM;\r\n        hC = (left + right) / 2;\r\n    } else if ((t = anchors.centerIn) !== undefined) {\r\n        if (!t.$properties.horizontalCenter.changed.isConnected(this, updateHGeometry))\r\n            t.$properties.horizontalCenter.changed.connect(this, updateHGeometry);\r\n\r\n        w = width || this.width;\r\n        hC = t.horizontalCenter;\r\n        x = hC - w / 2 - (this.parent ? this.parent.left : 0);\r\n        left = hC - w / 2;\r\n        right = hC + w / 2;\r\n    } else if ((t = anchors.left) !== undefined) {\r\n        left = t + lM\r\n        if ((u = anchors.right) !== undefined) {\r\n            right = u - rM;\r\n            this.$isUsingImplicitWidth = false;\r\n            width = right - left;\r\n            x = left - (this.parent ? this.parent.left : 0);\r\n            hC = (right + left) / 2;\r\n        } else if ((hC = anchors.horizontalCenter) !== undefined) {\r\n            this.$isUsingImplicitWidth = false;\r\n            width = (hC - left) * 2;\r\n            x = left - (this.parent ? this.parent.left : 0);\r\n            right = 2 * hC - left;\r\n        } else {\r\n            w = width || this.width;\r\n            x = left - (this.parent ? this.parent.left : 0);\r\n            right = left + w;\r\n            hC = left + w / 2;\r\n        }\r\n    } else if ((t = anchors.right) !== undefined) {\r\n        right = t - rM;\r\n        if ((hC = anchors.horizontalCenter) !== undefined) {\r\n            this.$isUsingImplicitWidth = false;\r\n            width = (right - hC) * 2;\r\n            x = 2 * hC - right - (this.parent ? this.parent.left : 0);\r\n            left = 2 * hC - right;\r\n        } else {\r\n            w = width || this.width;\r\n            x = right - w - (this.parent ? this.parent.left : 0);\r\n            left = right - w;\r\n            hC = right - w / 2;\r\n        }\r\n    } else if ((hC = anchors.horizontalCenter) !== undefined) {\r\n        w = width || this.width;\r\n        x = hC - w / 2 - (this.parent ? this.parent.left : 0);\r\n        left = hC - w / 2;\r\n        right = hC + w / 2;\r\n    } else {\r\n        if (this.parent && !this.parent.$properties.left.changed.isConnected(this, updateHGeometry))\r\n            this.parent.$properties.left.changed.connect(this, updateHGeometry);\r\n\r\n        w = width || this.width;\r\n        left = this.x + (this.parent ? this.parent.left : 0);\r\n        right = left + w;\r\n        hC = left + w / 2;\r\n    }\r\n\r\n    if (left !== undefined)\r\n        this.left = left;\r\n    if (hC !== undefined)\r\n        this.horizontalCenter = hC;\r\n    if (right !== undefined)\r\n        this.right = right;\r\n    if (x !== undefined)\r\n        this.x = x;\r\n    if (width !== undefined)\r\n        this.width = width;\r\n\r\n    this.$updatingGeometry = false;\r\n}\r\n\r\nfunction updateVGeometry(newVal, oldVal, propName) {\r\n    var anchors = this.anchors || this;\r\n    if (this.$updatingGeometry)\r\n        return;\r\n    this.$updatingGeometry = true;\r\n\r\n    var t, w, height, y, top, vC, bottom,\r\n        tM = anchors.topMargin || anchors.margins,\r\n        bM = anchors.bottomMargin || anchors.margins;\r\n\r\n    // Height\r\n    if (this.$isUsingImplicitHeight && propName == \"implicitHeight\")\r\n        height = this.implicitHeight;\r\n    else if (propName == \"height\")\r\n        this.$isUsingImplicitHeight = false;\r\n\r\n    // Position TODO: Layouts\r\n    if ((t = anchors.fill) !== undefined) {\r\n        if (!t.$properties.top.changed.isConnected(this, updateVGeometry))\r\n            t.$properties.top.changed.connect(this, updateVGeometry);\r\n        if (!t.$properties.height.changed.isConnected(this, updateVGeometry))\r\n            t.$properties.height.changed.connect(this, updateVGeometry);\r\n\r\n        this.$isUsingImplicitHeight = false;\r\n        height = t.height - tM - bM;\r\n        y = t.top - (this.parent ? this.parent.top : 0) + tM;\r\n        top = t.top + tM;\r\n        bottom = t.bottom - bM;\r\n        vC = (top + bottom) / 2;\r\n    } else if ((t = anchors.centerIn) !== undefined) {\r\n        if (!t.$properties.verticalCenter.changed.isConnected(this, updateVGeometry))\r\n            t.$properties.verticalCenter.changed.connect(this, updateVGeometry);\r\n\r\n        w = height || this.height;\r\n        vC = t.verticalCenter;\r\n        y = vC - w / 2 - (this.parent ? this.parent.top : 0);\r\n        top = vC - w / 2;\r\n        bottom = vC + w / 2;\r\n    } else if ((t = anchors.top) !== undefined) {\r\n        top = t + tM\r\n        if ((u = anchors.bottom) !== undefined) {\r\n            bottom = u - bM;\r\n            this.$isUsingImplicitHeight = false;\r\n            height = bottom - top;\r\n            y = top - (this.parent ? this.parent.top : 0);\r\n            vC = (bottom + top) / 2;\r\n        } else if ((vC = anchors.verticalCenter) !== undefined) {\r\n            this.$isUsingImplicitHeight = false;\r\n            height = (vC - top) * 2;\r\n            y = top - (this.parent ? this.parent.top : 0);\r\n            bottom = 2 * vC - top;\r\n        } else {\r\n            w = height || this.height;\r\n            y = top - (this.parent ? this.parent.top : 0);\r\n            bottom = top + w;\r\n            vC = top + w / 2;\r\n        }\r\n    } else if ((t = anchors.bottom) !== undefined) {\r\n        bottom = t - bM;\r\n        if ((vC = anchors.verticalCenter) !== undefined) {\r\n            this.$isUsingImplicitHeight = false;\r\n            height = (bottom - vC) * 2;\r\n            y = 2 * vC - bottom - (this.parent ? this.parent.top : 0);\r\n            top = 2 * vC - bottom;\r\n        } else {\r\n            w = height || this.height;\r\n            y = bottom - w - (this.parent ? this.parent.top : 0);\r\n            top = bottom - w;\r\n            vC = bottom - w / 2;\r\n        }\r\n    } else if ((vC = anchors.verticalCenter) !== undefined) {\r\n        w = height || this.height;\r\n        y = vC - w / 2 - (this.parent ? this.parent.top : 0);\r\n        top = vC - w / 2;\r\n        bottom = vC + w / 2;\r\n    } else {\r\n        if (this.parent && !this.parent.$properties.top.changed.isConnected(this, updateVGeometry))\r\n            this.parent.$properties.top.changed.connect(this, updateVGeometry);\r\n\r\n        w = height || this.height;\r\n        top = this.y + (this.parent ? this.parent.top : 0);\r\n        bottom = top + w;\r\n        vC = top + w / 2;\r\n    }\r\n\r\n    if (top !== undefined)\r\n        this.top = top;\r\n    if (vC !== undefined)\r\n        this.verticalCenter = vC;\r\n    if (bottom !== undefined)\r\n        this.bottom = bottom;\r\n    if (y !== undefined)\r\n        this.y = y;\r\n    if (height !== undefined)\r\n        this.height = height;\r\n\r\n    this.$updatingGeometry = false;\r\n}\r\n\r\n\r\n\nregisterQmlType({\r\n  module:   'QmlWeb',\r\n  name:     'RestModel',\r\n  versions: /.*/,\r\n  baseClass: QMLItem,\r\n  constructor: function QMLRestModel(meta) {\r\n    QMLItem.call(this, meta);\r\n    var self = this;\r\n    var attributes = this.getAttributes();\r\n\r\n    createSimpleProperty(\"string\", this, \"url\");\r\n    createSimpleProperty(\"bool\",   this, \"isLoading\");\r\n    createSimpleProperty(\"string\", this, \"mimeType\");\r\n    createSimpleProperty(\"string\", this, \"queryMimeType\");\r\n\r\n    this.mimeType      = \"application/json\";\r\n    this.queryMimeType = \"application/x-www-urlencoded\";\r\n    this.isLoading     = false;\r\n    this.attributes    = attributes;\r\n\r\n    this.fetched = Signal();\r\n    this.saved   = Signal();\r\n\r\n    this.runningRequests = 0;\r\n\r\n    this.fetch = function() {\r\n      ajax({\r\n        method:   'GET',\r\n        mimeType: self.mimetype,\r\n        success: function(xhr) {\r\n          xhrReadResponse(xhr);\r\n          self.fetched();\r\n        }\r\n      });\r\n    };\r\n\r\n    this.create = function() {\r\n      sendToServer('POST');\r\n    };\r\n\r\n    this.save = function() {\r\n      sendToServer('PUT');\r\n    };\r\n\r\n    function sendToServer(method) {\r\n      var body = generateBodyForPostQuery();\r\n\r\n      ajax({\r\n        method:   method,\r\n        mimeType: self.queryMimeType,\r\n        body:     body,\r\n        success:  function(xhr) {\r\n          xhrReadResponse(xhr);\r\n          self.saved();\r\n        }\r\n      });\r\n    }\r\n\r\n    this.remove = function() {\r\n      ajax({\r\n        method: 'DELETE',\r\n        success: function(xhr) {\r\n          self.destroy();\r\n        }\r\n      });\r\n    };\r\n\r\n    function generateBodyForPostQuery() {\r\n      var object     = {};\r\n      var body;\r\n\r\n      for (var i = 0 ; i < self.attributes.length ; ++i)\r\n        object[self.attributes[i]] = self.$properties[self.attributes[i]].get();\r\n      console.log(object);\r\n      if (self.queryMimeType == 'application/json' || self.queryMimeType == 'text/json')\r\n        body = JSON.stringify(object);\r\n      else if (self.queryMimeType == 'application/x-www-urlencoded')\r\n        body = objectToUrlEncoded(object);\r\n      return body;\r\n    }\r\n\r\n    function myEncodeURIComponent(str) {\r\n      return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {\r\n        return '%' + c.charCodeAt(0).toString(16);\r\n      });\r\n    }\r\n\r\n    function objectToUrlEncoded(object, prefix) {\r\n      var str = '';\r\n      for (var key in object) {\r\n        if (object.hasOwnProperty(key)) {\r\n          var value = object[key];\r\n          if (str != '')\r\n            str += '&';\r\n          if (typeof prefix != 'undefined')\r\n            key  = prefix + '[' + key + ']';\r\n          if (typeof value == 'object')\r\n            str += objectToUrlEncoded(value, key);\r\n          else\r\n            str += myEncodeURIComponent(key) + '=' + myEncodeURIComponent(value);\r\n        }\r\n      }\r\n      return str;\r\n    }\r\n\r\n    function ajax(options) {\r\n      var xhr = new XMLHttpRequest();\r\n\r\n      xhr.overrideMimeType(self.mimeType);\r\n      xhr.onreadystatechange = function() {\r\n        if (xhr.readyState == XMLHttpRequest.DONE) {\r\n          if (xhr.status == 200)\r\n            options.success(xhr);\r\n          else\r\n            options.failure(xhr);\r\n          self.runningRequests -= 1;\r\n          if (self.runningRequests <= 0)\r\n            self.isLoading = false;\r\n        }\r\n      }\r\n      xhr.open(options.method, self.url, true);\r\n      if (typeof options.body != 'undefined') {\r\n        xhr.setRequestHeader('Content-Type', self.queryMimeType);\r\n        xhr.send(options.body);\r\n      }\r\n      else\r\n        xhr.send(null);\r\n      self.runningRequests += 1;\r\n      self.isLoading = true;\r\n    }\r\n\r\n    function xhrReadResponse(xhr) {\r\n      var responseObject;\r\n\r\n      if (self.mimeType == 'application/json' || self.mimeType == 'text/json') {\r\n        responseObject = JSON.parse(xhr.responseText);\r\n      }\r\n      updatePropertiesFromResponseObject(responseObject);\r\n    }\r\n\r\n    function updatePropertiesFromResponseObject(responseObject) {\r\n      for (var key in responseObject) {\r\n        if (responseObject.hasOwnProperty(key) && self.$hasProperty(key)) {\r\n          self.$properties[key].set(responseObject[key]);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.$hasProperty = function(name) {\r\n      return (typeof self.$properties[name] != 'undefined');\r\n    }\r\n  }\r\n});\r\n\nregisterQmlType({\r\n  module: 'QtQuick',\r\n  name:   'Settings',\r\n  versions: /.*/,\r\n  baseClass: QMLItem,\r\n  constructor: function QMLSettings(meta) {\r\n    QMLItem.call(this, meta);\r\n\r\n    createSimpleProperty(\"string\", this, \"category\");\r\n\r\n    if (typeof window.localStorage == 'undefined')\r\n      return ;\r\n\r\n    var attributes;\r\n\r\n    var getKey = (function(attrName) {\r\n      return this.category + '/' + attrName;\r\n    }).bind(this);\r\n\r\n    var loadProperties = (function() {\r\n      for (var i = 0 ; i < attributes.length ; ++i) {\r\n        this[attributes[i]] = localStorage.getItem(getKey(attributes[i]));\r\n      }\r\n    }).bind(this);\r\n\r\n    var initializeProperties = (function() {\r\n      for (var i = 0 ; i < attributes.length ; ++i) {\r\n        var attrName   = attributes[i];\r\n        var signalName = attrName + 'Changed';\r\n        var emitter    = this;\r\n\r\n        if (this.$properties[attrName].type == 'alias') {\r\n          emitter    = this.$context[this.$properties[attrName].val.objectName];\r\n          signalName = this.$properties[attrName].val.propertyName + 'Changed';\r\n        }\r\n        emitter[signalName].connect(this, (function() {\r\n          localStorage.setItem(getKey(this.attrName), this.self[this.attrName]);\r\n        }).bind({ self: this, attrName: attrName }));\r\n      }\r\n    }).bind(this);\r\n\r\n    this.Component.completed.connect(this, (function() {\r\n      attributes = this.getAttributes();\r\n      loadProperties();\r\n      initializeProperties();\r\n    }).bind(this));\r\n  }\r\n});\r\n\n})(typeof global != 'undefined' ? global : typeof window != 'undefined' ? window : this);"],"sourceRoot":"/source/"}